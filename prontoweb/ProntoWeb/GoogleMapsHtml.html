
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="initial-scale=1.0" />
    <style type="text/css">
         /* Always set the map height explicitly to define the size of the div
        * element that contains the map. */
         #map {
             height: 100%;
         }
         /* Optional: Makes the sample page fill the window. */
         html, body {
             height: 100%;
             margin: 0;
             padding: 0;
         }
    </style>
</head>
<body id="map-container">
    <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/themes/smoothness/jquery-ui.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js"></script>

    <!--<script src="https://cdn.rawgit.com/googlemaps/v3-utility-library/master/infobox/src/infobox.js"></script>-->

    <!--<script type="text/javascript"
            src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDWNbUasHY_ay5SMIpz02pu534Y1cif72k&libraries=visualization&callback=initMap">
    </script>-->



    <div id="map"></div>



    <script>

        //https://developers.google.com/maps/documentation/javascript/shapes#circle_add
        //https://developers.google.com/maps/documentation/javascript/heatmaplayer


        var map



        function initMap() {
     

            map = new google.maps.Map(document.getElementById('map'), {
                center: { lat: -32, lng: -60 },
                zoom: 6
            });


            datos();
        }







        function datos() {

            var dataRows;
            //var dataRows = [{
            //    id: 1,
            //    geom: "LINESTRING(-1.131510412 52.65531, -1.13286 52.65559)"
            //}];

            $.ajax({
                type: 'POST',
                contentType: 'application/json; charset=utf-8',
                url: "WebServiceCartas.asmx/MapaGeoJSON",
                dataType: 'json',
                //data: JSON.stringify({
                //    idcarta: gridId,
                //    idsituacion: datos.idsituacion,
                //    sObservacionesSituacion: dataFromTheRow.ObservacionesSituacion
                //}),
                success: function (result) {
                    var dat = JSON.parse(result.d);
                    var heatMapData = [];// [ { location: new google.maps.LatLng(0, 0), weight: 0 } ] ;
                    var hcont = 0;

                    for (var city in dat) {
                        // Add the circle for this city to the map.
                        if (dat[city].lat==null) continue;

                        var pos = { lat: dat[city].lat, lng: dat[city].lng }

                        if (true) {
                            //var mapLabel = new MapLabel({
                            //    text: dat[city].ProcedenciaDesc,
                            //    position: new google.maps.LatLng(dat[city].lat, dat[city].lng),
                            //    map: map,
                            //    fontSize: 35,
                            //    align: 'right'
                            //});
                            //mapLabel.set('position', new google.maps.LatLng(dat[city].lat, dat[city].lng));


                            var marker = new google.maps.Marker({
                                position: { lat: dat[city].lat, lng: dat[city].lng },
                                label: dat[city].ProcedenciaDesc,
                                map: map
                            });



                            var circle = new google.maps.Circle({

                                strokeColor: '#FF0000',
                                strokeOpacity: 0.8,
                                strokeWeight: 2,
                                fillColor: '#FF0000',
                                fillOpacity: 0.35,
                                map: map,

                                center: { lat: dat[city].lat, lng: dat[city].lng },
                                radius: Math.sqrt(dat[city].total) * 50

                            });

                            circle.bindTo('center', marker, 'position');
                            marker.setVisible(false);


                            //var labelText = "1";
                            //var myOptions = {
                            //    content: dat[city].ProcedenciaDesc,
                            //    boxStyle: {
                            //        border: "none",
                            //        textAlign: "center",
                            //        fontSize: "10pt",
                            //        width: "50px"
                            //    },
                            //    disableAutoPan: true,
                            //    pixelOffset: new google.maps.Size(-25, -5),
                            //    position: pos,
                            //    closeBoxURL: "",
                            //    isHidden: false,
                            //    pane: "floatPane",
                            //    enableEventPropagation: true
                            //};

                            //var ibLabel = new InfoBox(myOptions);
                            //ibLabel.open(map);



                        }
                        else {

                            var h = { location: new google.maps.LatLng(dat[city].lat, dat[city].lng), weight: Math.sqrt(dat[city].total) * 100000 };
                            heatMapData[hcont] = h;
                            hcont++;
                        }
                    }


                    var heatmap = new google.maps.visualization.HeatmapLayer({
                        data: heatMapData
                    });
                    heatmap.setMap(map);


                },
                error: function (xhr, textStatus, exceptionThrown) {
                },
            });









            //features = [];
            //dataRows.forEach(function (row) {
            //    var coords = row.geom.replace("(", "[").replace(")", "]").substring(row.geom.indexOf("("), row.geom.length);
            //    features.push({
            //        "type": "Feature",
            //        "properties": {
            //            "id": row.id
            //        },
            //        "geometry": {
            //            "type": row.geom.substring(0, row.geom.indexOf("(")),
            //            "coordinates": coords
            //        }
            //    });
            //});

            //return features;
        }







        function geocode() {
            var geocoder = new google.maps.Geocoder();
            geocoder.geocode({ 'address': 'miami, us' }, function (results, status) {
                if (status == google.maps.GeocoderStatus.OK) {
                    alert("location : " + results[0].geometry.location.lat() + " " + results[0].geometry.location.lng());
                } else {
                    alert("Something got wrong " + status);
                }
            });
        }




    </script>
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDWNbUasHY_ay5SMIpz02pu534Y1cif72k&libraries=visualization&callback=initMap"></script>
    <script src="https://github.com/googlemaps/js-map-label/blob/gh-pages/src/maplabel-compiled.js"></script>
</body>
</html>





<!-- 


<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="initial-scale=1.0" />
    <style type="text/css">
         /* Always set the map height explicitly to define the size of the div
        * element that contains the map. */
         #map {
             height: 100%;
         }
         /* Optional: Makes the sample page fill the window. */
         html, body {
             height: 100%;
             margin: 0;
             padding: 0;
         }
    </style>
</head>
<body id="map-container">
    <div id="map"></div>
    <script>
      var map;

      function initMap() {
        map = new google.maps.Map(document.getElementById('map'), {
          center: { lat: 20, lng: -160 },
          zoom: 2,
          styles: mapStyle
        });

        map.data.setStyle(styleFeature);

        // Get the earthquake data (JSONP format)
        // This feed is a copy from the USGS feed, you can find the originals here:
        //   http://earthquake.usgs.gov/earthquakes/feed/v1.0/geojson.php
        var script = document.createElement('script');
        script.setAttribute(
            'src',
            'https://storage.googleapis.com/mapsdevsite/json/quakes.geo.json');
        document.getElementsByTagName('head')[0].appendChild(script);
      }

      // Defines the callback function referenced in the jsonp file.
      function eqfeed_callback(data) {
        map.data.addGeoJson(data);
      }

      function styleFeature(feature) {
        var low = [151, 83, 34];   // color of mag 1.0
        var high = [5, 69, 54];  // color of mag 6.0 and above
        var minMag = 1.0;
        var maxMag = 6.0;

        // fraction represents where the value sits between the min and max
        var fraction = (Math.min(feature.getProperty('mag'), maxMag) - minMag) /
            (maxMag - minMag);

        var color = interpolateHsl(low, high, fraction);

        return {
          icon: {
            path: google.maps.SymbolPath.CIRCLE,
            strokeWeight: 0.5,
            strokeColor: '#fff',
            fillColor: color,
            fillOpacity: 2 / feature.getProperty('mag'),
            // while an exponent would technically be correct, quadratic looks nicer
            scale: Math.pow(feature.getProperty('mag'), 2)
          },
          zIndex: Math.floor(feature.getProperty('mag'))
        };
      }

      function interpolateHsl(lowHsl, highHsl, fraction) {
        var color = [];
        for (var i = 0; i < 3; i++) {
          // Calculate color based on the fraction.
          color[i] = (highHsl[i] - lowHsl[i]) * fraction + lowHsl[i];
        }

        return 'hsl(' + color[0] + ',' + color[1] + '%,' + color[2] + '%)';
      }

      var mapStyle = [{
        'featureType': 'all',
        'elementType': 'all',
        'stylers': [{'visibility': 'off'}]
      }, {
        'featureType': 'landscape',
        'elementType': 'geometry',
        'stylers': [{'visibility': 'on'}, {'color': '#fcfcfc'}]
      }, {
        'featureType': 'water',
        'elementType': 'labels',
        'stylers': [{'visibility': 'off'}]
      }, {
        'featureType': 'water',
        'elementType': 'geometry',
        'stylers': [{'visibility': 'on'}, {'hue': '#5f94ff'}, {'lightness': 60}]
      }];
    </script>
    <script async defer
            src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDWNbUasHY_ay5SMIpz02pu534Y1cif72k&callback=initMap">
    </script>
</body>
</html>




 -->