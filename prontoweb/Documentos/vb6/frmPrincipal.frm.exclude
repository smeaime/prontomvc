VERSION 5.00
Object = "{D9AF33E0-7C55-11D5-9151-0000E856BC17}#1.0#0"; "fiscal010724.ocx"
Object = "{831FDD16-0C5C-11D2-A9FC-0000F8754DA1}#2.0#0"; "MSCOMCTL.OCX"
Object = "{3B7C8863-D78F-101B-B9B5-04021C009402}#1.2#0"; "richtx32.ocx"
Object = "{12DE615C-8D4B-4936-8801-459AB2EAA3FC}#3.0#0"; "Controles1013.ocx"
Object = "{B52C1CDE-38E9-11D5-98EC-00C0F01C6C81}#1.0#0"; "IFEpson.ocx"
Begin VB.Form frmPrincipal 
   ClientHeight    =   6615
   ClientLeft      =   225
   ClientTop       =   855
   ClientWidth     =   10440
   Icon            =   "frmPrincipal.frx":0000
   LinkTopic       =   "Form1"
   ScaleHeight     =   6615
   ScaleWidth      =   10440
   StartUpPosition =   3  'Windows Default
   Begin EPSON_Impresora_Fiscal.PrinterFiscal PrinterFiscal1 
      Left            =   6525
      Top             =   5670
      _ExtentX        =   847
      _ExtentY        =   847
   End
   Begin VB.Timer Timer1 
      Enabled         =   0   'False
      Left            =   4365
      Top             =   5715
   End
   Begin MSComctlLib.ImageList img32 
      Left            =   5400
      Top             =   5670
      _ExtentX        =   1005
      _ExtentY        =   1005
      BackColor       =   -2147483643
      ImageWidth      =   32
      ImageHeight     =   32
      MaskColor       =   12632256
      _Version        =   393216
      BeginProperty Images {2C247F25-8591-11D1-B16A-00C0F0283628} 
         NumListImages   =   187
         BeginProperty ListImage1 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":076A
            Key             =   "Abierto"
         EndProperty
         BeginProperty ListImage2 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":0BBC
            Key             =   "Ppal"
         EndProperty
         BeginProperty ListImage3 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":0ED6
            Key             =   "Abierto1"
         EndProperty
         BeginProperty ListImage4 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":1328
            Key             =   "Cerrado"
         EndProperty
         BeginProperty ListImage5 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":177A
            Key             =   "Cerrado1"
         EndProperty
         BeginProperty ListImage6 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":1BCC
            Key             =   "TablasG"
         EndProperty
         BeginProperty ListImage7 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":437E
            Key             =   "Rubros"
         EndProperty
         BeginProperty ListImage8 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":4698
            Key             =   "Familias"
         EndProperty
         BeginProperty ListImage9 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":49B2
            Key             =   "Subrubros"
         EndProperty
         BeginProperty ListImage10 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":4CCC
            Key             =   "TTermicos"
         EndProperty
         BeginProperty ListImage11 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":4FE6
            Key             =   "Depositos"
         EndProperty
         BeginProperty ListImage12 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":5300
            Key             =   "Tipos"
         EndProperty
         BeginProperty ListImage13 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":561A
            Key             =   "Unidades"
         EndProperty
         BeginProperty ListImage14 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":5934
            Key             =   "Acabados"
         EndProperty
         BeginProperty ListImage15 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":5C4E
            Key             =   "Calidades"
         EndProperty
         BeginProperty ListImage16 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":5F68
            Key             =   "Materiales"
         EndProperty
         BeginProperty ListImage17 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":6E42
            Key             =   "LAcopio"
         EndProperty
         BeginProperty ListImage18 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":715C
            Key             =   "LMateriales"
         EndProperty
         BeginProperty ListImage19 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":7476
            Key             =   "InformesC"
         EndProperty
         BeginProperty ListImage20 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":7D50
            Key             =   "EstadosP"
         EndProperty
         BeginProperty ListImage21 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":806A
            Key             =   "MovStock"
         EndProperty
         BeginProperty ListImage22 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":84BC
            Key             =   "ProveedoresRubros"
         EndProperty
         BeginProperty ListImage23 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":87D6
            Key             =   "Paises"
         EndProperty
         BeginProperty ListImage24 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":8AF0
            Key             =   "Relaciones"
         EndProperty
         BeginProperty ListImage25 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":8E0A
            Key             =   "CodigosUniversales"
         EndProperty
         BeginProperty ListImage26 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":9124
            Key             =   "Series"
         EndProperty
         BeginProperty ListImage27 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":99FE
            Key             =   "Formas"
         EndProperty
         BeginProperty ListImage28 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":9D18
            Key             =   "Obras2"
         EndProperty
         BeginProperty ListImage29 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":A032
            Key             =   "DefinicionesArt"
         EndProperty
         BeginProperty ListImage30 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":A34C
            Key             =   "ControlesCalidad"
         EndProperty
         BeginProperty ListImage31 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":BADE
            Key             =   "Obras1"
         EndProperty
         BeginProperty ListImage32 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":BDF8
            Key             =   "Schedulers"
         EndProperty
         BeginProperty ListImage33 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":C112
            Key             =   "Grados"
         EndProperty
         BeginProperty ListImage34 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":C42C
            Key             =   "Equipos"
         EndProperty
         BeginProperty ListImage35 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":C746
            Key             =   "AcoCalidades"
         EndProperty
         BeginProperty ListImage36 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":CA60
            Key             =   "AcotarTablas"
         EndProperty
         BeginProperty ListImage37 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":CD7A
            Key             =   "AcoMateriales"
         EndProperty
         BeginProperty ListImage38 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":D094
            Key             =   "AcoGrados"
         EndProperty
         BeginProperty ListImage39 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":D3AE
            Key             =   "AcoSeries"
         EndProperty
         BeginProperty ListImage40 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":D6C8
            Key             =   "AcoTratamientos"
         EndProperty
         BeginProperty ListImage41 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":D9E2
            Key             =   "Colores"
         EndProperty
         BeginProperty ListImage42 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":DCFC
            Key             =   "Normas"
         EndProperty
         BeginProperty ListImage43 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":E5D6
            Key             =   "AcoTipos"
         EndProperty
         BeginProperty ListImage44 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":E8F0
            Key             =   "Localidades"
         EndProperty
         BeginProperty ListImage45 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":EC0A
            Key             =   "Provincias"
         EndProperty
         BeginProperty ListImage46 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":EF24
            Key             =   "Rangos"
         EndProperty
         BeginProperty ListImage47 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":F23E
            Key             =   "Modelos"
         EndProperty
         BeginProperty ListImage48 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":FB18
            Key             =   "AlimentacionesElectricas"
         EndProperty
         BeginProperty ListImage49 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":FE32
            Key             =   "Marcas"
         EndProperty
         BeginProperty ListImage50 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":11B0C
            Key             =   "AniosNorma"
         EndProperty
         BeginProperty ListImage51 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":123E6
            Key             =   "AcoFormas"
         EndProperty
         BeginProperty ListImage52 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":12700
            Key             =   "AcoMarcas"
         EndProperty
         BeginProperty ListImage53 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":12A1A
            Key             =   "AcoModelos"
         EndProperty
         BeginProperty ListImage54 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":12D34
            Key             =   "AcoNormas"
         EndProperty
         BeginProperty ListImage55 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":1304E
            Key             =   "Planos"
         EndProperty
         BeginProperty ListImage56 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":13368
            Key             =   "AcoCodigos"
         EndProperty
         BeginProperty ListImage57 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":13682
            Key             =   "AcoSchedulers"
         EndProperty
         BeginProperty ListImage58 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":1399C
            Key             =   "Codigos"
         EndProperty
         BeginProperty ListImage59 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":13CB6
            Key             =   "AcoAcabados"
         EndProperty
         BeginProperty ListImage60 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":13FD0
            Key             =   "CentrosCosto"
         EndProperty
         BeginProperty ListImage61 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":142EA
            Key             =   "AcoBiselados"
         EndProperty
         BeginProperty ListImage62 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":14604
            Key             =   "AcoTiposRosca"
         EndProperty
         BeginProperty ListImage63 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":1491E
            Key             =   "CalidadesClad"
         EndProperty
         BeginProperty ListImage64 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":14C38
            Key             =   "Biselados"
         EndProperty
         BeginProperty ListImage65 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":15A8A
            Key             =   "TiposRosca"
         EndProperty
         BeginProperty ListImage66 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":15DAC
            Key             =   "Sectores"
         EndProperty
         BeginProperty ListImage67 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":160C6
            Key             =   "Cargos"
         EndProperty
         BeginProperty ListImage68 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":163E0
            Key             =   "Densidades"
         EndProperty
         BeginProperty ListImage69 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":166FA
            Key             =   "Historicos"
         EndProperty
         BeginProperty ListImage70 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":16B4C
            Key             =   "Transportistas"
         EndProperty
         BeginProperty ListImage71 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":17426
            Key             =   "HistObras"
         EndProperty
         BeginProperty ListImage72 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":17D00
            Key             =   "HLAcopios"
         EndProperty
         BeginProperty ListImage73 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":185DA
            Key             =   "HLMateriales"
         EndProperty
         BeginProperty ListImage74 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":18EB4
            Key             =   "HRequerimientos"
         EndProperty
         BeginProperty ListImage75 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":1978E
            Key             =   "HPedidos"
         EndProperty
         BeginProperty ListImage76 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":1A068
            Key             =   "Monedas"
         EndProperty
         BeginProperty ListImage77 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":1A382
            Key             =   "ArchivosATransmitirDestinos"
         EndProperty
         BeginProperty ListImage78 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":1A69C
            Key             =   "AcoColores"
         EndProperty
         BeginProperty ListImage79 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":1A9B6
            Key             =   "ItemsPopUpMateriales"
         EndProperty
         BeginProperty ListImage80 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":1AE08
            Key             =   "Comercial"
         EndProperty
         BeginProperty ListImage81 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":1B122
            Key             =   "LMaterialesPorObras"
         EndProperty
         BeginProperty ListImage82 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":1B43C
            Key             =   "Conceptos"
         EndProperty
         BeginProperty ListImage83 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":1B756
            Key             =   "OrdenesCompra"
         EndProperty
         BeginProperty ListImage84 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":1BA70
            Key             =   "Facturas"
         EndProperty
         BeginProperty ListImage85 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":1BD8A
            Key             =   "Devoluciones"
         EndProperty
         BeginProperty ListImage86 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":1C0A4
            Key             =   "NotasDebito"
         EndProperty
         BeginProperty ListImage87 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":1C3BE
            Key             =   "NotasCredito"
         EndProperty
         BeginProperty ListImage88 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":1C6D8
            Key             =   "Recibos"
         EndProperty
         BeginProperty ListImage89 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":1CFB2
            Key             =   "CtasCtesD"
         EndProperty
         BeginProperty ListImage90 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":1D88C
            Key             =   "CtasCtesA"
         EndProperty
         BeginProperty ListImage91 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":1E166
            Key             =   "Valores"
         EndProperty
         BeginProperty ListImage92 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":1EA40
            Key             =   "DepositosBancarios"
         EndProperty
         BeginProperty ListImage93 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":1ED5A
            Key             =   "ComprobantesPrv"
         EndProperty
         BeginProperty ListImage94 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":1F074
            Key             =   "OPago"
         EndProperty
         BeginProperty ListImage95 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":1F38E
            Key             =   "Contabilidad"
         EndProperty
         BeginProperty ListImage96 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":20268
            Key             =   "RubrosContables"
         EndProperty
         BeginProperty ListImage97 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":20582
            Key             =   "Subdiarios"
         EndProperty
         BeginProperty ListImage98 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":2089C
            Key             =   "Asientos"
         EndProperty
         BeginProperty ListImage99 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":20BB6
            Key             =   "Articulos"
         EndProperty
         BeginProperty ListImage100 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":21008
            Key             =   "Empleados"
         EndProperty
         BeginProperty ListImage101 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":21322
            Key             =   "Obras"
         EndProperty
         BeginProperty ListImage102 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":2163C
            Key             =   "Compras"
         EndProperty
         BeginProperty ListImage103 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":21956
            Key             =   "AnexosEquipos"
         EndProperty
         BeginProperty ListImage104 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":21C70
            Key             =   "Requerimientos"
         EndProperty
         BeginProperty ListImage105 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":21F8A
            Key             =   "Cotizaciones"
         EndProperty
         BeginProperty ListImage106 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":222A4
            Key             =   "Vendedores"
         EndProperty
         BeginProperty ListImage107 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":225BE
            Key             =   "Bancos"
         EndProperty
         BeginProperty ListImage108 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":228D8
            Key             =   "Cuentas"
         EndProperty
         BeginProperty ListImage109 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":22D2A
            Key             =   "CuentasGastos"
         EndProperty
         BeginProperty ListImage110 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":2317C
            Key             =   "UnidadesOperativas"
         EndProperty
         BeginProperty ListImage111 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":232D6
            Key             =   "Conciliaciones"
         EndProperty
         BeginProperty ListImage112 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":235F0
            Key             =   "CuentasBancarias"
         EndProperty
         BeginProperty ListImage113 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":2390A
            Key             =   "Ganancias"
         EndProperty
         BeginProperty ListImage114 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":23C24
            Key             =   "DiferenciasCambio_P"
         EndProperty
         BeginProperty ListImage115 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":23F3E
            Key             =   "Clientes"
         EndProperty
         BeginProperty ListImage116 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":24258
            Key             =   "Remitos"
         EndProperty
         BeginProperty ListImage117 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":24572
            Key             =   "TiposCuentaGrupos"
         EndProperty
         BeginProperty ListImage118 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":2488C
            Key             =   "Conjuntos"
         EndProperty
         BeginProperty ListImage119 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":24BA6
            Key             =   "BancoChequeras"
         EndProperty
         BeginProperty ListImage120 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":24EC0
            Key             =   "Ubicaciones"
         EndProperty
         BeginProperty ListImage121 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":251DA
            Key             =   "ListasPrecios"
         EndProperty
         BeginProperty ListImage122 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":254FC
            Key             =   "DiferenciasCambio_C"
         EndProperty
         BeginProperty ListImage123 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":25816
            Key             =   "Cajas"
         EndProperty
         BeginProperty ListImage124 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":260F0
            Key             =   "ConciliacionesCajas"
         EndProperty
         BeginProperty ListImage125 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":2640A
            Key             =   "AnticiposAlPersonal"
         EndProperty
         BeginProperty ListImage126 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":2685C
            Key             =   "PlazosFijos"
         EndProperty
         BeginProperty ListImage127 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":26B76
            Key             =   "PuntosVenta"
         EndProperty
         BeginProperty ListImage128 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":26E90
            Key             =   "IBCondiciones"
         EndProperty
         BeginProperty ListImage129 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":271AA
            Key             =   "CondicionesCompra"
         EndProperty
         BeginProperty ListImage130 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":274C4
            Key             =   "Proveedores"
         EndProperty
         BeginProperty ListImage131 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":277DE
            Key             =   "Comparativas"
         EndProperty
         BeginProperty ListImage132 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":27AF8
            Key             =   "Pedidos"
         EndProperty
         BeginProperty ListImage133 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":27E12
            Key             =   "Presupuestos"
         EndProperty
         BeginProperty ListImage134 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":2812C
            Key             =   "ResumenesParaConciliacion"
         EndProperty
         BeginProperty ListImage135 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":28446
            Key             =   "EmisionCheques"
         EndProperty
         BeginProperty ListImage136 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":28760
            Key             =   "VentasCuotas"
         EndProperty
         BeginProperty ListImage137 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":28A7A
            Key             =   "VentasCuotasOperacion"
         EndProperty
         BeginProperty ListImage138 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":28D94
            Key             =   "VentasCuotasCobranzas"
         EndProperty
         BeginProperty ListImage139 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":290AE
            Key             =   "CoeficientesContables"
         EndProperty
         BeginProperty ListImage140 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":293D0
            Key             =   "CoeficientesImpositivos"
         EndProperty
         BeginProperty ListImage141 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":296EA
            Key             =   "ActivoFijo"
         EndProperty
         BeginProperty ListImage142 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":29A04
            Key             =   "ModificacionActivoFijo"
         EndProperty
         BeginProperty ListImage143 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":29D1E
            Key             =   "GruposActivosFijos"
         EndProperty
         BeginProperty ListImage144 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":2A038
            Key             =   "IGCondiciones"
         EndProperty
         BeginProperty ListImage145 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":2A352
            Key             =   "Revaluos"
         EndProperty
         BeginProperty ListImage146 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":2A66C
            Key             =   "PresupuestoFinanciero"
         EndProperty
         BeginProperty ListImage147 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":2A986
            Key             =   "PresupuestoEconomico"
         EndProperty
         BeginProperty ListImage148 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":2ACA0
            Key             =   "ImpuestosDirectos"
         EndProperty
         BeginProperty ListImage149 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":2AFBA
            Key             =   "EjerciciosContables"
         EndProperty
         BeginProperty ListImage150 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":2B2D4
            Key             =   "GastosBancarios"
         EndProperty
         BeginProperty ListImage151 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":2B5EE
            Key             =   "GruposObras"
         EndProperty
         BeginProperty ListImage152 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":2B908
            Key             =   "Recepciones"
         EndProperty
         BeginProperty ListImage153 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":2BC22
            Key             =   "SalidaMateriales"
         EndProperty
         BeginProperty ListImage154 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":2BF3C
            Key             =   "AjustesStock"
         EndProperty
         BeginProperty ListImage155 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":2C256
            Key             =   "Reservas"
         EndProperty
         BeginProperty ListImage156 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":2C570
            Key             =   "OtrosIngresosAlmacen"
         EndProperty
         BeginProperty ListImage157 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":2CE4A
            Key             =   "ValesSalida"
         EndProperty
         BeginProperty ListImage158 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":2D164
            Key             =   "CCalidades"
         EndProperty
         BeginProperty ListImage159 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":2D47E
            Key             =   "PosicionesImportacion"
         EndProperty
         BeginProperty ListImage160 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":2D798
            Key             =   "CostosImportacion"
         EndProperty
         BeginProperty ListImage161 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":2E072
            Key             =   "ActividadesP"
         EndProperty
         BeginProperty ListImage162 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":2E38C
            Key             =   "SolicitudesCompra"
         EndProperty
         BeginProperty ListImage163 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":2E6A6
            Key             =   "DistribucionesObras"
         EndProperty
         BeginProperty ListImage164 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":2E9C0
            Key             =   "CashFlow"
         EndProperty
         BeginProperty ListImage165 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":2ECDA
            Key             =   "HChequeras"
         EndProperty
         BeginProperty ListImage166 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":2F5B4
            Key             =   "TarjetasCredito"
         EndProperty
         BeginProperty ListImage167 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":2F8CE
            Key             =   "OrdenesTrabajo"
         EndProperty
         BeginProperty ListImage168 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":2FBE8
            Key             =   "ChequesPendientes"
         EndProperty
         BeginProperty ListImage169 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":2FF02
            Key             =   "FondosFijos"
         EndProperty
         BeginProperty ListImage170 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":3049C
            Key             =   "TiposComprobante"
         EndProperty
         BeginProperty ListImage171 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":30A36
            Key             =   "ProntoSAT"
         EndProperty
         BeginProperty ListImage172 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":30FD0
            Key             =   "PresupuestoObras"
         EndProperty
         BeginProperty ListImage173 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":3156A
            Key             =   "PresupuestoObrasRubros"
         EndProperty
         BeginProperty ListImage174 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":31B04
            Key             =   "Traducciones"
         EndProperty
         BeginProperty ListImage175 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":323DE
            Key             =   "Clausulas"
         EndProperty
         BeginProperty ListImage176 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":32CB8
            Key             =   "UnidadesEmpaque"
         EndProperty
         BeginProperty ListImage177 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":33592
            Key             =   "CertificacionesObra"
         EndProperty
         BeginProperty ListImage178 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":33E6C
            Key             =   "Subcontratos"
         EndProperty
         BeginProperty ListImage179 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":34746
            Key             =   "PresupuestoObrasGruposMateriales"
         EndProperty
         BeginProperty ListImage180 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":34CE0
            Key             =   "CtrlTransp"
         EndProperty
         BeginProperty ListImage181 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":355BA
            Key             =   "Choferes"
         EndProperty
         BeginProperty ListImage182 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":358D4
            Key             =   "TarifasFletes"
         EndProperty
         BeginProperty ListImage183 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":361AE
            Key             =   "Fletes"
         EndProperty
         BeginProperty ListImage184 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":364C8
            Key             =   "GastosFletes"
         EndProperty
         BeginProperty ListImage185 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":36DA2
            Key             =   "LiquidacionesFletes"
         EndProperty
         BeginProperty ListImage186 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":370BC
            Key             =   "AutorizacionesCompra"
         EndProperty
         BeginProperty ListImage187 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":373D6
            Key             =   "PartesProduccion"
         EndProperty
      EndProperty
   End
   Begin RichTextLib.RichTextBox RichTextBox1 
      Height          =   195
      Left            =   6435
      TabIndex        =   5
      Top             =   5940
      Visible         =   0   'False
      Width           =   1095
      _ExtentX        =   1931
      _ExtentY        =   344
      _Version        =   393217
      TextRTF         =   $"frmPrincipal.frx":39688
   End
   Begin VB.PictureBox Split 
      Height          =   4965
      Left            =   3465
      MousePointer    =   9  'Size W E
      ScaleHeight     =   4965
      ScaleWidth      =   30
      TabIndex        =   3
      Top             =   405
      Width           =   35
   End
   Begin MSComctlLib.Toolbar Toolbar1 
      Align           =   1  'Align Top
      Height          =   420
      Left            =   0
      TabIndex        =   2
      Top             =   0
      Width           =   10440
      _ExtentX        =   18415
      _ExtentY        =   741
      ButtonWidth     =   609
      ButtonHeight    =   582
      Appearance      =   1
      ImageList       =   "imlToolbarIcons"
      _Version        =   393216
      BeginProperty Buttons {66833FE8-8583-11D1-B16A-00C0F0283628} 
         NumButtons      =   31
         BeginProperty Button1 {66833FEA-8583-11D1-B16A-00C0F0283628} 
            Key             =   "New"
            Object.ToolTipText     =   "Nuevo"
            ImageKey        =   "New"
         EndProperty
         BeginProperty Button2 {66833FEA-8583-11D1-B16A-00C0F0283628} 
            Key             =   "Save"
            Object.ToolTipText     =   "Exportar a Excel"
            ImageKey        =   "Excel"
         EndProperty
         BeginProperty Button3 {66833FEA-8583-11D1-B16A-00C0F0283628} 
            Enabled         =   0   'False
            Key             =   "Print"
            Object.ToolTipText     =   "Imprimir"
            ImageKey        =   "Print"
         EndProperty
         BeginProperty Button4 {66833FEA-8583-11D1-B16A-00C0F0283628} 
            Style           =   3
         EndProperty
         BeginProperty Button5 {66833FEA-8583-11D1-B16A-00C0F0283628} 
            Key             =   "Copy"
            Object.ToolTipText     =   "Copiar"
            ImageKey        =   "Copy"
         EndProperty
         BeginProperty Button6 {66833FEA-8583-11D1-B16A-00C0F0283628} 
            Key             =   "Paste"
            Object.ToolTipText     =   "Pegar"
            ImageKey        =   "Paste"
         EndProperty
         BeginProperty Button7 {66833FEA-8583-11D1-B16A-00C0F0283628} 
            Style           =   3
         EndProperty
         BeginProperty Button8 {66833FEA-8583-11D1-B16A-00C0F0283628} 
            Key             =   "Find"
            Object.ToolTipText     =   "Buscar"
            ImageKey        =   "Find"
         EndProperty
         BeginProperty Button9 {66833FEA-8583-11D1-B16A-00C0F0283628} 
            Key             =   "Sumar"
            Object.ToolTipText     =   "Totalizar campo"
            ImageKey        =   "Sumar"
         EndProperty
         BeginProperty Button10 {66833FEA-8583-11D1-B16A-00C0F0283628} 
            Key             =   "Calculadora"
            Object.ToolTipText     =   "Calculadora"
            ImageKey        =   "Calculadora"
         EndProperty
         BeginProperty Button11 {66833FEA-8583-11D1-B16A-00C0F0283628} 
            Style           =   3
         EndProperty
         BeginProperty Button12 {66833FEA-8583-11D1-B16A-00C0F0283628} 
            Key             =   "View Large Icons"
            Object.ToolTipText     =   "Iconos grandes"
            ImageKey        =   "View Large Icons"
            Style           =   2
         EndProperty
         BeginProperty Button13 {66833FEA-8583-11D1-B16A-00C0F0283628} 
            Key             =   "View Small Icons"
            Object.ToolTipText     =   "Iconos pequeños"
            ImageKey        =   "View Small Icons"
            Style           =   2
         EndProperty
         BeginProperty Button14 {66833FEA-8583-11D1-B16A-00C0F0283628} 
            Key             =   "View List"
            Object.ToolTipText     =   "Lista"
            ImageKey        =   "View List"
            Style           =   2
         EndProperty
         BeginProperty Button15 {66833FEA-8583-11D1-B16A-00C0F0283628} 
            Key             =   "View Details"
            Object.ToolTipText     =   "Detalles"
            ImageKey        =   "View Details"
            Style           =   2
         EndProperty
         BeginProperty Button16 {66833FEA-8583-11D1-B16A-00C0F0283628} 
            Style           =   3
         EndProperty
         BeginProperty Button17 {66833FEA-8583-11D1-B16A-00C0F0283628} 
            Key             =   "Help"
            Object.ToolTipText     =   "Ayuda"
            ImageKey        =   "Help"
         EndProperty
         BeginProperty Button18 {66833FEA-8583-11D1-B16A-00C0F0283628} 
            Style           =   3
         EndProperty
         BeginProperty Button19 {66833FEA-8583-11D1-B16A-00C0F0283628} 
            Object.Visible         =   0   'False
            Key             =   "CopiarCampo"
            Object.ToolTipText     =   "Copiar un campo a varias mascaras"
            ImageKey        =   "CopiarCampo"
         EndProperty
         BeginProperty Button20 {66833FEA-8583-11D1-B16A-00C0F0283628} 
            Key             =   "Refrescar"
            Object.ToolTipText     =   "Refrescar el arbol de comprobantes"
            ImageKey        =   "RefrescarArbol"
         EndProperty
         BeginProperty Button21 {66833FEA-8583-11D1-B16A-00C0F0283628} 
            Style           =   3
         EndProperty
         BeginProperty Button22 {66833FEA-8583-11D1-B16A-00C0F0283628} 
            Key             =   "Parametros"
            Object.ToolTipText     =   "Parametros"
            ImageKey        =   "Parametros"
         EndProperty
         BeginProperty Button23 {66833FEA-8583-11D1-B16A-00C0F0283628} 
            Key             =   "Empresa"
            Object.ToolTipText     =   "Datos de la empresa"
            ImageKey        =   "Empresa"
         EndProperty
         BeginProperty Button24 {66833FEA-8583-11D1-B16A-00C0F0283628} 
            Style           =   3
         EndProperty
         BeginProperty Button25 {66833FEA-8583-11D1-B16A-00C0F0283628} 
            Key             =   "EnviarMensaje"
            Object.ToolTipText     =   "Enviar un mensaje a uno o varios usuarios"
            ImageKey        =   "EnviarMensaje"
         EndProperty
         BeginProperty Button26 {66833FEA-8583-11D1-B16A-00C0F0283628} 
            Style           =   3
         EndProperty
         BeginProperty Button27 {66833FEA-8583-11D1-B16A-00C0F0283628} 
            Key             =   "MenuPopUp"
            Object.ToolTipText     =   "Generar menu desplegable de materiales"
            ImageKey        =   "MenuPopUp"
         EndProperty
         BeginProperty Button28 {66833FEA-8583-11D1-B16A-00C0F0283628} 
            Style           =   3
         EndProperty
         BeginProperty Button29 {66833FEA-8583-11D1-B16A-00C0F0283628} 
            Key             =   "AccesoPorUsuarios"
            Object.ToolTipText     =   "Pasa a modo definicion de accesos por item - usuarios"
            ImageKey        =   "AccesoPorUsuarios"
         EndProperty
         BeginProperty Button30 {66833FEA-8583-11D1-B16A-00C0F0283628} 
            Style           =   3
         EndProperty
         BeginProperty Button31 {66833FEA-8583-11D1-B16A-00C0F0283628} 
            Key             =   "Idioma"
            Object.ToolTipText     =   "Cambiar idioma"
            ImageKey        =   "Idioma"
         EndProperty
      EndProperty
      Begin VB.CheckBox Check1 
         Alignment       =   1  'Right Justify
         Caption         =   "Consolidar"
         Height          =   240
         Left            =   8370
         TabIndex        =   9
         Top             =   90
         Visible         =   0   'False
         Width           =   1095
      End
   End
   Begin MSComctlLib.StatusBar StatusBar1 
      Align           =   2  'Align Bottom
      Height          =   390
      Left            =   0
      TabIndex        =   1
      Top             =   6225
      Width           =   10440
      _ExtentX        =   18415
      _ExtentY        =   688
      _Version        =   393216
      BeginProperty Panels {8E3867A5-8586-11D1-B16A-00C0F0283628} 
         NumPanels       =   7
         BeginProperty Panel1 {8E3867AB-8586-11D1-B16A-00C0F0283628} 
            AutoSize        =   1
            Object.Width           =   5292
            MinWidth        =   5292
            Picture         =   "frmPrincipal.frx":3970A
            Key             =   "Estado"
         EndProperty
         BeginProperty Panel2 {8E3867AB-8586-11D1-B16A-00C0F0283628} 
            AutoSize        =   1
            Object.Width           =   5292
            MinWidth        =   5292
         EndProperty
         BeginProperty Panel3 {8E3867AB-8586-11D1-B16A-00C0F0283628} 
            AutoSize        =   1
            Object.Width           =   2999
            MinWidth        =   2999
         EndProperty
         BeginProperty Panel4 {8E3867AB-8586-11D1-B16A-00C0F0283628} 
            Style           =   1
            Alignment       =   1
            AutoSize        =   2
            Enabled         =   0   'False
            Object.Width           =   900
            MinWidth        =   18
            TextSave        =   "CAPS"
            Key             =   "Caps"
         EndProperty
         BeginProperty Panel5 {8E3867AB-8586-11D1-B16A-00C0F0283628} 
            Style           =   2
            AutoSize        =   2
            Object.Width           =   820
            MinWidth        =   18
            TextSave        =   "NUM"
            Key             =   "Num"
         EndProperty
         BeginProperty Panel6 {8E3867AB-8586-11D1-B16A-00C0F0283628} 
            Style           =   6
            Alignment       =   1
            AutoSize        =   2
            Object.Width           =   1693
            MinWidth        =   18
            TextSave        =   "27/07/2011"
            Key             =   "Fecha"
         EndProperty
         BeginProperty Panel7 {8E3867AB-8586-11D1-B16A-00C0F0283628} 
            Style           =   5
            AutoSize        =   2
            Object.Width           =   873
            MinWidth        =   19
            TextSave        =   "15:13"
         EndProperty
      EndProperty
   End
   Begin MSComctlLib.TreeView Arbol 
      Height          =   6225
      Left            =   0
      TabIndex        =   0
      Top             =   0
      Width           =   3375
      _ExtentX        =   5953
      _ExtentY        =   10980
      _Version        =   393217
      Indentation     =   18
      LabelEdit       =   1
      LineStyle       =   1
      Style           =   7
      ImageList       =   "img16"
      Appearance      =   1
      OLEDropMode     =   1
   End
   Begin MSComctlLib.ImageList imlToolbarIcons 
      Left            =   3330
      Top             =   5670
      _ExtentX        =   1005
      _ExtentY        =   1005
      BackColor       =   -2147483643
      ImageWidth      =   16
      ImageHeight     =   16
      MaskColor       =   12632256
      _Version        =   393216
      BeginProperty Images {2C247F25-8591-11D1-B16A-00C0F0283628} 
         NumListImages   =   38
         BeginProperty ListImage1 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":39A24
            Key             =   "New"
         EndProperty
         BeginProperty ListImage2 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":39B36
            Key             =   "Open"
         EndProperty
         BeginProperty ListImage3 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":39C48
            Key             =   "Save"
         EndProperty
         BeginProperty ListImage4 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":39D5A
            Key             =   "Print"
         EndProperty
         BeginProperty ListImage5 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":39E6C
            Key             =   "Cut"
         EndProperty
         BeginProperty ListImage6 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":39F7E
            Key             =   "Copy"
         EndProperty
         BeginProperty ListImage7 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":3A090
            Key             =   "Paste"
         EndProperty
         BeginProperty ListImage8 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":3A1A2
            Key             =   "Delete"
         EndProperty
         BeginProperty ListImage9 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":3A2B4
            Key             =   "Undo"
         EndProperty
         BeginProperty ListImage10 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":3A3C6
            Key             =   "Find"
         EndProperty
         BeginProperty ListImage11 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":3A4D8
            Key             =   "Sort Ascending"
         EndProperty
         BeginProperty ListImage12 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":3A5EA
            Key             =   "Sort Descending"
         EndProperty
         BeginProperty ListImage13 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":3A6FC
            Key             =   "Up One Level"
         EndProperty
         BeginProperty ListImage14 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":3A80E
            Key             =   "View Large Icons"
         EndProperty
         BeginProperty ListImage15 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":3A920
            Key             =   "View Small Icons"
         EndProperty
         BeginProperty ListImage16 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":3AA32
            Key             =   "View List"
         EndProperty
         BeginProperty ListImage17 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":3AB44
            Key             =   "View Details"
         EndProperty
         BeginProperty ListImage18 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":3AC56
            Key             =   "Properties"
         EndProperty
         BeginProperty ListImage19 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":3AD68
            Key             =   "Help"
         EndProperty
         BeginProperty ListImage20 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":3AE7A
            Key             =   "Help What's This"
         EndProperty
         BeginProperty ListImage21 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":3AF8C
            Key             =   "CopiarCampo"
         EndProperty
         BeginProperty ListImage22 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":3B3DE
            Key             =   "ActualizaMateriales"
         EndProperty
         BeginProperty ListImage23 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":3B6F8
            Key             =   "Excel"
         EndProperty
         BeginProperty ListImage24 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":3BB4A
            Key             =   "Refrescar"
         EndProperty
         BeginProperty ListImage25 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":3BE64
            Key             =   "Parametros"
         EndProperty
         BeginProperty ListImage26 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":3C17E
            Key             =   "Empresa"
         EndProperty
         BeginProperty ListImage27 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":3C498
            Key             =   "RefrescarArbol"
         EndProperty
         BeginProperty ListImage28 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":3C7B2
            Key             =   "EnviarCorreo1"
         EndProperty
         BeginProperty ListImage29 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":3EF64
            Key             =   "EnviarCorreo"
         EndProperty
         BeginProperty ListImage30 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":3F27E
            Key             =   "LeerCorreo"
         EndProperty
         BeginProperty ListImage31 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":3F598
            Key             =   "EnviarMensaje"
         EndProperty
         BeginProperty ListImage32 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":3F9EA
            Key             =   "EstadoObras"
         EndProperty
         BeginProperty ListImage33 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":3FD04
            Key             =   "MenuPopUp"
         EndProperty
         BeginProperty ListImage34 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":4001E
            Key             =   "ImportarDATANET"
         EndProperty
         BeginProperty ListImage35 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":40470
            Key             =   "AccesoPorUsuarios"
         EndProperty
         BeginProperty ListImage36 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":4078A
            Key             =   "Calculadora"
         EndProperty
         BeginProperty ListImage37 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":40AA4
            Key             =   "Sumar"
         EndProperty
         BeginProperty ListImage38 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":4103E
            Key             =   "Idioma"
         EndProperty
      EndProperty
   End
   Begin Controles1013.DbListView Lista 
      Height          =   5190
      Left            =   3510
      TabIndex        =   4
      Top             =   450
      Width           =   6720
      _ExtentX        =   11853
      _ExtentY        =   9155
      BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
         Name            =   "MS Sans Serif"
         Size            =   8.25
         Charset         =   0
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      MouseIcon       =   "frmPrincipal.frx":41918
      OLEDragMode     =   1
      PictureAlignment=   5
      ColumnHeaderIcons=   "ImgColumnas"
   End
   Begin MSComctlLib.TreeView ArbolDefault 
      Height          =   510
      Left            =   8820
      TabIndex        =   6
      Top             =   5715
      Visible         =   0   'False
      Width           =   1035
      _ExtentX        =   1826
      _ExtentY        =   900
      _Version        =   393217
      Indentation     =   18
      LabelEdit       =   1
      LineStyle       =   1
      Style           =   7
      ImageList       =   "img16"
      Appearance      =   1
      OLEDropMode     =   1
   End
   Begin VB.PictureBox picBackground 
      AutoSize        =   -1  'True
      BorderStyle     =   0  'None
      Height          =   1500
      Left            =   6750
      Picture         =   "frmPrincipal.frx":41934
      ScaleHeight     =   1500
      ScaleWidth      =   3750
      TabIndex        =   7
      Top             =   3330
      Visible         =   0   'False
      Width           =   3750
   End
   Begin VB.PictureBox picBackgroundArbol 
      AutoSize        =   -1  'True
      BorderStyle     =   0  'None
      Height          =   1500
      Left            =   6660
      Picture         =   "frmPrincipal.frx":47FE6
      ScaleHeight     =   1500
      ScaleWidth      =   3750
      TabIndex        =   8
      Top             =   4950
      Visible         =   0   'False
      Width           =   3750
   End
   Begin MSComctlLib.ImageList img_cPMenu 
      Left            =   3825
      Top             =   5805
      _ExtentX        =   1005
      _ExtentY        =   1005
      BackColor       =   -2147483643
      ImageWidth      =   16
      ImageHeight     =   16
      MaskColor       =   12632256
      _Version        =   393216
      BeginProperty Images {2C247F25-8591-11D1-B16A-00C0F0283628} 
         NumListImages   =   8
         BeginProperty ListImage1 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":4962F
            Key             =   "Tareas"
         EndProperty
         BeginProperty ListImage2 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":49F09
            Key             =   "Obras"
         EndProperty
         BeginProperty ListImage3 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":4A7E3
            Key             =   "Etapas"
         EndProperty
         BeginProperty ListImage4 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":4B0BD
            Key             =   "Sectores"
         EndProperty
         BeginProperty ListImage5 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":4B997
            Key             =   "TareasNP"
         EndProperty
         BeginProperty ListImage6 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":4C271
            Key             =   "TareasP"
         EndProperty
         BeginProperty ListImage7 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":4CB4B
            Key             =   "TareasM"
         EndProperty
         BeginProperty ListImage8 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":4D425
            Key             =   "Celdas"
         EndProperty
      EndProperty
   End
   Begin MSComctlLib.ImageList img16 
      Left            =   4815
      Top             =   5670
      _ExtentX        =   1005
      _ExtentY        =   1005
      BackColor       =   -2147483643
      ImageWidth      =   16
      ImageHeight     =   16
      MaskColor       =   12632256
      _Version        =   393216
      BeginProperty Images {2C247F25-8591-11D1-B16A-00C0F0283628} 
         NumListImages   =   188
         BeginProperty ListImage1 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":4DCFF
            Key             =   "Abierto1"
         EndProperty
         BeginProperty ListImage2 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":4E151
            Key             =   "Cerrado1"
         EndProperty
         BeginProperty ListImage3 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":4E5A3
            Key             =   "Cerrado"
         EndProperty
         BeginProperty ListImage4 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":4E9F5
            Key             =   "Abierto"
         EndProperty
         BeginProperty ListImage5 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":4EE47
            Key             =   "Ppal"
         EndProperty
         BeginProperty ListImage6 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":4F299
            Key             =   "TablasG"
         EndProperty
         BeginProperty ListImage7 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":51A4B
            Key             =   "Rubros"
         EndProperty
         BeginProperty ListImage8 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":51D65
            Key             =   "Familias"
         EndProperty
         BeginProperty ListImage9 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":5207F
            Key             =   "Subrubros"
         EndProperty
         BeginProperty ListImage10 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":52399
            Key             =   "TTermicos"
         EndProperty
         BeginProperty ListImage11 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":526B3
            Key             =   "Depositos"
         EndProperty
         BeginProperty ListImage12 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":529CD
            Key             =   "Tipos"
         EndProperty
         BeginProperty ListImage13 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":52CE7
            Key             =   "Unidades"
         EndProperty
         BeginProperty ListImage14 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":53001
            Key             =   "Acabados"
         EndProperty
         BeginProperty ListImage15 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":5331B
            Key             =   "Calidades"
         EndProperty
         BeginProperty ListImage16 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":53635
            Key             =   "Materiales"
         EndProperty
         BeginProperty ListImage17 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":5450F
            Key             =   "LAcopio"
         EndProperty
         BeginProperty ListImage18 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":54829
            Key             =   "LMateriales"
         EndProperty
         BeginProperty ListImage19 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":54B43
            Key             =   "InformesC"
         EndProperty
         BeginProperty ListImage20 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":5541D
            Key             =   "EstadosP"
         EndProperty
         BeginProperty ListImage21 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":55737
            Key             =   "MovStock"
         EndProperty
         BeginProperty ListImage22 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":55B89
            Key             =   "ProveedoresRubros"
         EndProperty
         BeginProperty ListImage23 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":55EA3
            Key             =   "Paises"
         EndProperty
         BeginProperty ListImage24 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":561BD
            Key             =   "Relaciones"
         EndProperty
         BeginProperty ListImage25 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":564D7
            Key             =   "CodigosUniversales"
         EndProperty
         BeginProperty ListImage26 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":567F1
            Key             =   "Series"
         EndProperty
         BeginProperty ListImage27 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":570CB
            Key             =   "Formas"
         EndProperty
         BeginProperty ListImage28 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":573E5
            Key             =   "Obras2"
         EndProperty
         BeginProperty ListImage29 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":576FF
            Key             =   "DefinicionesArt"
         EndProperty
         BeginProperty ListImage30 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":57A19
            Key             =   "Obras1"
         EndProperty
         BeginProperty ListImage31 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":57D33
            Key             =   "Schedulers"
         EndProperty
         BeginProperty ListImage32 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":5804D
            Key             =   "Grados"
         EndProperty
         BeginProperty ListImage33 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":58367
            Key             =   "AcoCalidades"
         EndProperty
         BeginProperty ListImage34 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":58681
            Key             =   "AcotarTablas"
         EndProperty
         BeginProperty ListImage35 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":5899B
            Key             =   "AcoMateriales"
         EndProperty
         BeginProperty ListImage36 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":58CB5
            Key             =   "AcoGrados"
         EndProperty
         BeginProperty ListImage37 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":58FCF
            Key             =   "AcoSeries"
         EndProperty
         BeginProperty ListImage38 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":592E9
            Key             =   "AcoTratamientos"
         EndProperty
         BeginProperty ListImage39 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":59603
            Key             =   "Colores"
         EndProperty
         BeginProperty ListImage40 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":5991D
            Key             =   "Normas"
         EndProperty
         BeginProperty ListImage41 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":5A1F7
            Key             =   "AcoTipos"
         EndProperty
         BeginProperty ListImage42 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":5A511
            Key             =   "Equipos"
         EndProperty
         BeginProperty ListImage43 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":5A82B
            Key             =   "Localidades"
         EndProperty
         BeginProperty ListImage44 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":5AB45
            Key             =   "Provincias"
         EndProperty
         BeginProperty ListImage45 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":5AE5F
            Key             =   "Rangos"
         EndProperty
         BeginProperty ListImage46 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":5B179
            Key             =   "Modelos"
         EndProperty
         BeginProperty ListImage47 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":5BA53
            Key             =   "AlimentacionesElectricas"
         EndProperty
         BeginProperty ListImage48 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":5BD6D
            Key             =   "Marcas"
         EndProperty
         BeginProperty ListImage49 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":5DA47
            Key             =   "AniosNorma"
         EndProperty
         BeginProperty ListImage50 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":5E321
            Key             =   "AcoFormas"
         EndProperty
         BeginProperty ListImage51 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":5E63B
            Key             =   "AcoMarcas"
         EndProperty
         BeginProperty ListImage52 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":5E955
            Key             =   "AcoModelos"
         EndProperty
         BeginProperty ListImage53 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":5EC6F
            Key             =   "AcoNormas"
         EndProperty
         BeginProperty ListImage54 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":5EF89
            Key             =   "Planos"
         EndProperty
         BeginProperty ListImage55 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":5F2A3
            Key             =   "AcoCodigos"
         EndProperty
         BeginProperty ListImage56 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":5F5BD
            Key             =   "AcoSchedulers"
         EndProperty
         BeginProperty ListImage57 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":5F8D7
            Key             =   "Codigos"
         EndProperty
         BeginProperty ListImage58 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":5FBF1
            Key             =   "AcoAcabados"
         EndProperty
         BeginProperty ListImage59 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":5FF0B
            Key             =   "CentrosCosto"
         EndProperty
         BeginProperty ListImage60 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":60225
            Key             =   "AcoBiselados"
         EndProperty
         BeginProperty ListImage61 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":6053F
            Key             =   "AcoTiposRosca"
         EndProperty
         BeginProperty ListImage62 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":60859
            Key             =   "CalidadesClad"
         EndProperty
         BeginProperty ListImage63 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":60B73
            Key             =   "TiposRosca"
         EndProperty
         BeginProperty ListImage64 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":60E95
            Key             =   "Biselados"
         EndProperty
         BeginProperty ListImage65 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":61CE7
            Key             =   "Sectores"
         EndProperty
         BeginProperty ListImage66 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":62001
            Key             =   "Cargos"
         EndProperty
         BeginProperty ListImage67 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":6231B
            Key             =   "Densidades"
         EndProperty
         BeginProperty ListImage68 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":62635
            Key             =   "Historicos"
         EndProperty
         BeginProperty ListImage69 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":62A87
            Key             =   "Transportistas"
         EndProperty
         BeginProperty ListImage70 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":63361
            Key             =   "Tarifador"
         EndProperty
         BeginProperty ListImage71 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":63C3B
            Key             =   "HistObras"
         EndProperty
         BeginProperty ListImage72 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":64515
            Key             =   "HLAcopios"
         EndProperty
         BeginProperty ListImage73 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":64DEF
            Key             =   "HLMateriales"
         EndProperty
         BeginProperty ListImage74 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":656C9
            Key             =   "HRequerimientos"
         EndProperty
         BeginProperty ListImage75 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":65FA3
            Key             =   "HPedidos"
         EndProperty
         BeginProperty ListImage76 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":6687D
            Key             =   "Monedas"
         EndProperty
         BeginProperty ListImage77 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":66B97
            Key             =   "ArchivosATransmitirDestinos"
         EndProperty
         BeginProperty ListImage78 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":66EB1
            Key             =   "AcoColores"
         EndProperty
         BeginProperty ListImage79 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":671CB
            Key             =   "ItemsPopUpMateriales"
         EndProperty
         BeginProperty ListImage80 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":6761D
            Key             =   "Comercial"
         EndProperty
         BeginProperty ListImage81 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":67937
            Key             =   "LMaterialesPorObras"
         EndProperty
         BeginProperty ListImage82 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":67C51
            Key             =   "Conceptos"
         EndProperty
         BeginProperty ListImage83 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":67F6B
            Key             =   "OrdenesCompra"
         EndProperty
         BeginProperty ListImage84 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":68285
            Key             =   "Facturas"
         EndProperty
         BeginProperty ListImage85 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":6859F
            Key             =   "Devoluciones"
         EndProperty
         BeginProperty ListImage86 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":688B9
            Key             =   "NotasDebito"
         EndProperty
         BeginProperty ListImage87 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":68BD3
            Key             =   "NotasCredito"
         EndProperty
         BeginProperty ListImage88 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":68EED
            Key             =   "Recibos"
         EndProperty
         BeginProperty ListImage89 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":697C7
            Key             =   "CtasCtesD"
         EndProperty
         BeginProperty ListImage90 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":6A0A1
            Key             =   "CtasCtesA"
         EndProperty
         BeginProperty ListImage91 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":6A97B
            Key             =   "Valores"
         EndProperty
         BeginProperty ListImage92 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":6B255
            Key             =   "DepositosBancarios"
         EndProperty
         BeginProperty ListImage93 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":6B56F
            Key             =   "ComprobantesPrv"
         EndProperty
         BeginProperty ListImage94 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":6B889
            Key             =   "OPago"
         EndProperty
         BeginProperty ListImage95 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":6BBA3
            Key             =   "Contabilidad"
         EndProperty
         BeginProperty ListImage96 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":6CA7D
            Key             =   "RubrosContables"
         EndProperty
         BeginProperty ListImage97 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":6CD97
            Key             =   "Subdiarios"
         EndProperty
         BeginProperty ListImage98 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":6D0B1
            Key             =   "Asientos"
         EndProperty
         BeginProperty ListImage99 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":6D3CB
            Key             =   "Articulos"
         EndProperty
         BeginProperty ListImage100 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":6D81D
            Key             =   "Empleados"
         EndProperty
         BeginProperty ListImage101 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":6DB37
            Key             =   "Obras"
         EndProperty
         BeginProperty ListImage102 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":6DE51
            Key             =   "Compras"
         EndProperty
         BeginProperty ListImage103 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":6E16B
            Key             =   "AnexosEquipos"
         EndProperty
         BeginProperty ListImage104 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":6E485
            Key             =   "Requerimientos"
         EndProperty
         BeginProperty ListImage105 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":6E79F
            Key             =   "Cotizaciones"
         EndProperty
         BeginProperty ListImage106 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":6EAB9
            Key             =   "Vendedores"
         EndProperty
         BeginProperty ListImage107 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":6EDD3
            Key             =   "Bancos"
         EndProperty
         BeginProperty ListImage108 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":6F0ED
            Key             =   "Cuentas"
         EndProperty
         BeginProperty ListImage109 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":6F53F
            Key             =   "CuentasGastos"
         EndProperty
         BeginProperty ListImage110 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":6F991
            Key             =   "UnidadesOperativas"
         EndProperty
         BeginProperty ListImage111 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":6FAEB
            Key             =   "Conciliaciones"
         EndProperty
         BeginProperty ListImage112 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":6FE05
            Key             =   "CuentasBancarias"
         EndProperty
         BeginProperty ListImage113 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":7011F
            Key             =   "Ganancias"
         EndProperty
         BeginProperty ListImage114 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":70439
            Key             =   "DiferenciasCambio_P"
         EndProperty
         BeginProperty ListImage115 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":70753
            Key             =   "Clientes"
         EndProperty
         BeginProperty ListImage116 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":70A6D
            Key             =   "Remitos"
         EndProperty
         BeginProperty ListImage117 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":70D87
            Key             =   "TiposCuentaGrupos"
         EndProperty
         BeginProperty ListImage118 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":710A1
            Key             =   "Conjuntos"
         EndProperty
         BeginProperty ListImage119 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":713BB
            Key             =   "ControlesCalidad"
         EndProperty
         BeginProperty ListImage120 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":72B4D
            Key             =   "BancoChequeras"
         EndProperty
         BeginProperty ListImage121 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":72E67
            Key             =   "Ubicaciones"
         EndProperty
         BeginProperty ListImage122 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":73181
            Key             =   "ListasPrecios"
         EndProperty
         BeginProperty ListImage123 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":734A3
            Key             =   "DiferenciasCambio_C"
         EndProperty
         BeginProperty ListImage124 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":737BD
            Key             =   "Cajas"
         EndProperty
         BeginProperty ListImage125 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":74097
            Key             =   "ConciliacionesCajas"
         EndProperty
         BeginProperty ListImage126 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":743B1
            Key             =   "AnticiposAlPersonal"
         EndProperty
         BeginProperty ListImage127 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":74803
            Key             =   "PlazosFijos"
         EndProperty
         BeginProperty ListImage128 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":74B1D
            Key             =   "PuntosVenta"
         EndProperty
         BeginProperty ListImage129 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":74E37
            Key             =   "IBCondiciones"
         EndProperty
         BeginProperty ListImage130 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":75151
            Key             =   "CondicionesCompra"
         EndProperty
         BeginProperty ListImage131 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":7546B
            Key             =   "Proveedores"
         EndProperty
         BeginProperty ListImage132 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":75785
            Key             =   "Comparativas"
         EndProperty
         BeginProperty ListImage133 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":75A9F
            Key             =   "Pedidos"
         EndProperty
         BeginProperty ListImage134 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":75DB9
            Key             =   "Presupuestos"
         EndProperty
         BeginProperty ListImage135 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":760D3
            Key             =   "ResumenesParaConciliacion"
         EndProperty
         BeginProperty ListImage136 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":763ED
            Key             =   "EmisionCheques"
         EndProperty
         BeginProperty ListImage137 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":76707
            Key             =   "VentasCuotas"
         EndProperty
         BeginProperty ListImage138 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":76A21
            Key             =   "VentasCuotasOperacion"
         EndProperty
         BeginProperty ListImage139 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":76D3B
            Key             =   "VentasCuotasCobranzas"
         EndProperty
         BeginProperty ListImage140 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":77055
            Key             =   "CoeficientesContables"
         EndProperty
         BeginProperty ListImage141 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":77377
            Key             =   "CoeficientesImpositivos"
         EndProperty
         BeginProperty ListImage142 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":77691
            Key             =   "ActivoFijo"
         EndProperty
         BeginProperty ListImage143 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":779AB
            Key             =   "ModificacionActivoFijo"
         EndProperty
         BeginProperty ListImage144 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":77CC5
            Key             =   "GruposActivosFijos"
         EndProperty
         BeginProperty ListImage145 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":77FDF
            Key             =   "IGCondiciones"
         EndProperty
         BeginProperty ListImage146 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":782F9
            Key             =   "Revaluos"
         EndProperty
         BeginProperty ListImage147 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":78613
            Key             =   "PresupuestoFinanciero"
         EndProperty
         BeginProperty ListImage148 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":7892D
            Key             =   "PresupuestoEconomico"
         EndProperty
         BeginProperty ListImage149 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":78C47
            Key             =   "ImpuestosDirectos"
         EndProperty
         BeginProperty ListImage150 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":78F61
            Key             =   "EjerciciosContables"
         EndProperty
         BeginProperty ListImage151 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":7927B
            Key             =   "GastosBancarios"
         EndProperty
         BeginProperty ListImage152 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":79595
            Key             =   "GruposObras"
         EndProperty
         BeginProperty ListImage153 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":798AF
            Key             =   "Recepciones"
         EndProperty
         BeginProperty ListImage154 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":79BC9
            Key             =   "SalidaMateriales"
         EndProperty
         BeginProperty ListImage155 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":79EE3
            Key             =   "AjustesStock"
         EndProperty
         BeginProperty ListImage156 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":7A1FD
            Key             =   "Reservas"
         EndProperty
         BeginProperty ListImage157 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":7A517
            Key             =   "OtrosIngresosAlmacen"
         EndProperty
         BeginProperty ListImage158 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":7ADF1
            Key             =   "ValesSalida"
         EndProperty
         BeginProperty ListImage159 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":7B10B
            Key             =   "CCalidades"
         EndProperty
         BeginProperty ListImage160 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":7B425
            Key             =   "PosicionesImportacion"
         EndProperty
         BeginProperty ListImage161 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":7B73F
            Key             =   "CostosImportacion"
         EndProperty
         BeginProperty ListImage162 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":7C019
            Key             =   "ActividadesP"
         EndProperty
         BeginProperty ListImage163 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":7C333
            Key             =   "SolicitudesCompra"
         EndProperty
         BeginProperty ListImage164 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":7C64D
            Key             =   "DistribucionesObras"
         EndProperty
         BeginProperty ListImage165 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":7C967
            Key             =   "CashFlow"
         EndProperty
         BeginProperty ListImage166 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":7CC81
            Key             =   "HChequeras"
         EndProperty
         BeginProperty ListImage167 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":7D55B
            Key             =   "TarjetasCredito"
         EndProperty
         BeginProperty ListImage168 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":7D875
            Key             =   "OrdenesTrabajo"
         EndProperty
         BeginProperty ListImage169 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":7DB8F
            Key             =   "ChequesPendientes"
         EndProperty
         BeginProperty ListImage170 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":7DEA9
            Key             =   "FondosFijos"
         EndProperty
         BeginProperty ListImage171 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":7E443
            Key             =   "TiposComprobante"
         EndProperty
         BeginProperty ListImage172 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":7E9DD
            Key             =   "ProntoSAT"
         EndProperty
         BeginProperty ListImage173 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":7EF77
            Key             =   "PresupuestoObras"
         EndProperty
         BeginProperty ListImage174 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":7F511
            Key             =   "PresupuestoObrasRubros"
         EndProperty
         BeginProperty ListImage175 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":7FAAB
            Key             =   "Traducciones"
         EndProperty
         BeginProperty ListImage176 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":80385
            Key             =   "Clausulas"
         EndProperty
         BeginProperty ListImage177 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":80C5F
            Key             =   "UnidadesEmpaque"
         EndProperty
         BeginProperty ListImage178 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":81539
            Key             =   "CertificacionesObra"
         EndProperty
         BeginProperty ListImage179 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":81E13
            Key             =   "Subcontratos"
         EndProperty
         BeginProperty ListImage180 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":826ED
            Key             =   "PresupuestoObrasGruposMateriales"
         EndProperty
         BeginProperty ListImage181 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":82C87
            Key             =   "CtrlTransp"
         EndProperty
         BeginProperty ListImage182 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":83561
            Key             =   "Choferes"
         EndProperty
         BeginProperty ListImage183 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":8387B
            Key             =   "TarifasFletes"
         EndProperty
         BeginProperty ListImage184 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":84155
            Key             =   "Fletes"
         EndProperty
         BeginProperty ListImage185 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":8446F
            Key             =   "GastosFletes"
         EndProperty
         BeginProperty ListImage186 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":84D49
            Key             =   "LiquidacionesFletes"
         EndProperty
         BeginProperty ListImage187 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":85063
            Key             =   "AutorizacionesCompra"
         EndProperty
         BeginProperty ListImage188 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmPrincipal.frx":8537D
            Key             =   "PartesProduccion"
         EndProperty
      EndProperty
   End
   Begin FiscalPrinterLibCtl.HASAR HASAR1 
      Left            =   5985
      OleObjectBlob   =   "frmPrincipal.frx":8762F
      Top             =   5715
   End
   Begin VB.Menu mnuMaster 
      Caption         =   "&Archivo"
      Index           =   0
      Begin VB.Menu mnuFileA 
         Caption         =   "&Nuevo"
         Index           =   0
         Shortcut        =   ^N
      End
      Begin VB.Menu mnuFileA 
         Caption         =   "&Exportar a Excel"
         Index           =   1
         Shortcut        =   ^S
      End
      Begin VB.Menu mnuFileA 
         Caption         =   "&Imprimir"
         Index           =   2
      End
      Begin VB.Menu mnuFileA 
         Caption         =   "&Copiar"
         Index           =   3
      End
      Begin VB.Menu mnuFileA 
         Caption         =   "&Buscar"
         Index           =   4
      End
      Begin VB.Menu mnuFileA 
         Caption         =   "&Salir"
         Index           =   5
      End
   End
   Begin VB.Menu mnuMaster 
      Caption         =   "&Vistas"
      Index           =   1
      Begin VB.Menu mnuViewA 
         Caption         =   "Iconos &Grandes"
         Index           =   0
      End
      Begin VB.Menu mnuViewA 
         Caption         =   "Iconos &Pequeños"
         Index           =   1
      End
      Begin VB.Menu mnuViewA 
         Caption         =   "&Lista"
         Index           =   2
      End
      Begin VB.Menu mnuViewA 
         Caption         =   "&Detalles"
         Index           =   3
      End
   End
   Begin VB.Menu mnuMaster 
      Caption         =   "&Consultas"
      Index           =   2
      Begin VB.Menu MnuSub 
         Caption         =   "Almacenes"
         Index           =   0
         Begin VB.Menu MnuSubA 
            Caption         =   "Requerimientos pendientes de asignacion"
            Index           =   0
         End
         Begin VB.Menu MnuSubA 
            Caption         =   "Notas de pedido pendientes de recibir (Resumen)"
            Index           =   1
         End
         Begin VB.Menu MnuSubA 
            Caption         =   "Notas de pedido pendientes de recibir (Detallado, todos los pedidos)"
            Index           =   2
         End
         Begin VB.Menu MnuSubA 
            Caption         =   "Vales emitidos no retirados (Detallado o Resumido)"
            Index           =   3
         End
         Begin VB.Menu MnuSubA 
            Caption         =   "Vales de retiro de materiales faltantes por obra"
            Index           =   4
         End
         Begin VB.Menu MnuSubA 
            Caption         =   "Cardex"
            Index           =   5
         End
         Begin VB.Menu MnuSubA 
            Caption         =   "Transporte de mercaderia"
            Index           =   6
         End
         Begin VB.Menu MnuSubA 
            Caption         =   "Reservas de stock pendientes"
            Index           =   7
         End
         Begin VB.Menu MnuSubA 
            Caption         =   "Informe de remitos de proveedores"
            Index           =   8
         End
         Begin VB.Menu MnuSubA 
            Caption         =   "Informe de vales de consumo"
            Index           =   9
         End
         Begin VB.Menu MnuSubA 
            Caption         =   "Informe de salida de materiales"
            Index           =   10
         End
         Begin VB.Menu MnuSubA 
            Caption         =   "Estadistica de ventas por rubro-articulo"
            Index           =   11
         End
         Begin VB.Menu MnuSubA 
            Caption         =   "Ordenes de trabajo"
            Index           =   12
         End
         Begin VB.Menu MnuSubA 
            Caption         =   "Items de ordenes de compra pendientes de remitir"
            Index           =   13
         End
         Begin VB.Menu MnuSubA 
            Caption         =   "Items de ordenes de compra pendientes de facturar"
            Index           =   14
         End
         Begin VB.Menu MnuSubA 
            Caption         =   "Detalle de comprobantes por partida"
            Index           =   15
         End
      End
      Begin VB.Menu MnuSub 
         Caption         =   "Compras"
         Index           =   1
         Begin VB.Menu MnuSubC 
            Caption         =   "Requerimientos y listas de acopio pendientes sin nota de pedido"
            Index           =   0
         End
         Begin VB.Menu MnuSubC 
            Caption         =   "Notas de pedido pendientes de recibir"
            Index           =   1
         End
         Begin VB.Menu MnuSubC 
            Caption         =   "Notas de pedido pendientes de recibir (Detallado, todos los pedidos)"
            Index           =   2
         End
         Begin VB.Menu MnuSubC 
            Caption         =   "Estado general de entregas por obra - equipo"
            Index           =   3
         End
         Begin VB.Menu MnuSubC 
            Caption         =   "Activacion de compras de materiales"
            Index           =   4
         End
         Begin VB.Menu MnuSubC 
            Caption         =   "Listas de precios segun pedidos"
            Index           =   5
         End
         Begin VB.Menu MnuSubC 
            Caption         =   "Informe de compras efectuadas por terceros"
            Index           =   6
         End
         Begin VB.Menu MnuSubC 
            Caption         =   "Informe de registro de notas de pedido"
            Index           =   7
         End
         Begin VB.Menu MnuSubC 
            Caption         =   "Asignacion de costos de importacion a pedidos"
            Index           =   8
         End
         Begin VB.Menu MnuSubC 
            Caption         =   "Subcontratos - Certificaciones"
            Index           =   9
         End
         Begin VB.Menu MnuSubC 
            Caption         =   "Comparativas (Cubo)"
            Index           =   10
         End
         Begin VB.Menu MnuSubC 
            Caption         =   "Requerimientos dados por cumplidos y/o anulados"
            Index           =   11
         End
         Begin VB.Menu MnuSubC 
            Caption         =   "Listado de costos por obra"
            Index           =   12
         End
         Begin VB.Menu MnuSubC 
            Caption         =   "Recepciones pendientes de ingreso de comprobante"
            Index           =   13
         End
         Begin VB.Menu MnuSubC 
            Caption         =   "Estado de pedidos abiertos"
            Index           =   14
         End
         Begin VB.Menu MnuSubC 
            Caption         =   "Pedidos pendientes por fecha de vencimiento"
            Index           =   15
         End
         Begin VB.Menu MnuSubC 
            Caption         =   "Subcontratos - Resumen"
            Index           =   16
         End
         Begin VB.Menu MnuSubC 
            Caption         =   "Notas de pedido y materiales recibidos"
            Index           =   17
         End
         Begin VB.Menu MnuSubC 
            Caption         =   "Seguimiento de compras"
            Index           =   18
         End
         Begin VB.Menu MnuSubC 
            Caption         =   "Nota de pedido con items dados por cumplido"
            Index           =   19
         End
         Begin VB.Menu MnuSubC 
            Caption         =   "Modificacion de costos"
            Index           =   20
         End
      End
      Begin VB.Menu MnuSub 
         Caption         =   "Proveedores"
         Index           =   2
         Begin VB.Menu MnuSubPrv 
            Caption         =   "Retenciones y Percepciones"
            Index           =   0
            Begin VB.Menu MnuSubPrvRet 
               Caption         =   "CITI"
               Index           =   0
            End
            Begin VB.Menu MnuSubPrvRet 
               Caption         =   "SICORE"
               Index           =   1
               Begin VB.Menu MnuSubPrvRetSIC 
                  Caption         =   "Retenciones de impuesto a las ganancias (Control)"
                  Index           =   0
               End
               Begin VB.Menu MnuSubPrvRetSIC 
                  Caption         =   "Generacion SICORE"
                  Index           =   1
               End
               Begin VB.Menu MnuSubPrvRetSIC 
                  Caption         =   "Retenciones de IVA"
                  Index           =   2
               End
               Begin VB.Menu MnuSubPrvRetSIC 
                  Caption         =   "Percepciones de IVA"
                  Index           =   3
               End
            End
            Begin VB.Menu MnuSubPrvRet 
               Caption         =   "SUSS"
               Index           =   2
            End
            Begin VB.Menu MnuSubPrvRet 
               Caption         =   "Retenciones IIBB (Pagos)"
               Index           =   3
            End
            Begin VB.Menu MnuSubPrvRet 
               Caption         =   "SIFERE"
               Index           =   4
               Begin VB.Menu MnuSubPrvRetSIF 
                  Caption         =   "Percepciones IIBB (Compras) - Convenio multilateral"
                  Index           =   0
               End
               Begin VB.Menu MnuSubPrvRetSIF 
                  Caption         =   "Percepciones IIBB (Compras) - Jurisdiccion local"
                  Index           =   1
               End
               Begin VB.Menu MnuSubPrvRetSIF 
                  Caption         =   "SIRCREB"
                  Index           =   2
               End
            End
         End
         Begin VB.Menu MnuSubPrv 
            Caption         =   "Resumen de compras por proveedor"
            Index           =   1
         End
         Begin VB.Menu MnuSubPrv 
            Caption         =   "Ranking de compras por proveedor"
            Index           =   2
         End
         Begin VB.Menu MnuSubPrv 
            Caption         =   "Listado de comprobantes ingresados"
            Index           =   3
         End
         Begin VB.Menu MnuSubPrv 
            Caption         =   "Listado de saldos de proveedores"
            Index           =   4
         End
         Begin VB.Menu MnuSubPrv 
            Caption         =   "Comprobantes pendientes de imputacion"
            Index           =   5
         End
         Begin VB.Menu MnuSubPrv 
            Caption         =   "Detalle de saldos por tipo de proveedor"
            Index           =   6
         End
         Begin VB.Menu MnuSubPrv 
            Caption         =   "OP's de fondo fijo pendientes de control (dif. cambio)"
            Index           =   7
         End
         Begin VB.Menu MnuSubPrv 
            Caption         =   "Deuda vencida a fecha"
            Index           =   8
         End
         Begin VB.Menu MnuSubPrv 
            Caption         =   "Listado de ordenes de pago"
            Index           =   9
         End
         Begin VB.Menu MnuSubPrv 
            Caption         =   "Listado de proveedores - rubros provistos"
            Index           =   10
         End
         Begin VB.Menu MnuSubPrv 
            Caption         =   "Listado de saldos de proveedores entre fechas"
            Index           =   11
         End
         Begin VB.Menu MnuSubPrv 
            Caption         =   "Listado resumen de fondos fijos por rendicion"
            Index           =   12
         End
         Begin VB.Menu MnuSubPrv 
            Caption         =   "Anticipos a proveedores"
            Index           =   13
         End
         Begin VB.Menu MnuSubPrv 
            Caption         =   "Caja egresos"
            Index           =   14
         End
         Begin VB.Menu MnuSubPrv 
            Caption         =   "Listado de saldos de fondos fijos (todos)"
            Index           =   15
         End
      End
      Begin VB.Menu MnuSub 
         Caption         =   "Clientes"
         Index           =   3
         Begin VB.Menu MnuSubCli 
            Caption         =   "Retenciones y Percepciones"
            Index           =   0
            Begin VB.Menu MnuSubCliRet 
               Caption         =   "SICORE"
               Index           =   0
               Begin VB.Menu MnuSubCliRetSIC 
                  Caption         =   "Generacion SICORE"
                  Index           =   0
               End
               Begin VB.Menu MnuSubCliRetSIC 
                  Caption         =   "Retenciones de IVA"
                  Index           =   1
               End
               Begin VB.Menu MnuSubCliRetSIC 
                  Caption         =   "Percepciones de IVA"
                  Index           =   2
               End
            End
            Begin VB.Menu MnuSubCliRet 
               Caption         =   "Retenciones SUSS"
               Index           =   1
            End
            Begin VB.Menu MnuSubCliRet 
               Caption         =   "Percepciones IIBB"
               Index           =   2
            End
            Begin VB.Menu MnuSubCliRet 
               Caption         =   "Retenciones IIBB (Cobranzas) - SIFERE"
               Index           =   3
            End
            Begin VB.Menu MnuSubCliRet 
               Caption         =   "CITI"
               Index           =   4
            End
         End
         Begin VB.Menu MnuSubCli 
            Caption         =   "Resumen de ventas por cliente"
            Index           =   1
         End
         Begin VB.Menu MnuSubCli 
            Caption         =   "Ranking de ventas por cliente"
            Index           =   2
         End
         Begin VB.Menu MnuSubCli 
            Caption         =   "Listado de comprobantes ingresados"
            Index           =   3
         End
         Begin VB.Menu MnuSubCli 
            Caption         =   "Listado de saldos de clientes"
            Index           =   4
         End
         Begin VB.Menu MnuSubCli 
            Caption         =   "Remitos pendientes de facturar"
            Index           =   5
         End
         Begin VB.Menu MnuSubCli 
            Caption         =   "Desarrollo de items de ordenes de compra (Por facturacion)"
            Index           =   6
         End
         Begin VB.Menu MnuSubCli 
            Caption         =   "Desarrollo de items de ordenes de compra (Por remitos)"
            Index           =   7
         End
         Begin VB.Menu MnuSubCli 
            Caption         =   "Creditos vencidos a fecha"
            Index           =   8
         End
         Begin VB.Menu MnuSubCli 
            Caption         =   "Caja ingresos"
            Index           =   9
         End
         Begin VB.Menu MnuSubCli 
            Caption         =   "Analisis de cobranzas"
            Index           =   10
         End
         Begin VB.Menu MnuSubCli 
            Caption         =   "Listado de pedidos"
            Index           =   11
         End
         Begin VB.Menu MnuSubCli 
            Caption         =   "Cobranzas por cobrador"
            Index           =   12
         End
         Begin VB.Menu MnuSubCli 
            Caption         =   "Ranking de ventas por vendedor"
            Index           =   13
         End
         Begin VB.Menu MnuSubCli 
            Caption         =   "Entregas / Devoluciones"
            Index           =   14
         End
         Begin VB.Menu MnuSubCli 
            Caption         =   "Analisis de cobranzas / facturacion"
            Index           =   15
         End
         Begin VB.Menu MnuSubCli 
            Caption         =   "Control de facturacion electronica"
            Index           =   16
         End
         Begin VB.Menu MnuSubCli 
            Caption         =   "Remitos - Movimiento de materiales por cliente"
            Index           =   17
         End
         Begin VB.Menu MnuSubCli 
            Caption         =   "Resumen por certificaciones de obra"
            Index           =   18
         End
      End
      Begin VB.Menu MnuSub 
         Caption         =   "Fabrica"
         Index           =   4
         Begin VB.Menu MnuSubF 
            Caption         =   "Disponibilidad de materiales (segun lista de materiales)"
            Index           =   0
         End
         Begin VB.Menu MnuSubF 
            Caption         =   "Consulta de revisiones"
            Index           =   1
            Visible         =   0   'False
         End
         Begin VB.Menu MnuSubF 
            Caption         =   "Informe general de controles de calidad"
            Index           =   2
         End
         Begin VB.Menu MnuSubF 
            Caption         =   "Informe de materiales recibidos"
            Index           =   3
         End
         Begin VB.Menu MnuSubF 
            Caption         =   "Informe de materiales recibidos y aprobados"
            Index           =   4
         End
         Begin VB.Menu MnuSubF 
            Caption         =   "Materiales controlados - remitos de rechazo"
            Index           =   5
         End
         Begin VB.Menu MnuSubF 
            Caption         =   "Informe de materiales recibidos con datos de transporte"
            Index           =   6
         End
         Begin VB.Menu MnuSubF 
            Caption         =   "Informe de salida de materiales con datos de transporte"
            Index           =   7
         End
      End
      Begin VB.Menu MnuSub 
         Caption         =   "Obras"
         Index           =   5
         Begin VB.Menu MnuSubO 
            Caption         =   "Obras, equipos y planos"
            Index           =   0
         End
         Begin VB.Menu MnuSubO 
            Caption         =   "Estado de polizas"
            Index           =   1
         End
         Begin VB.Menu MnuSubO 
            Caption         =   "Detalle de equipos instalados por fecha"
            Index           =   2
         End
      End
      Begin VB.Menu MnuSub 
         Caption         =   "Planeamiento"
         Index           =   6
         Begin VB.Menu MnuSubP 
            Caption         =   "Listados de acopio sumarizados por obra"
            Index           =   0
            Visible         =   0   'False
         End
         Begin VB.Menu MnuSubP 
            Caption         =   "Listados de materiales sumarizados por obra"
            Index           =   1
         End
         Begin VB.Menu MnuSubP 
            Caption         =   "Requerimientos de materiales sumarizados por obra"
            Index           =   2
         End
         Begin VB.Menu MnuSubP 
            Caption         =   "LM - LA - RM - RS"
            Index           =   3
         End
         Begin VB.Menu MnuSubP 
            Caption         =   "Reservas de stock sumarizados por obra"
            Index           =   4
         End
         Begin VB.Menu MnuSubP 
            Caption         =   "Requerimientos y listas de acopio pendientes sin nota de pedido"
            Index           =   5
         End
         Begin VB.Menu MnuSubP 
            Caption         =   "Activacion de compras de materiales"
            Index           =   6
         End
         Begin VB.Menu MnuSubP 
            Caption         =   "Costos de materiales por equipo"
            Index           =   7
         End
         Begin VB.Menu MnuSubP 
            Caption         =   "Historico de equipos instalados"
            Index           =   8
         End
         Begin VB.Menu MnuSubP 
            Caption         =   "Salidas de materiales"
            Index           =   9
         End
         Begin VB.Menu MnuSubP 
            Caption         =   "Informe de gastos por OT"
            Index           =   10
         End
         Begin VB.Menu MnuSubP 
            Caption         =   "Control lista de materiales salidas por destino"
            Index           =   11
         End
         Begin VB.Menu MnuSubP 
            Caption         =   "Desarrollo de items de RM's"
            Index           =   12
         End
         Begin VB.Menu MnuSubP 
            Caption         =   "Analisis de materiales en obra y desvios"
            Index           =   13
         End
         Begin VB.Menu MnuSubP 
            Caption         =   "Asignacion de salidas y comprobantes a presupuesto de obra"
            Index           =   14
         End
         Begin VB.Menu MnuSubP 
            Caption         =   "Asignacion de tarifas de fletes"
            Index           =   15
         End
         Begin VB.Menu MnuSubP 
            Caption         =   "Liquidacion de fletes"
            Index           =   16
         End
         Begin VB.Menu MnuSubP 
            Caption         =   "Salida de materiales - control de transportistas"
            Index           =   17
         End
         Begin VB.Menu MnuSubP 
            Caption         =   "Requerimientos con desliberaciones y/o eliminacion de firmas"
            Index           =   18
         End
         Begin VB.Menu MnuSubP 
            Caption         =   "Control de facturas y recepciones"
            Index           =   19
         End
      End
      Begin VB.Menu MnuSub 
         Caption         =   "Stock"
         Index           =   7
         Begin VB.Menu MnuSubS 
            Caption         =   "Reservas de stock (General o por obra)"
            Index           =   0
         End
         Begin VB.Menu MnuSubS 
            Caption         =   "Stock actual (General)"
            Index           =   1
         End
         Begin VB.Menu MnuSubS 
            Caption         =   "Stock actual (Por articulo - partida)"
            Index           =   2
         End
         Begin VB.Menu MnuSubS 
            Caption         =   "Costos promedios ponderados"
            Index           =   3
         End
         Begin VB.Menu MnuSubS 
            Caption         =   "Stock de articulos a fecha"
            Index           =   4
         End
         Begin VB.Menu MnuSubS 
            Caption         =   "Stock de articulos a fecha (Cubo)"
            Index           =   5
         End
         Begin VB.Menu MnuSubS 
            Caption         =   "Control stock reposicion - minimo"
            Index           =   6
         End
      End
      Begin VB.Menu MnuSub 
         Caption         =   "Contabilidad"
         Index           =   8
         Begin VB.Menu MnuSubCo 
            Caption         =   "Diario"
            Index           =   0
         End
         Begin VB.Menu MnuSubCo 
            Caption         =   "Mayor de cuentas detallado"
            Index           =   1
         End
         Begin VB.Menu MnuSubCo 
            Caption         =   "Balance de sumas y saldos"
            Index           =   2
         End
         Begin VB.Menu MnuSubCo 
            Caption         =   "Balance de sumas y saldos (con apertura)"
            Index           =   3
         End
         Begin VB.Menu MnuSubCo 
            Caption         =   "Resumen por rubros contables"
            Index           =   4
         End
         Begin VB.Menu MnuSubCo 
            Caption         =   "IVA Ventas"
            Index           =   5
         End
         Begin VB.Menu MnuSubCo 
            Caption         =   "IVA Compras"
            Index           =   6
         End
         Begin VB.Menu MnuSubCo 
            Caption         =   "Resolucion 1361"
            Index           =   7
         End
         Begin VB.Menu MnuSubCo 
            Caption         =   "Resolucion 1547"
            Index           =   8
         End
         Begin VB.Menu MnuSubCo 
            Caption         =   "Activo fijo"
            Index           =   9
            Begin VB.Menu MnuDetAF 
               Caption         =   "Amortizaciones activo fijo (contable)"
               Index           =   0
            End
            Begin VB.Menu MnuDetAF 
               Caption         =   "Revaluo activo fijo"
               Index           =   1
               Visible         =   0   'False
            End
            Begin VB.Menu MnuDetAF 
               Caption         =   "Amortizaciones activo fijo (impositivo)"
               Index           =   2
            End
         End
         Begin VB.Menu MnuSubCo 
            Caption         =   "Cierre de ejercicio"
            Index           =   10
         End
         Begin VB.Menu MnuSubCo 
            Caption         =   "Apertura de ejercicio"
            Index           =   11
         End
         Begin VB.Menu MnuSubCo 
            Caption         =   "Detalle imputaciones por rubro p/presupuesto financiero"
            Index           =   12
         End
         Begin VB.Menu MnuSubCo 
            Caption         =   "Cuadro de ingresos y egresos"
            Index           =   13
            Begin VB.Menu MnuSubCoA 
               Caption         =   "Defincion de cuadro"
               Index           =   0
            End
            Begin VB.Menu MnuSubCoA 
               Caption         =   "Emision de cuadro"
               Index           =   1
            End
         End
         Begin VB.Menu MnuSubCo 
            Caption         =   "Cuadro de flujo de caja y estado de resultados"
            Index           =   14
            Begin VB.Menu MnuSubCoB 
               Caption         =   "Definicion de cuadros"
               Index           =   0
            End
            Begin VB.Menu MnuSubCoB 
               Caption         =   "Emision de flujo de caja"
               Index           =   1
            End
            Begin VB.Menu MnuSubCoB 
               Caption         =   "Emision de flujo de caja (x Mes + Proyectado) Modelo 1"
               Index           =   2
            End
            Begin VB.Menu MnuSubCoB 
               Caption         =   "Emision de flujo de caja (Mes + Acumulado)"
               Index           =   3
            End
            Begin VB.Menu MnuSubCoB 
               Caption         =   "Emision de flujo de caja (x Mes + Proyectado) Modelo 2"
               Index           =   4
            End
            Begin VB.Menu MnuSubCoB 
               Caption         =   "Emision de flujo de caja (x Mes + Desvios)"
               Index           =   5
            End
            Begin VB.Menu MnuSubCoB 
               Caption         =   "Emision de estado de resultados (x Mes + Desvios) Modelo 1"
               Index           =   6
            End
            Begin VB.Menu MnuSubCoB 
               Caption         =   "Emision de estado de resultados (x Mes + Desvios) Modelo 2"
               Index           =   7
            End
            Begin VB.Menu MnuSubCoB 
               Caption         =   "Emision de estado de resultados (x Mes + Proyectado)"
               Index           =   8
            End
            Begin VB.Menu MnuSubCoB 
               Caption         =   "Emision de estado de resultados (x Mes + Acumulado) Modelo 1"
               Index           =   9
            End
            Begin VB.Menu MnuSubCoB 
               Caption         =   "Emision de estado de resultados (x Mes + Acumulado) Modelo 2"
               Index           =   10
            End
         End
         Begin VB.Menu MnuSubCo 
            Caption         =   "IVA Compras detallado"
            Index           =   15
         End
         Begin VB.Menu MnuSubCo 
            Caption         =   "Subdiarios"
            Index           =   16
            Begin VB.Menu MnuSubCoC 
               Caption         =   "Subdiario de proveedores"
               Index           =   0
            End
            Begin VB.Menu MnuSubCoC 
               Caption         =   "Subdiario de pagos"
               Index           =   1
            End
            Begin VB.Menu MnuSubCoC 
               Caption         =   "Subdiario de clientes"
               Index           =   2
            End
            Begin VB.Menu MnuSubCoC 
               Caption         =   "Subdiario de caja y bancos"
               Index           =   3
            End
            Begin VB.Menu MnuSubCoC 
               Caption         =   "Subdiario de cobranzas"
               Index           =   4
            End
            Begin VB.Menu MnuSubCoC 
               Caption         =   "Subdiario de iva ventas"
               Index           =   5
            End
            Begin VB.Menu MnuSubCoC 
               Caption         =   "Subdiario de iva compras"
               Index           =   6
            End
         End
         Begin VB.Menu MnuSubCo 
            Caption         =   "Diario IGJ"
            Index           =   17
         End
      End
      Begin VB.Menu MnuSub 
         Caption         =   "Informes Gerenciales"
         Index           =   9
         Begin VB.Menu MnuSubCom 
            Caption         =   "Ordenes de compra pendientes de facturar"
            Index           =   0
         End
         Begin VB.Menu MnuSubCom 
            Caption         =   "Proyeccion de egresos"
            Index           =   1
         End
         Begin VB.Menu MnuSubCom 
            Caption         =   "Proyeccion de egresos (detallados)"
            Index           =   2
         End
         Begin VB.Menu MnuSubCom 
            Caption         =   "Cuadro de gastos (detallados)"
            Index           =   4
         End
         Begin VB.Menu MnuSubCom 
            Caption         =   "Ventas (detalladas)"
            Index           =   7
         End
         Begin VB.Menu MnuSubCom 
            Caption         =   "Resumen posicion financiera"
            Index           =   8
         End
         Begin VB.Menu MnuSubCom 
            Caption         =   "Cuadro de Ingresos - Egresos por Obra"
            Index           =   9
         End
         Begin VB.Menu MnuSubCom 
            Caption         =   "Analisis de comprobantes para presupuesto financiero"
            Index           =   10
         End
         Begin VB.Menu MnuSubCom 
            Caption         =   "Presupuesto financiero por rubro contable"
            Index           =   11
         End
         Begin VB.Menu MnuSubCom 
            Caption         =   "Presupuesto economico por cuenta"
            Index           =   12
         End
         Begin VB.Menu MnuSubCom 
            Caption         =   "Saldos de comprobantes por proveedor - obra"
            Index           =   13
         End
         Begin VB.Menu MnuSubCom 
            Caption         =   "IVA ventas - compras por obra"
            Index           =   14
         End
         Begin VB.Menu MnuSubCom 
            Caption         =   "Costos de importacion"
            Index           =   15
         End
         Begin VB.Menu MnuSubCom 
            Caption         =   "Ventas en cuotas"
            Index           =   16
         End
         Begin VB.Menu MnuSubCom 
            Caption         =   "Reserva presupuestaria"
            Index           =   17
         End
         Begin VB.Menu MnuSubCom 
            Caption         =   "AVL"
            Index           =   18
         End
         Begin VB.Menu MnuSubCom 
            Caption         =   "Reintegros (ComEx)"
            Index           =   19
         End
         Begin VB.Menu MnuSubCom 
            Caption         =   "Comprobantes comercio exterior"
            Index           =   20
         End
         Begin VB.Menu MnuSubCom 
            Caption         =   "Analisis Pedidos - Entregas"
            Index           =   21
         End
         Begin VB.Menu MnuSubCom 
            Caption         =   "Resumen posicion financiera (Cubo)"
            Index           =   22
         End
         Begin VB.Menu MnuSubCom 
            Caption         =   "Cuadro de Egresos (detallados por obra)"
            Index           =   23
         End
         Begin VB.Menu MnuSubCom 
            Caption         =   "Resumen posicion financiera 2"
            Index           =   24
         End
      End
      Begin VB.Menu MnuSub 
         Caption         =   "Bancos"
         Index           =   10
         Begin VB.Menu MnuSubBco 
            Caption         =   "Valores a depositar"
            Index           =   0
         End
         Begin VB.Menu MnuSubBco 
            Caption         =   "Saldos a fecha"
            Index           =   1
         End
         Begin VB.Menu MnuSubBco 
            Caption         =   "Retenciones"
            Index           =   2
         End
         Begin VB.Menu MnuSubBco 
            Caption         =   "Valores diferidos pendientes"
            Index           =   3
         End
         Begin VB.Menu MnuSubBco 
            Caption         =   "Cheques anulados"
            Index           =   4
         End
         Begin VB.Menu MnuSubBco 
            Caption         =   "Posicion bancos"
            Index           =   5
         End
      End
      Begin VB.Menu MnuSub 
         Caption         =   "Personal"
         Index           =   11
         Begin VB.Menu MnuSubPer 
            Caption         =   "Estado anticipos al personal"
            Index           =   0
         End
      End
      Begin VB.Menu MnuSub 
         Caption         =   "ProntoSat"
         Index           =   12
         Begin VB.Menu MnuSubSAT 
            Caption         =   "Control de remitos a SAT"
            Index           =   0
         End
         Begin VB.Menu MnuSubSAT 
            Caption         =   "Recepciones en SAT"
            Index           =   1
         End
      End
   End
   Begin VB.Menu mnuMaster 
      Caption         =   "&Seguridad"
      Index           =   4
      Begin VB.Menu MnuSeg 
         Caption         =   "Definicion de accesos"
         Index           =   0
      End
      Begin VB.Menu MnuSeg 
         Caption         =   "Definicion de autorizaciones"
         Index           =   1
      End
      Begin VB.Menu MnuSeg 
         Caption         =   "Autorizacion de documentos"
         Index           =   2
      End
      Begin VB.Menu MnuSeg 
         Caption         =   "Control del circuito de firmas"
         Index           =   3
      End
      Begin VB.Menu MnuSeg 
         Caption         =   "Control de lotes transmitidos a obras/terceros"
         Index           =   4
         Visible         =   0   'False
      End
      Begin VB.Menu MnuSeg 
         Caption         =   "Destinatarios de mensajes por eventos del sistema"
         Index           =   5
      End
      Begin VB.Menu MnuSeg 
         Caption         =   "Ver mensajes para usuario actual"
         Index           =   6
      End
      Begin VB.Menu MnuSeg 
         Caption         =   "Definicion de anulacion de comprobantes"
         Index           =   7
      End
      Begin VB.Menu MnuSeg 
         Caption         =   "Log de movimientos"
         Index           =   8
      End
      Begin VB.Menu MnuSeg 
         Caption         =   "Configuracion de usuarios (Pronto Ini)"
         Index           =   9
      End
   End
   Begin VB.Menu mnuMaster 
      Caption         =   "&Utilidades"
      Index           =   5
      Begin VB.Menu MnuUti 
         Caption         =   "Importacion de comprobantes"
         Index           =   0
         Begin VB.Menu MnuUtiImp 
            Caption         =   "Importacion de datos desde Presto"
            Index           =   0
         End
         Begin VB.Menu MnuUtiImp 
            Caption         =   "Importacion de datos desde Presto (Access)"
            Index           =   1
         End
         Begin VB.Menu MnuUtiImp 
            Caption         =   "Importacion de datos desde DataNet"
            Index           =   2
         End
         Begin VB.Menu MnuUtiImp 
            Caption         =   "Importacion de conjuntos ( Excel )"
            Index           =   3
         End
         Begin VB.Menu MnuUtiImp 
            Caption         =   "Importacion de cobranzas ( valores )"
            Index           =   4
         End
         Begin VB.Menu MnuUtiImp 
            Caption         =   "Importacion de cobranzas ( efectivo )"
            Index           =   5
         End
         Begin VB.Menu MnuUtiImp 
            Caption         =   "Importacion de cobranzas ( TXT )"
            Index           =   6
         End
         Begin VB.Menu MnuUtiImp 
            Caption         =   "Importacion de cobranzas ( Pago Facil )"
            Index           =   7
         End
         Begin VB.Menu MnuUtiImp 
            Caption         =   "Importacion de comprobantes de proveedores desde obra"
            Index           =   8
         End
         Begin VB.Menu MnuUtiImp 
            Caption         =   "Importacion de comprobantes de fondo fijo desde obra"
            Index           =   9
         End
         Begin VB.Menu MnuUtiImp 
            Caption         =   "Importacion de ordenes de pago ( Excel )"
            Index           =   10
         End
         Begin VB.Menu MnuUtiImp 
            Caption         =   "Importacion de requerimientos ( Excel )"
            Index           =   11
         End
         Begin VB.Menu MnuUtiImp 
            Caption         =   "Importacion de articulos ( Excel )"
            Index           =   12
         End
         Begin VB.Menu MnuUtiImp 
            Caption         =   "Importacion de comprobantes de proveedores desde obra (Tipo FF)"
            Index           =   13
         End
         Begin VB.Menu MnuUtiImp 
            Caption         =   "Importacion de asientos contables"
            Index           =   14
         End
         Begin VB.Menu MnuUtiImp 
            Caption         =   "Importacion de notas de debito ( Excel )"
            Index           =   15
         End
         Begin VB.Menu MnuUtiImp 
            Caption         =   "Importacion de cobranzas ( Santander Rio )"
            Index           =   16
         End
         Begin VB.Menu MnuUtiImp 
            Caption         =   "Importacion de proveedores"
            Index           =   17
         End
         Begin VB.Menu MnuUtiImp 
            Caption         =   "Importacion de comprobantes de venta (FA - ND - NC)"
            Index           =   18
         End
         Begin VB.Menu MnuUtiImp 
            Caption         =   "Importacion de ajustes de stock"
            Index           =   19
         End
         Begin VB.Menu MnuUtiImp 
            Caption         =   "Importacion de salida de materiales (con equipo destino)"
            Index           =   20
         End
      End
      Begin VB.Menu MnuUti 
         Caption         =   "Utilidades PRONTO"
         Index           =   1
         Begin VB.Menu MnuUtiPRONTO 
            Caption         =   "Enviar novedades a PRONTO SAT"
            Index           =   0
         End
         Begin VB.Menu MnuUtiPRONTO 
            Caption         =   "Enviar tablas completas a PRONTO SAT"
            Index           =   1
         End
         Begin VB.Menu MnuUtiPRONTO 
            Caption         =   "Importar novedades desde PRONTO SAT"
            Index           =   2
         End
         Begin VB.Menu MnuUtiPRONTO 
            Caption         =   "Enviar novedades a PRONTO MANTENIMIENTO"
            Index           =   3
         End
         Begin VB.Menu MnuUtiPRONTO 
            Caption         =   "Exportar comprobantes (XML)"
            Index           =   4
         End
         Begin VB.Menu MnuUtiPRONTO 
            Caption         =   "Enviar tablas completas a PRONTO"
            Index           =   5
         End
         Begin VB.Menu MnuUtiPRONTO 
            Caption         =   "Importar novedades desde PRONTO"
            Index           =   6
         End
         Begin VB.Menu MnuUtiPRONTO 
            Caption         =   "Enviar tablas completas a PRONTO BALANZA"
            Index           =   7
         End
         Begin VB.Menu MnuUtiPRONTO 
            Caption         =   "Importar novedades desde PRONTO BALANZA"
            Index           =   8
         End
         Begin VB.Menu MnuUtiPRONTO 
            Caption         =   "Generar MDB para Presto"
            Index           =   9
         End
      End
      Begin VB.Menu MnuUti 
         Caption         =   "Generacion automatica de facturas de venta anuladas"
         Index           =   2
      End
      Begin VB.Menu MnuUti 
         Caption         =   "Anulacion masiva de facturas generadas (ya existentes)"
         Index           =   3
      End
      Begin VB.Menu MnuUti 
         Caption         =   "Prefacturacion (desde ordenes de compra automaticas)"
         Index           =   4
      End
      Begin VB.Menu MnuUti 
         Caption         =   "Generacion de facturas (desde ordenes de compra automaticas)"
         Index           =   5
      End
      Begin VB.Menu MnuUti 
         Caption         =   "Registro de ingreso de bienes de uso"
         Index           =   6
      End
      Begin VB.Menu MnuUti 
         Caption         =   "Generar/Importar informacion impositiva"
         Index           =   7
      End
      Begin VB.Menu MnuUti 
         Caption         =   "Definicion de bases para consolidacion"
         Index           =   8
      End
      Begin VB.Menu MnuUti 
         Caption         =   "Consolidacion contable"
         Index           =   9
      End
      Begin VB.Menu MnuUti 
         Caption         =   "Cierre Z"
         Index           =   10
      End
      Begin VB.Menu MnuUti 
         Caption         =   "Definir grupos de cuentas para ajustes en subdiarios"
         Index           =   11
      End
      Begin VB.Menu MnuUti 
         Caption         =   "Generar archivo de debitos por facturacion para bancos"
         Index           =   12
      End
      Begin VB.Menu MnuUti 
         Caption         =   "Cambios de ubicacion de materiales"
         Index           =   13
      End
      Begin VB.Menu MnuUti 
         Caption         =   "Generacion de pagos por lote de deuda"
         Index           =   14
      End
      Begin VB.Menu MnuUti 
         Caption         =   "Generacion de asiento de sueldos desde distribucion de horas"
         Index           =   15
      End
   End
   Begin VB.Menu mnuMaster 
      Caption         =   "?"
      Index           =   6
      Begin VB.Menu MnuAyuda 
         Caption         =   "Acerca de ..."
         Index           =   0
      End
      Begin VB.Menu MnuAyuda 
         Caption         =   "Ayuda"
         Index           =   1
      End
   End
   Begin VB.Menu MnuDet 
      Caption         =   "Funciones varias"
      Visible         =   0   'False
      Begin VB.Menu MnuDetA 
         Caption         =   "Generar email"
         Index           =   0
      End
      Begin VB.Menu MnuDetA 
         Caption         =   "Crear material similar"
         Index           =   1
         Visible         =   0   'False
      End
      Begin VB.Menu MnuDetA 
         Caption         =   "Orden de pago entregada"
         Index           =   2
         Visible         =   0   'False
      End
      Begin VB.Menu MnuDetA 
         Caption         =   "Pasar a pendiente de firma"
         Index           =   3
         Visible         =   0   'False
      End
      Begin VB.Menu MnuDetA 
         Caption         =   "Pasar a caja"
         Index           =   4
         Visible         =   0   'False
      End
      Begin VB.Menu MnuDetA 
         Caption         =   "Generar pedidos en Word (con impresion)"
         Index           =   5
      End
      Begin VB.Menu MnuDetA 
         Caption         =   "Generar requerimientos en Word (con impresion)"
         Index           =   6
      End
      Begin VB.Menu MnuDetA 
         Caption         =   "Eliminar comprobante(s)"
         Index           =   7
      End
      Begin VB.Menu MnuDetA 
         Caption         =   "Eliminar RM's"
         Index           =   8
      End
      Begin VB.Menu MnuDetA 
         Caption         =   "Generar pedidos borrador en Word (con impresion)"
         Index           =   9
      End
      Begin VB.Menu MnuDetA 
         Caption         =   "Marcar RM como impresa"
         Index           =   10
      End
      Begin VB.Menu MnuDetA 
         Caption         =   "Desmarcar RM como impresa"
         Index           =   11
      End
      Begin VB.Menu MnuDetA 
         Caption         =   "Marcar Pedido como impreso"
         Index           =   12
      End
      Begin VB.Menu MnuDetA 
         Caption         =   "Desmarcar Pedido como impreso"
         Index           =   13
      End
      Begin VB.Menu MnuDetA 
         Caption         =   "Enviar RM a Proveedores por correo"
         Index           =   14
      End
      Begin VB.Menu MnuDetA 
         Caption         =   "Registrar fecha de salida del pedido"
         Index           =   15
      End
      Begin VB.Menu MnuDetA 
         Caption         =   "Enviar RM a Proveedores por fax"
         Index           =   16
      End
      Begin VB.Menu MnuDetA 
         Caption         =   "Modificar imputacion de RM"
         Index           =   17
         Visible         =   0   'False
      End
      Begin VB.Menu MnuDetA 
         Caption         =   "Pasar a caja obra"
         Index           =   18
         Visible         =   0   'False
      End
   End
   Begin VB.Menu MnuDif 
      Caption         =   "DiferenciasCambio"
      Visible         =   0   'False
      Begin VB.Menu MnuDifA 
         Caption         =   "Eliminar registro"
         Index           =   0
      End
      Begin VB.Menu MnuDifA 
         Caption         =   "Generar comprobante"
         Index           =   1
         Visible         =   0   'False
      End
      Begin VB.Menu MnuDifA 
         Caption         =   "Ver registros generados anteriormente"
         Index           =   2
         Visible         =   0   'False
      End
      Begin VB.Menu MnuDifA 
         Caption         =   "Quitar registros ya generados"
         Index           =   3
         Visible         =   0   'False
      End
      Begin VB.Menu MnuDifA 
         Caption         =   "Marcar registro"
         Index           =   4
      End
      Begin VB.Menu MnuDifA 
         Caption         =   "Desmarcar registro"
         Index           =   5
      End
      Begin VB.Menu MnuDifA 
         Caption         =   "Mostrar proceso de detallado de calculo en registros marcados"
         Index           =   6
      End
   End
   Begin VB.Menu MnuArt 
      Caption         =   "FuncionesArticulos"
      Visible         =   0   'False
      Begin VB.Menu MnuArtA 
         Caption         =   "Aplicar alicuota IVA"
         Index           =   0
      End
      Begin VB.Menu MnuArtA 
         Caption         =   "Recalcular costo promedio ponderado"
         Index           =   1
      End
      Begin VB.Menu MnuArtA 
         Caption         =   "Emision de etiquetas"
         Index           =   2
      End
      Begin VB.Menu MnuArtA 
         Caption         =   "Emision de etiquetas (Zebra)"
         Index           =   3
      End
   End
   Begin VB.Menu MnuAsi 
      Caption         =   "FuncionesAsientos"
      Visible         =   0   'False
      Begin VB.Menu MnuAsiA 
         Caption         =   "Renumeracion de asientos"
         Index           =   0
      End
      Begin VB.Menu MnuAsiA 
         Caption         =   "Copiar el asiento a uno nuevo"
         Index           =   1
      End
      Begin VB.Menu MnuAsiA 
         Caption         =   "Revertir el asiento"
         Index           =   2
      End
   End
   Begin VB.Menu MnuConc 
      Caption         =   "FuncionesConciliacion"
      Visible         =   0   'False
      Begin VB.Menu MnuConcA 
         Caption         =   "Conciliacion"
         Index           =   0
      End
      Begin VB.Menu MnuConcA 
         Caption         =   "Marcar como conciliado"
         Index           =   1
      End
      Begin VB.Menu MnuConcA 
         Caption         =   "Desmarcar conciliacion"
         Index           =   2
      End
      Begin VB.Menu MnuConcA 
         Caption         =   "Marcar como confirmado (debitado o acreditado)"
         Index           =   3
      End
      Begin VB.Menu MnuConcA 
         Caption         =   "Desmarcar confirmacion"
         Index           =   4
      End
      Begin VB.Menu MnuConcA 
         Caption         =   "Quitar marca de aprobacion"
         Index           =   5
      End
   End
   Begin VB.Menu MnuEmiCh 
      Caption         =   "FuncionesEmisionCheques"
      Visible         =   0   'False
      Begin VB.Menu MnuEmiChA 
         Caption         =   "Emision de cheques"
         Index           =   0
      End
      Begin VB.Menu MnuEmiChA 
         Caption         =   "Marcar como emitido"
         Index           =   1
      End
      Begin VB.Menu MnuEmiChA 
         Caption         =   "Marcar como NO emitido"
         Index           =   2
      End
      Begin VB.Menu MnuEmiChA 
         Caption         =   "Cambiar beneficiario"
         Index           =   3
      End
   End
   Begin VB.Menu MnuEmiOP 
      Caption         =   "FuncionesOrdenesPago"
      Visible         =   0   'False
      Begin VB.Menu MnuEmiOP1 
         Caption         =   "Emitir ordenes de pago (Impresora)"
         Index           =   0
      End
      Begin VB.Menu MnuEmiOP1 
         Caption         =   "Emitir ordenes de pago (Word)"
         Index           =   1
      End
      Begin VB.Menu MnuEmiOP1 
         Caption         =   "Eliminar OP's a confirmar"
         Index           =   2
      End
      Begin VB.Menu MnuEmiOP1 
         Caption         =   "Pasar a caja"
         Index           =   3
      End
      Begin VB.Menu MnuEmiOP1 
         Caption         =   "Confirmar acreditacion de FF"
         Index           =   4
      End
      Begin VB.Menu MnuEmiOP1 
         Caption         =   "Pasar a caja obra"
         Index           =   5
      End
   End
   Begin VB.Menu MnuObras 
      Caption         =   "FuncionesObras"
      Visible         =   0   'False
      Begin VB.Menu MnuObrasA 
         Caption         =   "Datos de obras (impresora)"
         Index           =   0
      End
      Begin VB.Menu MnuObrasA 
         Caption         =   "Datos de obras (Word)"
         Index           =   1
      End
      Begin VB.Menu MnuObrasA 
         Caption         =   "Certificado de servicios"
         Index           =   2
      End
   End
   Begin VB.Menu mnuFncProv 
      Caption         =   "FuncionesProveedores"
      Visible         =   0   'False
      Begin VB.Menu mnuFncProvA 
         Caption         =   "Pasar proveedor eventual a definitivo"
         Index           =   0
      End
   End
   Begin VB.Menu mnuFncCli 
      Caption         =   "FuncionesClientes"
      Visible         =   0   'False
      Begin VB.Menu mnuFncCliA 
         Caption         =   "Marcar ordenes de compra como cumplidas"
         Index           =   0
      End
      Begin VB.Menu mnuFncCliA 
         Caption         =   "Desmarcar ordenes de compra como cumplidas"
         Index           =   1
      End
      Begin VB.Menu mnuFncCliA 
         Caption         =   "Marcar ordenes de compra para facturacion automatica"
         Index           =   2
      End
      Begin VB.Menu mnuFncCliA 
         Caption         =   "Desmarcar ordenes de compra para facturacion automatica"
         Index           =   3
      End
      Begin VB.Menu mnuFncCliA 
         Caption         =   "Liberar ordenes de compra"
         Index           =   4
      End
   End
   Begin VB.Menu mnuFncCuo 
      Caption         =   "FuncionesVentasEnCuotas"
      Visible         =   0   'False
      Begin VB.Menu mnuFncCuoA 
         Caption         =   "Eliminar generacion"
         Index           =   0
      End
      Begin VB.Menu mnuFncCuoA 
         Caption         =   "Modificar fechas de vencimiento"
         Index           =   1
      End
   End
   Begin VB.Menu mnuFncFac 
      Caption         =   "FuncionesFacturas"
      Visible         =   0   'False
      Begin VB.Menu mnuFncFacA 
         Caption         =   "Emitir facturas (Impresora)"
         Index           =   0
      End
      Begin VB.Menu mnuFncFacA 
         Caption         =   "Emitir facturas (Word)"
         Index           =   1
      End
      Begin VB.Menu mnuFncFacA 
         Caption         =   "Eliminacion de facturas anuladas"
         Index           =   2
      End
   End
   Begin VB.Menu mnuFncNC 
      Caption         =   "FuncionesNC"
      Visible         =   0   'False
      Begin VB.Menu mnuFncNCA 
         Caption         =   "Emitir notas de credito (Impresora)"
         Index           =   0
      End
      Begin VB.Menu mnuFncNCA 
         Caption         =   "Emitir notas de credito (Word)"
         Index           =   1
      End
   End
   Begin VB.Menu mnuFncND 
      Caption         =   "FuncionesND"
      Visible         =   0   'False
      Begin VB.Menu mnuFncNDA 
         Caption         =   "Emitir notas de debito (Impresora)"
         Index           =   0
      End
      Begin VB.Menu mnuFncNDA 
         Caption         =   "Emitir notas de debito (Word)"
         Index           =   1
      End
   End
   Begin VB.Menu mnuFncAcc 
      Caption         =   "FuncionesAccesos"
      Visible         =   0   'False
      Begin VB.Menu mnuFncAccA 
         Caption         =   "Asignar acceso por usuarios"
         Index           =   0
      End
   End
   Begin VB.Menu mnuFncPE 
      Caption         =   "FuncionesPresupuestoEconomico"
      Visible         =   0   'False
      Begin VB.Menu mnuFncPEA 
         Caption         =   "Distribuir teoricos por matrices"
         Index           =   0
      End
   End
   Begin VB.Menu mnuFncCP 
      Caption         =   "FuncionesComprobantesProveedores"
      Visible         =   0   'False
      Begin VB.Menu mnuFncCPA 
         Caption         =   "Regrabar comprobantes de proveedores"
         Index           =   0
      End
      Begin VB.Menu mnuFncCPA 
         Caption         =   "Recalcular y grabar comprobantes de proveedores"
         Index           =   1
      End
      Begin VB.Menu mnuFncCPA 
         Caption         =   "Definir destino de pago"
         Index           =   2
      End
      Begin VB.Menu mnuFncCPA 
         Caption         =   "Seleccionar comprobantes desde archivo externo"
         Index           =   3
      End
      Begin VB.Menu mnuFncCPA 
         Caption         =   "Definir OP de fondo de reparo"
         Index           =   4
      End
   End
   Begin VB.Menu mnuFncCG 
      Caption         =   "FuncionesCuentasGastos"
      Visible         =   0   'False
      Begin VB.Menu mnuFncCGA 
         Caption         =   "Activar"
         Index           =   0
      End
      Begin VB.Menu mnuFncCGA 
         Caption         =   "Desactivar"
         Index           =   1
      End
   End
   Begin VB.Menu mnuFncAPSyJ 
      Caption         =   "FuncionesAnticiposAlPersonalSyJ"
      Visible         =   0   'False
      Begin VB.Menu mnuFncAPSyJA 
         Caption         =   "Transferir anticipos al SyJ"
         Index           =   0
      End
   End
   Begin VB.Menu mnuFncFF 
      Caption         =   "FuncionesFondoFijo"
      Visible         =   0   'False
      Begin VB.Menu mnuFncFFA 
         Caption         =   "Cerrar rendicion"
         Index           =   0
      End
   End
   Begin VB.Menu mnuFncConj 
      Caption         =   "FuncionesConjuntos"
      Visible         =   0   'False
      Begin VB.Menu mnuFncConjA 
         Caption         =   "Recalcular costo Kits"
         Index           =   0
      End
   End
   Begin VB.Menu mnuFncRubros 
      Caption         =   "FuncionesRubros"
      Visible         =   0   'False
      Begin VB.Menu mnuFncRubrosA 
         Caption         =   "Asignar mascaras de articulos"
         Index           =   0
      End
   End
   Begin VB.Menu mnuFncSubrubros 
      Caption         =   "FuncionesSubrubros"
      Visible         =   0   'False
      Begin VB.Menu mnuFncSubrubrosA 
         Caption         =   "Asignar mascaras de articulos"
         Index           =   0
      End
   End
   Begin VB.Menu mnuFncRec 
      Caption         =   "FuncionesRecibos"
      Visible         =   0   'False
      Begin VB.Menu mnuFncRecA 
         Caption         =   "Emitir recibos (Impresora)"
         Index           =   0
      End
      Begin VB.Menu mnuFncRecA 
         Caption         =   "Emitir recibos (Word)"
         Index           =   1
      End
   End
   Begin VB.Menu mnuFncChk 
      Caption         =   "FuncionesCheques"
      Visible         =   0   'False
      Begin VB.Menu mnuFncChkA 
         Caption         =   "Marcar como rechazado"
         Index           =   0
      End
   End
   Begin VB.Menu mnuFncCtas 
      Caption         =   "Funciones cuentas contables"
      Visible         =   0   'False
      Begin VB.Menu mnuFncCtasA 
         Caption         =   "Eliminar cuentas contables"
         Index           =   0
      End
   End
End
Attribute VB_Name = "frmPrincipal"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Option Explicit

Dim mnuVerP(3) As Menu
Dim Ultimo_Nodo As String
Dim Accesos(800, 3) As String
Dim VerNovedades As Boolean, VerPedidosHistoricos As Boolean
Dim UltimoNodoSeleccionado As Node
Private mLOCALE_SMONDECIMALSEP As String, mLOCALE_SMONTHOUSANDSEP As String, mLOCALE_SDECIMAL As String
Private mLOCALE_STHOUSAND As String, mIdiomaInicial As String
Private mFechaParaPlanCuentas As Date

Const NAME_COLUMN = 0
Const TYPE_COLUMN = 1
Const SIZE_COLUMN = 2
Const DATE_COLUMN = 3
Const MargenBotones As Integer = 10

Private Declare Function OSWinHelp% Lib "User32" Alias "WinHelpA" (ByVal hwnd&, ByVal HelpFile$, ByVal wCommand%, dwData As Any)

Dim WithEvents ActL As ControlForm
Attribute ActL.VB_VarHelpID = -1

Sub EditarConsulta(ByVal Mnu As String, ByVal Item As Long, Optional ByVal mTitulo As String)

   Dim oF As Form
   Dim NoModal As Boolean
   Dim mOpcionAcceso As String
   
   NoModal = False
   
   Select Case Mnu
      Case "A"
         Select Case Item
            Case 0
               Set oF = New frmConsulta2
               With oF
                  .Id = 89
                  .Show vbModal, Me
               End With
            Case 1
               Set oF = New frmConsultaPedidos
               With oF
                  .Show vbModal, Me
               End With
            Case 2
               Set oF = New frmConsultasGenerales
               With oF
                  .Id = 1
                  .Show vbModal, Me
               End With
            Case 3
               Set oF = New frmConsultaValesPendientes
               With oF
                  .Show vbModal, Me
               End With
            Case 4
               Set oF = New frmConsultaValesFaltantes
               With oF
                  .Obra = 0
                  .Show vbModal, Me
               End With
            Case 5
               Set oF = New frmCardex
               With oF
                  .Show vbModal, Me
               End With
            Case 6
               Set oF = New frmConsultasGenerales
               With oF
                  .Id = 5
                  .Show vbModal, Me
               End With
            Case 7
               Set oF = New frmConsultaReservasAuto
               With oF
                  .Show vbModal, Me
               End With
            Case 8
               Set oF = New frmExcel1
               With oF
                  .Codigo = "RemProv"
                  .Planilla = "ComprasTerceros"
                  .Titulo = mTitulo
                  .Show vbModal, Me
               End With
            Case 9
               Set oF = New frmExcel1
               With oF
                  .Codigo = "ValCons"
                  .Planilla = "ComprasTerceros"
                  .Titulo = mTitulo
                  .Show vbModal, Me
               End With
            Case 10
               Set oF = New frmExcel1
               With oF
                  .Codigo = "Salidas"
                  .Planilla = "ComprasTerceros"
                  .Titulo = mTitulo
                  .Show vbModal, Me
               End With
            Case 11
               Set oF = New frmConsulta2
               With oF
                  .Id = 90
                  .Show vbModal, Me
               End With
            Case 12
               Set oF = New frmConsulta2
               With oF
                  .Id = 92
                  .Show vbModal, Me
               End With
            Case 13
               Set oF = New frmConsulta1
               With oF
                  .Id = 16
                  .Show vbModal, Me
               End With
            Case 14
               Set oF = New frmConsulta1
               With oF
                  .Id = 7
                  .Show vbModal, Me
               End With
            Case 15
               Set oF = New frmConsulta3
               With oF
                  .Id = 11
                  .Show vbModal, Me
               End With
         End Select
      
      Case "C"
         Select Case Item
            Case 0
               Set oF = New frmConsultaRMPendientes
               With oF
                  .Id = "Compras"
                  .Show vbModal, Me
               End With
            Case 1
               Set oF = New frmConsultasGenerales
               With oF
                  .Id = 2
                  .Show vbModal, Me
               End With
            Case 2
               Set oF = New frmConsultasGenerales
               With oF
                  .Id = 1
                  .Show vbModal, Me
               End With
            Case 3
               NoModal = True
               Set oF = New frmConsultaEstadoObras
               With oF
                  .Show , Me
               End With
            Case 4
               NoModal = True
               Set oF = New frmConsultaActivacionCompras
               With oF
                  .Show , Me
               End With
            Case 5
               Set oF = New frmConsulta2
               With oF
                  .Id = 42
                  .Show vbModal, Me
               End With
            Case 6
               Set oF = New frmExcel1
               With oF
                  .Codigo = "ComTer"
                  .Planilla = "ComprasTerceros"
                  .Titulo = mTitulo
                  .Show vbModal, Me
               End With
            Case 7
               Set oF = New frmExcel1
               With oF
                  .Codigo = "RegPed"
                  .Planilla = "ComprasTerceros"
                  .Titulo = mTitulo
                  .Show vbModal, Me
               End With
            Case 8
               Set oF = New frmConsulta2
               With oF
                  .Id = 70
                  .Show vbModal, Me
               End With
            Case 9
               MsgBox "Opcion desactivada!", vbInformation
               Exit Sub
               Set oF = New frmExcel1
               With oF
                  .Codigo = "Subcontratos"
                  .Planilla = "ComprasTerceros"
                  .Titulo = mTitulo
                  .Show vbModal, Me
               End With
            Case 10
               Set oF = New frmConsulta2
               With oF
                  .Id = 77
                  .Show vbModal, Me
               End With
            Case 11
               Set oF = New frmConsulta3
               With oF
                  .Id = 94
                  .Show vbModal, Me
               End With
            Case 12
               Set oF = New frmConsulta3
               With oF
                  .Id = 2
                  .Show vbModal, Me
               End With
            Case 13
               Set oF = New frmConsulta3
               With oF
                  .Id = 5
                  .Show vbModal, Me
               End With
            Case 14
               Set oF = New frmConsulta3
               With oF
                  .Id = 6
                  .Show vbModal, Me
               End With
            Case 15
               Set oF = New frmConsulta3
               With oF
                  .Id = 20
                  .Show vbModal, Me
               End With
            Case 16
               Set oF = New frmExcel1
               With oF
                  .Codigo = "SubcontratosResumen"
                  .Planilla = "ComprasTerceros"
                  .Titulo = mTitulo
                  .Show vbModal, Me
               End With
            Case 17
               Set oF = New frmConsulta3
               With oF
                  .Id = 114
                  .Show vbModal, Me
               End With
            Case 18
               Set oF = New frmExcel1
               With oF
                  .Codigo = "SeguimientoCompras"
                  .Planilla = "ComprasTerceros"
                  .Titulo = mTitulo
                  .Show vbModal, Me
               End With
            Case 19
               Set oF = New frmConsulta3
               With oF
                  .Id = 123
                  .Show vbModal, Me
               End With
            Case 20
               Set oF = New frmConsulta3
               With oF
                  .Id = 124
                  .Show vbModal, Me
               End With
         End Select
      
      Case "Prv"
         Select Case Item
            Case 1
               Set oF = New frmInformesContables
               With oF
                  .Id = 100 + Item
                  .Show vbModal, Me
               End With
            Case 2
               Set oF = New frmConsulta2
               With oF
                  .Id = 20
                  .Show vbModal, Me
               End With
            Case 3
               Set oF = New frmConsulta2
               With oF
                  .Id = 21
                  .Show vbModal, Me
               End With
            Case 4
               Set oF = New frmConsulta2
               With oF
                  .Id = 22
                  .Show vbModal, Me
               End With
            Case 5
               Set oF = New frmConsulta2
               With oF
                  .Id = 24
                  .Show vbModal, Me
               End With
            Case 6
               Set oF = New frmConsulta2
               With oF
                  .Id = 25
                  .Show vbModal, Me
               End With
            Case 7
               Set oF = New frmConsulta2
               With oF
                  .Id = 36
                  .Show vbModal, Me
               End With
            Case 8
               NoModal = True
               Set oF = New frmConsulta2
               With oF
                  .Id = 26
                  .Show , Me
               End With
            Case 9
               Set oF = New frmConsulta2
               With oF
                  .Id = 53
                  .Show vbModal, Me
               End With
            Case 10
               Set oF = New frmConsulta2
               With oF
                  .Id = 56
                  .Show vbModal, Me
               End With
            Case 11
               Set oF = New frmConsulta2
               With oF
                  .Id = 61
                  .Show vbModal, Me
               End With
            Case 12
               Set oF = New frmExcel1
               With oF
                  .Codigo = "ResFF"
                  .Planilla = "ComprasTerceros"
                  .Titulo = mTitulo
                  .Show vbModal, Me
               End With
            Case 13
               Set oF = New frmConsulta3
               With oF
                  .Id = 111
                  .Show vbModal, Me
               End With
            Case 14
               Set oF = New frmConsulta3
               With oF
                  .Id = 9
                  .Show vbModal, Me
               End With
            Case 15
               Set oF = New frmConsulta3
               With oF
                  .Id = 21
                  .Show vbModal, Me
               End With
         End Select
      
      Case "PrvRet"
         Select Case Item
            Case 0
               Set oF = New frmConsulta2
               With oF
                  .Id = 14
                  .Show vbModal, Me
               End With
            Case 2
               Set oF = New frmConsulta2
               With oF
                  .Id = 41
                  .Show vbModal, Me
               End With
            Case 3
               Set oF = New frmConsulta2
               With oF
                  .Id = 44
                  .Show vbModal, Me
               End With
         End Select
      
      Case "PrvRetSIC"
         Select Case Item
            Case 0
               Set oF = New frmConsulta2
               With oF
                  .Id = 23
                  .Show vbModal, Me
               End With
            Case 1
               Set oF = New frmConsulta2
               With oF
                  .Id = 31
                  .Show vbModal, Me
               End With
            Case 2
               Set oF = New frmConsulta2
               With oF
                  .Id = 38
                  .Show vbModal, Me
               End With
            Case 3
               Set oF = New frmConsulta2
               With oF
                  .Id = 40
                  .Show vbModal, Me
               End With
         End Select
      
      Case "PrvRetSIF"
         Select Case Item
            Case 0
               Set oF = New frmConsulta2
               With oF
                  .Id = 84
                  .Show vbModal, Me
               End With
            Case 1
               Set oF = New frmConsulta3
               With oF
                  .Id = 112
                  .Show vbModal, Me
               End With
            Case 2
               Set oF = New frmConsulta3
               With oF
                  .Id = 105
                  .Show vbModal, Me
               End With
         End Select
      
      Case "F"
         Select Case Item
            Case 0
               NoModal = True
               Set oF = New frmConsultasGenerales
               With oF
                  .Id = 3
                  .Show , Me
               End With
            Case 1
               Set oF = New frmConsulta1
               With oF
                  .Id = 3
                  .Show vbModal, Me
               End With
            Case 2
               ImprimirConExcelDesdeRs Aplicacion.ControlesCalidad.TraerFiltrado("_Alfabetico"), "Controles de calidad"
            Case 3
               Set oF = New frmExcel1
               With oF
                  .Codigo = "MatRec"
                  .Planilla = "ComprasTerceros"
                  .Titulo = mTitulo
                  .Show vbModal, Me
               End With
            Case 4
               Set oF = New frmExcel1
               With oF
                  .Codigo = "MatRecAprob"
                  .Planilla = "ComprasTerceros"
                  .Titulo = mTitulo
                  .Show vbModal, Me
               End With
            Case 5
               Set oF = New frmConsulta2
               With oF
                  .Id = 95
                  .Show vbModal, Me
               End With
            Case 6
               Set oF = New frmExcel1
               With oF
                  .Codigo = "MatRecTransp"
                  .Planilla = "ComprasTerceros"
                  .Titulo = mTitulo
                  .Show vbModal, Me
               End With
            Case 7
               Set oF = New frmExcel1
               With oF
                  .Codigo = "SalMatTransp"
                  .Planilla = "ComprasTerceros"
                  .Titulo = mTitulo
                  .Show vbModal, Me
               End With
         End Select
   
      Case "O"
         Select Case Item
            Case 0
               Set oF = New frmConsulta1
               With oF
                  .Id = 2
                  .Show vbModal, Me
               End With
            Case 1
               Set oF = New frmConsulta2
               With oF
                  .Id = 58
                  .Show vbModal, Me
               End With
            Case 2
               Set oF = New frmConsulta2
               With oF
                  .Id = 87
                  .Show vbModal, Me
               End With
         End Select
   
      Case "P"
         Select Case Item
            Case 0
               Set oF = New frmConsultaDeSumarizacion
               With oF
                  .Id = 1
                  .Obra = 0
                  .Show vbModal, Me
               End With
            Case 1
               Set oF = New frmConsultaDeSumarizacion
               With oF
                  .Id = 2
                  .Obra = 0
                  .Show vbModal, Me
               End With
            Case 2
               Set oF = New frmConsultaDeSumarizacion
               With oF
                  .Id = 3
                  .Obra = 0
                  .Show vbModal, Me
               End With
            Case 3
               NoModal = True
               Set oF = New frmArticulosRequerimientos
               With oF
                  .Obra = 0
                  .Show , Me
               End With
            Case 4
               Set oF = New frmConsultaDeSumarizacion
               With oF
                  .Id = 4
                  .Obra = 0
                  .Show vbModal, Me
               End With
            Case 5
               Set oF = New frmConsultaRMPendientes
               With oF
                  .Id = "Planeamiento"
                  .Show vbModal, Me
               End With
            Case 6
               NoModal = True
               Set oF = New frmConsultaActivacionCompras
               With oF
                  .Show , Me
               End With
            Case 7
               NoModal = True
               Set oF = New frmConsulta2
               With oF
                  .Id = 57
                  .Show , Me
               End With
            Case 8
               NoModal = True
               Set oF = New frmConsulta2
               With oF
                  .Id = 76
                  .Show , Me
               End With
            Case 9
               NoModal = True
               Set oF = New frmConsulta2
               With oF
                  .Id = 91
                  .Show , Me
               End With
            Case 10
               Set oF = New frmExcel1
               With oF
                  .Codigo = "InformeOTs"
                  .Planilla = "ComprasTerceros"
                  .Titulo = mTitulo
                  .Show vbModal, Me
               End With
            Case 11
               NoModal = True
               Set oF = New frmConsulta3
               With oF
                  .Id = 3
                  .Show , Me
               End With
            Case 12
               NoModal = True
               Set oF = New frmConsulta3
               With oF
                  .Id = 18
                  .Show , Me
               End With
            Case 13
               NoModal = True
               Set oF = New frmConsulta3
               With oF
                  .Id = 25
                  .Show , Me
               End With
            Case 14
               NoModal = True
               Set oF = New frmConsulta3
               With oF
                  .Id = 115
                  .Show , Me
               End With
            Case 15
               NoModal = True
               Set oF = New frmConsulta3
               With oF
                  .Id = 116
                  .Show , Me
               End With
            Case 16
               Set oF = New frmExcel1
               With oF
                  .Codigo = "Fletes"
                  .Planilla = "ComprasTerceros"
                  .Titulo = mTitulo
                  .Show vbModal, Me
               End With
            Case 17
               NoModal = True
               Set oF = New frmConsulta3
               With oF
                  .Id = 117
                  .Show , Me
               End With
            Case 18
               NoModal = True
               Set oF = New frmConsulta3
               With oF
                  .Id = 122
                  .Show , Me
               End With
            Case 19
               Set oF = New frmExcel1
               With oF
                  .Codigo = "ControlFacturasRecepciones"
                  .Planilla = "ComprasTerceros"
                  .Titulo = mTitulo
                  .Show vbModal, Me
               End With
         End Select

      Case "S"
         Select Case Item
            Case 0
               Set oF = New frmConsultaReservas
               With oF
                  .Obra = 0
                  .Show vbModal, Me
               End With
            Case 1
               Set oF = New frmConsulta1
               With oF
                  .Id = 1
                  .Show vbModal, Me
               End With
            Case 2
               Set oF = New frmConsultaStockPorPartidas
               With oF
                  .Articulo = 0
                  .Show vbModal, Me
               End With
            Case 3
               NoModal = True
               Set oF = New frmConsulta2
               With oF
                  .Id = 29
                  .Show , Me
               End With
            Case 4
               NoModal = True
               Set oF = New frmConsulta2
               With oF
                  .Id = 64
                  .Show , Me
               End With
            Case 5
               NoModal = True
               Set oF = New frmConsulta2
               With oF
                  .Id = 75
                  .Show , Me
               End With
            Case 6
               NoModal = True
               Set oF = New frmConsulta3
               With oF
                  .Id = 96
                  .Show , Me
               End With
         End Select
   
      Case "Co"
         mOpcionAcceso = "MnuSubCo" & Item
         Select Case Item
            Case 0
               Set oF = New frmInformesContables
               With oF
                  .NivelAcceso = ControlAccesoNivel(mOpcionAcceso)
                  .Id = Item
                  .Show vbModal, Me
               End With
            Case 1
               Set oF = New frmInformesContables
               With oF
                  .Id = Item
                  .Show vbModal, Me
               End With
            Case 2
               Set oF = New frmInformesContables
               With oF
                  .Id = Item
                  .Show vbModal, Me
               End With
            Case 3
               Set oF = New frmInformesContables
               With oF
                  .Id = Item
                  .Show vbModal, Me
               End With
            Case 4
               Set oF = New frmInformesContables
               With oF
                  .Id = Item
                  .Show vbModal, Me
               End With
            Case 5
               Set oF = New frmConsulta2
               With oF
                  .Id = 16
                  .Show vbModal, Me
               End With
            Case 6
               Set oF = New frmConsulta2
               With oF
                  .Id = 17
                  .Show vbModal, Me
               End With
            Case 7
               Set oF = New frmConsulta2
               With oF
                  .Id = 43
                  .Show vbModal, Me
               End With
            Case 8
               Set oF = New frmConsulta2
               With oF
                  .Id = 46
                  .Show vbModal, Me
               End With
            Case 10
               Set oF = New frmConsulta2
               With oF
                  .Id = 48
                  .Show vbModal, Me
               End With
            Case 11
               Set oF = New frmConsulta2
               With oF
                  .Id = 49
                  .Show vbModal, Me
               End With
            Case 12
               Set oF = New frmConsulta2
               With oF
                  .Id = 54
                  .Show vbModal, Me
               End With
            Case 15
               Set oF = New frmConsulta2
               With oF
                  .Id = 86
                  .Show vbModal, Me
               End With
            Case 17
               Set oF = New frmInformesContables
               With oF
                  .NivelAcceso = ControlAccesoNivel(mOpcionAcceso)
                  .Id = Item
                  .Show vbModal, Me
               End With
         End Select
      
      Case "SubCoA"
         Select Case Item
            Case 1
               Set oF = New frmConsulta2
               With oF
                  .Id = 73
                  .Show vbModal, Me
               End With
         End Select
      
      Case "SubCoB"
         Select Case Item
            Case 1
               Set oF = New frmExcel1
               With oF
                  .Codigo = "CashFlow"
                  .Planilla = "CashFlow_" & glbEmpresaSegunString
                  .Titulo = mTitulo
                  .Show vbModal, Me
               End With
            Case 2
               Set oF = New frmExcel1
               With oF
                  .Codigo = "CashFlow2"
                  .Planilla = "CashFlow2_" & glbEmpresaSegunString
                  .Titulo = mTitulo
                  .Show vbModal, Me
               End With
            Case 3
               Set oF = New frmExcel1
               With oF
                  .Codigo = "CashFlow3"
                  .Planilla = "CashFlow3_" & glbEmpresaSegunString
                  .Titulo = mTitulo
                  .Show vbModal, Me
               End With
            Case 4
               Set oF = New frmExcel1
               With oF
                  .Codigo = "CashFlow4"
                  .Planilla = "CashFlow4_" & glbEmpresaSegunString
                  .Titulo = mTitulo
                  .Show vbModal, Me
               End With
            Case 5
               Set oF = New frmExcel1
               With oF
                  .Codigo = "CashFlow5"
                  .Planilla = "CashFlow5_" & glbEmpresaSegunString
                  .Titulo = mTitulo
                  .Show vbModal, Me
               End With
            Case 6
               Set oF = New frmExcel1
               With oF
                  .Codigo = "EstadoResultado1"
                  .Planilla = "EstadoResultados1_" & glbEmpresaSegunString
                  .Titulo = mTitulo
                  .Show vbModal, Me
               End With
            Case 7
               Set oF = New frmExcel1
               With oF
                  .Codigo = "EstadoResultado5"
                  .Planilla = "ComprasTerceros"
                  .Titulo = mTitulo
                  .Show vbModal, Me
               End With
            Case 8
               Set oF = New frmExcel1
               With oF
                  .Codigo = "EstadoResultado2"
                  .Planilla = "EstadoResultados2_" & glbEmpresaSegunString
                  .Titulo = mTitulo
                  .Show vbModal, Me
               End With
            Case 9
               Set oF = New frmExcel1
               With oF
                  .Codigo = "EstadoResultado3"
                  .Planilla = "EstadoResultados3_" & glbEmpresaSegunString
                  .Titulo = mTitulo
                  .Show vbModal, Me
               End With
            Case 10
               Set oF = New frmExcel1
               With oF
                  .Codigo = "EstadoResultado4"
                  .Planilla = "ComprasTerceros"
                  .Titulo = mTitulo
                  .Show vbModal, Me
               End With
         
         End Select
      
      Case "SubCoC"
         Select Case Item
            Case 0
               Set oF = New frmConsulta2
               With oF
                  .Id = 97
                  .Show vbModal, Me
               End With
            Case 1
               Set oF = New frmConsulta2
               With oF
                  .Id = 98
                  .Show vbModal, Me
               End With
            Case 2
               Set oF = New frmConsulta2
               With oF
                  .Id = 99
                  .Show vbModal, Me
               End With
            Case 3
               Set oF = New frmConsulta2
               With oF
                  .Id = 100
                  .Show vbModal, Me
               End With
            Case 4
               Set oF = New frmConsulta2
               With oF
                  .Id = 101
                  .Show vbModal, Me
               End With
            Case 5
               Set oF = New frmConsulta2
               With oF
                  .Id = 102
                  .Show vbModal, Me
               End With
            Case 6
               Set oF = New frmConsulta2
               With oF
                  .Id = 103
                  .Show vbModal, Me
               End With
      
         End Select
      
      Case "AF"
         Select Case Item
            Case 0
               Set oF = New frmExcel1
               With oF
                  .Codigo = "Amortizaciones"
                  .Planilla = "ActivoFijo"
                  .Titulo = mTitulo
                  .Show vbModal, Me
               End With
            Case 1
               'Opcion no habilitada
            Case 2
               Set oF = New frmExcel1
               With oF
                  .Codigo = "Amortizaciones2"
                  .Planilla = "ActivoFijo"
                  .Titulo = mTitulo
                  .Show vbModal, Me
               End With
         End Select
   
      Case "Com"
         Select Case Item
            Case 0
               Set oF = New frmConsulta1
               With oF
                  .Id = 7
                  .Show vbModal, Me
               End With
            Case 1
               Set oF = New frmConsulta2
               With oF
                  .Id = 19
                  .Show vbModal, Me
               End With
            Case 2
               Set oF = New frmConsulta2
               With oF
                  .Id = 59
                  .Show vbModal, Me
               End With
'            Case 3
'               Set oF = New frmConsulta2
'               With oF
'                  .Id = 18
'                  .Show vbModal, Me
'               End With
            Case 4
               Set oF = New frmConsulta2
               With oF
                  .Id = 62
                  .Show vbModal, Me
               End With
'            Case 5
'               Set oF = New frmConsulta2
'               With oF
'                  .Id = 27
'                  .Show vbModal, Me
'               End With
'            Case 6
'               Set oF = New frmConsulta2
'               With oF
'                  .Id = 28
'                  .Show vbModal, Me
'               End With
            Case 7
               Set oF = New frmConsulta2
               With oF
                  .Id = 63
                  .Show vbModal, Me
               End With
            Case 8
               Set oF = New frmExcel1
               With oF
                  .Codigo = "PosFin"
                  .Planilla = "ComprasTerceros"
                  .Titulo = "Resumen posicion financiera"
                  .Show vbModal, Me
               End With
            Case 9
               Set oF = New frmConsulta2
               With oF
                  .Id = 51
                  .Show vbModal, Me
               End With
            Case 10
               Set oF = New frmConsulta2
               With oF
                  .Id = 65
                  .Show vbModal, Me
               End With
            Case 11
               Set oF = New frmConsulta2
               With oF
                  .Id = 60
                  .Show vbModal, Me
               End With
            Case 12
               Set oF = New frmInformesContables
               With oF
                  .Id = 5
                  .Show vbModal, Me
               End With
            Case 13
               Set oF = New frmConsulta2
               With oF
                  .Id = 67
                  .Show vbModal, Me
               End With
            Case 14
               Set oF = New frmConsulta2
               With oF
                  .Id = 68
                  .Show vbModal, Me
               End With
            Case 15
               Set oF = New frmConsulta2
               With oF
                  .Id = 69
                  .Show vbModal, Me
               End With
            Case 16
               Set oF = New frmConsulta2
               With oF
                  .Id = 71
                  .Show vbModal, Me
               End With
            Case 17
               Set oF = New frmConsulta2
               With oF
                  .Id = 72
                  .Show vbModal, Me
               End With
            Case 18
               Set oF = New frmExcel1
               With oF
                  .Codigo = "AVL"
                  .Planilla = "ComprasTerceros"
                  .Titulo = "AVL"
                  .Show vbModal, Me
               End With
            Case 19
               Set oF = New frmConsulta2
               With oF
                  .Id = 79
                  .Show vbModal, Me
               End With
            Case 20
               Set oF = New frmConsulta2
               With oF
                  .Id = 80
                  .Show vbModal, Me
               End With
            Case 21
               Set oF = New frmConsulta2
               With oF
                  .Id = 82
                  .Show vbModal, Me
               End With
            Case 22
               Set oF = New frmConsulta2
               With oF
                  .Id = 85
                  .Show vbModal, Me
               End With
            Case 23
               Set oF = New frmExcel1
               With oF
                  .Codigo = "CuadroEgresos"
                  .Planilla = "ComprasTerceros"
                  .Titulo = "Cuadro de Egresos (detallados por obra)"
                  .Show vbModal, Me
               End With
            Case 24
               Set oF = New frmExcel1
               With oF
                  .Codigo = "PosFin2"
                  .Planilla = "ComprasTerceros"
                  .Titulo = "Resumen posicion financiera"
                  .Show vbModal, Me
               End With
         End Select
   
      Case "Cli"
         Select Case Item
            Case 1
               Set oF = New frmInformesContables
               With oF
                  .Id = 200 + Item
                  .Show vbModal, Me
               End With
            Case 2
               Set oF = New frmConsulta3
               With oF
                  .Id = 14
                  .Show vbModal, Me
               End With
            Case 3
               Set oF = New frmConsulta2
               With oF
                  .Id = 33
                  .Show vbModal, Me
               End With
            Case 4
               Set oF = New frmConsulta2
               With oF
                  .Id = 34
                  .Show vbModal, Me
               End With
            Case 5
               'Set oF = New frmConsulta1
               Set oF = New frmConsulta3
               With oF
                  '.Id = 8
                  .Id = 107
                  .Show vbModal, Me
               End With
            Case 6
               Set oF = New frmConsulta2
               With oF
                  .Id = 52
                  .Show vbModal, Me
               End With
            Case 7
               Set oF = New frmConsulta3
               With oF
                  .Id = 7
                  .Show vbModal, Me
               End With
            Case 8
               Set oF = New frmConsulta2
               With oF
                  .Id = 66
                  .Show vbModal, Me
               End With
            Case 9
               Set oF = New frmConsulta3
               With oF
                  .Id = 8
                  .Show vbModal, Me
               End With
            Case 10
               Set oF = New frmConsulta3
               With oF
                  .Id = 10
                  .Show vbModal, Me
               End With
            Case 11
               Set oF = New frmConsulta3
               With oF
                  .Id = 13
                  .Show vbModal, Me
               End With
            Case 12
               Set oF = New frmConsulta3
               With oF
                  .Id = 15
                  .Show vbModal, Me
               End With
            Case 13
               Set oF = New frmConsulta3
               With oF
                  .Id = 16
                  .Show vbModal, Me
               End With
            Case 14
               Set oF = New frmConsulta3
               With oF
                  .Id = 17
                  .Show vbModal, Me
               End With
            Case 15
               Set oF = New frmConsulta3
               With oF
                  .Id = 22
                  .Show vbModal, Me
               End With
            Case 16
               Set oF = New frmConsulta3
               With oF
                  .Id = 23
                  .Show vbModal, Me
               End With
            Case 17
               Set oF = New frmConsulta3
               With oF
                  .Id = 113
                  .Show vbModal, Me
               End With
            Case 18
               Set oF = New frmExcel1
               With oF
                  .Planilla = "ComprasTerceros"
                  .Titulo = "Resumen por certificaciones de obra"
                  .Codigo = "CertificacionObra"
                  .Show vbModal, Me
               End With
         End Select
      
      Case "CliRet"
         Select Case Item
            Case 1
               Set oF = New frmConsulta2
               With oF
                  .Id = 45
                  .Show vbModal, Me
               End With
            Case 2
               Set oF = New frmConsulta2
               With oF
                  .Id = 47
                  .Show vbModal, Me
               End With
            Case 3
               Set oF = New frmConsulta2
               With oF
                  .Id = 50
                  .Show vbModal, Me
               End With
            Case 4
               Set oF = New frmConsulta3
               With oF
                  .Id = 120
                  .Show vbModal, Me
               End With
         End Select
      
      Case "CliRetSIC"
         Select Case Item
            Case 0
               Set oF = New frmConsulta2
               With oF
                  .Id = 37
                  .Show vbModal, Me
               End With
            Case 1
               Set oF = New frmConsulta2
               With oF
                  .Id = 39
                  .Show vbModal, Me
               End With
            Case 2
               Set oF = New frmConsulta2
               With oF
                  .Id = 88
                  .Show vbModal, Me
               End With
         End Select
      
      Case "Bco"
         Select Case Item
            Case 0
               Set oF = New frmConsulta2
               With oF
                  .Id = 35
                  .Show vbModal, Me
               End With
            Case 1
               Set oF = New frmConsulta2
               With oF
                  .Id = 55
                  .Show vbModal, Me
               End With
            Case 2
               Set oF = New frmConsulta3
               With oF
                  .Id = 93
                  .Show vbModal, Me
               End With
            Case 3
               Set oF = New frmConsulta3
               With oF
                  .Id = 108
                  .Show vbModal, Me
               End With
            Case 4
               Set oF = New frmConsulta3
               With oF
                  .Id = 1
                  .Show vbModal, Me
               End With
            Case 5
               Set oF = New frmExcel1
               With oF
                  .Planilla = "ComprasTerceros"
                  .Titulo = "Resumen posicion bancaria"
                  .Codigo = "PosBancos"
                  .Show vbModal, Me
               End With
         End Select
   
      Case "Per"
         Select Case Item
            Case 0
               Set oF = New frmConsulta2
               With oF
                  .Id = 30
                  .Show vbModal, Me
               End With
         End Select
   
      Case "Uti"
         Select Case Item
            Case 6
               Set oF = New frmConsulta2
               With oF
                  .Id = 81
                  .Show vbModal, Me
               End With
         End Select
      
      Case "SAT"
         Select Case Item
            Case 0
               Set oF = New frmConsulta3
               With oF
                  .Id = 104
                  .Show vbModal, Me
               End With
            Case 1
               NoModal = True
               Set oF = New frmConsulta2
               With oF
                  .Id = 83
                  .Show , Me
               End With
         End Select
   
   End Select
   
   If Not NoModal And Not oF Is Nothing Then Unload oF
   Set oF = Nothing
      
End Sub

Public Sub CambiarVista(ByVal QueVista As ListViewConstants)

   Dim i As Integer
   
   Lista.View = QueVista
   
   For i = MargenBotones To MargenBotones + 3
      Toolbar1.Buttons(i).Value = tbrUnpressed
      mnuVerP(i - MargenBotones).Checked = False
   Next
   
   Toolbar1.Buttons(MargenBotones + QueVista).Value = tbrPressed
   
   DoEvents
   mnuVerP(QueVista).Checked = True
   
   'Toolbar1_ButtonClick Toolbar1.Buttons(6 + QueVista)

End Sub

Private Sub ActL_ActLista(ByVal IdRegistro As Long, _
                          ByVal TipoAccion As EnumAcciones, _
                          ByVal NombreListaEditada As String, _
                          ByVal IdRegistroOriginal As Long)

   ActualizarLista IdRegistro, TipoAccion, NombreListaEditada, IdRegistroOriginal

End Sub

Private Sub Arbol_MouseUp(Button As Integer, Shift As Integer, X As Single, Y As Single)

   If Button = vbRightButton And glbModoAccesosUsuarios Then
      PopupMenu mnuFncAcc
   End If

End Sub

Private Sub Arbol_NodeClick(ByVal Node As MSComctlLib.Node)

   Dim oRs As ADOR.Recordset
   Dim oRs1 As ADOR.Recordset
   Dim oRs2 As ADOR.Recordset
   Dim oRs3 As ADOR.Recordset
   Dim k_node As String, sFecha As String, sInve As String, sDato As String, clave As String, mIcono As String, mArg1 As String
   Dim sKey As String, sKey1 As String, sKey2 As String, sKey3 As String, sKey4 As String
   Dim mAux1 As Integer, mConsolidar As Integer
   Dim DatosFecha As Variant, DatosV As Variant
   Dim Desde As Date, Hasta As Date
   Dim mOrdena As Boolean, mNuevo As Boolean
   Dim Nodo As Object
   Dim oF As Form
   
   On Error Resume Next
   
   If Not UltimoNodoSeleccionado Is Nothing Then
      If UltimoNodoSeleccionado.BackColor = &H8000000F Then UltimoNodoSeleccionado.BackColor = &H80000005
   End If
   Node.BackColor = &H8000000F
   Set UltimoNodoSeleccionado = Node
   
   If glbSonidoNavegacion And Not glbModoAccesosUsuarios Then Sonido "Start Navigation"
   
   Toolbar1.Buttons("Print").Enabled = (Node.Key <> "Ppal")
   Toolbar1.Buttons("CopiarCampo").Visible = False
   
   Me.MousePointer = vbHourglass
   
   Lista.ListItems.Clear
   Lista.ColumnHeaders.Clear
   
   k_node = Node.Key
   If mId(k_node, 1, 1) = "-" Or mId(k_node, 1, 1) = "+" Then k_node = mId(k_node, 1, 7)
   
   Set Nodo = Arbol.SelectedItem
   clave = Nodo.Key
   Do Until Len(clave) And mId(clave, 1, 1) <> "-" And mId(clave, 1, 1) <> "+"
      Set Nodo = Nodo.Parent
      clave = Nodo.Key
   Loop
   Set Nodo = Nothing
   
   If clave <> Node.Key Then If ControlAccesoNivelExistente(Node.Key) Then clave = Node.Key
   If ControlAccesoNivel(clave) >= 9 Then
      Toolbar1.Buttons(1).Enabled = False
      If ControlAccesoNivel(clave) = 10 Then
         Me.MousePointer = vbDefault
         MsgBox "El usuario no tiene acceso a esta informacion", vbCritical
         Exit Sub
      End If
   Else
      If Not Toolbar1.Buttons(1).Enabled Then Toolbar1.Buttons(1).Enabled = True
   End If
   
   If mId(k_node, 1, 1) = "+" Then
      DatosFecha = VBA.Split(Node.Text, " ")
      DatosFecha(0) = NumeroMes(DatosFecha(0))
      Desde = DateSerial(DatosFecha(1), DatosFecha(0), 1)
      Hasta = DateAdd("m", 1, Desde)
      Hasta = DateAdd("d", -1, Hasta)
   End If
   
   mOrdena = False
   mNuevo = True
   mIcono = ""
   
   mConsolidar = -1
   If glbConsolidar Then mConsolidar = 0
   
   Ultimo_Nodo = k_node
   
   Select Case k_node
      Case "Ppal"
         mNuevo = False
      Case "PpalSAT"
         mNuevo = False
         Node.Expanded = True
         GoTo Salida
      Case "Acabados"
         Set oRs = Aplicacion.Acabados.TraerTodos
      Case "AcoAcabados"
         Set oRs = Aplicacion.AcoAcabados.TraerTodos
      Case "AcoBiselados"
         Set oRs = Aplicacion.AcoBiselados.TraerTodos
      Case "AcoCalidades"
         Set oRs = Aplicacion.AcoCalidades.TraerTodos
      Case "AcoCodigos"
         Set oRs = Aplicacion.AcoCodigos.TraerTodos
      Case "AcoColores"
         Set oRs = Aplicacion.AcoColores.TraerTodos
      Case "AcoFormas"
         Set oRs = Aplicacion.AcoFormas.TraerTodos
      Case "AcoGrados"
         Set oRs = Aplicacion.AcoGrados.TraerTodos
      Case "AcoMarcas"
         Set oRs = Aplicacion.AcoMarcas.TraerTodos
      Case "AcoMateriales"
         Set oRs = Aplicacion.AcoMateriales.TraerTodos
      Case "AcoModelos"
         Set oRs = Aplicacion.AcoModelos.TraerTodos
      Case "AcoNormas"
         Set oRs = Aplicacion.AcoNormas.TraerTodos
      Case "AcoSchedulers"
         Set oRs = Aplicacion.AcoSchedulers.TraerTodos
      Case "AcoSeries"
         Set oRs = Aplicacion.AcoSeries.TraerTodos
      Case "AcotarTablas"
         mNuevo = False
         Node.Expanded = True
         GoTo Salida
      Case "AcoTipos"
         Set oRs = Aplicacion.AcoTipos.TraerTodos
      Case "AcoTiposRosca"
         Set oRs = Aplicacion.AcoTiposRosca.TraerTodos
      Case "AcoTratamientos"
         Set oRs = Aplicacion.AcoTratamientos.TraerTodos
      Case "ActividadesP"
         Set oRs = Aplicacion.ActividadesProveedores.TraerTodos
      Case "ActivoFijo"
         mNuevo = False
         Node.Expanded = True
         GoTo Salida
      Case "AjustesStock"
         Node.Expanded = True
         GoTo Salida
      Case "AjustesStockTodos"
         If Mensaje("Todos los ajustes de stock", "Visualizar") Then
            Set oRs = Aplicacion.AjustesStock.TraerFiltrado("_Todos", glbIdObraAsignadaUsuario)
         Else
            GoTo Salida
         End If
         mIcono = "AjustesStock"
         GoTo Fin
      Case "AjustesStockAgrupados"
         AbrirSubarbol "AjustesStockAgrupados", "+SubAJ1", "+SubAJ2", Arbol, Node
         GoTo Salida
      Case "+SubAJ1"
         Desde = DateSerial(Node.Text, 1, 1)
         Hasta = DateSerial(Node.Text, 12, 31)
         If Mensaje("Ajustes de stock del año " & Node.Text, "Visualizar") Then
            Set oRs = Aplicacion.AjustesStock.TraerFiltrado("Fecha", Array(Desde, Hasta, glbIdObraAsignadaUsuario))
         Else
            GoTo Salida
         End If
         mIcono = "AjustesStock"
         GoTo Fin
      Case "+SubAJ2"
         Set oRs = Aplicacion.AjustesStock.TraerFiltrado("Fecha", Array(Desde, Hasta, glbIdObraAsignadaUsuario))
         mIcono = "AjustesStock"
         GoTo Fin
      Case "AjustesStockSAT"
         Node.Expanded = True
         GoTo Salida
      Case "AjustesStockTodosSAT"
         mNuevo = False
         Set oRs = Aplicacion.TablasGenerales.TraerFiltrado("AjustesStockSAT", "_Todos")
         mIcono = "AjustesStock"
         GoTo Fin
      Case "AjustesStockAgrupadosSAT"
         mNuevo = False
         AbrirSubarbol "AjustesStockAgrupadosSAT", "+SubAJ3", "+SubAJ4", Arbol, Node
         GoTo Salida
      Case "+SubAJ4"
         mNuevo = False
         Set oRs = Aplicacion.TablasGenerales.TraerFiltrado("AjustesStockSAT", "Fecha", Array(Desde, Hasta))
         mIcono = "AjustesStock"
         GoTo Fin
      Case "AlimentacionesElectricas"
         Set oRs = Aplicacion.AlimentacionesElectricas.TraerTodos
      Case "AnexosEquipos"
         Set oRs = Aplicacion.AnexosEquipos.TraerTodos
      Case "AniosNorma"
         Set oRs = Aplicacion.AniosNorma.TraerTodos
      Case "AnticiposAlPersonal"
         mNuevo = False
         Set oRs = Aplicacion.TablasGenerales.TraerFiltrado("AnticiposAlPersonal", "_Todos")
      Case "AnticiposAlPersonalSyJ"
         Set oRs = Aplicacion.AnticiposAlPersonalSyJ.TraerTodos
         mIcono = "AnticiposAlPersonal"
         GoTo Fin
      Case "ArchivosATransmitirDestinos"
         Set oRs = Aplicacion.ArchivosATransmitirDestinos.TraerTodos
      Case "Articulos"
         Node.Expanded = True
         GoTo Salida
      Case "ArticulosTodos"
         Node.Expanded = True
         GoTo Salida
      Case "ArticulosTodosDetallados"
         Set oRs = Aplicacion.Articulos.TraerTodos
         mIcono = "Articulos"
         GoTo Fin
      Case "ArticulosTodosResumidos"
         Set oRs = Aplicacion.Articulos.TraerFiltrado("_Resumidos")
         mIcono = "Articulos"
         GoTo Fin
      Case "ArticulosRubros"
         If Node.Children = 0 Then
            Set oRs = Aplicacion.Articulos.TraerFiltrado("_AgrupadoPorRubro")
            With oRs
               Do Until .EOF
                  Arbol.Nodes.Add "ArticulosRubros", tvwChild, "+SubAR1 " & .Fields(0).Value & " " & .Fields(1).Value, "" & .Fields(1).Value, "Articulos", "Articulos"
                  .MoveNext
               Loop
            End With
            Node.Expanded = True
         End If
         GoTo Salida
      Case "+SubAR1"
         sDato = Node.Key
         DatosV = VBA.Split(sDato, " ")
         'Set oRs = Aplicacion.Articulos.TraerFiltrado("_PorIdRubro", DatosV(1))
         sKey = GenerarSQL("ArticuloRubro", CLng(DatosV(1)))
         Set oRs = Aplicacion.TablasGenerales.TraerFiltrado("Consulta", "_PorSQL", sKey)
         mIcono = "Articulos"
         GoTo Fin
      Case "ArticulosEquiposTerceros"
         Set oRs = Aplicacion.Articulos.TraerFiltrado("_EquiposTerceros")
         mIcono = "Articulos"
         GoTo Fin
      Case "ArticulosInactivos"
         Set oRs = Aplicacion.Articulos.TraerFiltrado("_Inactivos")
         mIcono = "Articulos"
         GoTo Fin
      Case "ArticulosProntoMantenimiento"
         Set oRs = Aplicacion.Articulos.TraerFiltrado("_BD_ProntoMantenimientoTodos")
         mIcono = "Articulos"
         GoTo Fin
      Case "Asientos"
         Node.Expanded = True
         GoTo Salida
      Case "AsientosTodos"
         AbrirSubarbol "AsientosTodos", "+SubAsE", "", Arbol, Node
         GoTo Salida
      Case "+SubAsE"
         sFecha = Node.Text
         DatosFecha = VBA.Split(sFecha, " ")
         Set oRs = Aplicacion.Asientos.TraerFiltrado("Fecha", Array(DatosFecha(0), DatosFecha(2)))
         mIcono = "Asientos"
         GoTo Fin
      Case "AsientosAgrupados"
         AbrirSubarbol "AsientosAgrupados", "+SubAs1", "+SubAs2", Arbol, Node
         GoTo Salida
      Case "+SubAs1"
         Desde = DateSerial(Node.Text, 1, 1)
         Hasta = DateSerial(Node.Text, 12, 31)
         If Mensaje("Asientos del año " & Node.Text, "Visualizar") Then
            Set oRs = Aplicacion.Asientos.TraerFiltrado("Fecha", Array(Desde, Hasta))
         Else
            GoTo Salida
         End If
         mIcono = "Asientos"
         GoTo Fin
      Case "+SubAs2"
         Set oRs = Aplicacion.Asientos.TraerFiltrado("Fecha", Array(Desde, Hasta))
         mIcono = "Asientos"
         GoTo Fin
      Case "AutorizacionesCompra"
         Node.Expanded = True
         GoTo Salida
      Case "AutorizacionesCompraTodas"
         If Mensaje("Todas las autorizaciones de compra", "Visualizar") Then
            'Set oRs = Aplicacion.AutorizacionesCompra.TraerTodos
         Else
            GoTo Salida
         End If
         mIcono = "AutorizacionesCompra"
         GoTo Fin
      Case "AutorizacionesCompraAgrupadas"
         AbrirSubarbol "AutorizacionesCompraAgrupadas", "+SubAC1", "+SubAC2", Arbol, Node
         GoTo Salida
      Case "+SubAC1"
         Desde = DateSerial(Node.Text, 1, 1)
         Hasta = DateSerial(Node.Text, 12, 31)
         If Mensaje("Autorizaciones de compra del año " & Node.Text, "Visualizar") Then
            'Set oRs = Aplicacion.AutorizacionesCompra.TraerFiltrado("Fecha", Array(Desde, Hasta))
         Else
            GoTo Salida
         End If
         mIcono = "AutorizacionesCompra"
         GoTo Fin
      Case "+SubAC2"
         'Set oRs = Aplicacion.AutorizacionesCompra.TraerFiltrado("Fecha", Array(Desde, Hasta))
         mIcono = "AutorizacionesCompra"
         GoTo Fin
      Case "Bancos"
         Set oRs = Aplicacion.Bancos.TraerTodos
      Case "BancoChequeras"
         Set oRs = Aplicacion.BancoChequeras.TraerTodos
      Case "Biselados"
         Set oRs = Aplicacion.Biselados.TraerTodos
      Case "Cajas"
         Set oRs = Aplicacion.Cajas.TraerTodos
      Case "Calidades"
         Set oRs = Aplicacion.Calidades.TraerTodos
      Case "CalidadesClad"
         Set oRs = Aplicacion.CalidadesClad.TraerTodos
      Case "Cargos"
         Set oRs = Aplicacion.Cargos.TraerTodos
      Case "CashFlow"
         'Set oRs = Aplicacion.TablasGenerales.TraerFiltrado("DefinicionesFlujoCaja", "_Agrupados")
         Set oRs = Aplicacion.DefinicionesFlujoCaja.TraerTodos
      Case "CCalidades"
         If Not Node.Expanded Then Node.Expanded = True
         GoTo Salida
      Case "CCalidadesPendientes"
         Set oRs = Aplicacion.CCalidades.TraerTodos
         mIcono = "CCalidades"
         GoTo Fin
      Case "CCalidadesControlados"
         Set oRs = Aplicacion.CCalidades.TraerFiltrado("_Controlados")
         mIcono = "CCalidades"
         GoTo Fin
      Case "CCalidadesUltimos3Meses"
         Desde = DateSerial(Year(DateAdd("m", -2, Now)), Month(DateAdd("m", -2, Now)), 1)
         Set oRs = Aplicacion.CCalidades.TraerFiltrado("_Ultimos3Meses", Desde)
         mIcono = "CCalidades"
         GoTo Fin
      Case "CCalidadesTodos"
         Desde = DateSerial(Year(DateAdd("m", -2, Now)), Month(DateAdd("m", -2, Now)), 1)
         Set oRs = Aplicacion.CCalidades.TraerFiltrado("_Todos")
         mIcono = "CCalidades"
         GoTo Fin
      Case "CentrosCosto"
         Set oRs = Aplicacion.CentrosCosto.TraerTodos
      Case "ChequesPendientes"
         mNuevo = False
         Set oRs = Aplicacion.Valores.TraerFiltrado("_ChequesPendientes")
      Case "Choferes"
         Set oRs = Aplicacion.Choferes.TraerTodos
      Case "CertificacionesObra"
         Set oRs = Aplicacion.CertificacionesObras.TraerTodos
      Case "Clausulas"
         Set oRs = Aplicacion.Clausulas.TraerTodos
      Case "Clientes"
         If Not Node.Expanded Then Node.Expanded = True
         GoTo Salida
      Case "ClientesAConfirmar"
         Set oRs = Aplicacion.Clientes.TraerFiltrado("_AConfirmar")
         mIcono = "Clientes"
         GoTo Fin
      Case "ClientesResumen"
         Set oRs = Aplicacion.Clientes.TraerFiltrado("_Resumido", glbIdVendedor)
         mIcono = "Clientes"
         GoTo Fin
      Case "ClientesDetalle"
         Set oRs = Aplicacion.Clientes.TraerFiltrado("_Detallado", glbIdVendedor)
         mIcono = "Clientes"
         GoTo Fin
      Case "Codigos"
         Set oRs = Aplicacion.Codigos.TraerTodos
      Case "CodigosUniversales"
         Set oRs = Aplicacion.CodigosUniversales.TraerTodos
      Case "CoeficientesContables"
         Set oRs = Aplicacion.CoeficientesContables.TraerTodos
      Case "CoeficientesImpositivos"
         Set oRs = Aplicacion.CoeficientesImpositivos.TraerTodos
      Case "Colores"
         Set oRs = Aplicacion.Colores.TraerTodos
      Case "Comercial"
         mNuevo = False
         Node.Expanded = True
         GoTo Salida
      Case "Comparativas"
         If Not Node.Expanded Then Node.Expanded = True
         GoTo Salida
      Case "ComparativasTodas"
         Set oRs = Aplicacion.Comparativas.TraerTodos
         mIcono = "Comparativas"
         GoTo Fin
      Case "ComparativasAgrupadas"
         AbrirSubarbol "ComparativasAgrupadas", "+SubCm1", "+SubCm2", Arbol, Node
         GoTo Salida
      Case "+SubCm2"
         Set oRs = Aplicacion.Comparativas.TraerFiltrado("Fecha", Array(Desde, Hasta))
         mIcono = "Comparativas"
         GoTo Fin
      Case "Compras"
         mNuevo = False
         Node.Expanded = True
         GoTo Salida
      Case "ComprobantesPrv"
         If Not Node.Expanded Then Node.Expanded = True
         GoTo Salida
      Case "ComprobantesPrvTodos"
         If Mensaje("Todos los comprobantes", "Visualizar") Then
            Set oRs = Aplicacion.ComprobantesProveedores.TraerFiltrado("_Todos", glbIdUsuario)
         Else
            GoTo Salida
         End If
         mIcono = "ComprobantesPrv"
         GoTo Fin
      Case "ComprobantesPrvPorMes"
         AbrirSubarbol "ComprobantesPrvPorMes", "+SubCP1", "+SubCP2", Arbol, Node
         GoTo Salida
      Case "+SubCP1"
         Desde = DateSerial(Node.Text, 1, 1)
         Hasta = DateSerial(Node.Text, 12, 31)
         If Mensaje("Comprobantes del año " & Node.Text, "Visualizar") Then
            Set oRs = Aplicacion.ComprobantesProveedores.TraerFiltrado("Fecha", Array(Desde, Hasta, glbIdUsuario))
         Else
            GoTo Salida
         End If
         mIcono = "ComprobantesPrv"
         GoTo Fin
      Case "+SubCP2"
         Set oRs = Aplicacion.ComprobantesProveedores.TraerFiltrado("Fecha", Array(Desde, Hasta, glbIdUsuario))
         mIcono = "ComprobantesPrv"
         GoTo Fin
      Case "ComprobantesAConfirmar"
         Set oRs = Aplicacion.ComprobantesProveedores.TraerFiltrado("_AConfirmar")
         mIcono = "ComprobantesPrv"
         GoTo Fin
      Case "Conceptos"
         Set oRs = Aplicacion.Conceptos.TraerTodos
      Case "ConceptosOP"
         Set oRs = Aplicacion.Conceptos.TraerFiltrado("_PorGrupo", -1)
         mIcono = "Conceptos"
         GoTo Fin
      Case "Conciliaciones"
         AbrirSubarbol "Conciliaciones", "", "", Arbol, Node
         GoTo Salida
      Case "+SubCn1"
         AbrirSubarbol "+SubCn1", "", "", Arbol, Node
         mIcono = "Conciliaciones"
         GoTo Fin
      Case "+SubCn2"
         DatosFecha = VBA.Split(Node.Key, " ")
         Set oRs = ArmaConciliacionCaja(0, DatosFecha(1), Date, Date, -1)
         If Node.Children > 0 Then Node.Expanded = Not Node.Expanded
         mIcono = "Conciliaciones"
         GoTo Fin
      Case "+SubCn3"
         sFecha = Node.Key
         DatosFecha = VBA.Split(sFecha, " ")
         Desde = DateSerial(DatosFecha(2), 1, 1)
         Hasta = DateSerial(DatosFecha(2), 12, 31)
         Set oRs = ArmaConciliacionCaja(0, DatosFecha(1), Desde, Hasta, 0)
         If Node.Children > 0 Then Node.Expanded = Not Node.Expanded
         mIcono = "Conciliaciones"
         GoTo Fin
      Case "+SubCn4"
         sFecha = Node.Key
         DatosFecha = VBA.Split(sFecha, " ")
         DatosV = VBA.Split(DatosFecha(2), "/")
         Desde = DateSerial(DatosV(1), DatosV(0), 1)
         Hasta = DateAdd("m", 1, Desde)
         Hasta = DateAdd("d", -1, Hasta)
         Set oRs = ArmaConciliacionCaja(0, DatosFecha(1), Desde, Hasta, 0)
         mIcono = "Conciliaciones"
         GoTo Fin
      Case "+SubCn9"
         sFecha = Node.Key
         DatosFecha = VBA.Split(sFecha, " ")
         Set oRs = Aplicacion.Bancos.TraerFiltrado("_ChequesDiferidosPendientesPorIdBanco", DatosFecha(1))
         mIcono = "Conciliaciones"
         GoTo Fin
      Case "ConciliacionesCajas"
         AbrirSubarbol "ConciliacionesCajas", "", "", Arbol, Node
         GoTo Salida
      Case "+SubCc1"
         AbrirSubarbol "+SubCc1", "", "", Arbol, Node
         mIcono = "ConciliacionesCajas"
         GoTo Fin
      Case "+SubCc2"
         sFecha = Node.Key
         DatosFecha = VBA.Split(sFecha, " ")
         Desde = DateSerial(DatosFecha(2), 1, 1)
         Hasta = DateSerial(DatosFecha(2), 12, 31)
         Set oRs = ArmaConciliacionCaja(DatosFecha(1), 0, Desde, Hasta, 0)
         mIcono = "ConciliacionesCajas"
         GoTo Fin
      Case "+SubCc3"
         sFecha = Node.Key
         DatosFecha = VBA.Split(sFecha, " ")
         Desde = DateSerial(DatosFecha(2), DatosFecha(3), 1)
         Hasta = DateAdd("m", 1, Desde)
         Hasta = DateAdd("d", -1, Hasta)
         Set oRs = ArmaConciliacionCaja(DatosFecha(1), 0, Desde, Hasta, 0)
         mIcono = "ConciliacionesCajas"
         GoTo Fin
      Case "ConciliacionesTarjetas"
         AbrirSubarbol "ConciliacionesTarjetas", "", "", Arbol, Node
         GoTo Salida
      Case "+SubCt1"
         AbrirSubarbol "+SubCt1", "", "", Arbol, Node
         mIcono = "Conciliaciones"
         GoTo Fin
      Case "+SubCt2"
         sFecha = Node.Key
         DatosFecha = VBA.Split(sFecha, " ")
         Desde = DateSerial(DatosFecha(2), 1, 1)
         Hasta = DateSerial(DatosFecha(2), 12, 31)
         Set oRs = ArmaConciliacionCaja(0, 0, Desde, Hasta, 0, DatosFecha(1))
         mIcono = "Conciliaciones"
         GoTo Fin
      Case "+SubCt3"
         sFecha = Node.Key
         DatosFecha = VBA.Split(sFecha, " ")
         Desde = DateSerial(DatosFecha(2), DatosFecha(3), 1)
         Hasta = DateAdd("m", 1, Desde)
         Hasta = DateAdd("d", -1, Hasta)
         Set oRs = ArmaConciliacionCaja(0, 0, Desde, Hasta, 0, DatosFecha(1))
         mIcono = "Conciliaciones"
         GoTo Fin
      Case "CondicionesCompra1", "CondicionesCompra2"
         Set oRs = Aplicacion.CondicionesCompra.TraerTodos
         mIcono = "CondicionesCompra"
         GoTo Fin
      Case "Conjuntos"
         Node.Expanded = True
         GoTo Salida
      Case "ConjuntosTodos"
         Set oRs = Aplicacion.Conjuntos.TraerTodos
         mIcono = "Conjuntos"
         GoTo Fin
      Case "ConjuntosFinales"
         Set oRs = Aplicacion.Conjuntos.TraerFiltrado("_Finales")
         mIcono = "Conjuntos"
         GoTo Fin
      Case "ConjuntosDependientes"
         Set oRs = Aplicacion.Conjuntos.TraerFiltrado("_Subconjuntos")
         mIcono = "Conjuntos"
         GoTo Fin
      Case "Contabilidad"
         mNuevo = False
         Node.Expanded = True
         GoTo Salida
      Case "ControlesCalidad"
         Set oRs = Aplicacion.ControlesCalidad.TraerTodos
      Case "CostosImportacion"
         Set oRs = Aplicacion.CostosImportacion.TraerTodos
      Case "Cotizaciones"
         AbrirSubarbol "Cotizaciones", "+SubCo1", "+SubCo2", Arbol, Node
         GoTo Salida
      Case "+SubCo2"
         Set oRs = Aplicacion.Cotizaciones.TraerFiltrado("Fecha", Array(Desde, Hasta))
         mIcono = "Cotizaciones"
         GoTo Fin
      Case "CtasCtesA"
         mNuevo = False
         Set oRs = Aplicacion.CtasCtesA.TraerFiltrado("_TT", mConsolidar)
      Case "CtasCtesD"
         mNuevo = False
         Set oRs = Aplicacion.CtasCtesD.TraerFiltrado("_TT", Array(mConsolidar, glbIdVendedor))
      Case "CtrlTransp"
         Node.Expanded = True
         GoTo Salida
      Case "Cuentas"
         If Node.Children = 1 Then
            Arbol.Nodes.Add Node.Key, tvwChild, "+SubCTa 0", "Cuentas 1 2 3 4 y 5", "Cuentas", "Cuentas"
            Set oRs = Aplicacion.UnidadesOperativas.TraerTodos
            With oRs
               Do Until .EOF
                  Arbol.Nodes.Add Node.Key, tvwChild, "+SubCTa " & .Fields("IdUnidadOperativa").Value, "" & .Fields("Descripcion").Value, "Cuentas", "Cuentas"
                  .MoveNext
               Loop
            End With
            oRs.Close
            Node.Expanded = True
         End If
         Node.Expanded = True
         GoTo Salida
      Case "CuentasTodas"
         Set oRs = ArmarPlanDeCuentas(-1)
         mIcono = "Cuentas"
         GoTo Fin
      Case "+SubCTa"
         DatosFecha = VBA.Split(Node.Key, " ")
         Set oRs = ArmarPlanDeCuentas(DatosFecha(1))
         mIcono = "Cuentas"
         GoTo Fin
      Case "CuentasBancarias"
         Set oRs = Aplicacion.CuentasBancarias.TraerTodos
      Case "CuentasGastos"
         Set oRs = Aplicacion.CuentasGastos.TraerTodos
      Case "DefinicionesArt"
         Node.Expanded = True
         GoTo Salida
      Case "DefinicionesArtTodos"
         Toolbar1.Buttons("CopiarCampo").Visible = True
         Set oRs = Aplicacion.DefinicionesArt.TraerTodos
         mIcono = "DefinicionesArt"
         GoTo Fin
      Case "DefinicionesArtRubros"
         If Node.Children = 0 Then
            Set oRs = Aplicacion.DefinicionesArt.TraerFiltrado("_AgrupadoPorRubro")
            With oRs
               Do Until .EOF
                  Arbol.Nodes.Add "DefinicionesArtRubros", tvwChild, "+SubDA1 " & .Fields(0).Value & " " & .Fields(1).Value, "" & .Fields(1).Value, "DefinicionesArt", "DefinicionesArt"
                  .MoveNext
               Loop
            End With
            Node.Expanded = True
         End If
         GoTo Salida
      Case "+SubDA1"
         Toolbar1.Buttons("CopiarCampo").Visible = True
         sDato = Node.Key
         DatosV = VBA.Split(sDato, " ")
         Set oRs = Aplicacion.DefinicionesArt.TraerFiltrado("_PorIdRubro", DatosV(1))
         mIcono = "DefinicionesArt"
         GoTo Fin
      Case "Densidades"
         Set oRs = Aplicacion.Densidades.TraerTodos
      Case "Depositos"
         Set oRs = Aplicacion.Depositos.TraerTodos
      Case "DepositosBancarios"
         If Not Node.Expanded Then Node.Expanded = True
         GoTo Salida
      Case "DepositosBancariosTodos"
         If Mensaje("Todos los depositos", "Visualizar") Then
            Set oRs = Aplicacion.DepositosBancarios.TraerTodos
         Else
            GoTo Salida
         End If
         mIcono = "DepositosBancarios"
         GoTo Fin
      Case "DepositosBancariosAgrupados"
         AbrirSubarbol "DepositosBancariosAgrupados", "+SubDP1", "+SubDP2", Arbol, Node
         GoTo Salida
      Case "+SubDP2"
         Set oRs = Aplicacion.DepositosBancarios.TraerFiltrado("Fecha", Array(Desde, Hasta))
         mIcono = "DepositosBancarios"
         GoTo Fin
      Case "Devoluciones"
         If Not Node.Expanded Then Node.Expanded = True
         GoTo Salida
      Case "DevolucionesTodas"
         Set oRs = Aplicacion.Devoluciones.TraerTodos
         mIcono = "Devoluciones"
         GoTo Fin
      Case "DevolucionesAgrupadas"
         AbrirSubarbol "DevolucionesAgrupadas", "+SubDV1", "+SubDV2", Arbol, Node
         GoTo Salida
      Case "+SubDV2"
         Set oRs = Aplicacion.Devoluciones.TraerFiltrado("Fecha", Array(Desde, Hasta))
         mIcono = "Devoluciones"
         GoTo Fin
      Case "DiferenciasCambio"
         mNuevo = False
         Node.Expanded = True
         GoTo Salida
      Case "DiferenciasCambio_C"
         Node.Expanded = True
         GoTo Salida
      Case "DiferenciasCambio_CP"
         Set oRs = Aplicacion.DiferenciasCambio.TraerFiltrado("_PorCobranzasPendientes")
         mIcono = "DiferenciasCambio_C"
         GoTo Fin
      Case "DiferenciasCambio_CG"
         Set oRs = Aplicacion.DiferenciasCambio.TraerFiltrado("_PorCobranzasGeneradas")
         mIcono = "DiferenciasCambio_C"
         GoTo Fin
      Case "DiferenciasCambio_PP"
         Set oRs = Aplicacion.DiferenciasCambio.TraerFiltrado("_PorPagosPendientes")
         mIcono = "DiferenciasCambio_P"
         GoTo Fin
      Case "DiferenciasCambio_PG"
         Set oRs = Aplicacion.DiferenciasCambio.TraerFiltrado("_PorPagosGeneradas")
         mIcono = "DiferenciasCambio_P"
         GoTo Fin
      Case "DistribucionesObras"
         Set oRs = Aplicacion.DistribucionesObras.TraerTodos
      Case "EjerciciosContables"
         Set oRs = Aplicacion.EjerciciosContables.TraerTodos
      Case "EmisionCheques"
         mNuevo = False
         Node.Expanded = True
         GoTo Salida
      Case "EmisionChequesTodosEmitidos"
         Set oRs = Aplicacion.Valores.TraerFiltrado("_TodosEmitidos")
         mIcono = "EmisionCheques"
         GoTo Fin
      Case "EmisionChequesTodosNoEmitidos"
         Set oRs = Aplicacion.Valores.TraerFiltrado("_TodosNoEmitidos")
         mIcono = "EmisionCheques"
         GoTo Fin
      Case "EmisionChequesTodosNoEmitidosPorCuenta"
         If Node.Children = 0 Then
            Set oRs = Aplicacion.Bancos.TraerFiltrado("_ConCuenta")
            With oRs
               Do Until .EOF
                  Arbol.Nodes.Add "EmisionChequesTodosNoEmitidosPorCuenta", tvwChild, "+SubEc1 " & .Fields(0).Value, "" & .Fields(1).Value, "EmisionCheques", "EmisionCheques"
                  .MoveNext
               Loop
            End With
            Node.Expanded = True
            If oRs.RecordCount > 0 Then
               oRs.MoveFirst
               Do Until oRs.EOF
                  sKey = "+SubEc1 " & oRs.Fields(0).Value
                  Set oRs1 = Aplicacion.Bancos.TraerFiltrado("_CuentasPorIdBanco", oRs.Fields(0).Value)
                  Do Until oRs1.EOF
                     Arbol.Nodes.Add sKey, tvwChild, "+SubEc2 " & oRs1.Fields(0).Value & " " & oRs1.Fields(2).Value, "" & oRs1.Fields(1).Value, "EmisionCheques", "EmisionCheques"
                     sKey = "+SubEc2 " & oRs1.Fields(0).Value & " " & oRs1.Fields(2).Value
                     oRs1.MoveNext
                  Loop
                  oRs1.Close
                  Set oRs1 = Nothing
                  oRs.MoveNext
               Loop
            End If
         End If
         GoTo Salida
      Case "+SubEc1"
         Node.Expanded = True
         GoTo Salida
      Case "+SubEc2"
         DatosFecha = VBA.Split(Node.Key, " ")
         Set oRs = Aplicacion.Valores.TraerFiltrado("_NoEmitidosPorCuenta", DatosFecha(1))
         mIcono = "EmisionCheques"
         GoTo Fin
      Case "Empleados"
         Set oRs = Aplicacion.Empleados.TraerFiltrado("_PorObraAsignada", -1)
         mIcono = "Empleados"
         Node.Expanded = True
         GoTo Fin
      Case "Empleados1"
         Set oRs = Aplicacion.Empleados.TraerFiltrado("_PorObraAsignada", glbIdObraAsignadaUsuario)
         mIcono = "Empleados"
         GoTo Fin
      Case "Empleados2"
         Set oRs = Aplicacion.Empleados.TraerFiltrado("_PorObraAsignada", -2)
         mIcono = "Empleados"
         GoTo Fin
      Case "Empleados3"
         Set oRs = Aplicacion.Empleados.TraerFiltrado("_PorObraAsignada", -1)
         mIcono = "Empleados"
         GoTo Fin
      Case "Equipos"
         Set oRs = Aplicacion.Equipos.TraerTodos
      Case "Facturas"
         If Not Node.Expanded Then Node.Expanded = True
         GoTo Salida
      Case "FacturasTodas"
         If Mensaje("Todas las facturas", "Visualizar") Then
            Set oRs = Aplicacion.Facturas.TraerTodos
         Else
            GoTo Salida
         End If
         mIcono = "Facturas"
         GoTo Fin
      Case "FacturasAgrupadas"
         AbrirSubarbol "FacturasAgrupadas", "+SubFA1", "+SubFA2", Arbol, Node
         GoTo Salida
      Case "+SubFA1"
         Desde = DateSerial(Node.Text, 1, 1)
         Hasta = DateSerial(Node.Text, 12, 31)
         If Mensaje("Facturas del año " & Node.Text, "Visualizar") Then
            Set oRs = Aplicacion.Facturas.TraerFiltrado("Fecha", Array(Desde, Hasta, BuscarClaveINI("IdAbonos")))
         Else
            GoTo Salida
         End If
         mIcono = "Facturas"
         GoTo Fin
      Case "+SubFA2"
         Set oRs = Aplicacion.Facturas.TraerFiltrado("Fecha", Array(Desde, Hasta, BuscarClaveINI("IdAbonos")))
         mIcono = "Facturas"
         GoTo Fin
      Case "FacturasContado"
         If Not Node.Expanded Then Node.Expanded = True
         GoTo Salida
      Case "FacturasContadoTodas"
         Set oRs = Aplicacion.Facturas.TraerFiltrado("_FacturasContadoTodas")
         mIcono = "Facturas"
         GoTo Fin
      Case "FacturasContadoAgrupadas"
         AbrirSubarbol "FacturasContadoAgrupadas", "+SubFC1", "+SubFC2", Arbol, Node
         GoTo Salida
      Case "+SubFC2"
         Set oRs = Aplicacion.Facturas.TraerFiltrado("Fecha_Contado", Array(Desde, Hasta, BuscarClaveINI("IdAbonos")))
         mIcono = "Facturas"
         GoTo Fin
      Case "Familias"
         Set oRs = Aplicacion.Familias.TraerTodos
      Case "Fletes"
         Set oRs = Aplicacion.Fletes.TraerTodos
      Case "FondosFijos"
         Set oRs = Aplicacion.Cuentas.TraerFiltrado("_FondosFijos", glbIdCuentaFFUsuario)
      Case "Formas"
         Set oRs = Aplicacion.Formas.TraerTodos
      Case "Ganancias1", "Ganancias2"
         Set oRs = Aplicacion.Ganancias.TraerTodos
         mIcono = "Ganancias"
         GoTo Fin
      Case "GastosBancarios"
         If Not Node.Expanded Then Node.Expanded = True
         GoTo Salida
      Case "GastosBancariosTodos"
         If Mensaje("Todos los gastos bancarios", "Visualizar") Then
            Set oRs = Aplicacion.Valores.TraerFiltrado("_GastosEntreFechas", Array(Date, Date, -1))
         Else
            GoTo Salida
         End If
         mIcono = "GastosBancarios"
         GoTo Fin
      Case "GastosBancariosAgrupados"
         AbrirSubarbol "GastosBancariosAgrupados", "+SubGS1", "+SubGS2", Arbol, Node
         GoTo Salida
      Case "+SubGS1"
         Desde = DateSerial(Node.Text, 1, 1)
         Hasta = DateSerial(Node.Text, 12, 31)
         If Mensaje("Gastos bancarios del año " & Node.Text, "Visualizar") Then
            Set oRs = Aplicacion.Valores.TraerFiltrado("_GastosEntreFechas", Array(Desde, Hasta, 0))
         Else
            GoTo Salida
         End If
         mIcono = "GastosBancarios"
         GoTo Fin
      Case "+SubGS2"
         Set oRs = Aplicacion.Valores.TraerFiltrado("_GastosEntreFechas", Array(Desde, Hasta, 0))
         mIcono = "GastosBancarios"
         GoTo Fin
      Case "GastosFletes"
         Node.Expanded = True
         GoTo Salida
      Case "GastosFletesTodos"
         If Mensaje("Todos los gastos fletes", "Visualizar") Then
            Set oRs = Aplicacion.GastosFletes.TraerFiltrado("_Fecha", Array(0, 0, -1))
         Else
            GoTo Salida
         End If
         mIcono = "GastosFletes"
         GoTo Fin
      Case "GastosFletesAgrupados"
         AbrirSubarbol "GastosFletesAgrupados", "+SubGF1", "+SubGF2", Arbol, Node
         GoTo Salida
      Case "+SubGF1"
         Desde = DateSerial(Node.Text, 1, 1)
         Hasta = DateSerial(Node.Text, 12, 31)
         If Mensaje("Gastos fletes del año " & Node.Text, "Visualizar") Then
            Set oRs = Aplicacion.GastosFletes.TraerFiltrado("_Fecha", Array(Desde, Hasta))
         Else
            GoTo Salida
         End If
         mIcono = "GastosFletes"
         GoTo Fin
      Case "+SubGF2"
         Set oRs = Aplicacion.GastosFletes.TraerFiltrado("_Fecha", Array(Desde, Hasta))
         mIcono = "GastosFletes"
         GoTo Fin
      Case "Grados"
         Set oRs = Aplicacion.Grados.TraerTodos
      Case "GruposActivosFijos"
         Set oRs = Aplicacion.GruposActivosFijos.TraerTodos
      Case "GruposObras"
         Set oRs = Aplicacion.GruposObras.TraerTodos
      Case "HChequeras"
         Set oRs = Aplicacion.BancoChequeras.TraerFiltrado("_Inactivas")
      Case "HistObras"
         If Not Node.Expanded Then Node.Expanded = True
         GoTo Salida
      Case "HistObras1"
         Set oRs = Aplicacion.Obras.TraerFiltrado("_Inactivas")
         mIcono = "HistObras"
         GoTo Fin
      Case "HistObras2"
         Set oRs = Aplicacion.Obras.TraerFiltrado("_Inactivas")
         If Node.Children = 0 Then
            With oRs
               Do Until .EOF
                  Arbol.Nodes.Add "HistObras2", tvwChild, "+SubObH " & .Fields(0).Value, "Obra " & .Fields(1).Value, "HistObras", "HistObras"
                  Arbol.Nodes.Add "+SubObH " & .Fields(0).Value, tvwChild, "+ObHXLA " & .Fields(1).Value, "x LA", "HistObras", "HistObras"
                  Arbol.Nodes.Add "+SubObH " & .Fields(0).Value, tvwChild, "+ObHXEq " & .Fields(0).Value, "x Equipos", "HistObras", "HistObras"
                  Arbol.Nodes.Add "+SubObH " & .Fields(0).Value, tvwChild, "+ObHXRM " & .Fields(1).Value, "x RM", "HistObras", "HistObras"
                  .MoveNext
               Loop
            End With
            Node.Expanded = True
            If oRs.RecordCount > 0 Then
               oRs.MoveFirst
               Do Until oRs.EOF
                  'Por Acopio
                  sKey = "+ObHXLA " & oRs.Fields(1).Value
                  Set oRs1 = Aplicacion.Acopios.TraerFiltrado("PorObra", oRs.Fields(1).Value)
                  If Not oRs1 Is Nothing Then
                     Do Until oRs1.EOF
                        Arbol.Nodes.Add sKey, tvwChild, "+ObHLA2 " & oRs1.Fields(0).Value, "Aco. " & oRs1.Fields(2).Value, "LAcopio", "LAcopio"
                        oRs1.MoveNext
                     Loop
                     If oRs1.RecordCount > 0 Then
                        oRs1.MoveFirst
                        Do Until oRs1.EOF
                           sKey = "+ObHLA2 " & oRs1.Fields(0).Value
                           Set oRs2 = Aplicacion.LMateriales.TraerFiltrado("PorLAcopio", oRs1.Fields(2).Value)
                           Do Until oRs2.EOF
                              Arbol.Nodes.Add sKey, tvwChild, "+ObHLA3 " & oRs2.Fields(0).Value & oRs2.Fields(3).Value, "Mat. " & oRs2.Fields(2).Value, "LMateriales", "LMateriales"
                              oRs2.MoveNext
                           Loop
                           oRs2.Close
                           Set oRs2 = Nothing
                           oRs1.MoveNext
                        Loop
                        oRs1.Close
                        Set oRs1 = Nothing
                     End If
                  End If
                  'Por Equipo
                  sKey = "+ObHXEq " & oRs.Fields(0).Value
                  Set oRs1 = Aplicacion.Equipos.TraerFiltrado("PorObra", oRs.Fields(0).Value)
                  Do Until oRs1.EOF
                     Arbol.Nodes.Add sKey, tvwChild, "+ObHEq2 " & oRs1.Fields(0).Value, "Equ. " & oRs1.Fields(2).Value, "Equipos", "Equipos"
                     oRs1.MoveNext
                  Loop
                  If oRs1.RecordCount > 0 Then
                     oRs1.MoveFirst
                     Do Until oRs1.EOF
                        sKey = "+ObHEq2 " & oRs1.Fields(0).Value
                        Set oRs2 = Aplicacion.Acopios.TraerFiltrado("_PorEquipo", oRs1.Fields(0).Value)
                        If oRs2.RecordCount > 0 Then
                           oRs2.MoveFirst
                           Arbol.Nodes.Add sKey, tvwChild, "+ObHEqA " & oRs1.Fields(0).Value, "x LA ", "HistObras", "HistObras"
                           Do Until oRs2.EOF
                              Arbol.Nodes.Add "+ObHEqA " & oRs1.Fields(0).Value, tvwChild, "+ObHEq3 " & oRs1.Fields(0).Value & "|" & oRs2.Fields(0).Value, "L.Aco. " & oRs2.Fields(1).Value, "LAcopio", "LAcopio"
                              oRs2.MoveNext
                           Loop
                        End If
                        oRs2.Close
                        Set oRs2 = Aplicacion.LMateriales.TraerFiltrado("PorEquipo", oRs1.Fields(0).Value)
                        If oRs2.RecordCount > 0 Then
                           oRs2.MoveFirst
                           Arbol.Nodes.Add sKey, tvwChild, "+ObHEqM " & oRs1.Fields(0).Value, "x LM ", "HistObras", "HistObras"
                           Do Until oRs2.EOF
                              Arbol.Nodes.Add "+ObHEqM " & oRs1.Fields(0).Value, tvwChild, "+ObHEq4 " & oRs2.Fields(0).Value, "Mat. " & oRs2.Fields(2).Value, "LMateriales", "LMateriales"
                              oRs2.MoveNext
                           Loop
                        End If
                        oRs2.Close
                        oRs1.MoveNext
                     Loop
                     oRs1.Close
                     Set oRs1 = Nothing
                     Set oRs2 = Nothing
                  End If
                  'Por RM
                  sKey = "+ObHXRM " & oRs.Fields(1).Value
                  Set oRs1 = Aplicacion.Requerimientos.TraerFiltrado("PorObra", oRs.Fields(0).Value)
                  Do Until oRs1.EOF
                     Arbol.Nodes.Add sKey, tvwChild, "+ObHRm2 " & oRs1.Fields(0).Value, "Req. " & oRs1.Fields(1).Value, "Requerimientos", "Requerimientos"
                     oRs1.MoveNext
                  Loop
                  oRs1.Close
                  Set oRs1 = Nothing
                  oRs.MoveNext
               Loop
            End If
         End If
         oRs.Close
         Set oRs = Aplicacion.Obras.TraerFiltrado("_Inactivas")
         mIcono = "HistObras"
         GoTo Fin
      Case "+ObHXLA"
         sKey = Node.Key
         sDato = mId(sKey, 9, 13)
         Set oRs = Aplicacion.Acopios.TraerFiltrado("PorObra", sDato)
         mIcono = "LAcopio"
         GoTo Fin
      Case "+ObHLA2"
         sKey = Node.Key
         sDato = mId(Node.Text, 6, 30)
         Set oRs = Aplicacion.LMateriales.TraerFiltrado("PorLAcopio", sDato)
         mIcono = "LMateriales"
         GoTo Fin
      Case "+ObHXEq"
         sKey = Node.Key
         sDato = mId(sKey, 8, 10)
         Set oRs = Aplicacion.Equipos.TraerFiltrado("PorObra", sDato)
         mIcono = "Equipos"
         GoTo Fin
      Case "+ObHEqM"
         sKey = Node.Key
         sDato = mId(sKey, 8, 10)
         Set oRs = Aplicacion.LMateriales.TraerFiltrado("PorEquipo", sDato)
         mIcono = "LMateriales"
         GoTo Fin
      Case "+ObHEqA"
         sKey = Node.Key
         sDato = mId(sKey, 8, 10)
         Set oRs = Aplicacion.Acopios.TraerFiltrado("_PorEquipo_Todo", sDato)
         mIcono = "LAcopio"
         GoTo Fin
      Case "+ObHXRM"
         sKey = Node.Key
         sDato = mId(sKey, 9, 13)
         Set oRs = Aplicacion.Requerimientos.TraerFiltrado("PorNumeroObra", sDato)
         mIcono = "Requerimientos"
         GoTo Fin
      Case "Historicos"
         mNuevo = False
         Node.Expanded = True
         GoTo Salida
      Case "HLAcopios"
         Set oRs = Aplicacion.Acopios.TraerFiltrado("_Cumplidos")
         mNuevo = False
      Case "HLMateriales"
         mNuevo = False
      Case "HPedidos"
         Set oRs = Aplicacion.Pedidos.TraerFiltrado("_Cumplidos")
         mNuevo = False
      Case "HRequerimientos"
         Set oRs = Aplicacion.Requerimientos.TraerFiltrado("_Cumplidos")
         mNuevo = False
      Case "IBCondiciones1", "IBCondiciones2"
         Set oRs = Aplicacion.IBCondiciones.TraerTodos
         mIcono = "IBCondiciones"
         GoTo Fin
      Case "IGCondiciones1", "IGCondiciones2"
         Set oRs = Aplicacion.TiposRetencionGanancia.TraerTodos
         mIcono = "IGCondiciones"
         GoTo Fin
      Case "ImpuestosDirectos"
         Set oRs = Aplicacion.ImpuestosDirectos.TraerTodos
         mIcono = "ImpuestosDirectos"
         GoTo Fin
      Case "ItemsPopUpMateriales"
         Set oRs = Aplicacion.ItemsPopUpMateriales.TraerTodos
      Case "LAcopio"
         Set oRs = Aplicacion.Acopios.TraerTodos
      Case "LiquidacionesFletes"
         Node.Expanded = True
         GoTo Salida
      Case "LiquidacionesFletesTodas"
         If Mensaje("Todas las liquidaciones de fletes", "Visualizar") Then
            'Set oRs = Aplicacion.LiquidacionesFletes.TraerTodos
         Else
            GoTo Salida
         End If
         mIcono = "LiquidacionesFletes"
         GoTo Fin
      Case "LiquidacionesFletesAgrupadas"
         AbrirSubarbol "LiquidacionesFletesAgrupadas", "+SubLF1", "+SubLF2", Arbol, Node
         GoTo Salida
      Case "+SubLF1"
         Desde = DateSerial(Node.Text, 1, 1)
         Hasta = DateSerial(Node.Text, 12, 31)
         If Mensaje("Liquidaciones de fletes del año " & Node.Text, "Visualizar") Then
            'Set oRs = Aplicacion.LiquidacionesFletes.TraerFiltrado("Fecha", Array(Desde, Hasta))
         Else
            GoTo Salida
         End If
         mIcono = "LiquidacionesFletes"
         GoTo Fin
      Case "+SubLF2"
         'Set oRs = Aplicacion.LiquidacionesFletes.TraerFiltrado("Fecha", Array(Desde, Hasta))
         mIcono = "LiquidacionesFletes"
         GoTo Fin
      Case "ListasPrecios"
         If Node.Children = 1 Then
            Set oRs = Aplicacion.ListasPrecios.TraerFiltrado("_ParaArbol")
            With oRs
               Do Until .EOF
                  Arbol.Nodes.Add "ListasPrecios", tvwChild, "+SubLP1 " & .Fields(0).Value, "" & .Fields(1).Value, "ListasPrecios", "ListasPrecios"
                  .MoveNext
               Loop
               .Close
            End With
            Node.Expanded = True
         End If
         GoTo Salida
      Case "+SubLP1"
         DatosFecha = VBA.Split(Node.Key, " ")
         Set oRs = Aplicacion.ListasPrecios.TraerFiltrado("_DetallesPorId", DatosFecha(1))
         mIcono = "ListasPrecios"
         GoTo Fin
      Case "ListasPreciosDefinicion"
         Set oRs = Aplicacion.ListasPrecios.TraerTodos
         mIcono = "ListasPrecios"
         GoTo Fin
      Case "LMateriales"
         Set oRs = Aplicacion.LMateriales.TraerTodos
      Case "LMaterialesPorObras"
         Set oRs = Aplicacion.Obras.TraerFiltrado("_Activas")
         If Node.Children = 0 Then
            With oRs
               Do Until .EOF
                  Arbol.Nodes.Add "LMaterialesPorObras", tvwChild, "+SubLMO " & .Fields(0).Value, "Obra " & .Fields(1).Value, "LMaterialesPorObras", "LMaterialesPorObras"
                  .MoveNext
               Loop
            End With
            Node.Expanded = True
            If oRs.RecordCount > 0 Then
               oRs.MoveFirst
               Do Until oRs.EOF
                  'Por Equipo
                  sKey = "+SubLMO " & oRs.Fields(0).Value
                  Set oRs1 = Aplicacion.Equipos.TraerFiltrado("PorObra", oRs.Fields(0).Value)
                  Do Until oRs1.EOF
                     Arbol.Nodes.Add sKey, tvwChild, "+LMOEq0 " & oRs1.Fields(0).Value, "Equ. " & oRs1.Fields(2).Value, "Equipos", "Equipos"
                     oRs1.MoveNext
                  Loop
                  If oRs1.RecordCount > 0 Then
                     oRs1.MoveFirst
                     Do Until oRs1.EOF
                        sKey = "+LMOEq0 " & oRs1.Fields(0).Value
                        Set oRs2 = Aplicacion.LMateriales.TraerFiltrado("PorEquipo", oRs1.Fields(0).Value)
                        If oRs2.RecordCount > 0 Then
                           oRs2.MoveFirst
                           Do Until oRs2.EOF
                              Arbol.Nodes.Add sKey, tvwChild, "+LMOEqM " & oRs2.Fields(0).Value, "Mat. " & oRs2.Fields(2).Value, "LMateriales", "LMateriales"
                              oRs2.MoveNext
                           Loop
                        End If
                        oRs2.Close
                        oRs1.MoveNext
                     Loop
                     oRs1.Close
                     Set oRs1 = Nothing
                     Set oRs2 = Nothing
                  End If
                  oRs.MoveNext
               Loop
            End If
         End If
         oRs.Close
         Set oRs = Aplicacion.Obras.TraerFiltrado("_Activas")
      Case "+SubLMO"
         sKey = Node.Key
         sDato = mId(sKey, 8, 10)
         Set oRs = Aplicacion.Equipos.TraerFiltrado("_PorObra1", sDato)
         mIcono = "Equipos"
         GoTo Fin
      Case "+LMOEq0"
         sKey = Node.Key
         sDato = mId(sKey, 8, 10)
         Set oRs = Aplicacion.LMateriales.TraerFiltrado("PorEquipo", sDato)
         mIcono = "LMateriales"
         GoTo Fin
      Case "Localidades"
         Set oRs = Aplicacion.Localidades.TraerTodos
      Case "LugaresEntrega"
         Set oRs = Aplicacion.LugaresEntrega.TraerTodos
         mIcono = "Pedidos"
         GoTo Fin
      Case "Marcas"
         Set oRs = Aplicacion.Marcas.TraerTodos
      Case "Materiales"
         Set oRs = Aplicacion.Materiales.TraerTodos
      Case "Modelos"
         Set oRs = Aplicacion.Modelos.TraerTodos
      Case "ModificacionActivoFijo"
         mNuevo = False
         Set oRs = Aplicacion.Articulos.TraerFiltrado("_ModificacionActivoFijo")
         mIcono = "ModificacionActivoFijo"
         GoTo Fin
      Case "Monedas"
         Set oRs = Aplicacion.Monedas.TraerTodos
      Case "MovimientoBancos"
         mNuevo = False
         Node.Expanded = True
         GoTo Salida
      Case "MovStock"
         mNuevo = False
         Node.Expanded = True
         GoTo Salida
      Case "MovStockSAT"
         mNuevo = False
         Node.Expanded = True
         GoTo Salida
      Case "Normas"
         Set oRs = Aplicacion.Normas.TraerTodos
      Case "NotasDebito"
         If Not Node.Expanded Then Node.Expanded = True
         GoTo Salida
      Case "NotasDebitoTodas"
         If Mensaje("Todas las notas de debito", "Visualizar") Then
            Set oRs = Aplicacion.NotasDebito.TraerTodos
         Else
            GoTo Salida
         End If
         mIcono = "NotasDebito"
         GoTo Fin
      Case "NotasDebitoAgrupadas"
         AbrirSubarbol "NotasDebitoAgrupadas", "+SubND1", "+SubND2", Arbol, Node
         GoTo Salida
      Case "+SubND1"
         Desde = DateSerial(Node.Text, 1, 1)
         Hasta = DateSerial(Node.Text, 12, 31)
         If Mensaje("Notas de debito del año " & Node.Text, "Visualizar") Then
            Set oRs = Aplicacion.NotasDebito.TraerFiltrado("Fecha", Array(Desde, Hasta))
         Else
            GoTo Salida
         End If
         mIcono = "NotasDebito"
         GoTo Fin
      Case "+SubND2"
         Set oRs = Aplicacion.NotasDebito.TraerFiltrado("Fecha", Array(Desde, Hasta))
         mIcono = "NotasDebito"
         GoTo Fin
      Case "NotasCredito"
         If Not Node.Expanded Then Node.Expanded = True
         GoTo Salida
      Case "NotasCreditoTodas"
         If Mensaje("Todas las notas de credito", "Visualizar") Then
            Set oRs = Aplicacion.NotasCredito.TraerTodos
         Else
            GoTo Salida
         End If
         mIcono = "NotasCredito"
         GoTo Fin
      Case "NotasCreditoAgrupadas"
         AbrirSubarbol "NotasCreditoAgrupadas", "+SubNC1", "+SubNC2", Arbol, Node
         GoTo Salida
      Case "+SubNC1"
         Desde = DateSerial(Node.Text, 1, 1)
         Hasta = DateSerial(Node.Text, 12, 31)
         If Mensaje("Notas de credito del año " & Node.Text, "Visualizar") Then
            Set oRs = Aplicacion.NotasCredito.TraerFiltrado("Fecha", Array(Desde, Hasta))
         Else
            GoTo Salida
         End If
         mIcono = "NotasCredito"
         GoTo Fin
      Case "+SubNC2"
         Set oRs = Aplicacion.NotasCredito.TraerFiltrado("Fecha", Array(Desde, Hasta))
         mIcono = "NotasCredito"
         GoTo Fin
      Case "Obras"
         Node.Expanded = True
         GoTo Salida
      Case "Obras1"
         If glbParametrizacionNivel1 Then
            Set oRs = Aplicacion.Obras.TraerFiltrado("_DetallesParametrizados", 1)
         Else
            Set oRs = Aplicacion.Obras.TraerFiltrado("_Activas")
         End If
         mIcono = "Obras"
         GoTo Fin
      Case "Obras2"
         Set oRs = Aplicacion.Obras.TraerFiltrado("_Activas")
         If Node.Children = 0 Then
            With oRs
               Do Until .EOF
                  Arbol.Nodes.Add "Obras2", tvwChild, "+SubObr " & .Fields(0).Value, "Obra " & .Fields(1).Value, "Obras", "Obras"
                  Arbol.Nodes.Add "+SubObr " & .Fields(0).Value, tvwChild, "+ObrXLA " & .Fields(1).Value, "x LA", "Obras", "Obras"
                  Arbol.Nodes.Add "+SubObr " & .Fields(0).Value, tvwChild, "+ObrXEq " & .Fields(0).Value, "x Equipos", "Obras", "Obras"
                  Arbol.Nodes.Add "+SubObr " & .Fields(0).Value, tvwChild, "+ObrXRM " & .Fields(1).Value, "x RM", "Obras", "Obras"
                  .MoveNext
               Loop
            End With
            Node.Expanded = True
            If oRs.RecordCount > 0 Then
               oRs.MoveFirst
               Do Until oRs.EOF
                  'Por Acopio
                  sKey = "+ObrXLA " & oRs.Fields(1).Value
                  Set oRs1 = Aplicacion.Acopios.TraerFiltrado("PorObra", oRs.Fields(1).Value)
                  Do Until oRs1.EOF
                     Arbol.Nodes.Add sKey, tvwChild, "+ObrLA2 " & oRs1.Fields(0).Value, "Aco. " & oRs1.Fields(2).Value, "LAcopio", "LAcopio"
                     oRs1.MoveNext
                  Loop
                  If oRs1.RecordCount > 0 Then
                     oRs1.MoveFirst
                     Do Until oRs1.EOF
                        sKey = "+ObrLA2 " & oRs1.Fields(0).Value
                        Set oRs2 = Aplicacion.LMateriales.TraerFiltrado("PorLAcopio", oRs1.Fields(2).Value)
                        Do Until oRs2.EOF
                           Arbol.Nodes.Add sKey, tvwChild, "+ObrLA3 " & oRs2.Fields(0).Value & oRs2.Fields(3).Value, "Mat. " & oRs2.Fields(2).Value, "LMateriales", "LMateriales"
                           oRs2.MoveNext
                        Loop
                        oRs2.Close
                        Set oRs2 = Nothing
                        oRs1.MoveNext
                     Loop
                     oRs1.Close
                     Set oRs1 = Nothing
                  End If
                  'Por Equipo
                  sKey = "+ObrXEq " & oRs.Fields(0).Value
                  Set oRs1 = Aplicacion.Equipos.TraerFiltrado("PorObra", oRs.Fields(0).Value)
                  Do Until oRs1.EOF
                     Arbol.Nodes.Add sKey, tvwChild, "+ObrEq2 " & oRs1.Fields(0).Value, "Equ. " & oRs1.Fields(2).Value, "Equipos", "Equipos"
                     oRs1.MoveNext
                  Loop
                  If oRs1.RecordCount > 0 Then
                     oRs1.MoveFirst
                     Do Until oRs1.EOF
                        sKey = "+ObrEq2 " & oRs1.Fields(0).Value
                        Set oRs2 = Aplicacion.Acopios.TraerFiltrado("_PorEquipo", oRs1.Fields(0).Value)
                        If oRs2.RecordCount > 0 Then
                           oRs2.MoveFirst
                           Arbol.Nodes.Add sKey, tvwChild, "+ObrEqA " & oRs1.Fields(0).Value, "x LA ", "Obras2", "Obras2"
                           Do Until oRs2.EOF
                              Arbol.Nodes.Add "+ObrEqA " & oRs1.Fields(0).Value, tvwChild, "+ObrEq3 " & oRs1.Fields(0).Value & "|" & oRs2.Fields(0).Value, "L.Aco. " & oRs2.Fields(1).Value, "LAcopio", "LAcopio"
                              oRs2.MoveNext
                           Loop
                        End If
                        oRs2.Close
                        Set oRs2 = Aplicacion.LMateriales.TraerFiltrado("PorEquipo", oRs1.Fields(0).Value)
                        If oRs2.RecordCount > 0 Then
                           oRs2.MoveFirst
                           Arbol.Nodes.Add sKey, tvwChild, "+ObrEqM " & oRs1.Fields(0).Value, "x LM ", "Obras2", "Obras2"
                           Do Until oRs2.EOF
                              Arbol.Nodes.Add "+ObrEqM " & oRs1.Fields(0).Value, tvwChild, "+ObrEq4 " & oRs2.Fields(0).Value, "Mat. " & oRs2.Fields(2).Value, "LMateriales", "LMateriales"
                              oRs2.MoveNext
                           Loop
                        End If
                        oRs2.Close
                        oRs1.MoveNext
                     Loop
                     oRs1.Close
                     Set oRs1 = Nothing
                     Set oRs2 = Nothing
                  End If
                  'Por RM
                  sKey = "+ObrXRM " & oRs.Fields(1).Value
                  Set oRs1 = Aplicacion.Requerimientos.TraerFiltrado("PorObra", oRs.Fields(0).Value)
                  Do Until oRs1.EOF
                     Arbol.Nodes.Add sKey, tvwChild, "+ObrRm2 " & oRs1.Fields(0).Value, "Req. " & oRs1.Fields(1).Value, "Requerimientos", "Requerimientos"
                     oRs1.MoveNext
                  Loop
                  oRs1.Close
                  Set oRs1 = Nothing
                  oRs.MoveNext
               Loop
            End If
         End If
         oRs.Close
         Set oRs = Aplicacion.Obras.TraerFiltrado("_Activas")
         mIcono = "Obras"
         GoTo Fin
      Case "+ObrXLA"
         sKey = Node.Key
         sDato = mId(sKey, 9, 10)
         Set oRs = Aplicacion.Acopios.TraerFiltrado("PorObra", sDato)
         mIcono = "LAcopio"
         GoTo Fin
      Case "+ObrLA2"
         sKey = Node.Key
         sDato = mId(Node.Text, 6, 30)
         Set oRs = Aplicacion.LMateriales.TraerFiltrado("PorLAcopio", sDato)
         mIcono = "LMateriales"
         GoTo Fin
      Case "+ObrXEq"
         sKey = Node.Key
         sDato = mId(sKey, 8, 10)
         Set oRs = Aplicacion.Equipos.TraerFiltrado("PorObra", sDato)
         mIcono = "Equipos"
         GoTo Fin
      Case "+ObrEqM"
         sKey = Node.Key
         sDato = mId(sKey, 8, 10)
         Set oRs = Aplicacion.LMateriales.TraerFiltrado("PorEquipo", sDato)
         mIcono = "LMateriales"
         GoTo Fin
      Case "+ObrEqA"
         sKey = Node.Key
         sDato = mId(sKey, 8, 10)
         Set oRs = Aplicacion.Acopios.TraerFiltrado("_PorEquipo_Todo", sDato)
         mIcono = "LAcopio"
         GoTo Fin
      Case "+ObrXRM"
         sKey = Node.Key
         sDato = mId(sKey, 9, 10)
         Set oRs = Aplicacion.Requerimientos.TraerFiltrado("PorNumeroObra", sDato)
         mIcono = "Requerimientos"
         GoTo Fin
      Case "OPago"
         If Not Node.Expanded Then Node.Expanded = True
         GoTo Salida
      Case "OPagoTodas"
         If Mensaje("Todas las ordenes de pago", "Visualizar") Then
            Set oRs = Aplicacion.OrdenesPago.TraerFiltrado("_Todas", glbIdCuentaFFUsuario)
         Else
            GoTo Salida
         End If
         mIcono = "OPago"
         GoTo Fin
      Case "OPagoALaFirma"
         Set oRs = Aplicacion.OrdenesPago.TraerFiltrado("_ALaFirma")
         mIcono = "OPago"
         GoTo Fin
      Case "OPagoEnCaja"
         Set oRs = Aplicacion.OrdenesPago.TraerFiltrado("_EnCaja")
         mIcono = "OPago"
         GoTo Fin
      Case "OPagoEnCajaObra"
         Set oRs = Aplicacion.OrdenesPago.TraerFiltrado("_EnCaja", "CO")
         mIcono = "OPago"
         GoTo Fin
      Case "OPagoPorMes"
         AbrirSubarbol "OPagoPorMes", "+SubOp1", "+SubOp2", Arbol, Node
         GoTo Salida
      Case "+SubOp1"
         Desde = DateSerial(Node.Text, 1, 1)
         Hasta = DateSerial(Node.Text, 12, 31)
         If Mensaje("Ordenes de pago del año " & Node.Text, "Visualizar") Then
            Set oRs = Aplicacion.OrdenesPago.TraerFiltrado("Fecha", Array(Desde, Hasta, glbIdCuentaFFUsuario))
         Else
            GoTo Salida
         End If
         mIcono = "OPago"
         GoTo Fin
      Case "+SubOp2"
         Set oRs = Aplicacion.OrdenesPago.TraerFiltrado("Fecha", Array(Desde, Hasta, glbIdCuentaFFUsuario))
         mIcono = "OPago"
         GoTo Fin
      Case "OPagoAConfirmar"
         mNuevo = False
         Set oRs = Aplicacion.OrdenesPago.TraerFiltrado("_AConfirmar")
         mIcono = "OPago"
         GoTo Fin
      Case "OrdenesCompra"
         If Not Node.Expanded Then Node.Expanded = True
         GoTo Salida
      Case "OrdenesCompraTodas"
         If Mensaje("Todas las ordenes de compra", "Visualizar") Then
            Set oRs = Aplicacion.OrdenesCompra.TraerFiltrado("_Todas", glbIdVendedor)
         Else
            GoTo Salida
         End If
         mIcono = "OrdenesCompra"
         GoTo Fin
      Case "OrdenesCompraAgrupadas"
         AbrirSubarbol "OrdenesCompraAgrupadas", "+SubOC1", "+SubOC2", Arbol, Node
         GoTo Salida
      Case "+SubOC1"
         Desde = DateSerial(Node.Text, 1, 1)
         Hasta = DateSerial(Node.Text, 12, 31)
         If Mensaje("Ordenes de compra del año " & Node.Text, "Visualizar") Then
            Set oRs = Aplicacion.OrdenesCompra.TraerFiltrado("Fecha", Array(Desde, Hasta))
         Else
            GoTo Salida
         End If
         mIcono = "OrdenesCompra"
         GoTo Fin
      Case "+SubOC2"
         Set oRs = Aplicacion.OrdenesCompra.TraerFiltrado("Fecha", Array(Desde, Hasta, glbIdVendedor))
         mIcono = "OrdenesCompra"
         GoTo Fin
      Case "OrdenesTrabajo"
         If Not Node.Expanded Then Node.Expanded = True
         GoTo Salida
      Case "OrdenesTrabajoTodas"
         Set oRs = Aplicacion.OrdenesTrabajo.TraerTodos
         mIcono = "OrdenesTrabajo"
         GoTo Fin
      Case "OrdenesTrabajoAgrupadas"
         AbrirSubarbol "OrdenesTrabajoAgrupadas", "+SubOT1", "+SubOT2", Arbol, Node
         GoTo Salida
      Case "+SubOT2"
         Set oRs = Aplicacion.OrdenesTrabajo.TraerFiltrado("Fecha", Array(Desde, Hasta))
         mIcono = "OrdenesTrabajo"
         GoTo Fin
      Case "OtrosIngresosAlmacen"
         Node.Expanded = True
         GoTo Salida
      Case "OtrosIngresosAlmacenTodos"
         If Mensaje("Todos los otros ingresos a almacen", "Visualizar") Then
            Set oRs = Aplicacion.OtrosIngresosAlmacen.TraerFiltrado("_Todos", glbIdObraAsignadaUsuario)
         Else
            GoTo Salida
         End If
         mIcono = "OtrosIngresosAlmacen"
         GoTo Fin
      Case "OtrosIngresosAlmacenAgrupados"
         AbrirSubarbol "OtrosIngresosAlmacenAgrupados", "+SubOI1", "+SubOI2", Arbol, Node
         GoTo Salida
      Case "+SubOI1"
         Desde = DateSerial(Node.Text, 1, 1)
         Hasta = DateSerial(Node.Text, 12, 31)
         If Mensaje("Otros ingresos a almacen del año " & Node.Text, "Visualizar") Then
            Set oRs = Aplicacion.OtrosIngresosAlmacen.TraerFiltrado("Fecha", Array(Desde, Hasta, glbIdObraAsignadaUsuario))
         Else
            GoTo Salida
         End If
         mIcono = "OtrosIngresosAlmacen"
         GoTo Fin
      Case "+SubOI2"
         Set oRs = Aplicacion.OtrosIngresosAlmacen.TraerFiltrado("Fecha", Array(Desde, Hasta, glbIdObraAsignadaUsuario))
         mIcono = "OtrosIngresosAlmacen"
         GoTo Fin
      Case "OtrosIngresosAlmacenSAT"
         Node.Expanded = True
         GoTo Salida
      Case "OtrosIngresosAlmacenTodosSAT"
         mNuevo = False
         Set oRs = Aplicacion.OtrosIngresosAlmacenSAT.TraerFiltrado("_Todos")
         mIcono = "OtrosIngresosAlmacen"
         GoTo Fin
      Case "OtrosIngresosAlmacenAgrupadosSAT"
         mNuevo = False
         AbrirSubarbol "OtrosIngresosAlmacenAgrupadosSAT", "+SubOI3", "+SubOI4", Arbol, Node
         GoTo Salida
      Case "+SubOI4"
         mNuevo = False
         Set oRs = Aplicacion.OtrosIngresosAlmacenSAT.TraerFiltrado("Fecha", Array(Desde, Hasta))
         mIcono = "OtrosIngresosAlmacen"
         GoTo Fin
      Case "Paises"
         Set oRs = Aplicacion.Paises.TraerTodos
      Case "PartesProduccion"
         'Set oRs = Aplicacion.PartesProduccion.TraerTodos
      Case "Pedidos"
         If Not Node.Expanded Then Node.Expanded = True
         GoTo Salida
      Case "PedidosTodos"
         If Mensaje("Todos los pedidos", "Visualizar") Then
            Set oRs = Aplicacion.Pedidos.TraerTodos
         Else
            GoTo Salida
         End If
         mIcono = "Pedidos"
         GoTo Fin
      Case "PedidosAgrupados"
         AbrirSubarbol "PedidosAgrupados", "+SubPe1", "+SubPe2", Arbol, Node
         GoTo Salida
      Case "+SubPe1"
         Desde = DateSerial(Node.Text, 1, 1)
         Hasta = DateSerial(Node.Text, 12, 31)
         If Mensaje("Pedidos del año " & Node.Text, "Visualizar") Then
            mAux1 = -1
            If Not VerPedidosHistoricos Then mAux1 = 0
            Set oRs = Aplicacion.Pedidos.TraerFiltrado("Fecha", Array(Desde, Hasta, mAux1))
         Else
            GoTo Salida
         End If
         mIcono = "Pedidos"
         GoTo Fin
      Case "+SubPe2"
         mAux1 = -1
         If Not VerPedidosHistoricos Then mAux1 = 0
         Set oRs = Aplicacion.Pedidos.TraerFiltrado("Fecha", Array(Desde, Hasta, mAux1))
         mIcono = "Pedidos"
         GoTo Fin
      Case "PedidosPendientes"
         Set oRs = Aplicacion.Pedidos.TraerFiltrado("_PendientesParaArbol")
         mIcono = "Pedidos"
         GoTo Fin
      Case "PedidosPorObra"
         If Node.Children = 0 Then
            Set oRs = Aplicacion.Obras.TraerFiltrado("_Habilitadas")
            With oRs
               Do Until .EOF
                  Arbol.Nodes.Add "PedidosPorObra", tvwChild, "+SubPo1 " & .Fields(0).Value, "" & .Fields(1).Value, "Pedidos", "Pedidos"
                  .MoveNext
               Loop
            End With
            oRs.Close
            Node.Expanded = True
         End If
         mIcono = "Pedidos"
         GoTo Salida
      Case "+SubPo1"
         sKey = Node.Key
         sDato = mId(sKey, 9, 10)
         Set oRs = Aplicacion.Pedidos.TraerFiltrado("_PorObra", sDato)
         mIcono = "Pedidos"
         GoTo Fin
      Case "PedidosSubcontratos"
         If Not Node.Expanded Then Node.Expanded = True
         GoTo Salida
      Case "PedidosSubcontratosTodos"
         Set oRs = Aplicacion.Pedidos.TraerFiltrado("_SubcontratosTodos")
         mIcono = "Pedidos"
         GoTo Fin
      Case "PedidosSubcontratosAgrupados"
         AbrirSubarbol "PedidosSubcontratosAgrupados", "+SubPS1", "+SubPS2", Arbol, Node
         GoTo Salida
      Case "+SubPS2"
         Set oRs = Aplicacion.Pedidos.TraerFiltrado("_SubcontratosEntreFecha", Array(Desde, Hasta))
         mIcono = "Pedidos"
         GoTo Fin
      Case "PedidosAbiertos"
         Set oRs = Aplicacion.PedidosAbiertos.TraerTodos
         mIcono = "Pedidos"
         GoTo Fin
      Case "PedidosSAT"
         If Not Node.Expanded Then Node.Expanded = True
         GoTo Salida
      Case "PedidosTodosSAT"
         mNuevo = False
         Set oRs = Aplicacion.PedidosSAT.TraerTodos
         mIcono = "Pedidos"
         GoTo Fin
      Case "PedidosAgrupadosSAT"
         mNuevo = False
         AbrirSubarbol "PedidosAgrupadosSAT", "+SubPe3", "+SubPe4", Arbol, Node
         GoTo Salida
      Case "+SubPe3"
         mNuevo = False
         Desde = DateSerial(Node.Text, 1, 1)
         Hasta = DateSerial(Node.Text, 12, 31)
         mAux1 = -1
         If Not VerPedidosHistoricos Then mAux1 = 0
         Set oRs = Aplicacion.PedidosSAT.TraerFiltrado("Fecha", Array(Desde, Hasta, mAux1))
         mIcono = "Pedidos"
         GoTo Fin
      Case "+SubPe4"
         mNuevo = False
         mAux1 = -1
         Set oRs = Aplicacion.PedidosSAT.TraerFiltrado("Fecha", Array(Desde, Hasta))
         mIcono = "Pedidos"
         GoTo Fin
      Case "PedidosPorObraSAT"
         mNuevo = False
         If Node.Children = 0 Then
            Set oRs = Aplicacion.ArchivosATransmitirDestinos.TraerFiltrado("_Todos")
            With oRs
               Do Until .EOF
                  Arbol.Nodes.Add "PedidosPorObraSAT", tvwChild, "+SubPo2 " & .Fields(0).Value, "" & .Fields(1).Value, "Pedidos", "Pedidos"
                  .MoveNext
               Loop
            End With
            oRs.Close
            Node.Expanded = True
         End If
         mIcono = "Pedidos"
         GoTo Salida
      Case "+SubPo2"
         mNuevo = False
         sKey = Node.Key
         sDato = mId(sKey, 9, 10)
         Set oRs = Aplicacion.PedidosSAT.TraerFiltrado("_PorOrigen", sDato)
         mIcono = "Pedidos"
         GoTo Fin
      Case "Personal"
         mNuevo = False
         Node.Expanded = True
         GoTo Salida
      Case "Planos"
         Set oRs = Aplicacion.Planos.TraerTodos
      Case "PlazosEntrega"
         Set oRs = Aplicacion.PlazosEntrega.TraerTodos
         mIcono = "Pedidos"
         GoTo Fin
      Case "PlazosFijos"
         Node.Expanded = True
         GoTo Salida
      Case "PlazosFijosTodos"
         Set oRs = Aplicacion.PlazosFijos.TraerTodos
         mIcono = "PlazosFijos"
         GoTo Fin
      Case "PlazosFijosAVencer"
         Set oRs = Aplicacion.PlazosFijos.TraerFiltrado("_AVencer")
         mIcono = "PlazosFijos"
         GoTo Fin
      Case "PlazosFijosVencidos"
         Set oRs = Aplicacion.PlazosFijos.TraerFiltrado("_Vencidos")
         mIcono = "PlazosFijos"
         GoTo Fin
      Case "PosicionesImportacion"
         Set oRs = Aplicacion.PosicionesImportacion.TraerTodos
      Case "Presupuestos"
         If Not Node.Expanded Then Node.Expanded = True
         GoTo Salida
      Case "PresupuestosTodos"
         If Mensaje("Todas las solicitudes de cotizacion", "Visualizar") Then
            Set oRs = Aplicacion.Presupuestos.TraerTodos
         Else
            GoTo Salida
         End If
         mIcono = "Presupuestos"
         GoTo Fin
      Case "PresupuestosAgrupados"
         AbrirSubarbol "PresupuestosAgrupados", "+SubPr1", "+SubPr2", Arbol, Node
         GoTo Salida
      Case "+SubPr1"
         Desde = DateSerial(Node.Text, 1, 1)
         Hasta = DateSerial(Node.Text, 12, 31)
         If Mensaje("Solicitudes de cotizacion del año " & Node.Text, "Visualizar") Then
            Set oRs = Aplicacion.Presupuestos.TraerFiltrado("Fecha", Array(Desde, Hasta))
         Else
            GoTo Salida
         End If
         mIcono = "Presupuestos"
         GoTo Fin
      Case "+SubPr2"
         Set oRs = Aplicacion.Presupuestos.TraerFiltrado("Fecha", Array(Desde, Hasta))
         mIcono = "Presupuestos"
         GoTo Fin
      Case "PresupuestoFinanciero"
         mNuevo = False
         AbrirSubarbol "PresupuestoFinanciero", "+SubPF1", "", Arbol, Node
         GoTo Salida
      Case "+SubPF1"
         mNuevo = False
         DatosFecha = VBA.Split(Node.Key, " ")
         If DatosFecha(2) = "M" Then
            Set oRs = Aplicacion.TablasGenerales.TraerFiltrado("PresupuestoFinanciero", "_DetalladoPorAño", DatosFecha(1))
         Else
            Set oRs = Aplicacion.TablasGenerales.TraerFiltrado("PresupuestoFinanciero", "_DetalladoPorAño_A", DatosFecha(1))
         End If
         mIcono = "PresupuestoFinanciero"
         GoTo Fin
      Case "PresupuestoEconomico"
         mNuevo = False
         AbrirSubarbol "PresupuestoEconomico", "+SubPEa", "", Arbol, Node
         GoTo Salida
      Case "+SubPEa"
         mNuevo = False
         sKey1 = ""
         If Node.Children = 0 Then
            DatosFecha = VBA.Split(Node.Key, " ")
            Arbol.Nodes.Add Node.Key, tvwChild, "+SubPEb (1)(2)(3) " & DatosFecha(1), "Cuentas 1 2 y 3", "PresupuestoEconomico", "PresupuestoEconomico"
            sKey1 = "+SubPEb (1)(2)(3) " & DatosFecha(1)
            Arbol.Nodes.Add Node.Key, tvwChild, "+SubPEb (4) " & DatosFecha(1), "Cuentas 4", "PresupuestoEconomico", "PresupuestoEconomico"
            Arbol.Nodes.Add Node.Key, tvwChild, "+SubPEb (5) " & DatosFecha(1), "Cuentas 5", "PresupuestoEconomico", "PresupuestoEconomico"
            Set oRs = Aplicacion.UnidadesOperativas.TraerTodos
            With oRs
               Do Until .EOF
                  Arbol.Nodes.Add Node.Key, tvwChild, "+SubPEb " & .Fields("IdUnidadOperativa").Value & " " & DatosFecha(1), "" & .Fields("Descripcion").Value, "PresupuestoEconomico", "PresupuestoEconomico"
                  .MoveNext
               Loop
            End With
            oRs.Close
            Node.Expanded = True
         End If
         If sKey1 <> "" Then
            Arbol.Nodes.Item(sKey1).Selected = True
            Arbol_NodeClick Arbol.Nodes.Item(sKey1)
         End If
         GoTo Salida
      Case "+SubPEb"
         mNuevo = False
         DatosFecha = VBA.Split(Node.Key, " ")
         Set oRs = Aplicacion.Cuentas.TraerFiltrado("_PresupuestoEconomicoPorTipoCuenta", Array(DatosFecha(1), DatosFecha(2)))
         mIcono = "PresupuestoEconomico"
         GoTo Fin
      Case "PresupuestoObras"
         If BuscarClaveINI("Presupuestador de obra nuevo") = "SI" Then
            Set oF = New frmPresupuestoObrasArbol
         Else
            Set oF = New frmPresupuestoObras
         End If
         oF.Show , Me
      Case "PresupuestoObrasGruposMateriales"
         'Set oRs = Aplicacion.PresupuestoGruposMateriales.TraerTodos
         mIcono = "PresupuestoObrasGruposMateriales"
         GoTo Fin
      Case "PresupuestoObrasRubros"
         Set oRs = Aplicacion.PresupuestoObrasRubros.TraerTodos
         mIcono = "PresupuestoObrasRubros"
         GoTo Fin
      Case "Proveedores"
         If Not Node.Expanded Then Node.Expanded = True
         GoTo Salida
      Case "ProveedoresAConfirmar"
         Set oRs = Aplicacion.Proveedores.TraerFiltrado("_AConfirmar")
         mIcono = "Proveedores"
         GoTo Fin
      Case "ProveedoresResumen"
         Set oRs = Aplicacion.Proveedores.TraerFiltrado("_Resumido")
         mIcono = "Proveedores"
         GoTo Fin
      Case "ProveedoresDetalle"
         Set oRs = Aplicacion.Proveedores.TraerTodos
         mIcono = "Proveedores"
         GoTo Fin
      Case "ProveedoresEventuales"
         Set oRs = Aplicacion.Proveedores.TraerFiltrado("_Eventuales")
         mIcono = "Proveedores"
         GoTo Fin
      Case "Provincias"
         Set oRs = Aplicacion.Provincias.TraerTodos
      Case "PuntosVenta"
         Set oRs = Aplicacion.PuntosVenta.TraerTodos
      Case "Rangos"
         Set oRs = Aplicacion.Rangos.TraerTodos
      Case "Recepciones"
         If Not Node.Expanded Then Node.Expanded = True
         GoTo Salida
      Case "RecepcionesTodas"
         If Mensaje("Todas las recepciones", "Visualizar") Then
            Set oRs = Aplicacion.Recepciones.TraerFiltrado("_Todos", glbIdObraAsignadaUsuario)
         Else
            GoTo Salida
         End If
         mIcono = "Recepciones"
         GoTo Fin
      Case "RecepcionesUltimos3Meses"
         Desde = DateSerial(Year(DateAdd("m", -2, Now)), Month(DateAdd("m", -2, Now)), 1)
         Set oRs = Aplicacion.Recepciones.TraerFiltrado("_Ultimos3Meses", Array(Desde, glbIdObraAsignadaUsuario))
         mIcono = "Recepciones"
         GoTo Fin
      Case "RecepcionesAgrupadas"
         AbrirSubarbol "RecepcionesAgrupadas", "+SubRP1", "+SubRP2", Arbol, Node
         GoTo Salida
      Case "+SubRP1"
         Desde = DateSerial(Node.Text, 1, 1)
         Hasta = DateSerial(Node.Text, 12, 31)
         If Mensaje("Recepciones del año " & Node.Text, "Visualizar") Then
            Set oRs = Aplicacion.Recepciones.TraerFiltrado("Fecha", Array(Desde, Hasta, glbIdObraAsignadaUsuario))
         Else
            GoTo Salida
         End If
         mIcono = "Recepciones"
         GoTo Fin
      Case "+SubRP2"
         Set oRs = Aplicacion.Recepciones.TraerFiltrado("Fecha", Array(Desde, Hasta, glbIdObraAsignadaUsuario))
         mIcono = "Recepciones"
         GoTo Fin
      Case "RecepcionesSAT"
         If Not Node.Expanded Then Node.Expanded = True
         GoTo Salida
      Case "RecepcionesTodasSAT"
         mNuevo = False
         Set oRs = Aplicacion.RecepcionesSAT.TraerTodos
         mIcono = "Recepciones"
         GoTo Fin
      Case "RecepcionesAgrupadasSAT"
         mNuevo = False
         AbrirSubarbol "RecepcionesAgrupadasSAT", "+SubRP3", "+SubRP4", Arbol, Node
         GoTo Salida
      Case "+SubRP4"
         mNuevo = False
         Set oRs = Aplicacion.RecepcionesSAT.TraerFiltrado("Fecha", Array(Desde, Hasta))
         mIcono = "Recepciones"
         GoTo Fin
      Case "Recepciones1"
         If Not Node.Expanded Then Node.Expanded = True
         GoTo Salida
      Case "Recepciones1Todas"
         If Mensaje("Todas las recepciones", "Visualizar") Then
            Set oRs = Aplicacion.Recepciones.TraerFiltrado("_Todos", glbIdObraAsignadaUsuario)
         Else
            GoTo Salida
         End If
         mIcono = "Recepciones"
         GoTo Fin
      Case "Recepciones1Agrupadas"
         AbrirSubarbol "Recepciones1Agrupadas", "+SubR21", "+SubR22", Arbol, Node
         GoTo Salida
      Case "+SubR21"
         Desde = DateSerial(Node.Text, 1, 1)
         Hasta = DateSerial(Node.Text, 12, 31)
         If Mensaje("Recepciones del año " & Node.Text, "Visualizar") Then
            Set oRs = Aplicacion.Recepciones.TraerFiltrado("Fecha", Array(Desde, Hasta, glbIdObraAsignadaUsuario))
         Else
            GoTo Salida
         End If
         mIcono = "Recepciones"
         GoTo Fin
      Case "+SubR22"
         Set oRs = Aplicacion.Recepciones.TraerFiltrado("Fecha", Array(Desde, Hasta, glbIdObraAsignadaUsuario))
         mIcono = "Recepciones"
         GoTo Fin
      Case "Recibos"
         If Not Node.Expanded Then Node.Expanded = True
         GoTo Salida
      Case "RecibosTodos"
         If Mensaje("Todos los recibos", "Visualizar") Then
            Set oRs = Aplicacion.Recibos.TraerTodos
         Else
            GoTo Salida
         End If
         mIcono = "Recibos"
         GoTo Fin
      Case "RecibosAgrupados"
         AbrirSubarbol "RecibosAgrupados", "+SubRE1", "+SubRE2", Arbol, Node
         GoTo Salida
      Case "+SubRE1"
         Desde = DateSerial(Node.Text, 1, 1)
         Hasta = DateSerial(Node.Text, 12, 31)
         If Mensaje("Recibos del año " & Node.Text, "Visualizar") Then
            Set oRs = Aplicacion.Recibos.TraerFiltrado("Fecha", Array(Desde, Hasta))
         Else
            GoTo Salida
         End If
         mIcono = "Recibos"
         GoTo Fin
      Case "+SubRE2"
         Set oRs = Aplicacion.Recibos.TraerFiltrado("Fecha", Array(Desde, Hasta))
         mIcono = "Recibos"
         GoTo Fin
      Case "Relaciones"
         Set oRs = Aplicacion.Relaciones.TraerTodos
      Case "Remitos"
         If Not Node.Expanded Then Node.Expanded = True
         GoTo Salida
      Case "RemitosTodos"
         Set oRs = Aplicacion.Remitos.TraerTodos
         mIcono = "Remitos"
         GoTo Fin
      Case "RemitosAgrupados"
         AbrirSubarbol "RemitosAgrupados", "+SubRM1", "+SubRM2", Arbol, Node
         GoTo Salida
      Case "+SubRM2"
         Set oRs = Aplicacion.Remitos.TraerFiltrado("Fecha", Array(Desde, Hasta))
         mIcono = "Remitos"
         GoTo Fin
      Case "Requerimientos"
         Node.Expanded = True
         GoTo Salida
      Case "RequerimientosTodos"
         If Mensaje("Todos los requerimientos", "Visualizar") Then
            If glbIdObraAsignadaUsuario > 0 Then
               Set oRs = Aplicacion.Requerimientos.TraerFiltrado("_TodosPorIdSector", Array(-1, glbIdObraAsignadaUsuario))
            Else
               If BuscarClaveINI("Visualizar RM por sectores") <> "SI" Or glbAdministrador Then
                  Set oRs = Aplicacion.Requerimientos.TraerTodos
               Else
                  Set oRs = Aplicacion.Requerimientos.TraerFiltrado("_TodosPorIdSector", glbIdSector)
               End If
            End If
         Else
            GoTo Salida
         End If
         mIcono = "Requerimientos"
         GoTo Fin
      Case "RequerimientosAgrupados"
         AbrirSubarbol "RequerimientosAgrupados", "+SubRq1", "+SubRq2", Arbol, Node
         GoTo Salida
      Case "+SubRq1"
         Desde = DateSerial(Node.Text, 1, 1)
         Hasta = DateSerial(Node.Text, 12, 31)
         If Mensaje("Requerimientos del año " & Node.Text, "Visualizar") Then
            If BuscarClaveINI("Visualizar RM por sectores") <> "SI" Or glbAdministrador Then
               Set oRs = Aplicacion.Requerimientos.TraerFiltrado("Fecha", Array(Desde, Hasta, glbIdObraAsignadaUsuario))
            Else
               Set oRs = Aplicacion.Requerimientos.TraerFiltrado("_PorIdSectorFecha", Array(Desde, Hasta, glbIdSector, glbIdObraAsignadaUsuario))
            End If
         Else
            GoTo Salida
         End If
         mIcono = "Requerimientos"
         GoTo Fin
      Case "+SubRq2"
         If BuscarClaveINI("Visualizar RM por sectores") <> "SI" Or glbAdministrador Then
            Set oRs = Aplicacion.Requerimientos.TraerFiltrado("Fecha", Array(Desde, Hasta, glbIdObraAsignadaUsuario))
         Else
            Set oRs = Aplicacion.Requerimientos.TraerFiltrado("_PorIdSectorFecha", Array(Desde, Hasta, glbIdSector, glbIdObraAsignadaUsuario))
         End If
         mIcono = "Requerimientos"
         GoTo Fin
      Case "RequerimientosPorObra"
         If Node.Children = 0 Then
            Set oRs = Aplicacion.Obras.TraerFiltrado("_Habilitadas")
            With oRs
               Do Until .EOF
                  Arbol.Nodes.Add "RequerimientosPorObra", tvwChild, "+SubRo1 " & .Fields(0).Value, "" & .Fields(1).Value, "Requerimientos", "Requerimientos"
                  .MoveNext
               Loop
            End With
            oRs.Close
            Node.Expanded = True
         End If
         mIcono = "Requerimientos"
         GoTo Salida
      Case "+SubRo1"
         sKey = Node.Key
         sDato = mId(sKey, 9, 10)
         Set oRs = Aplicacion.Requerimientos.TraerFiltrado("_PorIdObra", Array(sDato, glbIdObraAsignadaUsuario))
         mIcono = "Pedidos"
         GoTo Fin
      Case "RequerimientosObras"
         Set oRs = Aplicacion.Requerimientos.TraerFiltrado("_PorObra")
         mIcono = "Requerimientos"
         GoTo Fin
      Case "RequerimientosCC"
         Set oRs = Aplicacion.Requerimientos.TraerFiltrado("_PorCC")
         mIcono = "Requerimientos"
         GoTo Fin
      Case "RequerimientosAConfirmar"
         Set oRs = Aplicacion.Requerimientos.TraerFiltrado("_AConfirmar", glbIdObraAsignadaUsuario)
         mIcono = "Requerimientos"
         GoTo Fin
      Case "RequerimientosALiberar"
         Set oRs = Aplicacion.Requerimientos.TraerFiltrado("_ALiberar", glbIdObraAsignadaUsuario)
         mIcono = "Requerimientos"
         GoTo Fin
      Case "Reservas"
         Set oRs = Aplicacion.Reservas.TraerTodos
      Case "ResumenesParaConciliacion"
         Node.Expanded = True
         GoTo Salida
      Case "ResumenesParaConciliacionTodos"
         If Mensaje("Todos los resumenes", "Visualizar") Then
            Set oRs = Aplicacion.Conciliaciones.TraerTodos
         Else
            GoTo Salida
         End If
         mIcono = "ResumenesParaConciliacion"
         GoTo Fin
      Case "ResumenesParaConciliacionAgrupados"
         AbrirSubarbol "ResumenesParaConciliacionAgrupados", "+SubRC1", "+SubRC2", Arbol, Node
         GoTo Salida
      Case "+SubRC2"
         Set oRs = Aplicacion.Conciliaciones.TraerFiltrado("Fecha", Array(Desde, Hasta))
         mIcono = "ResumenesParaConciliacion"
         GoTo Fin
      Case "Revaluos"
         Set oRs = Aplicacion.Revaluos.TraerTodos
      Case "Rubros"
         Set oRs = Aplicacion.Rubros.TraerTodos
      Case "RubrosContables"
         Node.Expanded = True
         mNuevo = False
         GoTo Salida
      Case "RubrosContablesGastosPorObra"
         Set oRs = Aplicacion.RubrosContables.TraerFiltrado("_ParaGastosPorObra")
         mIcono = "RubrosContables"
         GoTo Fin
      Case "RubrosContablesFinancieros"
         Set oRs = Aplicacion.RubrosContables.TraerFiltrado("_Financieros")
         mIcono = "RubrosContables"
         GoTo Fin
      Case "SalidaMateriales"
         Node.Expanded = True
         GoTo Salida
      Case "SalidaMaterialesTodas"
         If Mensaje("Todas las salidas", "Visualizar") Then
            If BuscarClaveINI("Mostrar costos en salida de materiales") = "NO" Then
               Set oRs = Aplicacion.SalidasMateriales.TraerFiltrado("_Todas", Array(glbIdObraAsignadaUsuario, "NO"))
            Else
               Set oRs = Aplicacion.SalidasMateriales.TraerFiltrado("_Todas", glbIdObraAsignadaUsuario)
            End If
         Else
            GoTo Salida
         End If
         mIcono = "SalidaMateriales"
         GoTo Fin
      Case "SalidaMaterialesAgrupadas"
         AbrirSubarbol "SalidaMaterialesAgrupadas", "+SubSA1", "+SubSA2", Arbol, Node
         GoTo Salida
      Case "+SubSA2"
         If BuscarClaveINI("Mostrar costos en salida de materiales") = "NO" Then
            Set oRs = Aplicacion.SalidasMateriales.TraerFiltrado("Fecha", Array(Desde, Hasta, glbIdObraAsignadaUsuario, "NO"))
         Else
            Set oRs = Aplicacion.SalidasMateriales.TraerFiltrado("Fecha", Array(Desde, Hasta, glbIdObraAsignadaUsuario))
         End If
         mIcono = "SalidaMateriales"
         GoTo Fin
      Case "SalidaMateriales1"
         Node.Expanded = True
         GoTo Salida
      Case "SalidaMaterialesTodas1"
         If Mensaje("Todas las salidas", "Visualizar") Then
            If BuscarClaveINI("Mostrar costos en salida de materiales") = "NO" Then
               Set oRs = Aplicacion.SalidasMateriales.TraerFiltrado("_Todas", Array(glbIdObraAsignadaUsuario, "NO"))
            Else
               Set oRs = Aplicacion.SalidasMateriales.TraerFiltrado("_Todas", glbIdObraAsignadaUsuario)
            End If
         Else
            GoTo Salida
         End If
         mIcono = "SalidaMateriales"
         GoTo Fin
      Case "SalidaMaterialesAgrupadas1"
         AbrirSubarbol "SalidaMaterialesAgrupadas1", "+SubS21", "+SubS22", Arbol, Node
         GoTo Salida
      Case "+SubS22"
         If BuscarClaveINI("Mostrar costos en salida de materiales") = "NO" Then
            Set oRs = Aplicacion.SalidasMateriales.TraerFiltrado("Fecha", Array(Desde, Hasta, glbIdObraAsignadaUsuario, "NO"))
         Else
            Set oRs = Aplicacion.SalidasMateriales.TraerFiltrado("Fecha", Array(Desde, Hasta, glbIdObraAsignadaUsuario))
         End If
         mIcono = "SalidaMateriales"
         GoTo Fin
      Case "SalidaMaterialesSAT"
         Node.Expanded = True
         GoTo Salida
      Case "SalidaMaterialesTodasSAT"
         mNuevo = False
         Set oRs = Aplicacion.SalidasMaterialesSAT.TraerFiltrado("_Todas")
         mIcono = "SalidaMateriales"
         GoTo Fin
      Case "SalidaMaterialesAgrupadasSAT"
         mNuevo = False
         AbrirSubarbol "SalidaMaterialesAgrupadasSAT", "+SubSA3", "+SubSA4", Arbol, Node
         GoTo Salida
      Case "+SubSA4"
         mNuevo = False
         Set oRs = Aplicacion.SalidasMaterialesSAT.TraerFiltrado("Fecha", Array(Desde, Hasta))
         mIcono = "SalidaMateriales"
         GoTo Fin
      Case "Schedulers"
         Set oRs = Aplicacion.Schedulers.TraerTodos
      Case "Sectores"
         Set oRs = Aplicacion.Sectores.TraerTodos
      Case "Series"
         Set oRs = Aplicacion.Series.TraerTodos
      Case "SolicitudesCompra"
         Node.Expanded = True
         GoTo Salida
      Case "SolicitudesCompraTodas"
         If Mensaje("Todos las Solicitudes", "Visualizar") Then
            Set oRs = Aplicacion.SolicitudesCompra.TraerTodos
         Else
            GoTo Salida
         End If
         mIcono = "SolicitudesCompra"
         GoTo Fin
      Case "SolicitudesCompraAgrupadas"
         AbrirSubarbol "SolicitudesCompraAgrupadas", "+SubSC1", "+SubSC2", Arbol, Node
         GoTo Salida
      Case "+SubSC2"
         Set oRs = Aplicacion.SolicitudesCompra.TraerFiltrado("Fecha", Array(Desde, Hasta))
         mIcono = "SolicitudesCompra"
         GoTo Fin
      Case "Subcontratos"
         Set oRs = Aplicacion.Subcontratos.TraerTodos
      Case "Subdiarios"
         mNuevo = False
         Node.Expanded = True
         GoTo Salida
      Case "SubdiariosTodos"
         mNuevo = False
         sKey1 = ""
         If Node.Children = 0 Then
            Set oRs = Aplicacion.EjerciciosContables.TraerFiltrado("_TodosSF")
            With oRs
               Do Until .EOF
                  Arbol.Nodes.Add "SubdiariosTodos", tvwChild, "+SubSdE " & .Fields(0).Value, "" & .Fields(2).Value & " al " & .Fields(3).Value, "Subdiarios", "Subdiarios"
                  sKey1 = "+SubSdE " & .Fields(0).Value
                  .MoveNext
               Loop
            End With
            Node.Expanded = True
         End If
         If sKey1 <> "" Then
            Arbol.Nodes.Item(sKey1).Selected = True
            Arbol_NodeClick Arbol.Nodes.Item(sKey1)
         End If
         GoTo Salida
      Case "+SubSdE"
         sFecha = Node.Text
         DatosFecha = VBA.Split(sFecha, " ")
         Set oRs = Aplicacion.Subdiarios.TraerFiltrado("_AgrupadosPorMesAño", Array(DatosFecha(0), DatosFecha(2)))
         mIcono = "Subdiarios"
         GoTo Fin
      Case "SubdiariosAgrupados"
         mNuevo = False
         AbrirSubarbol "SubdiariosAgrupados", "+SubSd1", "+SubSd2", Arbol, Node
         GoTo Salida
      Case "+SubSd1"
         mNuevo = False
         GoTo Fin
      Case "+SubSd2"
         mNuevo = False
         Set oRs = Aplicacion.Subdiarios.TraerFiltrado("Fecha", Array(Desde, Hasta))
         mIcono = "Subdiarios"
         GoTo Fin
      Case "Subrubros"
         Set oRs = Aplicacion.Subrubros.TraerTodos
      Case "Tablas Generales"
         mNuevo = False
         Node.Expanded = True
         GoTo Salida
      Case "Tablas relacionadas"
         mNuevo = False
         Node.Expanded = True
         GoTo Salida
      Case "TarifasFletes"
         Set oRs = Aplicacion.TarifasFletes.TraerTodos
      Case "TarjetasCredito"
         Set oRs = Aplicacion.TarjetasCredito.TraerTodos
      Case "Tipos"
         Set oRs = Aplicacion.Tipos.TraerTodos
      Case "TiposArticulos"
         Set oRs = Aplicacion.Tipos.TraerFiltrado("_PorGrupo", 1)
         mIcono = "Tipos"
         GoTo Fin
      Case "TiposComprobante"
         mNuevo = False
         Set oRs = Aplicacion.TiposComprobante.TraerTodos
      Case "TiposCuentaGrupos"
         Set oRs = Aplicacion.TiposCuentaGrupos.TraerTodos
      Case "TiposRosca"
         Set oRs = Aplicacion.TiposRosca.TraerTodos
      Case "Traducciones"
         Set oRs = Aplicacion.Traducciones.TraerTodos
      Case "Transportistas", "Transportistas1"
         Set oRs = Aplicacion.Transportistas.TraerTodos
         mIcono = "Transportistas"
         GoTo Fin
      Case "TTermicos"
         Set oRs = Aplicacion.TTermicos.TraerTodos
      Case "Ubicaciones"
         Set oRs = Aplicacion.Ubicaciones.TraerTodos
      Case "Unidades"
         Set oRs = Aplicacion.Unidades.TraerTodos
      Case "UnidadesEmpaque"
         Node.Expanded = True
         GoTo Salida
      Case "UnidadesEmpaqueTodos"
         If Mensaje("Todos las unidades de empaque", "Visualizar") Then
            Set oRs = Aplicacion.UnidadesEmpaque.TraerTodos
         Else
            GoTo Salida
         End If
         mIcono = "UnidadesEmpaque"
         GoTo Fin
      Case "UnidadesEmpaqueAgrupados"
         AbrirSubarbol2 "UnidadesEmpaqueAgrupados", "+SubUP1", "+SubUP2", Arbol, Node
         GoTo Salida
      Case "+SubUP2"
         Set oRs = Aplicacion.UnidadesEmpaque.TraerFiltrado("Fecha", Array(Desde, Hasta))
         mIcono = "UnidadesEmpaque"
         GoTo Fin
      Case "UnidadesOperativas"
         Set oRs = Aplicacion.UnidadesOperativas.TraerTodos
      Case "ValesSalida"
         Node.Expanded = True
         GoTo Salida
      Case "ValesSalidaTodos"
         If Mensaje("Todos los Vales", "Visualizar") Then
            Set oRs = Aplicacion.ValesSalida.TraerFiltrado("_Todos", glbIdObraAsignadaUsuario)
         Else
            GoTo Salida
         End If
         mIcono = "ValesSalida"
         GoTo Fin
      Case "ValesSalidaAgrupados"
         AbrirSubarbol2 "ValesSalidaAgrupados", "+SubVS1", "+SubVS2", Arbol, Node
         GoTo Salida
      Case "+SubVS2"
         Set oRs = Aplicacion.ValesSalida.TraerFiltrado("Fecha", Array(Desde, Hasta, glbIdObraAsignadaUsuario))
         mIcono = "ValesSalida"
         GoTo Fin
      Case "Valores"
         Node.Expanded = True
         GoTo Salida
      Case "ValoresTodos"
         If Mensaje("Todos los Valores", "Visualizar") Then
            Set oRs = Aplicacion.Valores.TraerTodos
         Else
            GoTo Salida
         End If
         mIcono = "Valores"
         GoTo Fin
      Case "ValoresRecibidos"
         AbrirSubarbol2 "ValoresRecibidos", "+SubVR1", "+SubVR2", Arbol, Node, "+SubVR3"
         GoTo Salida
      Case "+SubVR3"
         DatosV = VBA.Split(Node.Key, " ")
         Set oRs = Aplicacion.Valores.TraerFiltrado("Fecha1", Array(Desde, Hasta, "IN", DatosV(3)))
         mIcono = "Valores"
         GoTo Fin
      Case "ValoresEmitidos"
         AbrirSubarbol2 "ValoresEmitidos", "+SubVE1", "+SubVE2", Arbol, Node, "+SubVE3"
         GoTo Salida
      Case "+SubVE3"
         DatosV = VBA.Split(Node.Key, " ")
         Set oRs = Aplicacion.Valores.TraerFiltrado("Fecha1", Array(Desde, Hasta, "EG", DatosV(3)))
         mIcono = "Valores"
         GoTo Fin
      Case "Vendedores"
         Set oRs = Aplicacion.Vendedores.TraerTodos
      Case "VentasCuotas"
         mNuevo = False
         Node.Expanded = True
         GoTo Salida
      Case "VentasCuotasOperacion"
         Set oRs = Aplicacion.VentasEnCuotas.TraerTodos
      Case "VentasCuotasGeneracion"
         Set oRs = Aplicacion.VentasEnCuotas.TraerFiltrado("_CuotasGeneradasAgrupadasPorNumero")
         mIcono = "VentasCuotasOperacion"
         GoTo Fin
      Case "VentasCuotasCobranzas"
         Set oRs = Aplicacion.VentasEnCuotas.TraerFiltrado("_CuotasCobradasAgrupadasPorBancoFecha")
         mIcono = "VentasCuotasCobranzas"
         GoTo Fin
      Case Else
         GoTo Salida
   End Select
   
Fin:
   If glbModoAccesosUsuarios Then GoTo Salida
   
   If Len(mIcono) > 0 Then
      Lista.IconoGrande = mIcono
      Lista.IconoPequeño = mIcono
   Else
      Lista.IconoGrande = Node.Key
      Lista.IconoPequeño = Node.Key
   End If
   
   Lista.ListItems.Clear
   If Not mOrdena Then Lista.Sorted = False
   If Not IsEmpty(oRs) And Not oRs Is Nothing Then
      Set Lista.DataSource = oRs
      ReemplazarEtiquetasListas Lista
      Lista.Refresh
   End If
   Lista.FullRowSelect = True
   
   StatusBar1.Panels(3).Text = " " & Lista.ListItems.Count & " elementos en la lista"
   
Salida:
   Set oRs = Nothing
   Set oF = Nothing
   
   If Toolbar1.Buttons(1).Enabled And Not mNuevo Then Toolbar1.Buttons(1).Enabled = mNuevo
   mnuFileA(0).Enabled = mNuevo
   
   If glbSonidoNavegacion Then Sonido "Complete Navigation"

   Me.MousePointer = vbDefault

End Sub

Public Sub AbrirSubarbol(ByVal mParent As String, _
                         ByVal mChildren As String, _
                         ByVal mSubChildren As String, _
                         ByRef mArbol As TreeView, _
                         ByRef mNode As Node, _
                         Optional ByVal mSubSubChildren As String)

   Dim sKey As String, sKey1 As String, sKey2 As String, sKey3 As String, sKey4 As String
   Dim oRs As ADOR.Recordset
   Dim oRs1 As ADOR.Recordset
   Dim oRs2 As ADOR.Recordset
   Dim oRs3 As ADOR.Recordset
   Dim Datos
         
   Select Case mParent
      Case "AjustesStockAgrupados"
         sKey1 = ""
         sKey2 = ""
         If mNode.Children = 0 Then
            Set oRs = Aplicacion.AjustesStock.TraerFiltrado("Anio")
            With oRs
               Do Until .EOF
                  mArbol.Nodes.Add "AjustesStockAgrupados", tvwChild, mChildren & " " & .Fields(0).Value, "" & .Fields(0).Value, "AjustesStock", "AjustesStock"
                  .MoveNext
               Loop
            End With
            mNode.Expanded = True
            If oRs.RecordCount > 0 Then
               oRs.MoveFirst
               Do Until oRs.EOF
                  sKey = mChildren & " " & oRs.Fields(0).Value
                  If oRs.AbsolutePosition = 1 Then sKey1 = sKey
                  Set oRs1 = Aplicacion.AjustesStock.TraerFiltrado("Mes", oRs.Fields(1).Value)
                  Do Until oRs1.EOF
                     If oRs1.AbsolutePosition = 1 And sKey2 = "" Then sKey2 = mSubChildren & " " & oRs1.Fields(0).Value
                     mArbol.Nodes.Add sKey, tvwChild, mSubChildren & " " & oRs1.Fields(0).Value, "" & oRs1.Fields(3).Value & " " & oRs1.Fields(1).Value, "AjustesStock", "AjustesStock"
                     oRs1.MoveNext
                  Loop
                  oRs1.Close
                  oRs.MoveNext
               Loop
            End If
            oRs.Close
         End If
         If sKey1 <> "" Then
            mArbol.Nodes.Item(sKey1).Expanded = True
            If sKey2 <> "" Then
               mArbol.Nodes.Item(sKey2).Selected = True
               Arbol_NodeClick mArbol.Nodes.Item(sKey2)
            End If
         End If
   
      Case "AjustesStockAgrupadosSAT"
         sKey1 = ""
         sKey2 = ""
         If mNode.Children = 0 Then
            Set oRs = Aplicacion.TablasGenerales.TraerFiltrado("AjustesStockSAT", "Anio")
            With oRs
               Do Until .EOF
                  mArbol.Nodes.Add "AjustesStockAgrupadosSAT", tvwChild, mChildren & " " & .Fields(0).Value, "" & .Fields(0).Value, "AjustesStock", "AjustesStock"
                  .MoveNext
               Loop
            End With
            mNode.Expanded = True
            If oRs.RecordCount > 0 Then
               oRs.MoveFirst
               Do Until oRs.EOF
                  sKey = mChildren & " " & oRs.Fields(0).Value
                  If oRs.AbsolutePosition = 1 Then sKey1 = sKey
                  Set oRs1 = Aplicacion.TablasGenerales.TraerFiltrado("AjustesStockSAT", "Mes", oRs.Fields(1).Value)
                  Do Until oRs1.EOF
                     If oRs1.AbsolutePosition = 1 And sKey2 = "" Then sKey2 = mSubChildren & " " & oRs1.Fields(0).Value
                     mArbol.Nodes.Add sKey, tvwChild, mSubChildren & " " & oRs1.Fields(0).Value, "" & oRs1.Fields(3).Value & " " & oRs1.Fields(1).Value, "AjustesStock", "AjustesStock"
                     oRs1.MoveNext
                  Loop
                  oRs1.Close
                  oRs.MoveNext
               Loop
            End If
            oRs.Close
         End If
         If sKey1 <> "" Then
            mArbol.Nodes.Item(sKey1).Expanded = True
            If sKey2 <> "" Then
               mArbol.Nodes.Item(sKey2).Selected = True
               Arbol_NodeClick mArbol.Nodes.Item(sKey2)
            End If
         End If
   
      Case "AsientosAgrupados"
         sKey1 = ""
         sKey2 = ""
         If mNode.Children = 0 Then
            Set oRs = Aplicacion.Asientos.TraerFiltrado("Anio")
            With oRs
               Do Until .EOF
                  mArbol.Nodes.Add "AsientosAgrupados", tvwChild, mChildren & " " & .Fields(0).Value, "" & .Fields(0).Value, "Asientos", "Asientos"
                  .MoveNext
               Loop
            End With
            mNode.Expanded = True
            If oRs.RecordCount > 0 Then
               oRs.MoveFirst
               Do Until oRs.EOF
                  sKey = mChildren & " " & oRs.Fields(0).Value
                  If oRs.AbsolutePosition = 1 Then sKey1 = sKey
                  Set oRs1 = Aplicacion.Asientos.TraerFiltrado("Mes", oRs.Fields(1).Value)
                  Do Until oRs1.EOF
                     If oRs1.AbsolutePosition = 1 And sKey2 = "" Then sKey2 = mSubChildren & " " & oRs1.Fields(0).Value
                     mArbol.Nodes.Add sKey, tvwChild, mSubChildren & " " & oRs1.Fields(0).Value, "" & oRs1.Fields(3).Value & " " & oRs1.Fields(1).Value, "Asientos", "Asientos"
                     oRs1.MoveNext
                  Loop
                  oRs1.Close
                  oRs.MoveNext
               Loop
            End If
            oRs.Close
         End If
         If sKey1 <> "" Then
            mArbol.Nodes.Item(sKey1).Expanded = True
            If sKey2 <> "" Then
               mArbol.Nodes.Item(sKey2).Selected = True
               Arbol_NodeClick mArbol.Nodes.Item(sKey2)
            End If
         End If
      
      Case "AsientosTodos"
         sKey1 = ""
         If mNode.Children = 0 Then
            Set oRs = Aplicacion.EjerciciosContables.TraerFiltrado("_TodosSF")
            With oRs
               Do Until .EOF
                  mArbol.Nodes.Add "AsientosTodos", tvwChild, mChildren & " " & .Fields(0).Value, "" & .Fields(2).Value & " al " & .Fields(3).Value, "Asientos", "Asientos"
                  sKey1 = mChildren & " " & .Fields(0).Value
                  .MoveNext
               Loop
            End With
            oRs.Close
            mNode.Expanded = True
         End If
         If sKey1 <> "" Then
            mArbol.Nodes.Item(sKey1).Selected = True
            Arbol_NodeClick mArbol.Nodes.Item(sKey1)
         End If
      
      Case "AutorizacionesCompraAgrupadas"
         sKey1 = ""
         sKey2 = ""
         If mNode.Children = 0 Then
            'Set oRs = Aplicacion.AutorizacionesCompra.TraerFiltrado("Anio")
            With oRs
               Do Until .EOF
                  mArbol.Nodes.Add "AutorizacionesCompraAgrupadas", tvwChild, mChildren & " " & .Fields(0).Value, "" & .Fields(0).Value, "AutorizacionesCompra", "AutorizacionesCompra"
                  .MoveNext
               Loop
            End With
            mNode.Expanded = True
            If oRs.RecordCount > 0 Then
               oRs.MoveFirst
               Do Until oRs.EOF
                  sKey = mChildren & " " & oRs.Fields(0).Value
                  If oRs.AbsolutePosition = 1 Then sKey1 = sKey
                  'Set oRs1 = Aplicacion.AutorizacionesCompra.TraerFiltrado("Mes", oRs.Fields(1).Value)
                  Do Until oRs1.EOF
                     If oRs1.AbsolutePosition = 1 And sKey2 = "" Then sKey2 = mSubChildren & " " & oRs1.Fields(0).Value
                     mArbol.Nodes.Add sKey, tvwChild, mSubChildren & " " & oRs1.Fields(0).Value, "" & oRs1.Fields(3).Value & " " & oRs1.Fields(1).Value, "AutorizacionesCompra", "AutorizacionesCompra"
                     oRs1.MoveNext
                  Loop
                  oRs1.Close
                  oRs.MoveNext
               Loop
            End If
            oRs.Close
         End If
         If sKey1 <> "" Then
            mArbol.Nodes.Item(sKey1).Expanded = True
            If sKey2 <> "" Then
               mArbol.Nodes.Item(sKey2).Selected = True
               Arbol_NodeClick mArbol.Nodes.Item(sKey2)
            End If
         End If
      
      Case "ComparativasAgrupadas"
         sKey1 = ""
         sKey2 = ""
         If mNode.Children = 0 Then
            Set oRs = Aplicacion.Comparativas.TraerFiltrado("Anio")
            With oRs
               Do Until .EOF
                  mArbol.Nodes.Add "ComparativasAgrupadas", tvwChild, "+SubCm1 " & .Fields(0).Value, "" & .Fields(0).Value, "Comparativas", "Comparativas"
                  .MoveNext
               Loop
            End With
            mNode.Expanded = True
            If oRs.RecordCount > 0 Then
               oRs.MoveFirst
               Do Until oRs.EOF
                  sKey = "+SubCm1 " & oRs.Fields(0).Value
                  If oRs.AbsolutePosition = 1 Then sKey1 = sKey
                  Set oRs1 = Aplicacion.Comparativas.TraerFiltrado("Mes", oRs.Fields(1).Value)
                  Do Until oRs1.EOF
                     If oRs1.AbsolutePosition = 1 And sKey2 = "" Then sKey2 = "+SubCm2 " & oRs1.Fields(0).Value
                     mArbol.Nodes.Add sKey, tvwChild, "+SubCm2 " & oRs1.Fields(0).Value, "" & oRs1.Fields(3).Value & " " & oRs1.Fields(1).Value, "Comparativas", "Comparativas"
                     oRs1.MoveNext
                  Loop
                  oRs1.Close
                  oRs.MoveNext
               Loop
            End If
            oRs.Close
         End If
         If sKey1 <> "" Then
            mArbol.Nodes.Item(sKey1).Expanded = True
            If sKey2 <> "" Then
               mArbol.Nodes.Item(sKey2).Selected = True
               Arbol_NodeClick mArbol.Nodes.Item(sKey2)
            End If
         End If
         
      Case "ComprobantesPrvPorMes"
         sKey1 = ""
         sKey2 = ""
         If mNode.Children = 0 Then
            Set oRs = Aplicacion.ComprobantesProveedores.TraerFiltrado("Anio")
            With oRs
               Do Until .EOF
                  mArbol.Nodes.Add "ComprobantesPrvPorMes", tvwChild, "+SubCP1 " & .Fields(0).Value, "" & .Fields(0).Value, "ComprobantesPrv", "ComprobantesPrv"
                  .MoveNext
               Loop
            End With
            mNode.Expanded = True
            If oRs.RecordCount > 0 Then
               oRs.MoveFirst
               Do Until oRs.EOF
                  sKey = "+SubCP1 " & oRs.Fields(0).Value
                  If oRs.AbsolutePosition = 1 Then sKey1 = sKey
                  Set oRs1 = Aplicacion.ComprobantesProveedores.TraerFiltrado("Mes", oRs.Fields(1).Value)
                  Do Until oRs1.EOF
                     If oRs1.AbsolutePosition = 1 And sKey2 = "" Then sKey2 = "+SubCP2 " & oRs1.Fields(0).Value
                     mArbol.Nodes.Add sKey, tvwChild, "+SubCP2 " & oRs1.Fields(0).Value, "" & oRs1.Fields(3).Value & " " & oRs1.Fields(1).Value, "ComprobantesPrv", "ComprobantesPrv"
                     oRs1.MoveNext
                  Loop
                  oRs1.Close
                  oRs.MoveNext
               Loop
            End If
            oRs.Close
         End If
         If sKey1 <> "" Then
            mArbol.Nodes.Item(sKey1).Expanded = True
            If sKey2 <> "" Then
               mArbol.Nodes.Item(sKey2).Selected = True
               Arbol_NodeClick mArbol.Nodes.Item(sKey2)
            End If
         End If

      Case "Conciliaciones"
         If mNode.Children = 0 Then
            Set oRs = Aplicacion.Bancos.TraerFiltrado("_ConCuenta", glbIdUsuario)
            With oRs
               Do Until .EOF
                  mArbol.Nodes.Add "Conciliaciones", tvwChild, "+SubCn1 " & .Fields(0).Value, "" & .Fields(1).Value, "Conciliaciones", "Conciliaciones"
                  mArbol.Nodes.Item("+SubCn1 " & .Fields(0).Value).Tag = "Conciliacion " & .Fields(1).Value
                  If glbActivarCircuitoChequesDiferidos = "SI" Then
                     mArbol.Nodes.Add "Conciliaciones", tvwChild, "+SubCn9 " & .Fields(0).Value, "  Cheques diferidos pendientes", "Conciliaciones", "Conciliaciones"
                  End If
                  .MoveNext
               Loop
               .Close
            End With
         End If
         If mNode.Children > 0 Then mNode.Expanded = Not mNode.Expanded
      Case "+SubCn1"
         Datos = VBA.Split(mNode.Key, " ")
         If mNode.Children = 0 Then
            sKey = mNode.Key
            Set oRs1 = Aplicacion.Bancos.TraerFiltrado("_CuentasPorIdBanco", Array(Datos(1), glbIdUsuario))
            Do Until oRs1.EOF
               mArbol.Nodes.Add sKey, tvwChild, "+SubCn2 " & oRs1.Fields(0).Value & " " & oRs1.Fields(2).Value, "" & oRs1.Fields(1).Value, "Conciliaciones", "Conciliaciones"
               mArbol.Nodes.Item("+SubCn2 " & oRs1.Fields(0).Value & " " & oRs1.Fields(2).Value).Tag = "Conciliacion " & Trim(oRs1.Fields("Banco").Value) & " - Cuenta : " & oRs1.Fields(1).Value
               sKey1 = "+SubCn2 " & oRs1.Fields(0).Value & " " & oRs1.Fields(2).Value
               Set oRs2 = Aplicacion.Bancos.TraerFiltrado("_MovimientosAnio", oRs1.Fields(0).Value)
               With oRs2
                  Do Until .EOF
                     mArbol.Nodes.Add sKey1, tvwChild, "+SubCn3 " & oRs1.Fields(0).Value & " " & .Fields(0).Value, "" & .Fields(0).Value, "Conciliaciones", "Conciliaciones"
                     .MoveNext
                  Loop
               End With
               If oRs2.RecordCount > 0 Then
                  oRs2.MoveFirst
                  Do Until oRs2.EOF
                     sKey2 = "+SubCn3 " & oRs1.Fields(0).Value & " " & oRs2.Fields(0).Value
                     If oRs2.AbsolutePosition = 1 Then
                        sKey4 = sKey2
                     End If
                     Set oRs3 = Aplicacion.Bancos.TraerFiltrado("_MovimientosMes", Array(oRs1.Fields(0).Value, oRs2.Fields(1).Value))
                     Do Until oRs3.EOF
                        If oRs3.AbsolutePosition = 1 And sKey3 = "" Then
                           sKey3 = "+SubCn4 " & oRs1.Fields(0).Value & " " & oRs3.Fields(0).Value
                        End If
                        mArbol.Nodes.Add sKey2, tvwChild, "+SubCn4 " & oRs1.Fields(0).Value & " " & oRs3.Fields(0).Value, "" & oRs3.Fields(3).Value & " " & oRs3.Fields(1).Value, "Conciliaciones", "Conciliaciones"
                        oRs3.MoveNext
                     Loop
                     oRs3.Close
                     Set oRs3 = Nothing
                     oRs2.MoveNext
                  Loop
               End If
               oRs2.Close
               Set oRs2 = Nothing
               oRs1.MoveNext
            Loop
         End If
         If mNode.Children > 0 Then mNode.Expanded = Not mNode.Expanded

      Case "ConciliacionesCajas"
         If mNode.Children = 0 Then
            Set oRs = Aplicacion.Valores.TraerFiltrado("_CajasConMovimientos")
            With oRs
               Do Until .EOF
                  mArbol.Nodes.Add "ConciliacionesCajas", tvwChild, "+SubCc1 " & .Fields(0).Value, "" & .Fields(1).Value, "ConciliacionesCajas", "ConciliacionesCajas"
                  .MoveNext
               Loop
               .Close
            End With
         End If
         If mNode.Children > 0 Then mNode.Expanded = Not mNode.Expanded
      Case "+SubCc1"
         Datos = VBA.Split(mNode.Key, " ")
         If mNode.Children = 0 Then
            sKey = mNode.Key
            Set oRs1 = Aplicacion.Valores.TraerFiltrado("_CajasConMovimientosPorAnio", Datos(1))
            With oRs1
               Do Until .EOF
                  mArbol.Nodes.Add sKey, tvwChild, "+SubCc2 " & Datos(1) & " " & .Fields(0).Value, "" & .Fields(0).Value, "ConciliacionesCajas", "ConciliacionesCajas"
                  .MoveNext
               Loop
            End With
            If oRs1.RecordCount > 0 Then
               oRs1.MoveFirst
               Do Until oRs1.EOF
                  sKey1 = "+SubCc2 " & Datos(1) & " " & oRs1.Fields(0).Value
                  If oRs1.AbsolutePosition = 1 Then sKey2 = sKey1
                  Set oRs2 = Aplicacion.Valores.TraerFiltrado("_CajasConMovimientosPorAnioMes", Array(Datos(1), oRs1.Fields(0).Value))
                  Do Until oRs2.EOF
                     mArbol.Nodes.Add sKey1, tvwChild, "+SubCc3 " & Datos(1) & " " & oRs1.Fields(0).Value & " " & oRs2.Fields(2).Value, "" & oRs2.Fields(3).Value & " " & oRs2.Fields(1).Value, "ConciliacionesCajas", "ConciliacionesCajas"
                     oRs2.MoveNext
                  Loop
                  oRs2.Close
                  Set oRs2 = Nothing
                  oRs1.MoveNext
               Loop
            End If
            oRs1.Close
            Set oRs1 = Nothing
         End If
         Set oRs = ArmaConciliacionCaja(Datos(1), 0, Date, Date, -1)
         If mNode.Children > 0 Then mNode.Expanded = Not mNode.Expanded
      
      Case "ConciliacionesTarjetas"
         If mNode.Children = 0 Then
            Set oRs = Aplicacion.Valores.TraerFiltrado("_TarjetasConMovimientos")
            With oRs
               Do Until .EOF
                  mArbol.Nodes.Add "ConciliacionesTarjetas", tvwChild, "+SubCt1 " & .Fields(0).Value, "" & .Fields(1).Value, "Conciliaciones", "Conciliaciones"
                  .MoveNext
               Loop
            End With
         End If
         If mNode.Children > 0 Then mNode.Expanded = Not mNode.Expanded
      Case "+SubCt1"
         Datos = VBA.Split(mNode.Key, " ")
         If mNode.Children = 0 Then
            sKey = mNode.Key
            Set oRs1 = Aplicacion.Valores.TraerFiltrado("_TarjetasConMovimientosPorAnio", Datos(1))
            With oRs1
               Do Until .EOF
                  mArbol.Nodes.Add sKey, tvwChild, "+SubCt2 " & Datos(1) & " " & .Fields(0).Value, "" & .Fields(0).Value, "Conciliaciones", "Conciliaciones"
                  .MoveNext
               Loop
            End With
            If oRs1.RecordCount > 0 Then
               oRs1.MoveFirst
               Do Until oRs1.EOF
                  sKey1 = "+SubCt2 " & Datos(1) & " " & oRs1.Fields(0).Value
                  If oRs1.AbsolutePosition = 1 Then sKey2 = sKey1
                  Set oRs2 = Aplicacion.Valores.TraerFiltrado("_TarjetasConMovimientosPorAnioMes", Array(Datos(1), oRs1.Fields(0).Value))
                  Do Until oRs2.EOF
                     mArbol.Nodes.Add sKey1, tvwChild, "+SubCt3 " & Datos(1) & " " & oRs1.Fields(0).Value & " " & oRs2.Fields(2).Value, "" & oRs2.Fields(3).Value & " " & oRs2.Fields(1).Value, "Conciliaciones", "Conciliaciones"
                     oRs2.MoveNext
                  Loop
                  oRs2.Close
                  Set oRs2 = Nothing
                  oRs1.MoveNext
               Loop
            End If
            oRs1.Close
            Set oRs1 = Nothing
         End If
         Set oRs = ArmaConciliacionCaja(0, 0, Date, Date, -1, Datos(1))
         If mNode.Children > 0 Then mNode.Expanded = Not mNode.Expanded
       
       Case "Cotizaciones"
         sKey1 = ""
         sKey2 = ""
         If mNode.Children = 0 Then
            Set oRs = Aplicacion.Cotizaciones.TraerFiltrado("Anio")
            With oRs
               Do Until .EOF
                  mArbol.Nodes.Add "Cotizaciones", tvwChild, mChildren & " " & .Fields(0).Value, "" & .Fields(0).Value, "Cotizaciones", "Cotizaciones"
                  .MoveNext
               Loop
            End With
            mNode.Expanded = True
            If oRs.RecordCount > 0 Then
               oRs.MoveFirst
               Do Until oRs.EOF
                  sKey = mChildren & " " & oRs.Fields(0).Value
                  If oRs.AbsolutePosition = 1 Then sKey1 = sKey
                  Set oRs1 = Aplicacion.Cotizaciones.TraerFiltrado("Mes", oRs.Fields(1).Value)
                  Do Until oRs1.EOF
                     If oRs1.AbsolutePosition = 1 And sKey2 = "" Then sKey2 = mSubChildren & " " & oRs1.Fields(0).Value
                     mArbol.Nodes.Add sKey, tvwChild, mSubChildren & " " & oRs1.Fields(0).Value, "" & oRs1.Fields(3).Value & " " & oRs1.Fields(1).Value, "Cotizaciones", "Cotizaciones"
                     oRs1.MoveNext
                  Loop
                  oRs1.Close
                  oRs.MoveNext
               Loop
            End If
            oRs.Close
         End If
         If sKey1 <> "" Then
            mArbol.Nodes.Item(sKey1).Expanded = True
            If sKey2 <> "" Then
               mArbol.Nodes.Item(sKey2).Selected = True
               Arbol_NodeClick mArbol.Nodes.Item(sKey2)
            End If
         End If
      
      Case "DepositosBancariosAgrupados"
         sKey1 = ""
         sKey2 = ""
         If mNode.Children = 0 Then
            Set oRs = Aplicacion.DepositosBancarios.TraerFiltrado("Anio")
            With oRs
               Do Until .EOF
                  mArbol.Nodes.Add "DepositosBancariosAgrupados", tvwChild, mChildren & " " & .Fields(0).Value, "" & .Fields(0).Value, "DepositosBancarios", "DepositosBancarios"
                  .MoveNext
               Loop
            End With
            mNode.Expanded = True
            If oRs.RecordCount > 0 Then
               oRs.MoveFirst
               Do Until oRs.EOF
                  sKey = mChildren & " " & oRs.Fields(0).Value
                  If oRs.AbsolutePosition = 1 Then sKey1 = sKey
                  Set oRs1 = Aplicacion.DepositosBancarios.TraerFiltrado("Mes", oRs.Fields(1).Value)
                  Do Until oRs1.EOF
                     If oRs1.AbsolutePosition = 1 And sKey2 = "" Then sKey2 = mSubChildren & " " & oRs1.Fields(0).Value
                     mArbol.Nodes.Add sKey, tvwChild, mSubChildren & " " & oRs1.Fields(0).Value, "" & oRs1.Fields(3).Value & " " & oRs1.Fields(1).Value, "DepositosBancarios", "DepositosBancarios"
                     oRs1.MoveNext
                  Loop
                  oRs1.Close
                  oRs.MoveNext
               Loop
            End If
            oRs.Close
         End If
         If sKey1 <> "" Then
            mArbol.Nodes.Item(sKey1).Expanded = True
            If sKey2 <> "" Then
               mArbol.Nodes.Item(sKey2).Selected = True
               Arbol_NodeClick mArbol.Nodes.Item(sKey2)
            End If
         End If

      Case "DevolucionesAgrupadas"
         sKey1 = ""
         sKey2 = ""
         If mNode.Children = 0 Then
            Set oRs = Aplicacion.Devoluciones.TraerFiltrado("Anio")
            With oRs
               Do Until .EOF
                  mArbol.Nodes.Add "DevolucionesAgrupadas", tvwChild, mChildren & " " & .Fields(0).Value, "" & .Fields(0).Value, "Devoluciones", "Devoluciones"
                  .MoveNext
               Loop
            End With
            mNode.Expanded = True
            If oRs.RecordCount > 0 Then
               oRs.MoveFirst
               Do Until oRs.EOF
                  sKey = mChildren & " " & oRs.Fields(0).Value
                  If oRs.AbsolutePosition = 1 Then sKey1 = sKey
                  Set oRs1 = Aplicacion.Devoluciones.TraerFiltrado("Mes", oRs.Fields(1).Value)
                  Do Until oRs1.EOF
                     If oRs1.AbsolutePosition = 1 And sKey2 = "" Then sKey2 = mSubChildren & " " & oRs1.Fields(0).Value
                     mArbol.Nodes.Add sKey, tvwChild, mSubChildren & " " & oRs1.Fields(0).Value, "" & oRs1.Fields(3).Value & " " & oRs1.Fields(1).Value, "Devoluciones", "Devoluciones"
                     oRs1.MoveNext
                  Loop
                  oRs1.Close
                  oRs.MoveNext
               Loop
            End If
            oRs.Close
         End If
         If sKey1 <> "" Then
            mArbol.Nodes.Item(sKey1).Expanded = True
            If sKey2 <> "" Then
               mArbol.Nodes.Item(sKey2).Selected = True
               Arbol_NodeClick mArbol.Nodes.Item(sKey2)
            End If
         End If

      Case "FacturasAgrupadas"
         sKey1 = ""
         sKey2 = ""
         If mNode.Children = 0 Then
            Set oRs = Aplicacion.Facturas.TraerFiltrado("Anio")
            With oRs
               Do Until .EOF
                  mArbol.Nodes.Add "FacturasAgrupadas", tvwChild, "+SubFA1 " & .Fields(0).Value, "" & .Fields(0).Value, "Facturas", "Facturas"
                  .MoveNext
               Loop
            End With
            mNode.Expanded = True
            If oRs.RecordCount > 0 Then
               oRs.MoveFirst
               Do Until oRs.EOF
                  sKey = "+SubFA1 " & oRs.Fields(0).Value
                  If oRs.AbsolutePosition = 1 Then sKey1 = sKey
                  Set oRs1 = Aplicacion.Facturas.TraerFiltrado("Mes", oRs.Fields(1).Value)
                  Do Until oRs1.EOF
                     If oRs1.AbsolutePosition = 1 And sKey2 = "" Then sKey2 = "+SubFA2 " & oRs1.Fields(0).Value
                     mArbol.Nodes.Add sKey, tvwChild, "+SubFA2 " & oRs1.Fields(0).Value, "" & oRs1.Fields(3).Value & " " & oRs1.Fields(1).Value, "Facturas", "Facturas"
                     oRs1.MoveNext
                  Loop
                  oRs1.Close
                  oRs.MoveNext
               Loop
            End If
            oRs.Close
         End If
         If sKey1 <> "" Then
            mArbol.Nodes.Item(sKey1).Expanded = True
            If sKey2 <> "" Then
               mArbol.Nodes.Item(sKey2).Selected = True
               Arbol_NodeClick mArbol.Nodes.Item(sKey2)
            End If
         End If
         
      Case "FacturasContadoAgrupadas"
         sKey1 = ""
         sKey2 = ""
         If mNode.Children = 0 Then
            Set oRs = Aplicacion.Facturas.TraerFiltrado("Anio_Contado")
            With oRs
               Do Until .EOF
                  mArbol.Nodes.Add "FacturasContadoAgrupadas", tvwChild, "+SubFC1 " & .Fields(0).Value, "" & .Fields(0).Value, "Facturas", "Facturas"
                  .MoveNext
               Loop
            End With
            mNode.Expanded = True
            If oRs.RecordCount > 0 Then
               oRs.MoveFirst
               Do Until oRs.EOF
                  sKey = "+SubFC1 " & oRs.Fields(0).Value
                  If oRs.AbsolutePosition = 1 Then sKey1 = sKey
                  Set oRs1 = Aplicacion.Facturas.TraerFiltrado("Mes_Contado", oRs.Fields(1).Value)
                  Do Until oRs1.EOF
                     If oRs1.AbsolutePosition = 1 And sKey2 = "" Then sKey2 = "+SubFC2 " & oRs1.Fields(0).Value
                     mArbol.Nodes.Add sKey, tvwChild, "+SubFC2 " & oRs1.Fields(0).Value, "" & oRs1.Fields(3).Value & " " & oRs1.Fields(1).Value, "Facturas", "Facturas"
                     oRs1.MoveNext
                  Loop
                  oRs1.Close
                  oRs.MoveNext
               Loop
            End If
            oRs.Close
         End If
         If sKey1 <> "" Then
            mArbol.Nodes.Item(sKey1).Expanded = True
            If sKey2 <> "" Then
               mArbol.Nodes.Item(sKey2).Selected = True
               Arbol_NodeClick mArbol.Nodes.Item(sKey2)
            End If
         End If
         
      Case "GastosBancariosAgrupados"
         sKey1 = ""
         sKey2 = ""
         If mNode.Children = 0 Then
            Set oRs = Aplicacion.Valores.TraerFiltrado("_GastosPorAnio")
            With oRs
               Do Until .EOF
                  mArbol.Nodes.Add "GastosBancariosAgrupados", tvwChild, mChildren & " " & .Fields(0).Value, "" & .Fields(0).Value, "GastosBancarios", "GastosBancarios"
                  .MoveNext
               Loop
            End With
            mNode.Expanded = True
            If oRs.RecordCount > 0 Then
               oRs.MoveFirst
               Do Until oRs.EOF
                  sKey = mChildren & " " & oRs.Fields(0).Value
                  If oRs.AbsolutePosition = 1 Then sKey1 = sKey
                  Set oRs1 = Aplicacion.Valores.TraerFiltrado("_GastosPorAnioMes", oRs.Fields(1).Value)
                  Do Until oRs1.EOF
                     If oRs1.AbsolutePosition = 1 And sKey2 = "" Then sKey2 = mSubChildren & " " & oRs1.Fields(0).Value
                     mArbol.Nodes.Add sKey, tvwChild, mSubChildren & " " & oRs1.Fields(0).Value, "" & oRs1.Fields(3).Value & " " & oRs1.Fields(1).Value, "GastosBancarios", "GastosBancarios"
                     oRs1.MoveNext
                  Loop
                  oRs1.Close
                  oRs.MoveNext
               Loop
            End If
            oRs.Close
         End If
         If sKey1 <> "" Then
            mArbol.Nodes.Item(sKey1).Expanded = True
            If sKey2 <> "" Then
               mArbol.Nodes.Item(sKey2).Selected = True
               Arbol_NodeClick mArbol.Nodes.Item(sKey2)
            End If
         End If
      
      Case "GastosFletesAgrupados"
         sKey1 = ""
         sKey2 = ""
         If mNode.Children = 0 Then
            Set oRs = Aplicacion.GastosFletes.TraerFiltrado("Anio")
            With oRs
               Do Until .EOF
                  mArbol.Nodes.Add "GastosFletesAgrupados", tvwChild, mChildren & " " & .Fields(0).Value, "" & .Fields(0).Value, "GastosFletes", "GastosFletes"
                  .MoveNext
               Loop
            End With
            mNode.Expanded = True
            If oRs.RecordCount > 0 Then
               oRs.MoveFirst
               Do Until oRs.EOF
                  sKey = mChildren & " " & oRs.Fields(0).Value
                  If oRs.AbsolutePosition = 1 Then sKey1 = sKey
                  Set oRs1 = Aplicacion.GastosFletes.TraerFiltrado("Mes", oRs.Fields(1).Value)
                  Do Until oRs1.EOF
                     If oRs1.AbsolutePosition = 1 And sKey2 = "" Then sKey2 = mSubChildren & " " & oRs1.Fields(0).Value
                     mArbol.Nodes.Add sKey, tvwChild, mSubChildren & " " & oRs1.Fields(0).Value, "" & oRs1.Fields(3).Value & " " & oRs1.Fields(1).Value, "GastosFletes", "GastosFletes"
                     oRs1.MoveNext
                  Loop
                  oRs1.Close
                  oRs.MoveNext
               Loop
            End If
            oRs.Close
         End If
         If sKey1 <> "" Then
            mArbol.Nodes.Item(sKey1).Expanded = True
            If sKey2 <> "" Then
               mArbol.Nodes.Item(sKey2).Selected = True
               Arbol_NodeClick mArbol.Nodes.Item(sKey2)
            End If
         End If

      Case "LiquidacionesFletesAgrupadas"
         sKey1 = ""
         sKey2 = ""
         If mNode.Children = 0 Then
           ' Set oRs = Aplicacion.LiquidacionesFletes.TraerFiltrado("Anio")
            With oRs
               Do Until .EOF
                  mArbol.Nodes.Add "LiquidacionesFletesAgrupadas", tvwChild, mChildren & " " & .Fields(0).Value, "" & .Fields(0).Value, "LiquidacionesFletes", "LiquidacionesFletes"
                  .MoveNext
               Loop
            End With
            mNode.Expanded = True
            If oRs.RecordCount > 0 Then
               oRs.MoveFirst
               Do Until oRs.EOF
                  sKey = mChildren & " " & oRs.Fields(0).Value
                  If oRs.AbsolutePosition = 1 Then sKey1 = sKey
                  'Set oRs1 = Aplicacion.LiquidacionesFletes.TraerFiltrado("Mes", oRs.Fields(1).Value)
                  Do Until oRs1.EOF
                     If oRs1.AbsolutePosition = 1 And sKey2 = "" Then sKey2 = mSubChildren & " " & oRs1.Fields(0).Value
                     mArbol.Nodes.Add sKey, tvwChild, mSubChildren & " " & oRs1.Fields(0).Value, "" & oRs1.Fields(3).Value & " " & oRs1.Fields(1).Value, "LiquidacionesFletes", "LiquidacionesFletes"
                     oRs1.MoveNext
                  Loop
                  oRs1.Close
                  oRs.MoveNext
               Loop
            End If
            oRs.Close
         End If
         If sKey1 <> "" Then
            mArbol.Nodes.Item(sKey1).Expanded = True
            If sKey2 <> "" Then
               mArbol.Nodes.Item(sKey2).Selected = True
               Arbol_NodeClick mArbol.Nodes.Item(sKey2)
            End If
         End If
   
      Case "NotasDebitoAgrupadas"
         sKey1 = ""
         sKey2 = ""
         If mNode.Children = 0 Then
            Set oRs = Aplicacion.NotasDebito.TraerFiltrado("Anio")
            With oRs
               Do Until .EOF
                  mArbol.Nodes.Add "NotasDebitoAgrupadas", tvwChild, "+SubND1 " & .Fields(0).Value, "" & .Fields(0).Value, "NotasDebito", "NotasDebito"
                  .MoveNext
               Loop
            End With
            mNode.Expanded = True
            If oRs.RecordCount > 0 Then
               oRs.MoveFirst
               Do Until oRs.EOF
                  sKey = "+SubND1 " & oRs.Fields(0).Value
                  If oRs.AbsolutePosition = 1 Then sKey1 = sKey
                  Set oRs1 = Aplicacion.NotasDebito.TraerFiltrado("Mes", oRs.Fields(1).Value)
                  Do Until oRs1.EOF
                     If oRs1.AbsolutePosition = 1 And sKey2 = "" Then sKey2 = "+SubND2 " & oRs1.Fields(0).Value
                     mArbol.Nodes.Add sKey, tvwChild, "+SubND2 " & oRs1.Fields(0).Value, "" & oRs1.Fields(3).Value & " " & oRs1.Fields(1).Value, "NotasDebito", "NotasDebito"
                     oRs1.MoveNext
                  Loop
                  oRs1.Close
                  oRs.MoveNext
               Loop
            End If
            oRs.Close
         End If
         If sKey1 <> "" Then
            mArbol.Nodes.Item(sKey1).Expanded = True
            If sKey2 <> "" Then
               mArbol.Nodes.Item(sKey2).Selected = True
               Arbol_NodeClick mArbol.Nodes.Item(sKey2)
            End If
         End If
      
      Case "NotasCreditoAgrupadas"
         sKey1 = ""
         sKey2 = ""
         If mNode.Children = 0 Then
            Set oRs = Aplicacion.NotasCredito.TraerFiltrado("Anio")
            With oRs
               Do Until .EOF
                  mArbol.Nodes.Add "NotasCreditoAgrupadas", tvwChild, "+SubNC1 " & .Fields(0).Value, "" & .Fields(0).Value, "NotasCredito", "NotasCredito"
                  .MoveNext
               Loop
            End With
            mNode.Expanded = True
            If oRs.RecordCount > 0 Then
               oRs.MoveFirst
               Do Until oRs.EOF
                  sKey = "+SubNC1 " & oRs.Fields(0).Value
                  If oRs.AbsolutePosition = 1 Then sKey1 = sKey
                  Set oRs1 = Aplicacion.NotasCredito.TraerFiltrado("Mes", oRs.Fields(1).Value)
                  Do Until oRs1.EOF
                     If oRs1.AbsolutePosition = 1 And sKey2 = "" Then sKey2 = "+SubNC2 " & oRs1.Fields(0).Value
                     mArbol.Nodes.Add sKey, tvwChild, "+SubNC2 " & oRs1.Fields(0).Value, "" & oRs1.Fields(3).Value & " " & oRs1.Fields(1).Value, "NotasCredito", "NotasCredito"
                     oRs1.MoveNext
                  Loop
                  oRs1.Close
                  oRs.MoveNext
               Loop
            End If
            oRs.Close
         End If
         If sKey1 <> "" Then
            mArbol.Nodes.Item(sKey1).Expanded = True
            If sKey2 <> "" Then
               mArbol.Nodes.Item(sKey2).Selected = True
               Arbol_NodeClick mArbol.Nodes.Item(sKey2)
            End If
         End If
      
      Case "OPagoPorMes"
         sKey1 = ""
         sKey2 = ""
         If mNode.Children = 0 Then
            Set oRs = Aplicacion.OrdenesPago.TraerFiltrado("Anio")
            With oRs
               Do Until .EOF
                  mArbol.Nodes.Add "OPagoPorMes", tvwChild, "+SubOp1 " & .Fields(0).Value, "" & .Fields(0).Value, "OPago", "OPago"
                  .MoveNext
               Loop
            End With
            mNode.Expanded = True
            If oRs.RecordCount > 0 Then
               oRs.MoveFirst
               Do Until oRs.EOF
                  sKey = "+SubOp1 " & oRs.Fields(0).Value
                  If oRs.AbsolutePosition = 1 Then sKey1 = sKey
                  Set oRs1 = Aplicacion.OrdenesPago.TraerFiltrado("Mes", oRs.Fields(1).Value)
                  Do Until oRs1.EOF
                     If oRs1.AbsolutePosition = 1 And sKey2 = "" Then sKey2 = "+SubOp2 " & oRs1.Fields(0).Value
                     mArbol.Nodes.Add sKey, tvwChild, "+SubOp2 " & oRs1.Fields(0).Value, "" & oRs1.Fields(3).Value & " " & oRs1.Fields(1).Value, "OPago", "OPago"
                     oRs1.MoveNext
                  Loop
                  oRs1.Close
                  oRs.MoveNext
               Loop
            End If
            oRs.Close
         End If
         If sKey1 <> "" Then
            mArbol.Nodes.Item(sKey1).Expanded = True
            If sKey2 <> "" Then
               mArbol.Nodes.Item(sKey2).Selected = True
               Arbol_NodeClick mArbol.Nodes.Item(sKey2)
            End If
         End If
      
      Case "OrdenesCompraAgrupadas"
         sKey1 = ""
         sKey2 = ""
         If mNode.Children = 0 Then
            Set oRs = Aplicacion.OrdenesCompra.TraerFiltrado("Anio")
            With oRs
               Do Until .EOF
                  mArbol.Nodes.Add "OrdenesCompraAgrupadas", tvwChild, "+SubOC1 " & .Fields(0).Value, "" & .Fields(0).Value, "OrdenesCompra", "OrdenesCompra"
                  .MoveNext
               Loop
            End With
            mNode.Expanded = True
            If oRs.RecordCount > 0 Then
               oRs.MoveFirst
               Do Until oRs.EOF
                  sKey = "+SubOC1 " & oRs.Fields(0).Value
                  If oRs.AbsolutePosition = 1 Then sKey1 = sKey
                  Set oRs1 = Aplicacion.OrdenesCompra.TraerFiltrado("Mes", oRs.Fields(1).Value)
                  Do Until oRs1.EOF
                     If oRs1.AbsolutePosition = 1 And sKey2 = "" Then sKey2 = "+SubOC2 " & oRs1.Fields(0).Value
                     mArbol.Nodes.Add sKey, tvwChild, "+SubOC2 " & oRs1.Fields(0).Value, "" & oRs1.Fields(3).Value & " " & oRs1.Fields(1).Value, "OrdenesCompra", "OrdenesCompra"
                     oRs1.MoveNext
                  Loop
                  oRs1.Close
                  oRs.MoveNext
               Loop
            End If
            oRs.Close
         End If
         If sKey1 <> "" Then
            mArbol.Nodes.Item(sKey1).Expanded = True
            If sKey2 <> "" Then
               mArbol.Nodes.Item(sKey2).Selected = True
               Arbol_NodeClick mArbol.Nodes.Item(sKey2)
            End If
         End If
      
      Case "OrdenesTrabajoAgrupadas"
         sKey1 = ""
         sKey2 = ""
         If mNode.Children = 0 Then
            Set oRs = Aplicacion.OrdenesTrabajo.TraerFiltrado("Anio")
            With oRs
               Do Until .EOF
                  mArbol.Nodes.Add "OrdenesTrabajoAgrupadas", tvwChild, "+SubOT1 " & .Fields(0).Value, "" & .Fields(0).Value, "OrdenesTrabajo", "OrdenesTrabajo"
                  .MoveNext
               Loop
            End With
            mNode.Expanded = True
            If oRs.RecordCount > 0 Then
               oRs.MoveFirst
               Do Until oRs.EOF
                  sKey = "+SubOT1 " & oRs.Fields(0).Value
                  If oRs.AbsolutePosition = 1 Then sKey1 = sKey
                  Set oRs1 = Aplicacion.OrdenesTrabajo.TraerFiltrado("Mes", oRs.Fields(1).Value)
                  Do Until oRs1.EOF
                     If oRs1.AbsolutePosition = 1 And sKey2 = "" Then sKey2 = "+SubOT2 " & oRs1.Fields(0).Value
                     mArbol.Nodes.Add sKey, tvwChild, "+SubOT2 " & oRs1.Fields(0).Value, "" & oRs1.Fields(3).Value & " " & oRs1.Fields(1).Value, "OrdenesTrabajo", "OrdenesTrabajo"
                     oRs1.MoveNext
                  Loop
                  oRs1.Close
                  oRs.MoveNext
               Loop
            End If
            oRs.Close
         End If
         If sKey1 <> "" Then
            mArbol.Nodes.Item(sKey1).Expanded = True
            If sKey2 <> "" Then
               mArbol.Nodes.Item(sKey2).Selected = True
               Arbol_NodeClick mArbol.Nodes.Item(sKey2)
            End If
         End If
      
      Case "OtrosIngresosAlmacenAgrupados"
         sKey1 = ""
         sKey2 = ""
         If mNode.Children = 0 Then
            Set oRs = Aplicacion.OtrosIngresosAlmacen.TraerFiltrado("Anio")
            With oRs
               Do Until .EOF
                  mArbol.Nodes.Add "OtrosIngresosAlmacenAgrupados", tvwChild, mChildren & " " & .Fields(0).Value, "" & .Fields(0).Value, "OtrosIngresosAlmacen", "OtrosIngresosAlmacen"
                  .MoveNext
               Loop
            End With
            mNode.Expanded = True
            If oRs.RecordCount > 0 Then
               oRs.MoveFirst
               Do Until oRs.EOF
                  sKey = mChildren & " " & oRs.Fields(0).Value
                  If oRs.AbsolutePosition = 1 Then sKey1 = sKey
                  Set oRs1 = Aplicacion.OtrosIngresosAlmacen.TraerFiltrado("Mes", oRs.Fields(1).Value)
                  Do Until oRs1.EOF
                     If oRs1.AbsolutePosition = 1 And sKey2 = "" Then sKey2 = mSubChildren & " " & oRs1.Fields(0).Value
                     mArbol.Nodes.Add sKey, tvwChild, mSubChildren & " " & oRs1.Fields(0).Value, "" & oRs1.Fields(3).Value & " " & oRs1.Fields(1).Value, "OtrosIngresosAlmacen", "OtrosIngresosAlmacen"
                     oRs1.MoveNext
                  Loop
                  oRs1.Close
                  oRs.MoveNext
               Loop
            End If
            oRs.Close
         End If
         If sKey1 <> "" Then
            mArbol.Nodes.Item(sKey1).Expanded = True
            If sKey2 <> "" Then
               mArbol.Nodes.Item(sKey2).Selected = True
               Arbol_NodeClick mArbol.Nodes.Item(sKey2)
            End If
         End If

      Case "OtrosIngresosAlmacenAgrupadosSAT"
         sKey1 = ""
         sKey2 = ""
         If mNode.Children = 0 Then
            Set oRs = Aplicacion.OtrosIngresosAlmacenSAT.TraerFiltrado("Anio")
            With oRs
               Do Until .EOF
                  mArbol.Nodes.Add "OtrosIngresosAlmacenAgrupadosSAT", tvwChild, mChildren & " " & .Fields(0).Value, "" & .Fields(0).Value, "OtrosIngresosAlmacen", "OtrosIngresosAlmacen"
                  .MoveNext
               Loop
            End With
            mNode.Expanded = True
            If oRs.RecordCount > 0 Then
               oRs.MoveFirst
               Do Until oRs.EOF
                  sKey = mChildren & " " & oRs.Fields(0).Value
                  If oRs.AbsolutePosition = 1 Then sKey1 = sKey
                  Set oRs1 = Aplicacion.OtrosIngresosAlmacenSAT.TraerFiltrado("Mes", oRs.Fields(1).Value)
                  Do Until oRs1.EOF
                     If oRs1.AbsolutePosition = 1 And sKey2 = "" Then sKey2 = mSubChildren & " " & oRs1.Fields(0).Value
                     mArbol.Nodes.Add sKey, tvwChild, mSubChildren & " " & oRs1.Fields(0).Value, "" & oRs1.Fields(3).Value & " " & oRs1.Fields(1).Value, "OtrosIngresosAlmacen", "OtrosIngresosAlmacen"
                     oRs1.MoveNext
                  Loop
                  oRs1.Close
                  oRs.MoveNext
               Loop
            End If
            oRs.Close
         End If
         If sKey1 <> "" Then
            mArbol.Nodes.Item(sKey1).Expanded = True
            If sKey2 <> "" Then
               mArbol.Nodes.Item(sKey2).Selected = True
               Arbol_NodeClick mArbol.Nodes.Item(sKey2)
            End If
         End If

      Case "PedidosAgrupados"
         sKey1 = ""
         sKey2 = ""
         If mNode.Children = 0 Then
            Set oRs = Aplicacion.Pedidos.TraerFiltrado("Anio")
            With oRs
               Do Until .EOF
                  mArbol.Nodes.Add "PedidosAgrupados", tvwChild, mChildren & " " & .Fields(0).Value, "" & .Fields(0).Value, "Pedidos", "Pedidos"
                  .MoveNext
               Loop
            End With
            mNode.Expanded = True
            If oRs.RecordCount > 0 Then
               oRs.MoveFirst
               Do Until oRs.EOF
                  sKey = mChildren & " " & oRs.Fields(0).Value
                  If oRs.AbsolutePosition = 1 Then sKey1 = sKey
                  Set oRs1 = Aplicacion.Pedidos.TraerFiltrado("Mes", oRs.Fields(1).Value)
                  Do Until oRs1.EOF
                     If oRs1.AbsolutePosition = 1 And sKey2 = "" Then sKey2 = mSubChildren & " " & oRs1.Fields(0).Value
                     mArbol.Nodes.Add sKey, tvwChild, mSubChildren & " " & oRs1.Fields(0).Value, "" & oRs1.Fields(3).Value & " " & oRs1.Fields(1).Value, "Pedidos", "Pedidos"
                     oRs1.MoveNext
                  Loop
                  oRs1.Close
                  oRs.MoveNext
               Loop
            End If
            oRs.Close
         End If
         If sKey1 <> "" Then
            mArbol.Nodes.Item(sKey1).Expanded = True
            If sKey2 <> "" Then
               mArbol.Nodes.Item(sKey2).Selected = True
               Arbol_NodeClick mArbol.Nodes.Item(sKey2)
            End If
         End If
         
      Case "PedidosAgrupadosSAT"
         sKey1 = ""
         sKey2 = ""
         If mNode.Children = 0 Then
            Set oRs = Aplicacion.PedidosSAT.TraerFiltrado("Anio")
            With oRs
               Do Until .EOF
                  mArbol.Nodes.Add "PedidosAgrupadosSAT", tvwChild, mChildren & " " & .Fields(0).Value, "" & .Fields(0).Value, "Pedidos", "Pedidos"
                  .MoveNext
               Loop
            End With
            mNode.Expanded = True
            If oRs.RecordCount > 0 Then
               oRs.MoveFirst
               Do Until oRs.EOF
                  sKey = mChildren & " " & oRs.Fields(0).Value
                  If oRs.AbsolutePosition = 1 Then sKey1 = sKey
                  Set oRs1 = Aplicacion.PedidosSAT.TraerFiltrado("Mes", oRs.Fields(1).Value)
                  Do Until oRs1.EOF
                     If oRs1.AbsolutePosition = 1 And sKey2 = "" Then sKey2 = mSubChildren & " " & oRs1.Fields(0).Value
                     mArbol.Nodes.Add sKey, tvwChild, mSubChildren & " " & oRs1.Fields(0).Value, "" & oRs1.Fields(3).Value & " " & oRs1.Fields(1).Value, "Pedidos", "Pedidos"
                     oRs1.MoveNext
                  Loop
                  oRs1.Close
                  oRs.MoveNext
               Loop
            End If
            oRs.Close
         End If
         If sKey1 <> "" Then
            mArbol.Nodes.Item(sKey1).Expanded = True
            If sKey2 <> "" Then
               mArbol.Nodes.Item(sKey2).Selected = True
               Arbol_NodeClick mArbol.Nodes.Item(sKey2)
            End If
         End If
         
      Case "PedidosSubcontratosAgrupados"
         sKey1 = ""
         sKey2 = ""
         If mNode.Children = 0 Then
            Set oRs = Aplicacion.Pedidos.TraerFiltrado("_SubContratosPorAnio")
            With oRs
               Do Until .EOF
                  mArbol.Nodes.Add "PedidosSubcontratosAgrupados", tvwChild, "+SubPS1 " & .Fields(0).Value, "" & .Fields(0).Value, "Pedidos", "Pedidos"
                  .MoveNext
               Loop
            End With
            mNode.Expanded = True
            If oRs.RecordCount > 0 Then
               oRs.MoveFirst
               Do Until oRs.EOF
                  sKey = "+SubPS1 " & oRs.Fields(0).Value
                  If oRs.AbsolutePosition = 1 Then sKey1 = sKey
                  Set oRs1 = Aplicacion.Pedidos.TraerFiltrado("_SubContratosPorMes", oRs.Fields(1).Value)
                  Do Until oRs1.EOF
                     If oRs1.AbsolutePosition = 1 And sKey2 = "" Then sKey2 = "+SubPS2 " & oRs1.Fields(0).Value
                     mArbol.Nodes.Add sKey, tvwChild, "+SubPS2 " & oRs1.Fields(0).Value, "" & oRs1.Fields(3).Value & " " & oRs1.Fields(1).Value, "Pedidos", "Pedidos"
                     oRs1.MoveNext
                  Loop
                  oRs1.Close
                  oRs.MoveNext
               Loop
            End If
            oRs.Close
         End If
         If sKey1 <> "" Then
            mArbol.Nodes.Item(sKey1).Expanded = True
            If sKey2 <> "" Then
               mArbol.Nodes.Item(sKey2).Selected = True
               Arbol_NodeClick mArbol.Nodes.Item(sKey2)
            End If
         End If

      Case "PresupuestosAgrupados"
         sKey1 = ""
         sKey2 = ""
         If mNode.Children = 0 Then
            Set oRs = Aplicacion.Presupuestos.TraerFiltrado("Anio")
            With oRs
               Do Until .EOF
                  mArbol.Nodes.Add "PresupuestosAgrupados", tvwChild, "+SubPr1 " & .Fields(0).Value, "" & .Fields(0).Value, "Presupuestos", "Presupuestos"
                  .MoveNext
               Loop
            End With
            mNode.Expanded = True
            If oRs.RecordCount > 0 Then
               oRs.MoveFirst
               Do Until oRs.EOF
                  sKey = "+SubPr1 " & oRs.Fields(0).Value
                  If oRs.AbsolutePosition = 1 Then sKey1 = sKey
                  Set oRs1 = Aplicacion.Presupuestos.TraerFiltrado("Mes", oRs.Fields(1).Value)
                  Do Until oRs1.EOF
                     If oRs1.AbsolutePosition = 1 And sKey2 = "" Then sKey2 = "+SubPr2 " & oRs1.Fields(0).Value
                     mArbol.Nodes.Add sKey, tvwChild, "+SubPr2 " & oRs1.Fields(0).Value, "" & oRs1.Fields(3).Value & " " & oRs1.Fields(1).Value, "Presupuestos", "Presupuestos"
                     oRs1.MoveNext
                  Loop
                  oRs1.Close
                  oRs.MoveNext
               Loop
            End If
            oRs.Close
         End If
         If sKey1 <> "" Then
            mArbol.Nodes.Item(sKey1).Expanded = True
            If sKey2 <> "" Then
               mArbol.Nodes.Item(sKey2).Selected = True
               Arbol_NodeClick mArbol.Nodes.Item(sKey2)
            End If
         End If
      
      Case "PresupuestoEconomico"
         sKey1 = ""
         If mNode.Children = 0 Then
            Set oRs = Aplicacion.EjerciciosContables.TraerFiltrado("_TodosSF")
            With oRs
               Do Until .EOF
                  mArbol.Nodes.Add "PresupuestoEconomico", tvwChild, mChildren & " " & .Fields(0).Value, "" & .Fields(2).Value & " al " & .Fields(3).Value, "PresupuestoEconomico", "PresupuestoEconomico"
                  sKey1 = mChildren & " " & .Fields(0).Value
                  .MoveNext
               Loop
            End With
            oRs.Close
            mNode.Expanded = True
         End If
         If sKey1 <> "" Then
            mArbol.Nodes.Item(sKey1).Selected = True
            Arbol_NodeClick mArbol.Nodes.Item(sKey1)
         End If
      
      Case "PresupuestoFinanciero"
         sKey1 = ""
         If mNode.Children = 0 Then
            Set oRs = Aplicacion.TablasGenerales.TraerFiltrado("PresupuestoFinanciero", "_PorAño")
            If oRs.RecordCount > 0 Then
               With oRs
                  Do Until .EOF
                     mArbol.Nodes.Add "PresupuestoFinanciero", tvwChild, mChildren & " " & .Fields(0).Value & " A", "" & .Fields(0).Value & " (Anual)", "PresupuestoFinanciero", "PresupuestoFinanciero"
                     mArbol.Nodes.Add "PresupuestoFinanciero", tvwChild, mChildren & " " & .Fields(0).Value & " M", "" & .Fields(0).Value & " (Mensual)", "PresupuestoFinanciero", "PresupuestoFinanciero"
                     .MoveNext
                  Loop
               End With
               mNode.Expanded = True
               oRs.MoveFirst
               sKey1 = mChildren & " " & oRs.Fields(0).Value & " M"
            Else
               mArbol.Nodes.Add "PresupuestoFinanciero", tvwChild, mChildren & " " & Year(Date) & " A", Year(Date) & " (Anual)", "PresupuestoFinanciero", "PresupuestoFinanciero"
               mArbol.Nodes.Add "PresupuestoFinanciero", tvwChild, mChildren & " " & Year(Date) & " M", Year(Date) & " (Mensual)", "PresupuestoFinanciero", "PresupuestoFinanciero"
               mNode.Expanded = True
               sKey1 = mChildren & " " & Year(Date) & " M"
            End If
         End If
         If sKey1 <> "" Then
            mArbol.Nodes.Item(sKey1).Selected = True
            Arbol_NodeClick mArbol.Nodes.Item(sKey1)
         End If
      
      Case "RecibosAgrupados"
         sKey1 = ""
         sKey2 = ""
         If mNode.Children = 0 Then
            Set oRs = Aplicacion.Recibos.TraerFiltrado("Anio")
            With oRs
               Do Until .EOF
                  mArbol.Nodes.Add "RecibosAgrupados", tvwChild, "+SubRE1 " & .Fields(0).Value, "" & .Fields(0).Value, "Recibos", "Recibos"
                  .MoveNext
               Loop
            End With
            mNode.Expanded = True
            If oRs.RecordCount > 0 Then
               oRs.MoveFirst
               Do Until oRs.EOF
                  sKey = "+SubRE1 " & oRs.Fields(0).Value
                  If oRs.AbsolutePosition = 1 Then sKey1 = sKey
                  Set oRs1 = Aplicacion.Recibos.TraerFiltrado("Mes", oRs.Fields(1).Value)
                  Do Until oRs1.EOF
                     If oRs1.AbsolutePosition = 1 And sKey2 = "" Then sKey2 = "+SubRE2 " & oRs1.Fields(0).Value
                     mArbol.Nodes.Add sKey, tvwChild, "+SubRE2 " & oRs1.Fields(0).Value, "" & oRs1.Fields(3).Value & " " & oRs1.Fields(1).Value, "Recibos", "Recibos"
                     oRs1.MoveNext
                  Loop
                  oRs1.Close
                  oRs.MoveNext
               Loop
            End If
            oRs.Close
         End If
         If sKey1 <> "" Then
            mArbol.Nodes.Item(sKey1).Expanded = True
            If sKey2 <> "" Then
               mArbol.Nodes.Item(sKey2).Selected = True
               Arbol_NodeClick mArbol.Nodes.Item(sKey2)
            End If
         End If
      
      Case "RecepcionesAgrupadas"
         sKey1 = ""
         sKey2 = ""
         If mNode.Children = 0 Then
            Set oRs = Aplicacion.Recepciones.TraerFiltrado("Anio")
            With oRs
               Do Until .EOF
                  mArbol.Nodes.Add "RecepcionesAgrupadas", tvwChild, mChildren & " " & .Fields(0).Value, "" & .Fields(0).Value, "Recepciones", "Recepciones"
                  .MoveNext
               Loop
            End With
            mNode.Expanded = True
            If oRs.RecordCount > 0 Then
               oRs.MoveFirst
               Do Until oRs.EOF
                  sKey = mChildren & " " & oRs.Fields(0).Value
                  If oRs.AbsolutePosition = 1 Then sKey1 = sKey
                  Set oRs1 = Aplicacion.Recepciones.TraerFiltrado("Mes", oRs.Fields(1).Value)
                  Do Until oRs1.EOF
                     If oRs1.AbsolutePosition = 1 And sKey2 = "" Then sKey2 = mSubChildren & " " & oRs1.Fields(0).Value
                     mArbol.Nodes.Add sKey, tvwChild, mSubChildren & " " & oRs1.Fields(0).Value, "" & oRs1.Fields(3).Value & " " & oRs1.Fields(1).Value, "Recepciones", "Recepciones"
                     oRs1.MoveNext
                  Loop
                  oRs1.Close
                  oRs.MoveNext
               Loop
            End If
            oRs.Close
         End If
         If sKey1 <> "" Then
            mArbol.Nodes.Item(sKey1).Expanded = True
            If sKey2 <> "" Then
               mArbol.Nodes.Item(sKey2).Selected = True
               Arbol_NodeClick mArbol.Nodes.Item(sKey2)
            End If
         End If
   
      Case "Recepciones1Agrupadas"
         sKey1 = ""
         sKey2 = ""
         If mNode.Children = 0 Then
            Set oRs = Aplicacion.Recepciones.TraerFiltrado("Anio")
            With oRs
               Do Until .EOF
                  mArbol.Nodes.Add "Recepciones1Agrupadas", tvwChild, mChildren & " " & .Fields(0).Value, "" & .Fields(0).Value, "Recepciones", "Recepciones"
                  .MoveNext
               Loop
            End With
            mNode.Expanded = True
            If oRs.RecordCount > 0 Then
               oRs.MoveFirst
               Do Until oRs.EOF
                  sKey = mChildren & " " & oRs.Fields(0).Value
                  If oRs.AbsolutePosition = 1 Then sKey1 = sKey
                  Set oRs1 = Aplicacion.Recepciones.TraerFiltrado("Mes", oRs.Fields(1).Value)
                  Do Until oRs1.EOF
                     If oRs1.AbsolutePosition = 1 And sKey2 = "" Then sKey2 = mSubChildren & " " & oRs1.Fields(0).Value
                     mArbol.Nodes.Add sKey, tvwChild, mSubChildren & " " & oRs1.Fields(0).Value, "" & oRs1.Fields(3).Value & " " & oRs1.Fields(1).Value, "Recepciones", "Recepciones"
                     oRs1.MoveNext
                  Loop
                  oRs1.Close
                  oRs.MoveNext
               Loop
            End If
            oRs.Close
         End If
         If sKey1 <> "" Then
            mArbol.Nodes.Item(sKey1).Expanded = True
            If sKey2 <> "" Then
               mArbol.Nodes.Item(sKey2).Selected = True
               Arbol_NodeClick mArbol.Nodes.Item(sKey2)
            End If
         End If
   
      Case "RecepcionesAgrupadasSAT"
         sKey1 = ""
         sKey2 = ""
         If mNode.Children = 0 Then
            Set oRs = Aplicacion.RecepcionesSAT.TraerFiltrado("Anio")
            With oRs
               Do Until .EOF
                  mArbol.Nodes.Add "RecepcionesAgrupadasSAT", tvwChild, mChildren & " " & .Fields(0).Value, "" & .Fields(0).Value, "Recepciones", "Recepciones"
                  .MoveNext
               Loop
            End With
            mNode.Expanded = True
            If oRs.RecordCount > 0 Then
               oRs.MoveFirst
               Do Until oRs.EOF
                  sKey = mChildren & " " & oRs.Fields(0).Value
                  If oRs.AbsolutePosition = 1 Then sKey1 = sKey
                  Set oRs1 = Aplicacion.RecepcionesSAT.TraerFiltrado("Mes", oRs.Fields(1).Value)
                  Do Until oRs1.EOF
                     If oRs1.AbsolutePosition = 1 And sKey2 = "" Then sKey2 = mSubChildren & " " & oRs1.Fields(0).Value
                     mArbol.Nodes.Add sKey, tvwChild, mSubChildren & " " & oRs1.Fields(0).Value, "" & oRs1.Fields(3).Value & " " & oRs1.Fields(1).Value, "Recepciones", "Recepciones"
                     oRs1.MoveNext
                  Loop
                  oRs1.Close
                  oRs.MoveNext
               Loop
            End If
            oRs.Close
         End If
         If sKey1 <> "" Then
            mArbol.Nodes.Item(sKey1).Expanded = True
            If sKey2 <> "" Then
               mArbol.Nodes.Item(sKey2).Selected = True
               Arbol_NodeClick mArbol.Nodes.Item(sKey2)
            End If
         End If
   
      Case "RemitosAgrupados"
         sKey1 = ""
         sKey2 = ""
         If mNode.Children = 0 Then
            Set oRs = Aplicacion.Remitos.TraerFiltrado("Anio")
            With oRs
               Do Until .EOF
                  mArbol.Nodes.Add "RemitosAgrupados", tvwChild, mChildren & " " & .Fields(0).Value, "" & .Fields(0).Value, "Remitos", "Remitos"
                  .MoveNext
               Loop
            End With
            mNode.Expanded = True
            If oRs.RecordCount > 0 Then
               oRs.MoveFirst
               Do Until oRs.EOF
                  sKey = mChildren & " " & oRs.Fields(0).Value
                  If oRs.AbsolutePosition = 1 Then sKey1 = sKey
                  Set oRs1 = Aplicacion.Remitos.TraerFiltrado("Mes", oRs.Fields(1).Value)
                  Do Until oRs1.EOF
                     If oRs1.AbsolutePosition = 1 And sKey2 = "" Then sKey2 = mSubChildren & " " & oRs1.Fields(0).Value
                     mArbol.Nodes.Add sKey, tvwChild, mSubChildren & " " & oRs1.Fields(0).Value, "" & oRs1.Fields(3).Value & " " & oRs1.Fields(1).Value, "Remitos", "Remitos"
                     oRs1.MoveNext
                  Loop
                  oRs1.Close
                  oRs.MoveNext
               Loop
            End If
            oRs.Close
         End If
         If sKey1 <> "" Then
            mArbol.Nodes.Item(sKey1).Expanded = True
            If sKey2 <> "" Then
               mArbol.Nodes.Item(sKey2).Selected = True
               Arbol_NodeClick mArbol.Nodes.Item(sKey2)
            End If
         End If
      
      Case "RequerimientosAgrupados"
         sKey1 = ""
         sKey2 = ""
         If mNode.Children = 0 Then
            Set oRs = Aplicacion.Requerimientos.TraerFiltrado("Anio")
            With oRs
               Do Until .EOF
                  mArbol.Nodes.Add "RequerimientosAgrupados", tvwChild, mChildren & " " & .Fields(0).Value, "" & .Fields(0).Value, "Requerimientos", "Requerimientos"
                  .MoveNext
               Loop
            End With
            mNode.Expanded = True
            If oRs.RecordCount > 0 Then
               oRs.MoveFirst
               Do Until oRs.EOF
                  sKey = mChildren & " " & oRs.Fields(0).Value
                  If oRs.AbsolutePosition = 1 Then sKey1 = sKey
                  Set oRs1 = Aplicacion.Requerimientos.TraerFiltrado("Mes", oRs.Fields(1).Value)
                  Do Until oRs1.EOF
                     If oRs1.AbsolutePosition = 1 And sKey2 = "" Then sKey2 = mSubChildren & " " & oRs1.Fields(0).Value
                     mArbol.Nodes.Add sKey, tvwChild, mSubChildren & " " & oRs1.Fields(0).Value, "" & oRs1.Fields(3).Value & " " & oRs1.Fields(1).Value, "Requerimientos", "Requerimientos"
                     oRs1.MoveNext
                  Loop
                  oRs1.Close
                  oRs.MoveNext
               Loop
            End If
            oRs.Close
         End If
         If sKey1 <> "" Then
            mArbol.Nodes.Item(sKey1).Expanded = True
            If sKey2 <> "" Then
               mArbol.Nodes.Item(sKey2).Selected = True
               Arbol_NodeClick mArbol.Nodes.Item(sKey2)
            End If
         End If
      
      Case "ResumenesParaConciliacionAgrupados"
         sKey1 = ""
         sKey2 = ""
         If mNode.Children = 0 Then
            Set oRs = Aplicacion.Conciliaciones.TraerFiltrado("Anio")
            With oRs
               Do Until .EOF
                  mArbol.Nodes.Add "ResumenesParaConciliacionAgrupados", tvwChild, mChildren & " " & .Fields(0).Value, "" & .Fields(0).Value, "ResumenesParaConciliacion", "ResumenesParaConciliacion"
                  .MoveNext
               Loop
            End With
            mNode.Expanded = True
            If oRs.RecordCount > 0 Then
               oRs.MoveFirst
               Do Until oRs.EOF
                  sKey = mChildren & " " & oRs.Fields(0).Value
                  If oRs.AbsolutePosition = 1 Then sKey1 = sKey
                  Set oRs1 = Aplicacion.Conciliaciones.TraerFiltrado("Mes", oRs.Fields(1).Value)
                  Do Until oRs1.EOF
                     If oRs1.AbsolutePosition = 1 And sKey2 = "" Then sKey2 = mSubChildren & " " & oRs1.Fields(0).Value
                     mArbol.Nodes.Add sKey, tvwChild, mSubChildren & " " & oRs1.Fields(0).Value, "" & oRs1.Fields(3).Value & " " & oRs1.Fields(1).Value, "ResumenesParaConciliacion", "ResumenesParaConciliacion"
                     oRs1.MoveNext
                  Loop
                  oRs1.Close
                  oRs.MoveNext
               Loop
            End If
            oRs.Close
         End If
         If sKey1 <> "" Then
            mArbol.Nodes.Item(sKey1).Expanded = True
            If sKey2 <> "" Then
               mArbol.Nodes.Item(sKey2).Selected = True
               Arbol_NodeClick mArbol.Nodes.Item(sKey2)
            End If
         End If
      
      Case "SalidaMaterialesAgrupadas"
         sKey1 = ""
         sKey2 = ""
         If mNode.Children = 0 Then
            Set oRs = Aplicacion.SalidasMateriales.TraerFiltrado("Anio")
            With oRs
               Do Until .EOF
                  mArbol.Nodes.Add "SalidaMaterialesAgrupadas", tvwChild, mChildren & " " & .Fields(0).Value, "" & .Fields(0).Value, "SalidaMateriales", "SalidaMateriales"
                  .MoveNext
               Loop
            End With
            mNode.Expanded = True
            If oRs.RecordCount > 0 Then
               oRs.MoveFirst
               Do Until oRs.EOF
                  sKey = mChildren & " " & oRs.Fields(0).Value
                  If oRs.AbsolutePosition = 1 Then sKey1 = sKey
                  Set oRs1 = Aplicacion.SalidasMateriales.TraerFiltrado("Mes", oRs.Fields(1).Value)
                  Do Until oRs1.EOF
                     If oRs1.AbsolutePosition = 1 And sKey2 = "" Then sKey2 = mSubChildren & " " & oRs1.Fields(0).Value
                     mArbol.Nodes.Add sKey, tvwChild, mSubChildren & " " & oRs1.Fields(0).Value, "" & oRs1.Fields(3).Value & " " & oRs1.Fields(1).Value, "SalidaMateriales", "SalidaMateriales"
                     oRs1.MoveNext
                  Loop
                  oRs1.Close
                  oRs.MoveNext
               Loop
            End If
            oRs.Close
         End If
         If sKey1 <> "" Then
            mArbol.Nodes.Item(sKey1).Expanded = True
            If sKey2 <> "" Then
               mArbol.Nodes.Item(sKey2).Selected = True
               Arbol_NodeClick mArbol.Nodes.Item(sKey2)
            End If
         End If

      Case "SalidaMaterialesAgrupadas1"
         sKey1 = ""
         sKey2 = ""
         If mNode.Children = 0 Then
            Set oRs = Aplicacion.SalidasMateriales.TraerFiltrado("Anio")
            With oRs
               Do Until .EOF
                  mArbol.Nodes.Add "SalidaMaterialesAgrupadas1", tvwChild, mChildren & " " & .Fields(0).Value, "" & .Fields(0).Value, "SalidaMateriales", "SalidaMateriales"
                  .MoveNext
               Loop
            End With
            mNode.Expanded = True
            If oRs.RecordCount > 0 Then
               oRs.MoveFirst
               Do Until oRs.EOF
                  sKey = mChildren & " " & oRs.Fields(0).Value
                  If oRs.AbsolutePosition = 1 Then sKey1 = sKey
                  Set oRs1 = Aplicacion.SalidasMateriales.TraerFiltrado("Mes", oRs.Fields(1).Value)
                  Do Until oRs1.EOF
                     If oRs1.AbsolutePosition = 1 And sKey2 = "" Then sKey2 = mSubChildren & " " & oRs1.Fields(0).Value
                     mArbol.Nodes.Add sKey, tvwChild, mSubChildren & " " & oRs1.Fields(0).Value, "" & oRs1.Fields(3).Value & " " & oRs1.Fields(1).Value, "SalidaMateriales", "SalidaMateriales"
                     oRs1.MoveNext
                  Loop
                  oRs1.Close
                  oRs.MoveNext
               Loop
            End If
            oRs.Close
         End If
         If sKey1 <> "" Then
            mArbol.Nodes.Item(sKey1).Expanded = True
            If sKey2 <> "" Then
               mArbol.Nodes.Item(sKey2).Selected = True
               Arbol_NodeClick mArbol.Nodes.Item(sKey2)
            End If
         End If

      Case "SalidaMaterialesAgrupadasSAT"
         sKey1 = ""
         sKey2 = ""
         If mNode.Children = 0 Then
            Set oRs = Aplicacion.SalidasMaterialesSAT.TraerFiltrado("Anio")
            With oRs
               Do Until .EOF
                  mArbol.Nodes.Add "SalidaMaterialesAgrupadasSAT", tvwChild, mChildren & " " & .Fields(0).Value, "" & .Fields(0).Value, "SalidaMateriales", "SalidaMateriales"
                  .MoveNext
               Loop
            End With
            mNode.Expanded = True
            If oRs.RecordCount > 0 Then
               oRs.MoveFirst
               Do Until oRs.EOF
                  sKey = mChildren & " " & oRs.Fields(0).Value
                  If oRs.AbsolutePosition = 1 Then sKey1 = sKey
                  Set oRs1 = Aplicacion.SalidasMaterialesSAT.TraerFiltrado("Mes", oRs.Fields(1).Value)
                  Do Until oRs1.EOF
                     If oRs1.AbsolutePosition = 1 And sKey2 = "" Then sKey2 = mSubChildren & " " & oRs1.Fields(0).Value
                     mArbol.Nodes.Add sKey, tvwChild, mSubChildren & " " & oRs1.Fields(0).Value, "" & oRs1.Fields(3).Value & " " & oRs1.Fields(1).Value, "SalidaMateriales", "SalidaMateriales"
                     oRs1.MoveNext
                  Loop
                  oRs1.Close
                  oRs.MoveNext
               Loop
            End If
            oRs.Close
         End If
         If sKey1 <> "" Then
            mArbol.Nodes.Item(sKey1).Expanded = True
            If sKey2 <> "" Then
               mArbol.Nodes.Item(sKey2).Selected = True
               Arbol_NodeClick mArbol.Nodes.Item(sKey2)
            End If
         End If

      Case "SolicitudesCompraAgrupadas"
         sKey1 = ""
         sKey2 = ""
         If mNode.Children = 0 Then
            Set oRs = Aplicacion.SolicitudesCompra.TraerFiltrado("Anio")
            With oRs
               Do Until .EOF
                  mArbol.Nodes.Add "SolicitudesCompraAgrupadas", tvwChild, mChildren & " " & .Fields(0).Value, "" & .Fields(0).Value, "SolicitudesCompra", "SolicitudesCompra"
                  .MoveNext
               Loop
            End With
            mNode.Expanded = True
            If oRs.RecordCount > 0 Then
               oRs.MoveFirst
               Do Until oRs.EOF
                  sKey = mChildren & " " & oRs.Fields(0).Value
                  If oRs.AbsolutePosition = 1 Then sKey1 = sKey
                  Set oRs1 = Aplicacion.SolicitudesCompra.TraerFiltrado("Mes", oRs.Fields(1).Value)
                  Do Until oRs1.EOF
                     If oRs1.AbsolutePosition = 1 And sKey2 = "" Then sKey2 = mSubChildren & " " & oRs1.Fields(0).Value
                     mArbol.Nodes.Add sKey, tvwChild, mSubChildren & " " & oRs1.Fields(0).Value, "" & oRs1.Fields(3).Value & " " & oRs1.Fields(1).Value, "SolicitudesCompra", "SolicitudesCompra"
                     oRs1.MoveNext
                  Loop
                  oRs1.Close
                  oRs.MoveNext
               Loop
            End If
            oRs.Close
         End If
         If sKey1 <> "" Then
            mArbol.Nodes.Item(sKey1).Expanded = True
            If sKey2 <> "" Then
               mArbol.Nodes.Item(sKey2).Selected = True
               Arbol_NodeClick mArbol.Nodes.Item(sKey2)
            End If
         End If
      
      Case "SubdiariosAgrupados"
         sKey1 = ""
         sKey2 = ""
         If mNode.Children = 0 Then
            Set oRs = Aplicacion.Subdiarios.TraerFiltrado("Anio")
            With oRs
               Do Until .EOF
                  mArbol.Nodes.Add "SubdiariosAgrupados", tvwChild, mChildren & " " & .Fields(0).Value, "" & .Fields(0).Value, "Subdiarios", "Subdiarios"
                  .MoveNext
               Loop
            End With
            mNode.Expanded = True
            If oRs.RecordCount > 0 Then
               oRs.MoveFirst
               Do Until oRs.EOF
                  sKey = mChildren & " " & oRs.Fields(0).Value
                  If oRs.AbsolutePosition = 1 Then sKey1 = sKey
                  Set oRs1 = Aplicacion.Subdiarios.TraerFiltrado("Mes", oRs.Fields(1).Value)
                  Do Until oRs1.EOF
                     If oRs1.AbsolutePosition = 1 And sKey2 = "" Then sKey2 = mSubChildren & " " & oRs1.Fields(0).Value
                     mArbol.Nodes.Add sKey, tvwChild, mSubChildren & " " & oRs1.Fields(0).Value, "" & oRs1.Fields(3).Value & " " & oRs1.Fields(1).Value, "Subdiarios", "Subdiarios"
                     oRs1.MoveNext
                  Loop
                  oRs1.Close
                  oRs.MoveNext
               Loop
            End If
            oRs.Close
         End If
         If sKey1 <> "" Then
            mArbol.Nodes.Item(sKey1).Expanded = True
            If sKey2 <> "" Then
               mArbol.Nodes.Item(sKey2).Selected = True
               Arbol_NodeClick mArbol.Nodes.Item(sKey2)
            End If
         End If
   End Select

   Set oRs = Nothing
   Set oRs1 = Nothing
   Set oRs2 = Nothing
   Set oRs3 = Nothing

End Sub

Public Sub AbrirSubarbol2(ByVal mParent As String, _
                          ByVal mChildren As String, _
                          ByVal mSubChildren As String, _
                          ByRef mArbol As TreeView, _
                          ByRef mNode As Node, _
                          Optional ByVal mSubSubChildren As String)

   Dim sKey As String, sKey1 As String, sKey2 As String, sKey3 As String, sKey4 As String
   Dim oRs As ADOR.Recordset
   Dim oRs1 As ADOR.Recordset
   Dim oRs2 As ADOR.Recordset
   Dim oRs3 As ADOR.Recordset
   Dim Datos
         
   Select Case mParent
      Case "UnidadesEmpaqueAgrupados"
         sKey1 = ""
         sKey2 = ""
         If mNode.Children = 0 Then
            Set oRs = Aplicacion.UnidadesEmpaque.TraerFiltrado("Anio")
            With oRs
               Do Until .EOF
                  mArbol.Nodes.Add "UnidadesEmpaqueAgrupados", tvwChild, mChildren & " " & .Fields(0).Value, "" & .Fields(0).Value, "UnidadesEmpaque", "UnidadesEmpaque"
                  .MoveNext
               Loop
            End With
            mNode.Expanded = True
            If oRs.RecordCount > 0 Then
               oRs.MoveFirst
               Do Until oRs.EOF
                  sKey = mChildren & " " & oRs.Fields(0).Value
                  If oRs.AbsolutePosition = 1 Then sKey1 = sKey
                  Set oRs1 = Aplicacion.UnidadesEmpaque.TraerFiltrado("Mes", oRs.Fields(1).Value)
                  Do Until oRs1.EOF
                     If oRs1.AbsolutePosition = 1 And sKey2 = "" Then sKey2 = mSubChildren & " " & oRs1.Fields(0).Value
                     mArbol.Nodes.Add sKey, tvwChild, mSubChildren & " " & oRs1.Fields(0).Value, "" & oRs1.Fields(3).Value & " " & oRs1.Fields(1).Value, "UnidadesEmpaque", "UnidadesEmpaque"
                     oRs1.MoveNext
                  Loop
                  oRs1.Close
                  oRs.MoveNext
               Loop
            End If
            oRs.Close
         End If
         If sKey1 <> "" Then
            mArbol.Nodes.Item(sKey1).Expanded = True
            If sKey2 <> "" Then
               mArbol.Nodes.Item(sKey2).Selected = True
               Arbol_NodeClick mArbol.Nodes.Item(sKey2)
            End If
         End If

      Case "ValesSalidaAgrupados"
         sKey1 = ""
         sKey2 = ""
         If mNode.Children = 0 Then
            Set oRs = Aplicacion.ValesSalida.TraerFiltrado("Anio")
            With oRs
               Do Until .EOF
                  mArbol.Nodes.Add "ValesSalidaAgrupados", tvwChild, mChildren & " " & .Fields(0).Value, "" & .Fields(0).Value, "ValesSalida", "ValesSalida"
                  .MoveNext
               Loop
            End With
            mNode.Expanded = True
            If oRs.RecordCount > 0 Then
               oRs.MoveFirst
               Do Until oRs.EOF
                  sKey = mChildren & " " & oRs.Fields(0).Value
                  If oRs.AbsolutePosition = 1 Then sKey1 = sKey
                  Set oRs1 = Aplicacion.ValesSalida.TraerFiltrado("Mes", oRs.Fields(1).Value)
                  Do Until oRs1.EOF
                     If oRs1.AbsolutePosition = 1 And sKey2 = "" Then sKey2 = mSubChildren & " " & oRs1.Fields(0).Value
                     mArbol.Nodes.Add sKey, tvwChild, mSubChildren & " " & oRs1.Fields(0).Value, "" & oRs1.Fields(3).Value & " " & oRs1.Fields(1).Value, "ValesSalida", "ValesSalida"
                     oRs1.MoveNext
                  Loop
                  oRs1.Close
                  oRs.MoveNext
               Loop
            End If
            oRs.Close
         End If
         If sKey1 <> "" Then
            mArbol.Nodes.Item(sKey1).Expanded = True
            If sKey2 <> "" Then
               mArbol.Nodes.Item(sKey2).Selected = True
               Arbol_NodeClick mArbol.Nodes.Item(sKey2)
            End If
         End If

      Case "ValoresRecibidos"
         sKey1 = ""
         sKey2 = ""
         sKey3 = ""
         If mNode.Children = 0 Then
            Set oRs = Aplicacion.Valores.TraerFiltrado("_PorBancoAgrupado", "IN")
            With oRs
               Do Until .EOF
                  mArbol.Nodes.Add "ValoresRecibidos", tvwChild, mChildren & " " & .Fields(0).Value, "" & .Fields(1).Value, "Valores", "Valores"
                  .MoveNext
               Loop
            End With
            mNode.Expanded = True
            If oRs.RecordCount > 0 Then
               oRs.MoveFirst
               Do Until oRs.EOF
                  sKey = mChildren & " " & oRs.Fields(0).Value
                  If oRs.AbsolutePosition = 1 Then sKey1 = sKey
                  Set oRs1 = Aplicacion.Valores.TraerFiltrado("Anio", Array("IN", oRs.Fields(0).Value))
                  Do Until oRs1.EOF
                     If oRs1.AbsolutePosition = 1 And sKey2 = "" Then sKey2 = mSubChildren & " " & oRs1.Fields(0).Value & " " & oRs.Fields(0).Value
                     mArbol.Nodes.Add sKey, tvwChild, mSubChildren & " " & oRs1.Fields(0).Value & " " & oRs.Fields(0).Value, "" & oRs1.Fields(0).Value, "Valores", "Valores"
                     oRs1.MoveNext
                  Loop
                  If oRs1.RecordCount > 0 Then
                     oRs1.MoveFirst
                     Do Until oRs1.EOF
                        sKey = mSubChildren & " " & oRs1.Fields(0).Value & " " & oRs.Fields(0).Value
                        If oRs1.AbsolutePosition = 1 Then sKey2 = sKey
                        Set oRs2 = Aplicacion.Valores.TraerFiltrado("Mes1", Array(oRs1.Fields(1).Value, "IN", oRs.Fields(0).Value))
                        Do Until oRs2.EOF
                           If oRs2.AbsolutePosition = 1 And sKey3 = "" Then sKey3 = mSubSubChildren & " " & oRs2.Fields(0).Value & " " & oRs2.Fields(3).Value & " " & oRs.Fields(0).Value
                           mArbol.Nodes.Add sKey, tvwChild, mSubSubChildren & " " & oRs2.Fields(0).Value & " " & oRs2.Fields(3).Value & " " & oRs.Fields(0).Value, "" & oRs2.Fields(3).Value & " " & oRs1.Fields(1).Value, "Valores", "Valores"
                           oRs2.MoveNext
                        Loop
                        oRs2.Close
                        oRs1.MoveNext
                     Loop
                  End If
                  oRs1.Close
                  oRs.MoveNext
               Loop
            End If
            oRs.Close
         End If
         If sKey1 <> "" Then
            mArbol.Nodes.Item(sKey1).Expanded = True
            If sKey2 <> "" Then
               mArbol.Nodes.Item(sKey2).Expanded = True
               If sKey3 <> "" Then
                  mArbol.Nodes.Item(sKey3).Selected = True
                  Arbol_NodeClick mArbol.Nodes.Item(sKey3)
               End If
            End If
         End If

      Case "ValoresEmitidos"
         sKey1 = ""
         sKey2 = ""
         sKey3 = ""
         If mNode.Children = 0 Then
            Set oRs = Aplicacion.Valores.TraerFiltrado("_PorBancoAgrupado", "EG")
            With oRs
               Do Until .EOF
                  mArbol.Nodes.Add "ValoresEmitidos", tvwChild, mChildren & " " & .Fields(0).Value, "" & .Fields(1).Value, "Valores", "Valores"
                  .MoveNext
               Loop
            End With
            mNode.Expanded = True
            If oRs.RecordCount > 0 Then
               oRs.MoveFirst
               Do Until oRs.EOF
                  sKey = mChildren & " " & oRs.Fields(0).Value
                  If oRs.AbsolutePosition = 1 Then sKey1 = sKey
                  Set oRs1 = Aplicacion.Valores.TraerFiltrado("Anio", Array("EG", oRs.Fields(0).Value))
                  Do Until oRs1.EOF
                     If oRs1.AbsolutePosition = 1 And sKey2 = "" Then sKey2 = mSubChildren & " " & oRs1.Fields(0).Value & " " & oRs.Fields(0).Value
                     mArbol.Nodes.Add sKey, tvwChild, mSubChildren & " " & oRs1.Fields(0).Value & " " & oRs.Fields(0).Value, "" & oRs1.Fields(0).Value, "Valores", "Valores"
                     oRs1.MoveNext
                  Loop
                  If oRs1.RecordCount > 0 Then
                     oRs1.MoveFirst
                     Do Until oRs1.EOF
                        sKey = mSubChildren & " " & oRs1.Fields(0).Value & " " & oRs.Fields(0).Value
                        If oRs1.AbsolutePosition = 1 Then sKey2 = sKey
                        Set oRs2 = Aplicacion.Valores.TraerFiltrado("Mes1", Array(oRs1.Fields(1).Value, "EG", oRs.Fields(0).Value))
                        Do Until oRs2.EOF
                           If oRs2.AbsolutePosition = 1 And sKey3 = "" Then sKey3 = mSubSubChildren & " " & oRs2.Fields(0).Value & " " & oRs2.Fields(3).Value & " " & oRs.Fields(0).Value
                           mArbol.Nodes.Add sKey, tvwChild, mSubSubChildren & " " & oRs2.Fields(0).Value & " " & oRs2.Fields(3).Value & " " & oRs.Fields(0).Value, "" & oRs2.Fields(3).Value & " " & oRs1.Fields(1).Value, "Valores", "Valores"
                           oRs2.MoveNext
                        Loop
                        oRs2.Close
                        oRs1.MoveNext
                     Loop
                  End If
                  oRs1.Close
                  oRs.MoveNext
               Loop
            End If
            oRs.Close
         End If
         If sKey1 <> "" Then
            mArbol.Nodes.Item(sKey1).Expanded = True
            If sKey2 <> "" Then
               mArbol.Nodes.Item(sKey2).Expanded = True
               If sKey3 <> "" Then
                  mArbol.Nodes.Item(sKey3).Selected = True
                  Arbol_NodeClick mArbol.Nodes.Item(sKey3)
               End If
            End If
         End If
   End Select

   Set oRs = Nothing
   Set oRs1 = Nothing
   Set oRs2 = Nothing
   Set oRs3 = Nothing

End Sub

Private Sub Check1_Click()

   If Check1.Value = 0 Then
      glbConsolidar = False
   Else
      glbConsolidar = True
   End If

End Sub

Private Sub Lista_DblClick()

   If Not Lista.SelectedItem Is Nothing Then
      If Len(Trim(Lista.SelectedItem.Tag)) <> 0 Then
         Editar Lista.SelectedItem.Tag
      End If
   End If
   
End Sub

Private Sub Lista_FinCarga()

   SetearIdioma "", "DbListView"

End Sub

Private Sub Lista_KeyUp(KeyCode As Integer, Shift As Integer)

   If KeyCode = 32 Then
      If Not Lista.SelectedItem Is Nothing Then
         If Len(Trim(Lista.SelectedItem.Tag)) <> 0 Then
            Editar Lista.SelectedItem.Tag
         End If
      End If
   End If
   
End Sub

Private Sub Lista_MouseMove(Button As Integer, Shift As Integer, X As Single, Y As Single)

   If Button = vbLeftButton Then Lista.OLEDrag

End Sub

Private Sub Lista_MouseUp(Button As Integer, Shift As Integer, X As Single, Y As Single)

   If Button = vbRightButton Then
      If Not Lista.SelectedItem Is Nothing Then
         If Lista.ListItems.Count > 0 Then
            Dim i As Integer
            If InStr(1, Lista.ColumnHeaders(1).Text, "Pedido") <> 0 Then
               MnuDetA(5).Visible = True
               MnuDetA(9).Visible = True
               MnuDetA(12).Visible = True
               MnuDetA(13).Visible = True
               MnuDetA(15).Visible = True
               If Not glbParametrizacionNivel1 Then
                  MnuDetA(0).Enabled = True
                  MnuDetA(0).Visible = True
               Else
                  MnuDetA(0).Visible = False
               End If
               MnuDetA(1).Visible = False
               MnuDetA(2).Visible = False
               MnuDetA(3).Visible = False
               MnuDetA(4).Visible = False
               MnuDetA(6).Visible = False
               MnuDetA(7).Visible = False
               MnuDetA(8).Visible = False
               MnuDetA(10).Visible = False
               MnuDetA(11).Visible = False
               MnuDetA(14).Visible = False
               MnuDetA(16).Visible = False
               MnuDetA(17).Visible = False
               MnuDetA(18).Visible = False
               PopupMenu MnuDet
            End If
            
            If InStr(1, Lista.ColumnHeaders(1).Text, "Presupuesto") <> 0 Then
               If Not glbParametrizacionNivel1 Then
                  MnuDetA(0).Enabled = True
                  MnuDetA(0).Visible = True
                  MnuDetA(1).Visible = False
                  MnuDetA(2).Visible = False
                  MnuDetA(3).Visible = False
                  MnuDetA(4).Visible = False
                  MnuDetA(5).Visible = False
                  MnuDetA(6).Visible = False
                  MnuDetA(7).Visible = False
                  MnuDetA(8).Visible = False
                  MnuDetA(9).Visible = False
                  MnuDetA(10).Visible = False
                  MnuDetA(11).Visible = False
                  MnuDetA(12).Visible = False
                  MnuDetA(13).Visible = False
                  MnuDetA(14).Visible = False
                  MnuDetA(15).Visible = False
                  MnuDetA(16).Visible = False
                  MnuDetA(17).Visible = False
                  MnuDetA(18).Visible = False
                  PopupMenu MnuDet, , , , MnuDetA(0)
               End If
            End If
            
            If Lista.ColumnHeaders.Count >= 1 Then
               If InStr(1, Lista.ColumnHeaders(1).Text, "Req. a Conf.") <> 0 Then
                  MnuDetA(8).Visible = True
                  MnuDetA(10).Visible = True
                  MnuDetA(11).Visible = True
                  MnuDetA(0).Visible = False
                  MnuDetA(1).Visible = False
                  MnuDetA(2).Visible = False
                  MnuDetA(3).Visible = False
                  MnuDetA(4).Visible = False
                  MnuDetA(5).Visible = False
                  MnuDetA(6).Visible = False
                  MnuDetA(7).Visible = False
                  MnuDetA(9).Visible = False
                  MnuDetA(12).Visible = False
                  MnuDetA(13).Visible = False
                  MnuDetA(14).Visible = False
                  MnuDetA(15).Visible = False
                  MnuDetA(16).Visible = False
                  MnuDetA(17).Visible = False
                  MnuDetA(18).Visible = False
                  PopupMenu MnuDet, , , , MnuDetA(8)
                  Exit Sub
               End If
            End If
         
            If InStr(1, Lista.ColumnHeaders(1).Text, "Req.") <> 0 Then
               MnuDetA(6).Visible = True
               MnuDetA(10).Visible = True
               MnuDetA(11).Visible = True
               MnuDetA(14).Visible = True
               MnuDetA(16).Visible = True
               MnuDetA(0).Visible = False
               MnuDetA(1).Visible = False
               MnuDetA(2).Visible = False
               MnuDetA(3).Visible = False
               MnuDetA(4).Visible = False
               MnuDetA(5).Visible = False
               MnuDetA(7).Visible = False
               MnuDetA(8).Visible = False
               MnuDetA(9).Visible = False
               MnuDetA(12).Visible = False
               MnuDetA(13).Visible = False
               MnuDetA(15).Visible = False
               MnuDetA(18).Visible = False
               If BuscarClaveINI("Permitir modificar detalle RM") = "SI" Then MnuDetA(17).Visible = True
               PopupMenu MnuDet, , , , MnuDetA(6)
            End If
            
            If Lista.ColumnHeaders.Count >= 4 Then
               If InStr(1, Lista.ColumnHeaders(1).Text, "Descripcion") <> 0 Then
                  If InStr(1, Lista.ColumnHeaders(3).Text, "Rubro") <> 0 And _
                     InStr(1, Lista.ColumnHeaders(4).Text, "Subrubro") <> 0 Then
                     MnuDetA(1).Visible = True
                     MnuDetA(0).Visible = False
                     MnuDetA(2).Visible = False
                     MnuDetA(3).Visible = False
                     MnuDetA(4).Visible = False
                     MnuDetA(5).Visible = False
                     MnuDetA(6).Visible = False
                     MnuDetA(7).Visible = False
                     MnuDetA(8).Visible = False
                     MnuDetA(9).Visible = False
                     MnuDetA(10).Visible = False
                     MnuDetA(11).Visible = False
                     MnuDetA(12).Visible = False
                     MnuDetA(13).Visible = False
                     MnuDetA(14).Visible = False
                     MnuDetA(15).Visible = False
                     MnuDetA(16).Visible = False
                     MnuDetA(17).Visible = False
                     MnuDetA(18).Visible = False
                     PopupMenu MnuDet, , , , MnuDetA(1)
                  End If
               End If
            End If
            
            If InStr(1, Lista.ColumnHeaders(1).Text, "Orden en caja") <> 0 Then
               MnuDetA(2).Visible = True
               MnuDetA(3).Visible = True
               MnuDetA(0).Visible = False
               MnuDetA(1).Visible = False
               MnuDetA(4).Visible = False
               MnuDetA(5).Visible = False
               MnuDetA(6).Visible = False
               MnuDetA(7).Visible = False
               MnuDetA(8).Visible = False
               MnuDetA(9).Visible = False
               MnuDetA(10).Visible = False
               MnuDetA(11).Visible = False
               MnuDetA(12).Visible = False
               MnuDetA(13).Visible = False
               MnuDetA(14).Visible = False
               MnuDetA(15).Visible = False
               MnuDetA(16).Visible = False
               MnuDetA(17).Visible = False
               MnuDetA(18).Visible = False
               PopupMenu MnuDet, , , , MnuDetA(2)
            End If
            
            If InStr(1, Lista.ColumnHeaders(1).Text, "Orden pend.") <> 0 Then
               MnuDetA(4).Visible = True
               If BuscarClaveINI("Habilitar caja obra en OP") = "SI" Then MnuDetA(18).Visible = True
               MnuDetA(0).Visible = False
               MnuDetA(1).Visible = False
               MnuDetA(2).Visible = False
               MnuDetA(3).Visible = False
               MnuDetA(5).Visible = False
               MnuDetA(6).Visible = False
               MnuDetA(7).Visible = False
               MnuDetA(8).Visible = False
               MnuDetA(9).Visible = False
               MnuDetA(10).Visible = False
               MnuDetA(11).Visible = False
               MnuDetA(12).Visible = False
               MnuDetA(13).Visible = False
               MnuDetA(14).Visible = False
               MnuDetA(15).Visible = False
               MnuDetA(16).Visible = False
               MnuDetA(17).Visible = False
               PopupMenu MnuDet, , , , MnuDetA(4)
            End If
            
            If Lista.ColumnHeaders.Count >= 13 Then
               If InStr(1, Lista.ColumnHeaders(13).Text, "Conc.") <> 0 Then
                  MnuConcA(0).Visible = True
                  MnuConcA(1).Visible = True
                  MnuConcA(2).Visible = True
                  MnuConcA(3).Visible = True
                  MnuConcA(4).Visible = True
                  MnuConcA(5).Visible = False
                  PopupMenu MnuConc, , , , MnuConcA(0)
               ElseIf InStr(1, Lista.ColumnHeaders(4).Text, "Conc.") <> 0 Then
                  MnuConcA(0).Visible = True
                  MnuConcA(1).Visible = True
                  MnuConcA(2).Visible = True
                  MnuConcA(3).Visible = False
                  MnuConcA(4).Visible = False
                  MnuConcA(5).Visible = False
                  PopupMenu MnuConc, , , , MnuConcA(0)
               End If
            End If
            
            If Lista.ColumnHeaders.Count >= 13 Then
               If InStr(1, Lista.ColumnHeaders(13).Text, "Dif.cambio u$s") <> 0 Then
                  PopupMenu MnuDif
               End If
            End If
            
            If Lista.ColumnHeaders.Count >= 1 Then
               If InStr(1, Lista.ColumnHeaders(1).Text, "Codigo material") <> 0 Then
                  PopupMenu MnuArt, , , , MnuArtA(0)
               End If
            End If
         
            If Lista.ColumnHeaders.Count >= 1 Then
               If InStr(1, Lista.ColumnHeaders(1).Text, "asiento") <> 0 Then
                  PopupMenu MnuAsi, , , , MnuAsiA(0)
               End If
            End If
         
            If Lista.ColumnHeaders.Count >= 1 Then
               If InStr(1, Lista.ColumnHeaders(1).Text, "Numero Cheque") <> 0 Then
                  PopupMenu MnuEmiCh, , , , MnuEmiChA(0)
               End If
            End If
         
            If Lista.ColumnHeaders.Count >= 1 Then
               If InStr(1, Lista.ColumnHeaders(1).Text, "a conf") <> 0 Then
                  MnuDetA(7).Visible = True
                  MnuDetA(0).Visible = False
                  MnuDetA(1).Visible = False
                  MnuDetA(2).Visible = False
                  MnuDetA(3).Visible = False
                  MnuDetA(4).Visible = False
                  MnuDetA(5).Visible = False
                  MnuDetA(6).Visible = False
                  MnuDetA(8).Visible = False
                  MnuDetA(9).Visible = False
                  MnuDetA(10).Visible = False
                  MnuDetA(11).Visible = False
                  MnuDetA(12).Visible = False
                  MnuDetA(13).Visible = False
                  MnuDetA(14).Visible = False
                  MnuDetA(15).Visible = False
                  MnuDetA(16).Visible = False
                  MnuDetA(17).Visible = False
                  MnuDetA(18).Visible = False
                  PopupMenu MnuDet, , , , MnuDetA(7)
               End If
            End If
         
            If Lista.ColumnHeaders.Count >= 6 Then
               If InStr(1, Lista.ColumnHeaders(1).Text, "Numero") <> 0 And _
                     InStr(1, Lista.ColumnHeaders(3).Text, "Cod") <> 0 And _
                     InStr(1, Lista.ColumnHeaders(6).Text, "Est.") = 0 Then
                  MnuEmiOP1(0).Visible = True
                  MnuEmiOP1(1).Visible = True
                  MnuEmiOP1(2).Visible = False
                  MnuEmiOP1(3).Visible = True
                  If BuscarClaveINI("Habilitar caja obra en OP") = "SI" Then MnuEmiOP1(5).Visible = True
                  i = 0
                  If glbIdObraAsignadaUsuario > 0 Then
                     MnuEmiOP1(0).Visible = False
                     MnuEmiOP1(1).Visible = False
                     MnuEmiOP1(2).Visible = False
                     MnuEmiOP1(3).Visible = False
                     MnuEmiOP1(4).Visible = True
                     MnuEmiOP1(5).Visible = False
                     i = 4
                  ElseIf Not glbAdministrador Then
                     MnuEmiOP1(4).Visible = False
                  End If
                  'Se libero la opcion 7/7/2009
                  If BuscarClaveINI("Liberar confirmacion de acreditacion de FF") = "SI" Then MnuEmiOP1(4).Visible = True
                  PopupMenu MnuEmiOP, , , , MnuEmiOP1(i)
               ElseIf InStr(1, Lista.ColumnHeaders(1).Text, "Numero") <> 0 And _
                      InStr(1, Lista.ColumnHeaders(3).Text, "Cod") <> 0 And _
                      InStr(1, Lista.ColumnHeaders(6).Text, "Est.") <> 0 Then
                  MnuEmiOP1(2).Visible = True
                  MnuEmiOP1(0).Visible = False
                  MnuEmiOP1(1).Visible = False
                  MnuEmiOP1(3).Visible = True
                  If BuscarClaveINI("Habilitar caja obra en OP") = "SI" Then MnuEmiOP1(5).Visible = True
                  i = 2
                  If glbIdObraAsignadaUsuario > 0 Then
                     MnuEmiOP1(0).Visible = False
                     MnuEmiOP1(1).Visible = False
                     MnuEmiOP1(2).Visible = False
                     MnuEmiOP1(3).Visible = False
                     MnuEmiOP1(4).Visible = True
                     MnuEmiOP1(5).Visible = False
                     i = 4
                  ElseIf Not glbAdministrador Then
                     MnuEmiOP1(4).Visible = False
                  End If
                  PopupMenu MnuEmiOP, , , , MnuEmiOP1(i)
               End If
            End If
         
            If Lista.ColumnHeaders.Count >= 3 Then
               If InStr(1, Lista.ColumnHeaders(1).Text, "Obra") <> 0 And _
                     InStr(1, Lista.ColumnHeaders(3).Text, "Tipo obra") <> 0 Then
                  PopupMenu MnuObras, , , , MnuObrasA(1)
               End If
            End If
         
            If Lista.ColumnHeaders.Count >= 2 Then
               If InStr(1, Lista.ColumnHeaders(1).Text, "Eventual") <> 0 Then
                  PopupMenu mnuFncProv, , , , mnuFncProvA(0)
               End If
            End If
         
            If Lista.ColumnHeaders.Count >= 2 Then
               If InStr(1, Lista.ColumnHeaders(1).Text, "Orden de compra") <> 0 Then
                  PopupMenu mnuFncCli, , , , mnuFncCliA(0)
               End If
            End If
         
            If Lista.ColumnHeaders.Count >= 4 Then
               If InStr(1, Lista.ColumnHeaders(4).Text, "Generacion") <> 0 Then
                  mnuFncCuoA(1).Visible = True
                  mnuFncCuoA(0).Visible = False
                  PopupMenu mnuFncCuo, , , , mnuFncCuoA(1)
               End If
            End If
         
            If Lista.ColumnHeaders.Count >= 4 Then
               If InStr(1, Lista.ColumnHeaders(4).Text, "Manzana") <> 0 Then
                  mnuFncCuoA(0).Visible = True
                  mnuFncCuoA(1).Visible = False
                  PopupMenu mnuFncCuo, , , , mnuFncCuoA(0)
               End If
            End If
         
            If Lista.ColumnHeaders.Count >= 4 Then
               If InStr(1, Lista.ColumnHeaders(4).Text, "Factura") <> 0 Then
                  If BuscarClaveINI("Activar eliminacion de facturas anuladas") = "SI" Then
                     mnuFncFacA(2).Visible = True
                  Else
                     mnuFncFacA(2).Visible = False
                  End If
                  PopupMenu mnuFncFac, , , , mnuFncFacA(0)
               End If
            End If
         
            If Lista.ColumnHeaders.Count >= 5 Then
               If InStr(1, Lista.ColumnHeaders(5).Text, "credito") <> 0 Then
                  PopupMenu mnuFncNC, , , , mnuFncNCA(0)
               End If
            End If
         
            If Lista.ColumnHeaders.Count >= 5 Then
               If InStr(1, Lista.ColumnHeaders(5).Text, "debito") <> 0 Then
                  PopupMenu mnuFncND, , , , mnuFncNDA(0)
               End If
            End If
         
            If Lista.ColumnHeaders.Count >= 7 Then
               If InStr(1, Lista.ColumnHeaders(7).Text, "Resumen") <> 0 Then
                  MnuConcA(5).Visible = True
                  MnuConcA(0).Visible = False
                  MnuConcA(1).Visible = False
                  MnuConcA(2).Visible = False
                  MnuConcA(3).Visible = False
                  MnuConcA(4).Visible = False
                  PopupMenu MnuConc, , , , MnuConcA(5)
               End If
            End If
            
            If Lista.ColumnHeaders.Count >= 5 Then
               If InStr(1, Lista.ColumnHeaders(3).Text, "Cuenta") <> 0 And _
                     InStr(1, Lista.ColumnHeaders(4).Text, "Obra") <> 0 Then
                  PopupMenu mnuFncPE, , , , mnuFncPEA(0)
               End If
            End If
         
            If Lista.ColumnHeaders.Count >= 3 And Not glbIdObraAsignadaUsuario > 0 Then
               If InStr(1, Lista.ColumnHeaders(1).Text, "Tipo comp.") <> 0 And _
                     InStr(1, Lista.ColumnHeaders(3).Text, "Nro.interno") <> 0 Then
                  PopupMenu mnuFncCP, , , , mnuFncCPA(0)
               End If
            End If
         
            If Lista.ColumnHeaders.Count >= 4 Then
               If InStr(1, Lista.ColumnHeaders(4).Text, "Act?") <> 0 Then
                  PopupMenu mnuFncCG, , , , mnuFncCGA(0)
               End If
            End If
         
            If Lista.ColumnHeaders.Count >= 1 Then
               If InStr(1, Lista.ColumnHeaders(1).Text, "Legajo") <> 0 Then
                  PopupMenu mnuFncAPSyJ, , , , mnuFncAPSyJA(0)
               End If
            End If
         
            If Lista.ColumnHeaders.Count >= 3 Then
               If InStr(1, Lista.ColumnHeaders(3).Text, "Nro.Rend.") <> 0 Then
                  PopupMenu mnuFncFF, , , , mnuFncFFA(0)
               End If
            End If
         
            If Lista.ColumnHeaders.Count >= 3 Then
               If InStr(1, Lista.ColumnHeaders(3).Text, "conjunto") <> 0 Then
                  PopupMenu mnuFncConj, , , , mnuFncConjA(0)
               End If
            End If
         
            If Lista.ColumnHeaders.Count >= 2 Then
               If InStr(1, Lista.ColumnHeaders(1).Text, "Rubro") <> 0 Then
                  PopupMenu mnuFncRubros, , , , mnuFncRubrosA(0)
               End If
            End If
         
            If Lista.ColumnHeaders.Count >= 2 Then
               If InStr(1, Lista.ColumnHeaders(1).Text, "Subrubro") <> 0 Then
                  PopupMenu mnuFncSubrubros, , , , mnuFncSubrubrosA(0)
               End If
            End If
         
            If Lista.ColumnHeaders.Count >= 3 Then
               If InStr(1, Lista.ColumnHeaders(3).Text, "Recibo") <> 0 Then
                  PopupMenu mnuFncRec, , , , mnuFncRecA(0)
               End If
            End If
         
            If Lista.ColumnHeaders.Count >= 3 Then
               If InStr(1, Lista.ColumnHeaders(3).Text, "Nro.Int.") <> 0 Then
                  PopupMenu mnuFncChk, , , , mnuFncChkA(0)
               End If
            End If
         
            If Lista.ColumnHeaders.Count >= 4 Then
               If InStr(1, Lista.ColumnHeaders(4).Text, "Tipo de cuenta") <> 0 Then
                  PopupMenu mnuFncCtas, , , , mnuFncCtasA(0)
               End If
            End If
         End If
      End If
   End If

End Sub

Private Sub Lista_OLEGiveFeedback(Effect As Long, DefaultCursors As Boolean)
   
   DefaultCursors = True

End Sub

Private Sub Lista_OLEStartDrag(Data As MSComctlLib.IVBDataObject, AllowedEffects As Long)

   AllowedEffects = vbDropEffectCopy

End Sub

Private Sub MnuArtA_Click(Index As Integer)

   Dim oF As Form
   Dim Filas
   Dim Columnas
   Dim s As String, clave As String
   Dim iFilas As Integer
   Dim mOk As Boolean
   Dim mAlicuotaIVA As Double
         
   Select Case Index
      Case 0
         Set oF = New frm_Aux
         With oF
            .Caption = "Cambio alicuota IVA"
            .Label1.Caption = "Alicuota IVA :"
            .Show vbModal, Me
            mAlicuotaIVA = Val(.Text1.Text)
            mOk = .Ok
         End With
         Unload oF
         Set oF = Nothing
         If mOk Then
            Filas = VBA.Split(Lista.GetString, vbCrLf)
            s = ""
            For iFilas = LBound(Filas) + 1 To UBound(Filas)
               Columnas = VBA.Split(Filas(iFilas), vbTab)
               If IsNumeric(Columnas(3)) Then
                  Aplicacion.Tarea "Articulos_RegistrarAlicuotaIVA", Array(Columnas(3), mAlicuotaIVA)
               End If
            Next
            Set Lista.DataSource = Aplicacion.Articulos.TraerTodos
         End If
         
      Case 1
         Filas = VBA.Split(Lista.GetString, vbCrLf)
         s = ""
         For iFilas = LBound(Filas) + 1 To UBound(Filas)
            Columnas = VBA.Split(Filas(iFilas), vbTab)
            If IsNumeric(Columnas(3)) Then
               Aplicacion.Tarea "Articulos_RecalcularCostoPPP_PorIdArticulo", Columnas(3)
            End If
         Next
         MsgBox "Proceso completado", vbInformation
         
      Case 2
         EmisionEtiquetasArticulos Lista.GetString
         
      Case 3
         EmisionEtiquetasArticulosZebra Lista.GetString
   End Select

End Sub

Private Sub MnuAsiA_Click(Index As Integer)

   Select Case Index
      Case 0
         RenumerarAsientos
      Case 1
         CopiarAsiento
      Case 2
         RevertirAsiento
      
   End Select

End Sub

Private Sub MnuAyuda_Click(Index As Integer)

   Select Case Index
      Case 0
         Dim oF As frmAbout
         Set oF = New frmAbout
         oF.Show vbModal, Me
         Unload oF
         Set oF = Nothing
      Case 1
         VerAyuda
   End Select

End Sub

Private Sub MnuConcA_Click(Index As Integer)

   If Index = 5 Then
      QuitarMarcaAprobacionConciliacion
      Exit Sub
   End If
   
   Dim oF As Form
   Dim s As String, clave As String, mFiltro As String, Clave1 As String
   Dim FechaDesde As Date, FechaHasta As Date
   Dim Nodo As Object
   Dim Filas, Columnas, ColumnasTitulos
   Dim iFilas As Integer

   s = Arbol.SelectedItem.Key
   Do Until Len(s) And mId(s, 1, 1) <> "-"
      s = Arbol.SelectedItem.Parent.Key
   Loop

   If mId(s, 1, 1) = "+" Then
      s = mId(s, 1, 7)
   End If

   Set Nodo = Arbol.SelectedItem
   clave = Nodo.Key
   Clave1 = ""
   Do Until Len(clave) And mId(clave, 1, 1) <> "-" And mId(clave, 1, 1) <> "+"
      If InStr(1, clave, "SubCn2") <> 0 Then
         Clave1 = clave
      End If
      Set Nodo = Nodo.Parent
      clave = Nodo.Key
   Loop
   Set Nodo = Nothing
   If Not ControlAcceso(clave) Or ControlAccesoNivel(clave) >= 9 Then
      MsgBox "El usuario no tiene acceso a esta informacion", vbCritical
      Exit Sub
   End If
         
   Select Case Index
      
      Case 0
         If Len(Clave1) = 0 Then
            MsgBox "Debe posicionarse en el arbol del sistema debajo de la cuenta bancaria"
            Exit Sub
         End If
         
         If ControlAccesoNivel(clave) > EnumAccesos.Medio Then
            MsgBox "Permiso insuficiente para la operacion", vbExclamation
            Exit Sub
         End If
         
         Columnas = VBA.Split(Clave1, " ")
         
         Set oF = New frmConciliacion
         With oF
            .NivelAcceso = EnumAccesos.Alto
            .IdCuentaBancaria = Columnas(1)
            .Id = -1
            .Show , Me
         End With
         
      Case 1
         If ControlAccesoNivel(clave) > EnumAccesos.Medio Then
            MsgBox "Permiso insuficiente para la operacion", vbExclamation
            Exit Sub
         End If
         
         Filas = VBA.Split(Lista.GetString, vbCrLf)
         ColumnasTitulos = VBA.Split(Filas(0), vbTab)
         s = "0"
         For iFilas = LBound(Filas) + 1 To UBound(Filas)
            Columnas = VBA.Split(Filas(iFilas), vbTab)
            If IsNumeric(Columnas(2)) Then
               Aplicacion.Tarea "Valores_MarcarComoConciliado", Columnas(2)
               s = Columnas(3)
            End If
         Next
         
         mFiltro = Lista.Filtrado
         Arbol_NodeClick Arbol.SelectedItem
         If Len(mFiltro) > 0 Then Lista.Filtrado = mFiltro
   
      Case 2
         If ControlAccesoNivel(clave) > EnumAccesos.Medio Then
            MsgBox "Permiso insuficiente para la operacion", vbExclamation
            Exit Sub
         End If
         
         Filas = VBA.Split(Lista.GetString, vbCrLf)
         ColumnasTitulos = VBA.Split(Filas(0), vbTab)
         s = "0"
         For iFilas = LBound(Filas) + 1 To UBound(Filas)
            Columnas = VBA.Split(Filas(iFilas), vbTab)
            If IsNumeric(Columnas(2)) Then
               Aplicacion.Tarea "Valores_DesmarcarConciliacion", Columnas(2)
               s = Columnas(3)
            End If
         Next
   
         mFiltro = Lista.Filtrado
         Arbol_NodeClick Arbol.SelectedItem
         If Len(mFiltro) > 0 Then Lista.Filtrado = mFiltro
   
      Case 3
         If ControlAccesoNivel(clave) > EnumAccesos.Medio Then
            MsgBox "Permiso insuficiente para la operacion", vbExclamation
            Exit Sub
         End If
         
         MarcarValoresComoConfirmados
         
         mFiltro = Lista.Filtrado
         Arbol_NodeClick Arbol.SelectedItem
         If Len(mFiltro) > 0 Then Lista.Filtrado = mFiltro
   
      Case 4
         If ControlAccesoNivel(clave) > EnumAccesos.Medio Then
            MsgBox "Permiso insuficiente para la operacion", vbExclamation
            Exit Sub
         End If
         
         Filas = VBA.Split(Lista.GetString, vbCrLf)
         ColumnasTitulos = VBA.Split(Filas(0), vbTab)
         s = "0"
         For iFilas = LBound(Filas) + 1 To UBound(Filas)
            Columnas = VBA.Split(Filas(iFilas), vbTab)
            If IsNumeric(Columnas(2)) Then
               Aplicacion.Tarea "Valores_DesmarcarConfirmacion", Columnas(2)
               s = Columnas(3)
            End If
         Next
   
         mFiltro = Lista.Filtrado
         Arbol_NodeClick Arbol.SelectedItem
         If Len(mFiltro) > 0 Then Lista.Filtrado = mFiltro
   
   End Select
   
   Set oF = Nothing

End Sub

Private Sub MnuDetA_Click(Index As Integer)

   Dim oF As Form
   Dim s As String, clave As String, mFiltro As String
   Dim iFilas As Integer
   Dim mAuxL1 As Long
   Dim mFecha As Date
   Dim Nodo As Object
   Dim Filas, Columnas, ColumnasTitulos

   s = Arbol.SelectedItem.Key
   Do Until Len(s) And mId(s, 1, 1) <> "-"
      s = Arbol.SelectedItem.Parent.Key
   Loop

   If mId(s, 1, 1) = "+" Then s = mId(s, 1, 7)

   Set Nodo = Arbol.SelectedItem
   clave = Nodo.Key
   Do Until Len(clave) And mId(clave, 1, 1) <> "-" And mId(clave, 1, 1) <> "+"
      Set Nodo = Nodo.Parent
      clave = Nodo.Key
   Loop
   Set Nodo = Nothing
   If Not ControlAcceso(clave) Or ControlAccesoNivel(clave) >= 9 Then
      MsgBox "El usuario no tiene acceso a esta informacion", vbCritical
      Exit Sub
   End If
         
   Select Case Index
      Case 0
         If InStr(1, Lista.ColumnHeaders(1).Text, "Pedido") <> 0 Then
            Set oF = New frmPedidos
            With oF
               .NivelAcceso = ControlAccesoNivel(clave)
               .AccesoParaMail = True
               .Id = Lista.SelectedItem.Tag
               .Disparar = ActL
               .Show , Me
            End With
         ElseIf InStr(1, Lista.ColumnHeaders(1).Text, "Presupuesto") <> 0 Then
            Set oF = New frmPresupuesto
            With oF
               .NivelAcceso = ControlAccesoNivel(clave)
               .AccesoParaMail = True
               .Id = Lista.SelectedItem.Tag
               .Disparar = ActL
               .Show , Me
            End With
         End If
      
      Case 2
         If ControlAccesoNivel(clave) > EnumAccesos.Medio Then
            MsgBox "Permiso insuficiente para la operacion", vbExclamation
            Exit Sub
         End If
         PasarOPaEntregada
         
      Case 3
         If ControlAccesoNivel(clave) > EnumAccesos.Medio Then
            MsgBox "Permiso insuficiente para la operacion", vbExclamation
            Exit Sub
         End If
         
         Filas = VBA.Split(Lista.GetString, vbCrLf)
         s = ""
         For iFilas = LBound(Filas) + 1 To UBound(Filas)
            Columnas = VBA.Split(Filas(iFilas), vbTab)
            If IsNumeric(Columnas(2)) Then Aplicacion.Tarea "OrdenesPago_MarcarComoPendiente", Columnas(2)
         Next
         Set Lista.DataSource = Aplicacion.OrdenesPago.TraerFiltrado("_EnCaja")
         
      Case 4
         If ControlAccesoNivel(clave) > EnumAccesos.Medio Then
            MsgBox "Permiso insuficiente para la operacion", vbExclamation
            Exit Sub
         End If
         
         Filas = VBA.Split(Lista.GetString, vbCrLf)
         s = ""
         For iFilas = LBound(Filas) + 1 To UBound(Filas)
            Columnas = VBA.Split(Filas(iFilas), vbTab)
            If IsNumeric(Columnas(2)) Then Aplicacion.Tarea "OrdenesPago_MarcarComoEnCaja", Columnas(2)
         Next
         Set Lista.DataSource = Aplicacion.OrdenesPago.TraerFiltrado("_ALaFirma")
         
      Case 5
         RegistrosDocumentosAExportar "Pedidos", 17, "NO"
      
      Case 6
         RegistrosDocumentosAExportar "Requerimientos", 1
   
      Case 7
         Dim mSeguro As Integer
         mSeguro = MsgBox("Esta seguro de eliminar los comprobantes ?", vbYesNo, "Eliminacion de comprobantes a confirmar")
         If mSeguro = vbYes Then EliminarComprobantesAConfirmar
         
      Case 8
         Dim mSeguro1 As Integer
         mSeguro1 = MsgBox("Esta seguro de eliminar las RM's ?", vbYesNo, "Eliminacion de RM's a confirmar")
         If mSeguro1 = vbYes Then EliminarRMAConfirmar
         
      Case 9
         RegistrosDocumentosAExportar "Pedidos", 17, "SI"
      
      Case 10
         MarcaImpresion "Marcar", "RM"
   
      Case 11
         MarcaImpresion "Desmarcar", "RM"
   
      Case 12
         MarcaImpresion "Marcar", "PE"
   
      Case 13
         MarcaImpresion "Desmarcar", "PE"
   
      Case 14
         Envio_RM_Proveedores
   
      Case 15
         RegistrarFechaSalidaPedido
   
      Case 16
         EnvioFax_RM_Proveedores
   
      Case 17
         GrabarDetalleRM
      
      Case 18
         If ControlAccesoNivel(clave) > EnumAccesos.Medio Then
            MsgBox "Permiso insuficiente para la operacion", vbExclamation
            Exit Sub
         End If
         
         Filas = VBA.Split(Lista.GetString, vbCrLf)
         s = ""
         For iFilas = LBound(Filas) + 1 To UBound(Filas)
            Columnas = VBA.Split(Filas(iFilas), vbTab)
            If IsNumeric(Columnas(2)) Then Aplicacion.Tarea "OrdenesPago_MarcarComoEnCaja", Array(Columnas(2), "CO")
         Next
         Set Lista.DataSource = Aplicacion.OrdenesPago.TraerFiltrado("_ALaFirma")
   End Select
   
   Set oF = Nothing

End Sub

Private Sub MnuDetAF_Click(Index As Integer)

   EditarConsulta "AF", Index, MnuDetAF(Index).Caption

End Sub

Private Sub MnuDifA_Click(Index As Integer)

   If Not Lista.SelectedItem Is Nothing Then
      
      Dim oL As ListItem
      Dim mTipoEntidad As String
      
      mTipoEntidad = Lista.ColumnHeaders.Item(3).Text
      
      Select Case Index
         Case 0
            Dim oAp As ComPronto.Aplicacion
            Dim oDif As ComPronto.DiferenciaCambio
            Set oAp = Aplicacion
            Set oDif = oAp.DiferenciasCambio.Item(Lista.SelectedItem.Tag)
            oDif.Registro.Fields("Estado").Value = "AN"
            oDif.Guardar
            Set oDif = Nothing
            Lista.ListItems.Remove (Lista.SelectedItem.Index)
            Set oAp = Nothing
         Case 1
'            GenerarDiferenciasCambio Lista
         Case 2
'            Lista.ListItems.Clear
'            Lista.ColumnHeaders.Clear
'            If mTipoEntidad = "Cliente" Then
'               Set Lista.DataSource = Aplicacion.DiferenciasCambio.TraerFiltrado("_PorCobranzasTodos")
'            Else
'               Set Lista.DataSource = Aplicacion.DiferenciasCambio.TraerFiltrado("_PorPagosTodos")
'            End If
'            StatusBar1.Panels(2).Text = "Diferencias de cambio " & Lista.ListItems.Count & " elementos en la lista"
         Case 3
            Lista.ListItems.Clear
            Lista.ColumnHeaders.Clear
            If mTipoEntidad = "Cliente" Then
               Set Lista.DataSource = Aplicacion.DiferenciasCambio.TraerFiltrado("_PorCobranzasPendientes")
            Else
               Set Lista.DataSource = Aplicacion.DiferenciasCambio.TraerFiltrado("_PorPagosPendientes")
            End If
            StatusBar1.Panels(2).Text = "Diferencias de cambio " & Lista.ListItems.Count & " elementos en la lista"
         Case 4
            For Each oL In Lista.ListItems
               If oL.Selected Then oL.SubItems(16) = "SI"
            Next
         Case 5
            For Each oL In Lista.ListItems
               If oL.Selected Then oL.SubItems(16) = "NO"
            Next
         Case 6
            ExportarDiferenciasDeCambioAExcel Lista
      End Select
   End If

End Sub

Private Sub MnuEmiChA_Click(Index As Integer)

   Dim s As String, clave As String
   Dim mFiltro As String
   Dim Nodo As Object
   Dim Filas
   Dim Columnas
   Dim ColumnasTitulos
   Dim oL As ListItem
   Dim iFilas As Integer

   s = Arbol.SelectedItem.Key
   Do Until Len(s) And mId(s, 1, 1) <> "-"
      s = Arbol.SelectedItem.Parent.Key
   Loop

   If mId(s, 1, 1) = "+" Then
      s = mId(s, 1, 7)
   End If

   Set Nodo = Arbol.SelectedItem
   clave = Nodo.Key
   Do Until Len(clave) And mId(clave, 1, 1) <> "-" And mId(clave, 1, 1) <> "+"
      Set Nodo = Nodo.Parent
      clave = Nodo.Key
   Loop
   Set Nodo = Nothing
   If Not ControlAcceso(clave) Or ControlAccesoNivel(clave) >= 9 Then
      MsgBox "El usuario no tiene acceso a esta informacion", vbCritical
      Exit Sub
   End If
         
   Select Case Index
      
      Case 0
         If ControlAccesoNivel(clave) > EnumAccesos.Medio Then
            MsgBox "Permiso insuficiente para la operacion", vbExclamation
            Exit Sub
         End If
         
         EmisionDeCheques
         
      Case 1
         If ControlAccesoNivel(clave) > EnumAccesos.Medio Then
            MsgBox "Permiso insuficiente para la operacion", vbExclamation
            Exit Sub
         End If
         
         Filas = VBA.Split(Lista.GetString, vbCrLf)
         ColumnasTitulos = VBA.Split(Filas(0), vbTab)
         For iFilas = LBound(Filas) + 1 To UBound(Filas)
            Columnas = VBA.Split(Filas(iFilas), vbTab)
            If IsNumeric(Columnas(2)) Then
               Aplicacion.Tarea "Valores_MarcarComoEmitido", Array(Columnas(2), glbIdUsuario)
               For Each oL In Lista.ListItems
                  If oL.ListSubItems(1) = Columnas(2) Then
                     oL.ListSubItems(21) = "SI"
                     oL.ListSubItems(22) = "" & Date
                     oL.ListSubItems(23) = "" & glbNombreUsuario
                     Exit For
                  End If
               Next
            End If
         Next
         
      Case 2
         If ControlAccesoNivel(clave) > EnumAccesos.Medio Then
            MsgBox "Permiso insuficiente para la operacion", vbExclamation
            Exit Sub
         End If
         
         Filas = VBA.Split(Lista.GetString, vbCrLf)
         ColumnasTitulos = VBA.Split(Filas(0), vbTab)
         For iFilas = LBound(Filas) + 1 To UBound(Filas)
            Columnas = VBA.Split(Filas(iFilas), vbTab)
            If IsNumeric(Columnas(2)) Then
               Aplicacion.Tarea "Valores_DesmarcarComoEmitido", Columnas(2)
               For Each oL In Lista.ListItems
                  If oL.ListSubItems(1) = Columnas(2) Then
                     oL.ListSubItems(21) = "NO"
                     oL.ListSubItems(22) = ""
                     oL.ListSubItems(23) = ""
                     Exit For
                  End If
               Next
            End If
         Next
   
      Case 3
         If ControlAccesoNivel(clave) > EnumAccesos.Medio Then
            MsgBox "Permiso insuficiente para la operacion", vbExclamation
            Exit Sub
         End If
         
         Filas = VBA.Split(Lista.GetString, vbCrLf)
         If UBound(Filas) > 2 Then
            MsgBox "Solo puede cambiar un cheque a la vez", vbExclamation
            Exit Sub
         End If
         
         CambiarBeneficiarioCheques Filas
         
   End Select
   
End Sub

Private Sub MnuEmiOP1_Click(Index As Integer)

   Select Case Index
      Case 0
         EmitirOrdenesDePago 0
      Case 1
         EmitirOrdenesDePago 1
      Case 2
         EliminarOrdenesDePago
      Case 3
         MarcarOPEnCaja
      Case 4
         ConfirmarAcreditacionFF
      Case 5
         MarcarOPEnCajaObra
   End Select

End Sub

Private Sub mnuFileA_Click(Index As Integer)

   Select Case Index
      Case 0
         Editar -1
      Case 1
         If Ultimo_Nodo = "Proveedores" Then
            ImprimeProveedores "E"
         Else
            ExportarAExcel Lista
         End If
      Case 2
         If Ultimo_Nodo = "Proveedores" Then
            ImprimeProveedores "I"
         Else
            ImprimirConExcel Lista
         End If
      Case 3
         CopiarAlClipboard
      Case 4
         FiltradoLista Lista
      Case 5
         Unload Me
   End Select

End Sub

Private Sub mnuFncAccA_Click(Index As Integer)

   Select Case Index
      Case 0
         DefinirAccesosItemUsuarios
   End Select

End Sub

Private Sub mnuFncAPSyJA_Click(Index As Integer)

   Select Case Index
      Case 0
         TransferirAnticiposAlPersonalSyJ
   End Select

End Sub

Private Sub mnuFncCGA_Click(Index As Integer)

   Select Case Index
      Case 0
         MarcarCuentasGastoComoActivas "SI"
      Case 1
         MarcarCuentasGastoComoActivas "NO"
   End Select

End Sub

Private Sub mnuFncChkA_Click(Index As Integer)

   Select Case Index
      Case 0
         MarcarChequeComoRechazado
   End Select

End Sub

Private Sub mnuFncCliA_Click(Index As Integer)

   Select Case Index
      Case 0
         MarcarOrdenesCompraComoCumplidas "SI"
      Case 1
         MarcarOrdenesCompraComoCumplidas "NO"
      Case 2
         MarcarOrdenesCompraParaFacturacionAutomatica "SI"
      Case 3
         MarcarOrdenesCompraParaFacturacionAutomatica "NO"
      Case 4
         LiberarOrdenesCompra
   End Select

End Sub

Private Sub mnuFncConjA_Click(Index As Integer)

   Select Case Index
      Case 0
         RecalcularCostoKits
   End Select

End Sub

Private Sub mnuFncCPA_Click(Index As Integer)

   Select Case Index
      Case 0
         RegrabarComprobantesProveedores
      Case 1
         RecalcularGrabarComprobantesProveedores
      Case 2
         DefinirDestinoPagoComprobantesProveedores
      Case 3
         SeleccionarComprobantesProveedores
      Case 4
         DefinirOPFondoReparoComprobantesProveedores
   End Select

End Sub

Private Sub mnuFncCtasA_Click(Index As Integer)

   Select Case Index
      Case 0
         EliminarCuentasContables
   End Select

End Sub

Private Sub mnuFncCuoA_Click(Index As Integer)

   Select Case Index
      Case 0
         EliminarVentaEnCuotas
      Case 1
         ModificarVencimientosVentaEnCuotas
   End Select

End Sub

Private Sub mnuFncFacA_Click(Index As Integer)

   Select Case Index
      Case 0
         EmitirFacturas 0
      Case 1
         EmitirFacturas 1
      Case 2
         EliminarFacturasAnuladas
   End Select

End Sub

Private Sub mnuFncFFA_Click(Index As Integer)

   Select Case Index
      Case 0
         CierreRendicionFF
   
   End Select

End Sub

Private Sub mnuFncNCA_Click(Index As Integer)

   Select Case Index
      Case 0
         EmitirNotasCredito 0
      Case 1
         EmitirNotasCredito 1
   End Select

End Sub

Private Sub mnuFncNDA_Click(Index As Integer)

   Select Case Index
      Case 0
         EmitirNotasDebito 0
      Case 1
         EmitirNotasDebito 1
   End Select

End Sub

Private Sub mnuFncPEA_Click(Index As Integer)

   Select Case Index
      Case 0
         DistribuirTeoricosPorMatrices
   End Select

End Sub

Private Sub mnuFncProvA_Click(Index As Integer)

   Select Case Index
      Case 0
         PasarProveedorEventualADefinitivo
   End Select

End Sub

Private Sub mnuFncRecA_Click(Index As Integer)

   Select Case Index
      Case 0
         EmitirRecibos 0
      Case 1
         EmitirRecibos 1
   End Select

End Sub

Private Sub mnuFncRubrosA_Click(Index As Integer)

   If Lista.SelectedItem Is Nothing Then Exit Sub
   Select Case Index
      Case 0
         AsignarMascaras Lista.SelectedItem.Tag, 0
   End Select

End Sub

Private Sub mnuFncSubrubrosA_Click(Index As Integer)

   If Lista.SelectedItem Is Nothing Then Exit Sub
   Select Case Index
      Case 0
         AsignarMascaras 0, Lista.SelectedItem.Tag
   End Select

End Sub

Private Sub MnuObrasA_Click(Index As Integer)

   Select Case Index
      Case 0
         EmitirDatosObra 0
      Case 1
         EmitirDatosObra 1
      Case 2
         EmitirCertificadoDeServicios Lista.GetString
   End Select

End Sub

Private Sub MnuSeg_Click(Index As Integer)

   Dim oF As Form
   Dim oArbol As Object
   Dim mAcceder As Integer
   Dim mModal As Boolean
   
   Select Case Index
      Case 0
         If Not glbAdministrador Then
            mAcceder = MsgBox("Para ingresar a este modulo debe tener permiso de ADMINISTRADOR" & vbCrLf & "Desea login de supervisores ?", vbYesNo, "Acceso a supervisores")
            If mAcceder = vbNo Then
               Exit Sub
            End If
            If Not DefinirAdministrador Then
               MsgBox "Para ingresar a este modulo debe tener permiso de ADMINISTRADOR", vbCritical
               Exit Sub
            End If
         End If
         Set oArbol = ArbolDefault
         Set oF = New frmAccesos
         With oF
            .Id = glbIdUsuario
            .ParentArbol = oArbol
            Set .ParentForm = Me
            .Show vbModal, Me
         End With
         mModal = True
      Case 1
         If Not glbAdministrador Then
            mAcceder = MsgBox("Para ingresar a este modulo debe tener permiso de ADMINISTRADOR" & vbCrLf & "Desea login de supervisores ?", vbYesNo, "Acceso a supervisores")
            If mAcceder = vbNo Then
               Exit Sub
            End If
            If Not DefinirAdministrador Then
               MsgBox "Para ingresar a este modulo debe tener permiso de ADMINISTRADOR", vbCritical
               Exit Sub
            End If
         End If
         Set oArbol = Arbol
         Set oF = New frmAutorizaciones
         With oF
            .Show vbModal, Me
         End With
         mModal = True
      Case 2
         Set oF = New frmAutorizacionesArbol
         With oF
            .Show , Me
         End With
         mModal = False
      Case 3
         Set oF = New frmConsulta2
         With oF
            .Id = 1
            .Show , Me
         End With
         mModal = False
      Case 4
         Set oF = New frmConsulta2
         With oF
            .Id = 2
            .Show , Me
         End With
         mModal = False
      Case 5
         Set oF = New frmEventosDelSistema
         With oF
            .Show , Me
         End With
         mModal = False
      Case 6
         VerNovedades = True
         VerNovedadesEventos
      Case 7
         If Not glbAdministrador Then
            mAcceder = MsgBox("Para ingresar a este modulo debe tener permiso de ADMINISTRADOR" & vbCrLf & "Desea login de supervisores ?", vbYesNo, "Acceso a supervisores")
            If mAcceder = vbNo Then
               Exit Sub
            End If
            If Not DefinirAdministrador Then
               MsgBox "Para ingresar a este modulo debe tener permiso de ADMINISTRADOR", vbCritical
               Exit Sub
            End If
         End If
         Set oF = New frmDefinicionAnulaciones
         With oF
            .Show , Me
         End With
         mModal = False
      Case 8
         Set oF = New frmConsulta3
         With oF
            .Id = 106
            .Show , Me
         End With
         mModal = False
      Case 9
         If Not glbAdministrador Then
            mAcceder = MsgBox("Para ingresar a este modulo debe tener permiso de ADMINISTRADOR" & vbCrLf & "Desea login de supervisores ?", vbYesNo, "Acceso a supervisores")
            If mAcceder = vbNo Then
               Exit Sub
            End If
            If Not DefinirAdministrador Then
               MsgBox "Para ingresar a este modulo debe tener permiso de ADMINISTRADOR", vbCritical
               Exit Sub
            End If
         End If
         Set oF = New frmProntoIni
         With oF
            .Show , Me
         End With
         mModal = False
   End Select

   If mModal Then Unload oF
   Set oF = Nothing
   Set oArbol = Nothing
   
   If Index <= 1 Then
      CargarPermisos
      CargarArbol
      CargarPopUpMenu
   End If

End Sub

Private Sub MnuSubA_Click(Index As Integer)

   EditarConsulta "A", Index, MnuSubA(Index).Caption

End Sub

Private Sub MnuSubBco_Click(Index As Integer)

   EditarConsulta "Bco", Index

End Sub

Private Sub MnuSubC_Click(Index As Integer)

   EditarConsulta "C", Index, MnuSubC(Index).Caption

End Sub

Private Sub MnuSubCli_Click(Index As Integer)

   EditarConsulta "Cli", Index

End Sub

Private Sub MnuSubCliRet_Click(Index As Integer)

   EditarConsulta "CliRet", Index

End Sub

Private Sub MnuSubCliRetSIC_Click(Index As Integer)

   EditarConsulta "CliRetSIC", Index

End Sub

Private Sub MnuSubCo_Click(Index As Integer)

   EditarConsulta "Co", Index

End Sub

Private Sub MnuSubCoA_Click(Index As Integer)

   Select Case Index
      Case 0
         Dim oF As frmDefinicionCuadroIngresosEgresos
         Set oF = New frmDefinicionCuadroIngresosEgresos
         With oF
            .Show vbModal, Me
         End With
         Unload oF
         Set oF = Nothing
      Case 1
         EditarConsulta "SubCoA", Index
   End Select

End Sub

Private Sub MnuSubCoB_Click(Index As Integer)

   Select Case Index
      Case 0
         Dim oF As frmDefinicionFlujoCaja
         Set oF = New frmDefinicionFlujoCaja
         With oF
            .Id = -1
            .Show vbModal, Me
         End With
         Unload oF
         Set oF = Nothing
      Case Else
         EditarConsulta "SubCoB", Index, MnuSubCoB(Index).Caption
   End Select

End Sub

Private Sub MnuSubCoC_Click(Index As Integer)

   EditarConsulta "SubCoC", Index, MnuSubCoC(Index).Caption

End Sub

Private Sub MnuSubCom_Click(Index As Integer)

   EditarConsulta "Com", Index

End Sub

Private Sub MnuSubF_Click(Index As Integer)

   EditarConsulta "F", Index, MnuSubF(Index).Caption

End Sub

Private Sub MnuSubO_Click(Index As Integer)

   EditarConsulta "O", Index

End Sub

Private Sub MnuSubP_Click(Index As Integer)

   EditarConsulta "P", Index, MnuSubP(Index).Caption

End Sub

Private Sub MnuSubPer_Click(Index As Integer)

   EditarConsulta "Per", Index

End Sub

Private Sub MnuSubPrv_Click(Index As Integer)

   EditarConsulta "Prv", Index, MnuSubPrv(Index).Caption

End Sub

Private Sub MnuSubPrvRet_Click(Index As Integer)

   EditarConsulta "PrvRet", Index

End Sub

Private Sub MnuSubPrvRetSIC_Click(Index As Integer)

   EditarConsulta "PrvRetSIC", Index

End Sub

Private Sub MnuSubPrvRetSIF_Click(Index As Integer)

   EditarConsulta "PrvRetSIF", Index

End Sub

Private Sub MnuSubS_Click(Index As Integer)

   EditarConsulta "S", Index

End Sub

Private Sub Form_Initialize()

   InitCommonControls

End Sub

Private Sub Form_Activate()

   If VerNovedades Then
      Me.WindowState = vbMaximized
      VerNovedadesEventos
   End If
   
End Sub

Private Sub Form_Load()

'   On Error Resume Next

   Dim lReturn As Long

   mLOCALE_SMONDECIMALSEP = GetRegionalSetting(LOCALE_SMONDECIMALSEP)
   If mLOCALE_SMONDECIMALSEP <> "." Then
      lReturn = SetLocaleInfo(LOCALE_USER_DEFAULT, LOCALE_SMONDECIMALSEP, ".")
   End If

   mLOCALE_SMONTHOUSANDSEP = GetRegionalSetting(LOCALE_SMONTHOUSANDSEP)
   If mLOCALE_SMONTHOUSANDSEP <> "," Then
      lReturn = SetLocaleInfo(LOCALE_USER_DEFAULT, LOCALE_SMONTHOUSANDSEP, ",")
   End If

   mLOCALE_SDECIMAL = GetRegionalSetting(LOCALE_SDECIMAL)
   If mLOCALE_SDECIMAL <> "." Then
      lReturn = SetLocaleInfo(LOCALE_USER_DEFAULT, LOCALE_SDECIMAL, ".")
   End If

   mLOCALE_STHOUSAND = GetRegionalSetting(LOCALE_STHOUSAND)
   If mLOCALE_STHOUSAND <> "," Then
      lReturn = SetLocaleInfo(LOCALE_USER_DEFAULT, LOCALE_STHOUSAND, ",")
   End If

   AnalizarStringConnection
   
'   Dim mArchivoDefinicionConexion As String
'   Dim mvarDefineConexion As Integer
'   Dim mOK As Boolean
'   mArchivoDefinicionConexion = Dir(GetWinDir & "\" & App.Title, vbArchive)
'   If mArchivoDefinicionConexion = "" Then
'      mvarDefineConexion = MsgBox("No existe definicion de acceso a la base de datos del sistema." & vbCrLf & _
'                                    "Desea definirla ahora?", vbYesNo, "Conexion a la base de datos")
'      If mvarDefineConexion = vbNo Then
'         End
'      End If
'      Dim of As frmInicial
'      Set of = New frmInicial
'      With of
'         .Show vbModal, Me
'         mOK = .Ok
'      End With
'      Unload of
'      Set of = Nothing
'      If Not mOK Then
'         End
'      End If
'   End If
   
   Dim success%
   Dim iStatusBarWidth As Integer
   
'   On Error GoTo SplashLoadErr
   
   glbMenuPopUpCargado = False
   glbMenuPopUpCargado1 = False
   glbModoAccesosUsuarios = False
   VerNovedades = True
   iStatusBarWidth = 4575
   gblMaximaLongitudAdjuntos = 100

   Dim oAp As ComPronto.Aplicacion
   Dim oRs As ADOR.Recordset
   Dim i As Integer, SN As Integer
   Dim mAux1 As String
   Dim mAux
   
   'Creamos un objeto para utilizar Wmi para los procesos
   'Set obj_Wmi = GetObject("winmgmts:")
   
   Set Aplicacion = CreateObject("ComPronto.Aplicacion")
   Aplicacion.StringConexion = glbStringConexion
   
   Set oAp = Aplicacion
   Set ActL = New ControlForm
   
   Set oRs = oAp.Parametros.Item(1).Registro
   glbArchivoAyuda = IIf(IsNull(oRs.Fields("ArchivoAyuda").Value), "", oRs.Fields("ArchivoAyuda").Value)
   If IsNull(oRs.Fields("PathPlantillas").Value) Or Len(oRs.Fields("PathPlantillas").Value) = 0 Then
      glbPathPlantillas = App.Path & "\Plantillas"
   Else
      glbPathPlantillas = oRs.Fields("PathPlantillas").Value
   End If
   glbActivarCircuitoChequesDiferidos = IIf(IsNull(oRs.Fields("ActivarCircuitoChequesDiferidos").Value), "NO", oRs.Fields("ActivarCircuitoChequesDiferidos").Value)
   glbBasePRONTOSyJAsociada = IIf(IsNull(oRs.Fields("BasePRONTOSyJAsociada").Value), "", oRs.Fields("BasePRONTOSyJAsociada").Value)
   glbActivarSolicitudMateriales = IIf(IsNull(oRs.Fields("ActivarSolicitudMateriales").Value), "NO", oRs.Fields("ActivarSolicitudMateriales").Value)
   oRs.Close
   
   Screen.MousePointer = vbHourglass
   Load Splash
   Splash.Show
   DoEvents
   ' Establece que la pantalla de impacto permanezca en primer plano.
   success% = SetWindowPos(Splash.hwnd, HWND_TOPMOST, 0, 0, 0, 0, Flags)
   
   DoEvents
   Splash.rctStatusBar.Width = iStatusBarWidth * 0.125

   mAux = TraerValorParametro2("Lenguaje")
   glbIdiomaActual = IIf(IsNull(mAux), "esp", mAux)
   
   mAux = TraerValorParametro2("TopeMonotributoAnual_Bienes")
   glbTopeMonotributoAnual_Bienes = 0
   If Not IsNull(mAux) Then glbTopeMonotributoAnual_Bienes = CDbl(mAux)
   
   mAux = TraerValorParametro2("TopeMonotributoAnual_Servicios")
   glbTopeMonotributoAnual_Servicios = 0
   If Not IsNull(mAux) Then glbTopeMonotributoAnual_Servicios = CDbl(mAux)
   
   mAux = TraerValorParametro2("UsarPartidasParaStock")
   glbUsarPartidasParaStock = False
   If IIf(IsNull(mAux), "NO", mAux) = "SI" Then glbUsarPartidasParaStock = True
   
   mAux = TraerValorParametro2("ModeloContableSinApertura")
'   glbModeloContableSinApertura = IIf(IsNull(mAux), "NO", mAux)
   
   mAux = TraerValorParametro2("DebugFacturaElectronica")
  ' glbDebugFacturaElectronica = False
   'If IIf(IsNull(mAux), "NO", mAux) = "SI" Then glbDebugFacturaElectronica = True
   
   With Lista
      Set .Icons = img32
      Set .SmallIcons = Img16
   End With
   
   Set mnuVerP(0) = mnuViewA(0)
   Set mnuVerP(1) = mnuViewA(1)
   Set mnuVerP(2) = mnuViewA(2)
   Set mnuVerP(3) = mnuViewA(3)
   
   DoEvents
   Splash.rctStatusBar.Width = iStatusBarWidth * 0.25

'   Set oRs = oAp.Articulos.TraerFiltrado("_ParaMenu")
'   GrabarMenu oRs
'   oRs.Close
   
   Set oRs = oAp.TablasGenerales.TraerFiltrado("Empresa", "_Datos")
   With oRs
      If .RecordCount > 0 Then
         glbEmpresa = IIf(IsNull(.Fields("Nombre").Value), "", .Fields("Nombre").Value)
         glbDetalleNombre = IIf(IsNull(.Fields("DetalleNombre").Value), "", .Fields("DetalleNombre").Value)
         glbDireccion = IIf(IsNull(.Fields("Direccion").Value), "", .Fields("Direccion").Value)
         glbLocalidad = IIf(IsNull(.Fields("Localidad").Value), "", .Fields("Localidad").Value)
         glbCodigoPostal = IIf(IsNull(.Fields("CodigoPostal").Value), "", .Fields("CodigoPostal").Value)
         glbProvincia = IIf(IsNull(.Fields("Provincia").Value), "", .Fields("Provincia").Value)
         glbTelefono1 = IIf(IsNull(.Fields("Telefono1").Value), "", .Fields("Telefono1").Value)
         glbTelefono2 = IIf(IsNull(.Fields("Telefono2").Value), "", .Fields("Telefono2").Value)
         glbEmail = IIf(IsNull(.Fields("Email").Value), "", .Fields("Email").Value)
         glbCuit = IIf(IsNull(.Fields("Cuit").Value), "", .Fields("Cuit").Value)
         glbCondicionIva = IIf(IsNull(.Fields("CondicionIva").Value), "", .Fields("CondicionIva").Value)
         glbDatosAdicionales1 = IIf(IsNull(.Fields("DatosAdicionales1").Value), "", .Fields("DatosAdicionales1").Value)
         glbDatosAdicionales2 = IIf(IsNull(.Fields("DatosAdicionales2").Value), "", .Fields("DatosAdicionales2").Value)
         glbDatosAdicionales3 = IIf(IsNull(.Fields("DatosAdicionales3").Value), "", .Fields("DatosAdicionales3").Value)
         glbIdCodigoIva = IIf(IsNull(.Fields("IdCodigoIva").Value), 1, .Fields("IdCodigoIva").Value)
         glbArchivoAFIP = IIf(IsNull(.Fields("ArchivoAFIP").Value), "", .Fields("ArchivoAFIP").Value)
         'glbModalidadFacturacionAPrueba = False
         If IIf(IsNull(.Fields("ModalidadFacturacionAPrueba").Value), "", .Fields("ModalidadFacturacionAPrueba").Value) = "SI" Then
            'glbModalidadFacturacionAPrueba = True
         End If
      End If
   End With
   oRs.Close
   
   Set oRs = oAp.TablasGenerales.TraerFiltrado("BD", "_Host")
   gblHOST = ""
   If oRs.RecordCount > 0 Then
      gblHOST = oRs.Fields(0).Value
   End If
   oRs.Close
   
   Set oRs = oAp.TablasGenerales.TraerFiltrado("BD", "_BaseDeDatos")
   gblBD = ""
   If oRs.RecordCount > 0 Then
      gblBD = oRs.Fields(0).Value
   End If
   oRs.Close
   
   StatusBar1.Panels.Item(2).Text = "Host : " & gblHOST & " - BD : " & gblBD
   
   With Me
      .WindowState = GetSetting(App.EXEName, "Ppal", "EstadoVentana", vbMaximized)
      If .WindowState = vbNormal Then
         .Left = GetSetting(App.EXEName, "Ppal", "Izq", 0)
         .Top = GetSetting(App.EXEName, "Ppal", "Arriba", 0)
         .Width = GetSetting(App.EXEName, "Ppal", "Ancho", Screen.Width)
         .Height = GetSetting(App.EXEName, "Ppal", "Alto", Screen.Height)
      End If
   End With
   
   DoEvents
   Splash.rctStatusBar.Width = iStatusBarWidth * 0.5

   CambiarVista lvwReport
   
   UsuarioSistema = GetCurrentUserName()
   UsuarioSistema = mId(UsuarioSistema, 1, Len(UsuarioSistema) - 1)
   UsuarioSistema1 = UsuarioSistema
   glbAdministrador = False
   glbInicialesUsuario = ""
   glbIdSector = 0
   glbTipoUsuario = 1
   glbLegajo = 0
   glbIdUsuario = -1
   glbIdCuentaFFUsuario = -1
   glbIdObraAsignadaUsuario = -1
   Set oRs = oAp.Empleados.TraerFiltrado("_usuarioNT", UsuarioSistema)
   With oRs
      If .RecordCount > 0 Then
         UsuarioSistema = UsuarioSistema & " [ " & IIf(IsNull(.Fields("Nombre").Value), " ", .Fields("Nombre").Value) & " ]"
         glbNombreUsuario = .Fields("Nombre").Value
         glbIdUsuario = oRs.Fields(0).Value
         glbInicialesUsuario = IIf(IsNull(oRs.Fields("Iniciales").Value), "", oRs.Fields("Iniciales").Value)
         glbIdSector = IIf(IsNull(oRs.Fields("IdSector").Value), 0, oRs.Fields("IdSector").Value)
         glbLegajo = IIf(IsNull(oRs.Fields("Legajo").Value), 0, oRs.Fields("Legajo").Value)
         If Not IsNull(oRs.Fields("Administrador").Value) Then
            If oRs.Fields("Administrador").Value = "SI" Then glbAdministrador = True
         End If
         glbTipoUsuario = IIf(IsNull(oRs.Fields("TipoUsuario").Value), 1, oRs.Fields("TipoUsuario").Value)
         glbIdCuentaFFUsuario = IIf(IsNull(oRs.Fields("IdCuentaFondoFijo").Value), -1, oRs.Fields("IdCuentaFondoFijo").Value)
         glbIdObraAsignadaUsuario = IIf(IsNull(oRs.Fields("IdObraAsignada").Value), -1, oRs.Fields("IdObraAsignada").Value)
         If Not IsNull(oRs.Fields("Idioma").Value) And Len(oRs.Fields("Idioma").Value) > 0 Then
            glbIdiomaActual = oRs.Fields("Idioma").Value
         End If
      Else
         .Close
         MsgBox "El usuario " & UsuarioSistema & " no esta definido en el sistema PRONTO" & vbCrLf & "Consulte con el administrador del sistema.", vbCritical
         Unload Me
         End
      End If
      .Close
   End With
   StatusBar1.Panels.Item(1).Text = "Usuario actual : " & UsuarioSistema
   
   DoEvents
   Splash.rctStatusBar.Width = iStatusBarWidth * 0.75

   Set oRs = Aplicacion.TablasGenerales.TraerFiltrado("ProntoIni", "_T", Array(glbIdUsuario, -1))
   If oRs.RecordCount = 0 Then
      If glbAdministrador Then
         MsgBox "El usuario " & glbNombreUsuario & ", no tiene creadas claves de operacion (Pronto.ini)." & vbCrLf & _
               "Esto es solo un aviso.", vbCritical
      Else
         MsgBox "El usuario " & glbNombreUsuario & ", no tiene creadas claves de operacion (Pronto.ini)." & vbCrLf & _
               "Avise al administrador del sistema para que las habilite antes de acceder con este usuario", vbCritical
         oRs.Close
         Set oRs = Nothing
         Unload Me
         End
      End If
   End If
   oRs.Close
   
   'Establece niveles de menus descolgables
   Dim oCtrl As Control
   Dim mNiv As Integer
   For Each oCtrl In Me.Controls
      If TypeOf oCtrl Is Menu Then
         Select Case oCtrl.Name
            Case "mnuMaster"
               mNiv = 1
            Case "mnuFileA", "mnuViewA", "MnuSub", "MnuInf", "MnuSeg", "MnuUti", "MnuAyuda"
               mNiv = 2
            Case "MnuSubA", "MnuSubCompras", "MnuSubF", "MnuSubO", "MnuSubP", _
                  "MnuSubS", "MnuSubCo", "MnuSubCom", "MnuInfA", "MnuInfCC", _
                  "MnuInfC", "MnuSubPer", "MnuSubCli", "MnuSubBco", "MnuSubC", _
                  "MnuSubPrv", "MnuUtiImp", "MnuUtiPRONTO"
               mNiv = 3
            Case "MnuSubPrvRet", "MnuSubCliRet", "MnuSubCoA", "MnuSubCoB", "MnuSubCoC"
               mNiv = 4
            Case Else
               mNiv = -1
         End Select
         If mNiv > 0 Then oCtrl.Tag = mNiv
      End If
   Next
   
   CargarPermisos
   CargarArbol
   CargarPopUpMenu
   'CargaPopUpMenu2
   'CargaPopUpMenu3
   
   Set oRs = oAp.Parametros.Item(1).Registro
   glbIdMonedaDolar = -1
   If Not IsNull(oRs.Fields("IdMonedaDolar").Value) Then
      glbIdMonedaPesos = IIf(IsNull(oRs.Fields("IdMoneda").Value), 1, oRs.Fields("IdMoneda").Value)
      glbIdMonedaDolar = IIf(IsNull(oRs.Fields("IdMonedaDolar").Value), 2, oRs.Fields("IdMonedaDolar").Value)
      glbIdMonedaEuro = IIf(IsNull(oRs.Fields("IdMonedaEuro").Value), 6, oRs.Fields("IdMonedaEuro").Value)
      If Not IsNull(oRs.Fields("FechaUltimoCierre").Value) Then
         gblFechaUltimoCierre = oRs.Fields("FechaUltimoCierre").Value
      Else
         gblFechaUltimoCierre = DateSerial(1980, 1, 1)
      End If
   End If
   oRs.Close
   
   DoEvents
   Splash.rctStatusBar.Width = iStatusBarWidth * 0.85

   mAux1 = BuscarClaveINI("Parametrizacion de Nivel 1")
   glbParametrizacionNivel1 = False
   If mAux1 = "SI" Then glbParametrizacionNivel1 = True
   
   mAux1 = BuscarClaveINI("Sonido de navegacion")
   glbSonidoNavegacion = False
   If mAux1 = "SI" Then glbSonidoNavegacion = True

   mAux1 = BuscarClaveINI("Ver pedidos historicos")
   VerPedidosHistoricos = False
   If mAux1 = "SI" Then VerPedidosHistoricos = True
   
   mAux1 = BuscarClaveINI("Señal global 1")
   glbSeñal1 = False
   If mAux1 = "SI" Then glbSeñal1 = True
   
   mAux1 = BuscarClaveINI("Ingreso de comprobantes en serie")
   glbCargaEnSerie = False
   If mAux1 = "SI" Then glbCargaEnSerie = True
   
   mAux1 = BuscarClaveINI1("Permitir consolidacion")
   glbConsolidar = False
   If mAux1 = "SI" Then Check1.Visible = True
   
   mAux1 = BuscarClaveINI("Filtrar informacion por vendedor")
   glbIdVendedor = -1
   If mAux1 = "SI" Then
      Set oRs = Aplicacion.Vendedores.TraerFiltrado("_PorUsuario", glbIdUsuario)
      If oRs.RecordCount > 0 Then glbIdVendedor = oRs.Fields(0).Value
      oRs.Close
   End If
   
   mAux1 = BuscarClaveINI("Control Host")
   If IsNumeric(mAux1) Then
      If Val(mAux1) > 0 Then
         With Timer1
            .Enabled = True
            .Interval = Val(mAux1)
         End With
      End If
   End If
   
   mAux1 = BuscarClaveINI("Terminar procesos Office")
   'glbTerminarProcesosOffice = False
   'If mAux1 = "SI" Then glbTerminarProcesosOffice = True
   
   GenerarMensajesPorControlDeStock
   
   'Sonido App.Path & "\Inicio.wav"

   DoEvents
   Splash.rctStatusBar.Width = iStatusBarWidth

   ' Desactiva el indicador de primer plano de la ventana.
   success% = SetWindowPos(Splash.hwnd, HWND_NOTOPMOST, 0, 0, 0, 0, Flags)
   Unload Splash
   Screen.MousePointer = vbDefault
  
   Me.Caption = "" & glbEmpresaSegunString & " Administracion (Version " & App.Major & "." & App.Minor & "." & App.Revision & ")"
   
   Lista.StringConexion = glbStringConexion
   
   Set oRs = Nothing
   Set oAp = Nothing

   If glbAdministrador And BuscarClaveINI("Activar control de acceso por item-usuario") = "SI" Then
      Toolbar1.Buttons("AccesoPorUsuarios").Visible = True
   Else
      Toolbar1.Buttons("AccesoPorUsuarios").Visible = False
   End If

   If BuscarClaveINI("SQL2005") = "SI" Then
      glbDtsExec = "Dtexec"
      glbDtsExt = "dtsx"
   Else
      glbDtsExec = "Dtsrun"
      glbDtsExt = "dts"
   End If
   
   glbPermitirModificacionTabulados = True
   
   ReemplazarEtiquetas Me
   
   CambiarLenguaje Me, "esp", glbIdiomaActual, ""
   
   Aplicacion.Tarea "Log_InsertarRegistro", Array("ING", 0, 0, Now, 0, _
         "Usuario (" & glbIdUsuario & ") " & glbNombreUsuario & ", Version " & _
         App.Major & " " & App.Minor & " " & App.Revision, _
         GetCompName(), glbNombreUsuario, "Pronto " & App.Major & " " & App.Minor & " " & App.Revision, _
         "Usuario NT : " & UsuarioSistema1, UsuarioSistema1, _
         Null, Null, Null, Null, Null, glbIdUsuario, Null, Null, Null, Null)

'SplashLoadErr:
'  success% = SetWindowPos(Splash.hWnd, HWND_NOTOPMOST, 0, 0, 0, 0, FLAGS)
'  Unload Splash
'  Screen.MousePointer = vbDefault
'  MsgBox Error$ & " - " & Str$(Err), vbExclamation, "Error al cargar la aplicación"
'  Exit Sub

End Sub

Private Sub Form_Resize()

   Ajustar

End Sub

Private Sub Form_Unload(Cancel As Integer)

   With Me
      SaveSetting App.EXEName, "Ppal", "EstadoVentana", .WindowState
      If .WindowState = vbNormal Then
         SaveSetting App.EXEName, "Ppal", "Izq", .Left
         SaveSetting App.EXEName, "Ppal", "Arriba", .Top
         SaveSetting App.EXEName, "Ppal", "Ancho", .Width
         SaveSetting App.EXEName, "Ppal", "Alto", .Height
      End If
   End With
   
   SaveSetting App.EXEName, "Ppal", "Vista", Lista.View
   
   Set ActL = Nothing
   Set Aplicacion = Nothing
   Set UltimoNodoSeleccionado = Nothing
   'Set obj_Wmi = Nothing
   
   Dim lReturn As Long

   If GetRegionalSetting(LOCALE_SMONDECIMALSEP) <> mLOCALE_SMONDECIMALSEP Then
      lReturn = SetLocaleInfo(LOCALE_USER_DEFAULT, LOCALE_SMONDECIMALSEP, mLOCALE_SMONDECIMALSEP)
   End If

   If GetRegionalSetting(LOCALE_SMONTHOUSANDSEP) <> mLOCALE_SMONTHOUSANDSEP Then
      lReturn = SetLocaleInfo(LOCALE_USER_DEFAULT, LOCALE_SMONTHOUSANDSEP, mLOCALE_SMONTHOUSANDSEP)
   End If

   If GetRegionalSetting(LOCALE_SDECIMAL) <> mLOCALE_SDECIMAL Then
      lReturn = SetLocaleInfo(LOCALE_USER_DEFAULT, LOCALE_SDECIMAL, mLOCALE_SDECIMAL)
   End If

   If GetRegionalSetting(LOCALE_STHOUSAND) <> mLOCALE_STHOUSAND Then
      lReturn = SetLocaleInfo(LOCALE_USER_DEFAULT, LOCALE_STHOUSAND, mLOCALE_STHOUSAND)
   End If
   
   DestroyMenu POP_hMenu
   Set cPMenu = Nothing

End Sub

Private Sub MnuSubSAT_Click(Index As Integer)

   EditarConsulta "SAT", Index

End Sub

Private Sub MnuUti_Click(Index As Integer)

   Dim oF As Form
   
   If Index > 1 Then
      Select Case Index
         Case 2
            GeneracionDeFacturasAnuladas
         Case 3
            GeneracionDeFacturasAnuladasExistentes
         Case 4
            Set oF = New frmConsulta2
            With oF
               .Id = 74
               .Show vbModal, Me
            End With
            Set oF = Nothing
         Case 5
            GeneracionDeFacturasDesdeOrdenesCompraAutomaticas
         Case 6
            EditarConsulta "Uti", 6, MnuUti(6).Caption
         Case 7
            ImportacionInformacionImpositiva
         Case 8
            DefinicionBasesParaConsolidacion
         Case 9
            ConsolidacionContable
         Case 10
            CierreZ
         Case 11
            DefinirGruposCuentasParaAjusteEnSubdiarios
         Case 12
            Set oF = New frmConsulta3
            With oF
               .Id = 12
               .Show vbModal, Me
            End With
            Set oF = Nothing
         Case 13
            Set oF = New frmCambiosUbicaciones
            With oF
               .Show , Me
            End With
            Set oF = Nothing
         Case 14
            Set oF = New frmConsulta3
            With oF
               .Id = 19
               .Show vbModal, Me
            End With
            Set oF = Nothing
         Case 15
            ImportacionAsientos2
      End Select
   End If

End Sub

Private Sub MnuUtiImp_Click(Index As Integer)

   Dim oRs As ADOR.Recordset
   Dim mAuxS1 As String
   
   Select Case Index
      Case 0
         Dim oF As Form
         Dim mSeguro As Integer
         mSeguro = MsgBox("ANTES DE COMENZAR EL PROCESO VERIFIQUE QUE PRESTO" & vbCrLf & _
                           "SOLO TENGA LA VENTANA DE PRECIOS ABIERTA, SI NO ESTA" & vbCrLf & _
                           "SEGURO LLAME AHORA A PRESTO, ABRA LA OBRA Y CIERRE" & vbCrLf & _
                           "TODAS LAS VENTANAS SALVO LA DE PRECIOS." & vbCrLf & _
                           "CONTINUA CON EL PROCEDIMIENTO ?", vbYesNo, "PRESTO")
         If mSeguro = vbYes Then
            'Set oRs = ImportarDatosDesdePresto
            Set oRs = LeerPresto
            If Not oRs Is Nothing Then
               If oRs.RecordCount > 0 Then
                  Set oF = New frmConsulta1
                  With oF
                     Set .RecordsetFuente = oRs
                     .Id = 10
                     .Show vbModal, Me
                  End With
               Else
                  MsgBox "Proceso completo", vbInformation
               End If
               Set oRs = Nothing
            End If
            Me.WindowState = vbMaximized
         End If
      Case 1
         Set oRs = ImportarDatosDesdePrestoAccess
         If Not oRs Is Nothing Then
            If oRs.RecordCount > 0 Then
               Set oF = New frmConsulta1
               With oF
                  Set .RecordsetFuente = oRs
                  .Id = 10
                  .Show vbModal, Me
               End With
            Else
               MsgBox "Proceso completo", vbInformation
            End If
            Set oRs = Nothing
         End If
         Me.WindowState = vbMaximized
      Case 2
         Set oF = New frmImportarDATANET
         With oF
            .Show vbModal, Me
         End With
      Case 3
         ImportacionConjuntos
      Case 4
         ImportacionValores
      Case 5
         If BuscarClaveINI("Modelo de importacion de efectivo") <> "02" Then
            ImportacionEfectivo
         Else
            ImportacionEfectivo1
         End If
      Case 6
         ImportacionCobranzas
      Case 7
         ImportacionCobranzasPagoFacil
      Case 8
         If BuscarClaveINI("Modelo de importacion de comprobantes de proveedores") = "01" Then
            ImportacionComprobantesProveedores2
         Else
            ImportacionComprobantesProveedores
         End If
      Case 9
         mAuxS1 = BuscarClaveINI("Modelo de importacion de comprobantes de fondo fijo")
         If mAuxS1 = "02" Then
            ImportacionComprobantesFondoFijo1
         ElseIf mAuxS1 = "03" Then
            ImportacionComprobantesFondoFijo2
         Else
            ImportacionComprobantesFondoFijo
         End If
      Case 10
         ImportacionOrdenesPago
      Case 11
         ImportacionRequerimientos
      Case 12
         ImportacionArticulos
      Case 13
         ImportacionComprobantesProveedores1
      Case 14
         If BuscarClaveINI("Modelo de importacion de asientos") <> "03" Then
            ImportacionAsientos
         Else
            ImportacionAsientos1
         End If
      Case 15
         ImportacionNotasDebito
      Case 16
         ImportacionCobranzasSantanderRio
      Case 17
         ImportacionProveedores
      Case 18
         If BuscarClaveINI("Modelo de importacion de comprobantes de ventas") = "01" Then
            ImportacionComprobantesVenta2
         Else
            ImportacionComprobantesVenta
         End If
      Case 19
         ImportacionAjustesStock
      Case 20
         ImportacionSalidaMateriales
   End Select

End Sub

Private Sub MnuUtiPRONTO_Click(Index As Integer)

   Select Case Index
      Case 0
         EnviarNovedades_PRONTO_SAT
      Case 1
         Dim oF As Form
         Set oF = New frmEnviarASat
         oF.Show , Me
         Set oF = Nothing
      Case 2
         ImportarNovedades_PRONTO_SAT
      Case 3
         EnviarNovedades_PRONTO_MANTENIMIENTO
      Case 4
         ExportarComprobantesXML
      Case 5
         EnviarNovedades_PRONTO
      Case 6
         ImportarNovedades_PRONTO
      Case 7
         EnviarNovedades_PRONTO_BALANZA
      Case 8
         ImportarNovedades_PRONTO_BALANZA
      Case 9
         GenerarNovedades_Presto
   End Select

End Sub

Private Sub mnuViewA_Click(Index As Integer)

   Select Case Index
      Case 0
         CambiarVista lvwIcon
      Case 1
         CambiarVista lvwSmallIcon
      Case 2
         CambiarVista lvwList
      Case 3
         CambiarVista lvwReport
   End Select
   
End Sub

Private Sub Split_MouseMove(Button As Integer, Shift As Integer, X As Single, Y As Single)

   If Button = vbLeftButton Then
      With Split
         .Move .Left + X
      End With
   End If

End Sub

Private Sub Split_MouseUp(Button As Integer, Shift As Integer, X As Single, Y As Single)

   If Button = vbLeftButton Then Ajustar

End Sub

Private Sub Timer1_Timer()

   VerificaHost

End Sub

Private Sub Toolbar1_ButtonClick(ByVal Button As MSComctlLib.Button)
 
   On Error Resume Next
   
   Dim mHojasAncho As Integer
   Dim of1 As Form
   
   Select Case Button.Key
      Case "New"
        Editar -1
      
      Case "Save"
         ExportarAExcel Lista, "Listado de " & Ultimo_NodoTitulo
         
      Case "Print"
         ImprimirConExcel Lista, "Listado de " & Ultimo_NodoTitulo
      
      Case "Copy"
         CopiarAlClipboard

      Case "Find"
         FiltradoLista Lista
         StatusBar1.Panels(3).Text = " " & Lista.ListItems.Count & " elementos en la lista"
         
      Case "Sumar"
         StatusBar1.Panels(3).Text = " " & TotalizarCampo(Lista)
         
      Case "Calculadora"
         Call ShellExecute(Me.hwnd, "open", "Calc.exe", vbNullString, vbNullString, SW_SHOWNORMAL)
      
      Case "View Large Icons"
         CambiarVista lvwIcon
      
      Case "View Small Icons"
         CambiarVista lvwSmallIcon
      
      Case "View List"
         CambiarVista lvwList
      
      Case "View Details"
         CambiarVista lvwReport
      
      Case "Help"
         VerAyuda
         
      Case "CopiarCampo"
         Set of1 = New frmCopiaDefArt

         With of1
            .Grupo = Trim(Lista.SelectedItem.Text) & " " & Trim(Lista.SelectedItem.ListSubItems(1)) & " " & Trim(Lista.SelectedItem.ListSubItems(2))
            .NombreCampo = Lista.SelectedItem.ListSubItems(5)
            .Id = Lista.SelectedItem.Tag
            .Show vbModal, Me
         End With
         Unload of1
         Set of1 = Nothing
   
      Case "ActMat"
         MsgBox "Modulo desactivado", vbExclamation
         Exit Sub
'         Dim oRs As ADOR.Recordset
'         Set oRs = Aplicacion.Articulos.TraerFiltrado("_ParaMenu")
'         GrabarMenu oRs
'         oRs.Close
'         Set oRs = Nothing
'
'         Dim ofBusca As frmBuscarArticulo
'         Set ofBusca = New frmBuscarArticulo
'         ofBusca.Show vbModal, Me
'         Unload ofBusca
'         Set ofBusca = Nothing
   
      Case "Refrescar"
         Refrescar
   
      Case "Parametros"
         If Not glbAdministrador Then
            MsgBox "Solo el administrador del sistema puede acceder a los parametros!", vbExclamation
            Exit Sub
         End If
         
         mIdiomaInicial = glbIdiomaActual
         
         Set of1 = New frmParametros1
         With of1
            .Id = 1
            .Show vbModal, Me
         End With
         Unload of1
         Set of1 = Nothing
         
         SetearIdioma mIdiomaInicial
      
      Case "Empresa"
         If Not glbAdministrador Then
            MsgBox "Solo el administrador del sistema puede acceder a los datos de " & glbEmpresaSegunString & "!", vbExclamation
            Exit Sub
         End If
         
         Set of1 = New frmEmpresa
         With of1
            .Caption = "Datos de " & glbEmpresa
            .Id = 1
            .Show vbModal, Me
         End With
         Unload of1
         Set of1 = Nothing
      
      Case "EnviarMensaje"
         Set of1 = New frmMensajes
         With of1
            .Show , Me
         End With
         Set of1 = Nothing
      
'      Case "EstadoObra"
'
'         If Not glbAdministrador Then
'            MsgBox "Solo un administrador del sistema puede acceder a esta opcion!", vbExclamation
'            Exit Sub
'         End If
'
'         ProcesarPedidosEstadoObras
   
      Case "MenuPopUp"
'         If Not glbMenuPopUpCargado Then
'            Set of1 = New frmInformacion
'            With of1
'               .Label1.Caption = "CARGANDO DESPLEGABLE DE MATERIALES"
'               .Label2.Caption = "Un momento por favor ..."
'               .Show , Me
'               DoEvents
'               LoadMenuPopUp
'            End With
'            Unload of1
'            Set of1 = Nothing
'            glbMenuPopUpCargado = True
'            Toolbar1.Buttons("MenuPopUp").Enabled = False
'         End If
         
         If Not glbMenuPopUpCargado1 Then
            Set of1 = New frmInformacion
            With of1
               .Label1.Caption = "CARGANDO DESPLEGABLE DE MATERIALES"
               .Label2.Caption = "Un momento por favor ..."
               .Show , Me
               DoEvents
               ActivarPopupMateriales
            End With
            Unload of1
            Set of1 = Nothing
            glbMenuPopUpCargado1 = True
            Toolbar1.Buttons("MenuPopUp").Enabled = False
         End If
         
      Case "AccesoPorUsuarios"
         If glbAdministrador Then
            If Lista.Picture Is Nothing Then
               Set Lista.Picture = picBackgroundArbol.Picture
               glbModoAccesosUsuarios = True
            Else
               Set Lista.Picture = Nothing
               glbModoAccesosUsuarios = False
            End If
         End If
         
      Case "Idioma"
         ElegirIdioma
   End Select

End Sub

Private Sub Toolbar1_MouseDown(Button As Integer, Shift As Integer, X As Single, Y As Single)

   If Button = vbRightButton Then
      If glbMenuPopUpCargado1 Then
         Dim iIndex As Long
         cPMenu.Restore "Materiales"
         iIndex = cPMenu.ShowPopupMenu(Me.Left, Me.Top)
      End If
   End If

End Sub

Sub Ajustar()

   Dim Arriba As Long
   Dim Altura As Long
   Dim Ancho As Long
   
   Arriba = Toolbar1.Height
   Ancho = Me.ScaleWidth
   Altura = Me.ScaleHeight - Arriba - StatusBar1.Height
   
   On Error Resume Next
   
   With Split
      .Top = Arriba
      .Height = Altura
   End With
   
   With Arbol
      .Left = 0
      .Top = Arriba
      .Height = Altura
      .Width = Split.Left
   End With
   
   With Lista
      .Top = Arriba
      .Height = Altura
      .Left = Split.Left + Split.Width
      .Width = Ancho - .Left
   End With

End Sub

Private Sub Editar(ByVal Identificador As Long, Optional ByVal IdentificadorAnterior As Long)

   Dim oF As Form
   Dim s As String, clave As String, Clave1 As String
   Dim mIdentificadorAnterior As Long
   Dim Nodo As Object
   Dim mClaveNodo, Columnas, SubClave
   Dim oRs As ADOR.Recordset
      
   Me.MousePointer = vbHourglass
   
   mClaveNodo = VBA.Split(Arbol.SelectedItem.Key, " ")
   
   s = Arbol.SelectedItem.Key
   Do Until Len(s) And mId(s, 1, 1) <> "-" 'Mientras no empiece con -Sub (es un subarbol del nodo)
      s = Arbol.SelectedItem.Parent.Key
   Loop
   
   If mId(s, 1, 1) = "+" Then s = mId(s, 1, 7)
   
   Set Nodo = Arbol.SelectedItem
   clave = Nodo.Key
   Clave1 = ""
   Do Until Len(clave) And mId(clave, 1, 1) <> "-" And mId(clave, 1, 1) <> "+"
      If InStr(1, clave, "SubCn2") <> 0 Then Clave1 = clave
      Set Nodo = Nodo.Parent
      clave = Nodo.Key
   Loop
   Set Nodo = Nothing
   If clave = "PresupuestoEconomico" And glbAdministrador And BuscarClaveINI("Activar control de acceso por item-usuario") = "SI" Then
      clave = Arbol.SelectedItem.Key
   End If
   If Not ControlAcceso(clave) Or ControlAccesoNivel(clave) >= 9 Then
      MsgBox "El usuario no tiene acceso a esta informacion", vbCritical
      GoTo Salida:
   End If
   
   Select Case s
      Case "Acabados"
         Set oF = New frmAcabados
      Case "AcoAcabados"
         Set oF = New frmAcoAcabados
      Case "AcoBiselados"
         Set oF = New frmAcoBiselados
      Case "AcoCalidades"
         Set oF = New frmAcoCalidades
      Case "AcoCodigos"
         Set oF = New frmAcoCodigos
      Case "AcoColores"
         Set oF = New frmAcoColores
      Case "AcoFormas"
         Set oF = New frmAcoFormas
      Case "AcoGrados"
         Set oF = New frmAcoGrados
      Case "AcoMarcas"
         Set oF = New frmAcoMarcas
      Case "AcoMateriales"
         Set oF = New frmAcoMateriales
      Case "AcoModelos"
         Set oF = New frmAcoModelos
      Case "AcoNormas"
         Set oF = New frmAcoNormas
      Case "AcoSchedulers"
         Set oF = New frmAcoSchedulers
      Case "AcoSeries"
         Set oF = New frmAcoSeries
      Case "AcoTipos"
         Set oF = New frmAcoTipos
      Case "AcoTiposRosca"
         Set oF = New frmAcoTiposRosca
      Case "AcoTratamientos"
         Set oF = New frmAcoTratamientos
      Case "ActividadesP"
         Set oF = New frmActividadesProveedores
      Case "AjustesStock", "AjustesStockTodos", "AjustesStockAgrupados", "+SubAJ1", "+SubAJ2"
         Set oF = New frmAjustesStock
      Case "AlimentacionesElectricas"
         Set oF = New frmAlimentacionesElectricas
      Case "AnexosEquipos"
         Set oF = New frmAnexosEquipos
      Case "AniosNorma"
         Set oF = New frmAniosNorma
      Case "AnticiposAlPersonalSyJ"
         Set oF = New frmAnticiposAlPersonalSyJ
      Case "ArchivosATransmitirDestinos"
         Set oF = New frmArchivosATransmitirDestinos
      Case "Articulos", "ArticulosTodos", "ArticulosRubros", _
            "+SubAR1", "ArticulosTodosDetallados", "ArticulosTodosResumidos", "ArticulosInactivos"
         Set oF = New frmArticulos
      Case "ArticulosEquiposTerceros"
         Set oF = New frmArticulos
         oF.EquipoTercero = True
      Case "Asientos", "AsientosTodos", "AsientosAgrupados", "+SubAs1", "+SubAs2", "+SubAsE"
         Set oF = New frmAsientos
      Case "AutorizacionesCompra", "AutorizacionesCompraTodas", "AutorizacionesCompraAgrupadas", "+SubAC1", "+SubAC2"
        ' Set oF = New frmAutorizacionesCompra
      Case "Bancos"
         Set oF = New frmBancos
      Case "BancoChequeras", "HChequeras"
         Set oF = New frmBancoChequeras
      Case "Biselados"
         Set oF = New frmBiselados
      Case "Cajas"
         Set oF = New frmCajas
      Case "Calidades"
         Set oF = New frmCalidades
      Case "CalidadesClad"
         Set oF = New frmCalidadesClad
      Case "Cargos"
         Set oF = New frmCargos
      Case "CashFlow"
         Set oF = New frmDefinicionFlujoCaja
      Case "CCalidades", "CCalidadesPendientes", "CCalidadesUltimos3Meses", "CCalidadesTodos", "CCalidadesControlados"
         If Identificador < 0 Then
            MsgBox "No puede ingresar nuevos controles de calidad", vbCritical
            GoTo Salida
         End If
         Set oF = New frmCCalidades
      Case "CentrosCosto"
         Set oF = New frmCentrosCosto
      Case "CertificacionesObra"
         Set oF = New frmCertificaciones
      Case "Choferes"
         'Set oF = New frmChoferes
      Case "Clausulas"
         Set oF = New frmClausulas
      Case "Clientes", "ClientesResumen", "ClientesDetalle", "ClientesAConfirmar"
         Set oF = New frmClientes
      Case "Codigos"
         Set oF = New frmCodigos
      Case "CodigosUniversales"
         Set oF = New frmCodigosUniversales
      Case "CoeficientesContables"
         Set oF = New frmCoeficientesContables
      Case "CoeficientesImpositivos"
         Set oF = New frmCoeficientesImpositivos
      Case "Colores"
         Set oF = New frmColores
      Case "Comparativas", "+SubCm1", "+SubCm2", "ComparativasTodas", "ComparativasAgrupadas"
         Set oF = New frmComparativa
      Case "ComprobantesPrv", "ComprobantesPrvTodos", "ComprobantesPrvPorMes", "+SubCP1", "+SubCP2"
         Set oF = New frmComprobantesPrv
         If IdentificadorAnterior > 0 Then oF.IdComprobanteAnterior = IdentificadorAnterior
      Case "ComprobantesAConfirmar"
         Set oF = New frmComprobantesPrv
         oF.Confirmado = "NO"
      Case "Conceptos"
         Set oF = New frmConceptos
      Case "ConceptosOP"
         Set oF = New frmConceptosOP
      Case "CondicionesCompra1", "CondicionesCompra2"
         Set oF = New frmCondicionesCompra
      Case "Conjuntos", "ConjuntosTodos", "ConjuntosFinales", "ConjuntosDependientes"
         Set oF = New frmConjuntos
      Case "ControlesCalidad"
         Set oF = New frmControlesCalidad
      Case "CostosImportacion"
         Set oF = New frmCostosImportacion
      Case "Cotizaciones", "+SubCo2"
         Set oF = New frmCotizaciones
      Case "CtasCtesA"
         Set oF = New frmCtasCtesA
      Case "CtasCtesD"
         Set oF = New frmCtasCtesD
      Case "Cuentas", "CuentasTodas", "Cuentas12345", "+SubCTa"
         Set oF = New frmCuentas
      Case "CuentasBancarias"
         Set oF = New frmCuentasBancarias
      Case "+SubCn1", "+SubCn2", "+SubCn3", "+SubCn4"
         If Identificador > 0 Then
            Set oRs = Aplicacion.Valores.TraerFiltrado("_PorId", Identificador)
            If oRs.RecordCount > 0 Then
               If IsNull(oRs.Fields("Estado").Value) Or oRs.Fields("Estado").Value <> "G" Then
                  MsgBox "Solo puede editar gastos bancarios, no valores", vbExclamation
                  GoTo Salida
               End If
            End If
            oRs.Close
            Set oRs = Nothing
         End If
         Set oF = New frmValoresGastos
         With oF
            .ObjetoOrigen = mId(s, 2, 6)
            If Len(Clave1) > 0 Then
               Columnas = VBA.Split(Clave1, " ")
               .IdCuentaBancaria = Columnas(1)
            End If
         End With
      Case "CuentasGastos"
         Set oF = New frmCuentasGastos
      Case "DefinicionesArt", "DefinicionesArtTodos", "DefinicionesArtRubros", "+SubDA1"
         Set oF = New frmDefinicionArt
      Case "Densidades"
         Set oF = New frmDensidades
      Case "Depositos"
         Set oF = New frmDepositos
      Case "DepositosBancarios", "DepositosBancariosTodos", "DepositosBancariosAgrupados", "+SubDP1", "+SubDP2"
         Set oF = New frmDepositosBancarios
      Case "Devoluciones", "DevolucionesTodas", "DevolucionesAgrupadas", "+SubDV1", "+SubDV2"
         Set oF = New frmDevoluciones
      Case "DistribucionesObras"
         Set oF = New frmDistribucionesObras
      Case "EjerciciosContables"
         Set oF = New frmEjerciciosContables
      Case "Empleados", "Empleados1", "Empleados2", "Empleados3"
         mIdiomaInicial = glbIdiomaActual
         Set oF = New frmEmpleados
      Case "Equipos", "+ObrXEq", "+ObHXEq", "+SubLMO"
         Set oF = New frmEquipos
      Case "Facturas", "FacturasTodas", "FacturasAgrupadas", "+SubFA1", "+SubFA2"
         Set oF = New frmFacturas
      Case "FacturasContado", "FacturasContadoTodas", "FacturasContadoAgrupadas", "+SubFC1", "+SubFC2"
         Set oF = New frmFacturasDirectas
      Case "Familias"
         Set oF = New frmFamilias
      Case "Fletes"
         'Set oF = New frmFletes
      Case "Formas"
         Set oF = New frmFormas
      Case "Ganancias1", "Ganancias2"
         Set oF = New frmGanancias
      Case "GastosBancarios", "GastosBancariosTodos", "GastosBancariosAgrupados", "+SubGS2"
         Set oF = New frmValoresGastos
      Case "GastosFletes", "GastosFletesTodos", "GastosFletesAgrupados", "+SubGF1", "+SubGF2"
         'Set oF = New frmGastosFletes
      Case "Grados"
         Set oF = New frmGrados
      Case "GruposActivosFijos"
         Set oF = New frmGruposActivosFijos
      Case "GruposObras"
         Set oF = New frmGruposObras
      Case "IBCondiciones1", "IBCondiciones2"
         Set oF = New frmIBCondiciones
      Case "IGCondiciones1", "IGCondiciones2"
         Set oF = New frmIGCondiciones
      Case "ImpuestosDirectos"
         Set oF = New frmImpuestosDirectos
      Case "ItemsPopUpMateriales"
         Set oF = New frmItemsPopUpMateriales
      Case "LAcopio", "+ObrXLA", "HLAcopios", "+ObHXLA", "+ObrEqA", "+ObHEqA"
         Set oF = New frmAcopios
      Case "LiquidacionesFletes", "LiquidacionesFletesTodas", "LiquidacionesFletesAgrupadas", "+SubLF1", "+SubLF2"
         'Set oF = New frmLiquidacionesFletes
      Case "ListasPrecios", "ListasPreciosDefinicion"
         Set oF = New frmListasPrecios
      Case "+SubLP1"
         Set oF = New frmListasPreciosDetalle
         oF.IdListaPrecios = mClaveNodo(1)
      Case "LMateriales", "+ObrLA2", "+ObrEq2", "+ObrEqM", "+ObHLA2", "+ObHEq2", "+ObHEqM", "+LMOEq0"
         Set oF = New frmLMateriales
      Case "Localidades"
         Set oF = New frmLocalidades
      Case "LugaresEntrega"
         Set oF = New frmLugaresEntrega
      Case "Marcas"
         Set oF = New frmMarcas
      Case "Materiales"
         Set oF = New frmMateriales
      Case "Modelos"
         Set oF = New frmModelos
      Case "ModificacionActivoFijo"
         Set oF = New frmModificacionActivoFijo
      Case "Monedas"
         Set oF = New frmMonedas
      Case "Normas"
         Set oF = New frmNormas
      Case "NotasDebito", "NotasDebitoTodas", "NotasDebitoAgrupadas", "+SubND1", "+SubND2"
         Set oF = New frmNotasDebito
      Case "NotasCredito", "NotasCreditoTodas", "NotasCreditoAgrupadas", "+SubNC1", "+SubNC2"
         Set oF = New frmNotasCredito
      Case "Obras1", "Obras2", "HistObras1", "HistObras2", "LMaterialesPorObras"
         Set oF = New frmObras
      Case "OPago", "+SubOp1", "+SubOp2", "OPagoPorMes", "OPagoTodas", "OPagoEnCaja", "OPagoEnCajaObra", "OPagoALaFirma", "OPagoAConfirmar"
         Set oF = New frmOrdenesPago
      Case "OrdenesCompra", "OrdenesCompraTodas", "OrdenesCompraAgrupadas", "+SubOC1", "+SubOC2"
         Set oF = New frmOrdenesCompra
      Case "OrdenesTrabajo", "OrdenesTrabajoTodas", "OrdenesTrabajoAgrupadas", "+SubOT1", "+SubOT2"
         Set oF = New frmOrdenesTrabajo
      Case "OtrosIngresosAlmacen", "OtrosIngresosAlmacenTodos", "OtrosIngresosAlmacenAgrupados", "+SubOI1", "+SubOI2"
         Set oF = New frmOtrosIngresosAlmacen
      Case "OtrosIngresosAlmacenTodosSAT", "+SubOI4"
         Set oF = New frmOtrosIngresosAlmacenSAT
      Case "Paises"
         Set oF = New frmPaises
      Case "PartesProduccion"
         'Set oF = New frmPartesProduccion
      Case "Pedidos", "HPedidos", "+SubPo1", "+SubPe1", "+SubPe2", "PedidosTodos", "PedidosAgrupados", "PedidosSubcontratos", _
            "PedidosSubcontratosTodos", "PedidosSubcontratosAgrupados", "+SubPS1", "+SubPS2", "PedidosPendientes"
         Set oF = New frmPedidos
      Case "PedidosAbiertos"
         Set oF = New frmPedidosAbiertos
      Case "PedidosTodosSAT", "+SubPe4", "+SubPo2"
         Set oF = New frmPedidosSAT
      Case "Planos"
         Set oF = New frmPlanos
      Case "PlazosEntrega"
         Set oF = New frmPlazosEntrega
      Case "PlazosFijos", "PlazosFijosTodos", "PlazosFijosAVencer", "PlazosFijosVencidos"
         Set oF = New FrmPlazosFijos
      Case "PosicionesImportacion"
         Set oF = New frmPosicionesImportacion
      Case "Presupuestos", "+SubPr1", "+SubPr2", "PresupuestosTodos", "PresupuestosAgrupados"
         Set oF = New frmPresupuesto
      Case "PresupuestoFinanciero"
         Set oF = New frmPresupuestoFinanciero
      Case "+SubPF1"
         If mClaveNodo(2) = "M" Then
            Set oF = New frmPresupuestoFinanciero
         Else
            Set oF = New frmPresupuestoFinancieroAnual
         End If
      Case "+SubPEb"
         Set oF = New frmPresupuestoEconomico
         SubClave = VBA.Split(Arbol.SelectedItem.Key, " ")
         oF.IdEjercicioContable = SubClave(2)
      Case "PresupuestoObrasGruposMateriales"
         'Set oF = New frmPresupuestoObrasGruposMateriales
      Case "PresupuestoObrasRubros"
         Set oF = New frmPresupuestoObrasRubros
      Case "ProveedoresEventuales", "ProveedoresAConfirmar"
         Set oF = New frmProveedoresEventuales
      Case "ProveedoresResumen", "ProveedoresDetalle"
         Set oF = New frmProveedores
      Case "Provincias"
         Set oF = New frmProvincias
      Case "PuntosVenta"
         Set oF = New frmPuntosVenta
      Case "Rangos"
         Set oF = New frmRangos
      Case "Recepciones", "RecepcionesTodas", "RecepcionesUltimos3Meses", "RecepcionesAgrupadas", "+SubRP1", "+SubRP2"
         Set oF = New frmRecepciones
      Case "Recepciones1", "Recepciones1Todas", "Recepciones1Agrupadas", "+SubR21", "+SubR22"
         Set oF = New frmRecepciones1
      Case "RecepcionesTodasSAT", "+SubRP4"
         Set oF = New frmRecepcionesSAT
      Case "Recibos", "RecibosTodos", "RecibosAgrupados", "+SubRE1", "+SubRE2"
         Set oF = New frmRecibos
      Case "Relaciones"
         Set oF = New frmRelaciones
      Case "Remitos", "RemitosTodos", "RemitosAgrupados", "+SubRM1", "+SubRM2"
         Set oF = New frmRemitos
      Case "Requerimientos", "RequerimientosTodos", "RequerimientosObras", "RequerimientosCC", "+ObrXRM", "HRequerimientos", "+ObHXRM", _
            "RequerimientosAgrupados", "+SubRq2", "RequerimientosAConfirmar", "RequerimientosPorObras", "+SubRo1", "RequerimientosALiberar"
         Set oF = New frmRequerimientos
      Case "Reservas"
         Set oF = New frmReservas
      Case "ResumenesParaConciliacion", "ResumenesParaConciliacionTodos", "ResumenesParaConciliacionAgrupados", "+SubRC1", "+SubRC2"
         Set oF = New frmConciliacion
      Case "Revaluos"
         Set oF = New frmRevaluos
      Case "Rubros"
         Set oF = New frmRubros
      Case "RubrosContablesGastosPorObra"
         Set oF = New frmRubrosContables
         oF.Tipo = 1
      Case "RubrosContablesFinancieros"
         Set oF = New frmRubrosContables
         oF.Tipo = 2
      Case "SalidaMateriales", "SalidaMaterialesTodas", "SalidaMaterialesAgrupadas", "+SubSA1", "+SubSA2"
         Set oF = New frmSalidasMateriales
      Case "SalidaMateriales1", "SalidaMaterialesTodas1", "SalidaMaterialesAgrupadas1", "+SubS21", "+SubS22"
         'Set oF = New frmSalidasMateriales1
      Case "SalidaMaterialesTodasSAT", "+SubSA4"
         Set oF = New frmSalidasMaterialesSAT
      Case "Schedulers"
         Set oF = New frmSchedulers
      Case "Sectores"
         Set oF = New frmSectores
      Case "Series"
         Set oF = New frmSeries
      Case "SolicitudesCompra", "SolicitudesCompraTodas", "SolicitudesCompraAgrupadas", "+SubSC1", "+SubSC2"
         Set oF = New frmSolicitudesCompra
      Case "Subcontratos"
         Me.MousePointer = vbDefault
         Set oF = New frmSubcontratos
      Case "Subdiarios", "SubdiariosTodos", "SubdiariosAgrupados", "+SubSd1", "+SubSd2", "+SubSdE"
         Set oF = New frmSubdiarios
      Case "Subrubros"
         Set oF = New frmSubrubros
      Case "TarifasFletes"
        ' Set oF = New frmTarifasFletes
      Case "TarjetasCredito"
         Set oF = New frmTarjetasCredito
      Case "Tipos"
         Set oF = New frmTipos
         oF.Grupo = 0
      Case "TiposArticulos"
         Set oF = New frmTipos
         oF.Grupo = 1
      Case "TiposComprobante"
         If Not glbAdministrador Then
            MsgBox "Solo el administrador puede acceder a esta opcion", vbInformation
            GoTo Salida
         End If
         If Identificador <= 0 Then
            MsgBox "No puede registrar nuevos tipos de comprobante", vbInformation
            GoTo Salida
         End If
         Set oF = New frmTiposComprobante
      Case "TiposCuentaGrupos"
         Set oF = New frmTiposCuentaGrupos
      Case "TiposRosca"
         Set oF = New frmTiposRosca
      Case "Traducciones"
         Set oF = New frmTraducciones
      Case "Transportistas", "Transportistas1"
         Set oF = New frmTransportistas
      Case "TTermicos"
         Set oF = New frmTTermicos
      Case "Ubicaciones"
         Set oF = New frmUbicaciones
      Case "Unidades"
         Set oF = New frmUnidades
      Case "UnidadesOperativas"
         Set oF = New frmUnidadesOperativas
      Case "ValesSalida", "ValesSalidaTodos", "ValesSalidaAgrupados", "+SubVS1", "+SubVS2"
         Set oF = New frmValesSalida
      Case "Valores", "ValoresTodos"
         Set oF = New frmValores
      Case "Vendedores"
         Set oF = New frmVendedores
      Case "VentasCuotasOperacion"
         Set oF = New frmVentasEnCuotas
      Case "VentasCuotasGeneracion"
         Set oF = New frmGeneracionVentasCuotas
      Case "VentasCuotasCobranzas"
         If Identificador < 0 Then
            Set oF = New frmImportarCobranzasCuotas
         Else
            GoTo Salida
         End If

      Case Else
         MsgBox "Item no editable"
         GoTo Salida:
   End Select
   
'   On Error Resume Next
   With oF
      .NivelAcceso = ControlAccesoNivel(clave)
      .OpcionesAcceso = ControlAccesoOpciones(clave)
      .Id = Identificador
      If Not glbPermitirModificacionTabulados Then
         If ExisteControlEnFormulario(oF, "lblTabIndex") Then .lblTabIndex.Visible = False
      End If
      If .Name = "frmCuentas" Then .FechaParaPlanCuentas = mFechaParaPlanCuentas
      .Disparar = ActL
      ReemplazarEtiquetas oF
      Me.MousePointer = vbDefault
      .Show , Me
   End With

Salida:
   Set oF = Nothing
   Set oRs = Nothing
   
   Me.MousePointer = vbDefault

End Sub

Public Sub ActualizarLista(ByVal Identificador As Long, _
                           ByVal TipoAccion As EnumAcciones, _
                           ByVal NombreListaEditada As String, _
                           Optional ByVal IdentificadorOriginal As Long)

   Dim oRs As ADOR.Recordset, oRsAux As ADOR.Recordset
   Dim oFld As ADOR.Field
   Dim s As String, mIcono As String, sKey As String
   Dim Columnas
   Dim i As Integer, X As Integer
   Dim mUno As Boolean, mEdicionEnSerie As Boolean
   Dim mFecha As Date, mFechaDesde As Date, mFechaHasta As Date
   
   On Error Resume Next
   
   If TipoAccion = baja Then
      Lista.ListItems.Remove (Lista.object.SelectedItem.Index)
      Exit Sub
   End If
   
'   s = NombreListaEditada
'   Do Until Len(s) And Not mId(s, 1, 1) = "-"
'      s = Arbol.SelectedItem.Parent.Key
'   Loop
   
   s = Arbol.SelectedItem.Key
   If mId(s, 1, 1) = "+" Then s = mId(s, 1, 7)
   
   If Not InStr(1, NombreListaEditada, s) <> 0 Then Exit Sub
   
   mUno = True
   mEdicionEnSerie = False
   
   Select Case s
      Case "Acabados"
         Set oRs = Aplicacion.Acabados.TraerFiltrado("_TT", Identificador)
      Case "AcoAcabados"
         Set oRs = Aplicacion.AcoAcabados.TraerFiltrado("_TT", Identificador)
      Case "AcoBiselados"
         Set oRs = Aplicacion.AcoBiselados.TraerFiltrado("_TT", Identificador)
      Case "AcoCalidades"
         Set oRs = Aplicacion.AcoCalidades.TraerFiltrado("_TT", Identificador)
      Case "AcoCodigos"
         Set oRs = Aplicacion.AcoCodigos.TraerFiltrado("_TT", Identificador)
      Case "AcoColores"
         Set oRs = Aplicacion.AcoColores.TraerFiltrado("_TT", Identificador)
      Case "AcoFormas"
         Set oRs = Aplicacion.AcoFormas.TraerFiltrado("_TT", Identificador)
      Case "AcoGrados"
         Set oRs = Aplicacion.AcoGrados.TraerFiltrado("_TT", Identificador)
      Case "AcoMarcas"
         Set oRs = Aplicacion.AcoMarcas.TraerFiltrado("_TT", Identificador)
      Case "AcoMateriales"
         Set oRs = Aplicacion.AcoMateriales.TraerFiltrado("_TT", Identificador)
      Case "AcoModelos"
         Set oRs = Aplicacion.AcoModelos.TraerFiltrado("_TT", Identificador)
      Case "AcoNormas"
         Set oRs = Aplicacion.AcoNormas.TraerFiltrado("_TT", Identificador)
      Case "AcoSchedulers"
         Set oRs = Aplicacion.AcoSchedulers.TraerFiltrado("_TT", Identificador)
      Case "AcoSeries"
         Set oRs = Aplicacion.AcoSeries.TraerFiltrado("_TT", Identificador)
      Case "AcoTipos"
         Set oRs = Aplicacion.AcoTipos.TraerFiltrado("_TT", Identificador)
      Case "AcoTiposRosca"
         Set oRs = Aplicacion.AcoTiposRosca.TraerFiltrado("_TT", Identificador)
      Case "AcoTratamientos"
         Set oRs = Aplicacion.AcoTratamientos.TraerFiltrado("_TT", Identificador)
      Case "ActividadesP"
         Set oRs = Aplicacion.ActividadesProveedores.TraerFiltrado("_TT", Identificador)
      Case "AjustesStockTodos", "+SubAJ2"
         Set oRs = Aplicacion.AjustesStock.TraerFiltrado("_TT", Identificador)
      Case "AlimentacionesElectricas"
         Set oRs = Aplicacion.AlimentacionesElectricas.TraerFiltrado("_TT", Identificador)
      Case "AnexosEquipos"
         Set oRs = Aplicacion.AnexosEquipos.TraerFiltrado("_TT", Identificador)
      Case "AniosNorma"
         Set oRs = Aplicacion.AniosNorma.TraerFiltrado("_TT", Identificador)
      Case "AnticiposAlPersonalSyJ"
         Set oRs = Aplicacion.AnticiposAlPersonalSyJ.TraerFiltrado("_TT", Identificador)
      Case "ArchivosATransmitirDestinos"
         Set oRs = Aplicacion.ArchivosATransmitirDestinos.TraerFiltrado("_TT", Identificador)
      Case "Articulos", "ArticulosTodos", "ArticulosRubros", "ArticulosTodosDetallados", "ArticulosTodosResumidos", _
            "ArticulosInactivos", "ArticulosEquiposTerceros"
         Set oRs = Aplicacion.Articulos.TraerFiltrado("_TT", Identificador)
      Case "+SubAR1"
         sKey = GenerarSQL("ArticuloRubro", 0, Identificador)
         Set oRs = Aplicacion.TablasGenerales.TraerFiltrado("Consulta", "_PorSQL", sKey)
      Case "Asientos", "AsientosTodos", "AsientosAgrupados", "+SubAs1", "+SubAs2", "+SubAsE"
         Set oRs = Aplicacion.Asientos.TraerFiltrado("_TT", Identificador)
      Case "AutorizacionesCompraTodas", "+SubAC2"
         'Set oRs = Aplicacion.AutorizacionesCompra.TraerFiltrado("_TT", Identificador)
      Case "Bancos"
         Set oRs = Aplicacion.Bancos.TraerFiltrado("_TT", Identificador)
      Case "BancoChequeras", "HChequeras"
         Set oRs = Aplicacion.BancoChequeras.TraerFiltrado("_TT", Identificador)
      Case "Biselados"
         Set oRs = Aplicacion.Biselados.TraerFiltrado("_TT", Identificador)
      Case "Cajas"
         Set oRs = Aplicacion.Cajas.TraerFiltrado("_TT", Identificador)
      Case "Calidades"
         Set oRs = Aplicacion.Calidades.TraerFiltrado("_TT", Identificador)
      Case "CalidadesClad"
         Set oRs = Aplicacion.CalidadesClad.TraerFiltrado("_TT", Identificador)
      Case "Cargos"
         Set oRs = Aplicacion.Cargos.TraerFiltrado("_TT", Identificador)
      Case "CashFlow"
         Arbol_NodeClick Arbol.SelectedItem
         Exit Sub
      Case "CCalidades", "CCalidadesPendientes", "CCalidadesUltimos3Meses", "CCalidadesTodos", "CCalidadesControlados"
         Set oRs = Aplicacion.CCalidades.TraerFiltrado("_TT", Identificador)
      Case "CentrosCosto"
         Set oRs = Aplicacion.CentrosCosto.TraerFiltrado("_TT", Identificador)
      Case "Choferes"
         Set oRs = Aplicacion.Choferes.TraerFiltrado("_TT", Identificador)
      Case "Clausulas"
         Set oRs = Aplicacion.Clausulas.TraerFiltrado("_TT", Identificador)
      Case "ClientesResumen", "ClientesDetalle", "ClientesAConfirmar"
         Set oRs = Aplicacion.Clientes.TraerFiltrado("_TT", Identificador)
      Case "Codigos"
         Set oRs = Aplicacion.Codigos.TraerFiltrado("_TT", Identificador)
      Case "CodigosUniversales"
         Set oRs = Aplicacion.CodigosUniversales.TraerFiltrado("_TT", Identificador)
      Case "CoeficientesContables"
         Set oRs = Aplicacion.CoeficientesContables.TraerFiltrado("_TT", Identificador)
      Case "CoeficientesImpositivos"
         Set oRs = Aplicacion.CoeficientesImpositivos.TraerFiltrado("_TT", Identificador)
      Case "Colores"
         Set oRs = Aplicacion.Colores.TraerFiltrado("_TT", Identificador)
      Case "Comparativas", "+SubCm2", "ComparativasTodas"
         Set oRs = Aplicacion.Comparativas.TraerFiltrado("_TT", Identificador)
      Case "ComprobantesPrvTodos", "ComprobantesPrvPorMes", "+SubCP1", "+SubCP2"
         Set oRs = Aplicacion.ComprobantesProveedores.TraerFiltrado("_TT", Identificador)
         mEdicionEnSerie = True
      Case "ComprobantesPrv", "ComprobantesPrvPorMes"
         mEdicionEnSerie = True
      Case "ComprobantesAConfirmar"
         Set oRsAux = Aplicacion.ComprobantesProveedores.TraerFiltrado("_PorId", Identificador)
         If oRsAux.RecordCount > 0 Then
            If Not IsNull(oRsAux.Fields("Confirmado").Value) And oRsAux.Fields("Confirmado").Value = "NO" Then
               Set oRs = Aplicacion.ComprobantesProveedores.TraerFiltrado("_TT", Identificador)
            Else
               Lista.ListItems.Remove (Lista.object.SelectedItem.Index)
            End If
         End If
         oRsAux.Close
         Set oRsAux = Nothing
      Case "CondicionesCompra1", "CondicionesCompra2"
         Set oRs = Aplicacion.CondicionesCompra.TraerFiltrado("_TT", Identificador)
      Case "Conceptos"
         Set oRs = Aplicacion.Conceptos.TraerFiltrado("_TT", Array(Identificador, 0))
      Case "ConceptosOP"
         Set oRs = Aplicacion.Conceptos.TraerFiltrado("_TT", Array(Identificador, -1))
      Case "ConjuntosTodos", "ConjuntosFinales", "ConjuntosDependientes"
         Set oRs = Aplicacion.Conjuntos.TraerFiltrado("_TT", Identificador)
      Case "ControlesCalidad"
         Set oRs = Aplicacion.ControlesCalidad.TraerFiltrado("_TT", Identificador)
      Case "CostosImportacion"
         Set oRs = Aplicacion.CostosImportacion.TraerFiltrado("_TT", Identificador)
      Case "Cotizaciones", "+SubCo2"
         Set oRs = Aplicacion.Cotizaciones.TraerFiltrado("_TT", Identificador)
      Case "CuentasTodas", "Cuentas12345", "+SubCTa"
         Set oRs = Aplicacion.Cuentas.TraerFiltrado("_TT", Identificador)
      Case "CuentasBancarias"
         Set oRs = Aplicacion.CuentasBancarias.TraerFiltrado("_TT", Identificador)
      Case "CuentasGastos"
         Set oRs = Aplicacion.CuentasGastos.TraerFiltrado("_TT", Identificador)
      Case "DefinicionesArt", "DefinicionesArtTodos", "DefinicionesArtRubros", "+SubDA1"
         Set oRs = Aplicacion.DefinicionesArt.TraerFiltrado("_TT", Identificador)
      Case "Densidades"
         Set oRs = Aplicacion.Densidades.TraerFiltrado("_TT", Identificador)
      Case "Depositos"
         Set oRs = Aplicacion.Depositos.TraerFiltrado("_TT", Identificador)
      Case "DepositosBancariosTodos", "+SubDP2"
         Set oRs = Aplicacion.DepositosBancarios.TraerFiltrado("_TT", Identificador)
      Case "DevolucionesTodas", "+SubDV2"
         Set oRs = Aplicacion.Devoluciones.TraerFiltrado("_TT", Identificador)
      Case "DistribucionesObras"
         Set oRs = Aplicacion.DistribucionesObras.TraerFiltrado("_TT", Identificador)
      Case "EjerciciosContables"
         Set oRs = Aplicacion.EjerciciosContables.TraerFiltrado("_TT", Identificador)
      Case "Empleados", "Empleados1", "Empleados2", "Empleados3"
         Set oRs = Aplicacion.Empleados.TraerFiltrado("_TT", Identificador)
      Case "Equipos"
         Set oRs = Aplicacion.Equipos.TraerFiltrado("_TT", Identificador)
      Case "FacturasTodas", "FacturasAgrupadas", "+SubFA2"
         Set oRs = Aplicacion.Facturas.TraerFiltrado("_TT", Identificador)
      Case "FacturasContadoTodas", "FacturasContadoAgrupadas", "+SubFC2"
         Set oRs = Aplicacion.Facturas.TraerFiltrado("_TT_Contado", Identificador)
      Case "Familias"
         Set oRs = Aplicacion.Familias.TraerFiltrado("_TT", Identificador)
      Case "Fletes"
         Set oRs = Aplicacion.Fletes.TraerFiltrado("_TT", Identificador)
      Case "Formas"
         Set oRs = Aplicacion.Formas.TraerFiltrado("_TT", Identificador)
      Case "GastosFletesTodos", "+SubGF2"
         Set oRs = Aplicacion.GastosFletes.TraerFiltrado("_TT", Identificador)
      Case "Ganancias1", "Ganancias2"
         Set oRs = Aplicacion.Ganancias.TraerFiltrado("_TT", Identificador)
      Case "Grados"
         Set oRs = Aplicacion.Grados.TraerFiltrado("_TT", Identificador)
      Case "GruposActivosFijos"
         Set oRs = Aplicacion.GruposActivosFijos.TraerFiltrado("_TT", Identificador)
      Case "GruposObras"
         Set oRs = Aplicacion.GruposObras.TraerFiltrado("_TT", Identificador)
      Case "IBCondiciones1", "IBCondiciones2"
         Set oRs = Aplicacion.IBCondiciones.TraerFiltrado("_TT", Identificador)
      Case "IGCondiciones1", "IGCondiciones2"
         Set oRs = Aplicacion.TiposRetencionGanancia.TraerFiltrado("_TT", Identificador)
      Case "ImpuestosDirectos"
         Set oRs = Aplicacion.ImpuestosDirectos.TraerFiltrado("_TT", Identificador)
      Case "ItemsPopUpMateriales"
         Set oRs = Aplicacion.ItemsPopUpMateriales.TraerFiltrado("_TT", Identificador)
      Case "LAcopio", "+ObrLA1", "+ObHLA1"
         Set oRs = Aplicacion.Acopios.TraerFiltrado("_TT", Identificador)
      Case "LiquidacionesFletesTodas", "+SubLF2"
         'Set oRs = Aplicacion.LiquidacionesFletes.TraerFiltrado("_TT", Identificador)
      Case "ListasPrecios", "ListasPreciosDefinicion"
         Set oRs = Aplicacion.ListasPrecios.TraerFiltrado("_TT", Identificador)
      Case "+SubLP1"
         Set oRs = Aplicacion.ListasPrecios.TraerFiltrado("_NuevoPrecio", Identificador)
      Case "LMateriales", "+ObrLA2", "+ObrEq2", "+ObHLA2", "+ObHEq2"
         Set oRs = Aplicacion.LMateriales.TraerFiltrado("_TT", Identificador)
      Case "Localidades"
         Set oRs = Aplicacion.Localidades.TraerFiltrado("_TT", Identificador)
      Case "LugaresEntrega"
         Set oRs = Aplicacion.LugaresEntrega.TraerFiltrado("_TT", Identificador)
      Case "Marcas"
         Set oRs = Aplicacion.Marcas.TraerFiltrado("_TT", Identificador)
      Case "Materiales"
         Set oRs = Aplicacion.Materiales.TraerFiltrado("_TT", Identificador)
      Case "Modelos"
         Set oRs = Aplicacion.Modelos.TraerFiltrado("_TT", Identificador)
      Case "ModificacionActivoFijo"
         Set oRs = Aplicacion.Articulos.TraerFiltrado("_ModificacionActivoFijo_TT", Identificador)
      Case "Monedas"
         Set oRs = Aplicacion.Monedas.TraerFiltrado("_TT", Identificador)
      Case "Normas"
         Set oRs = Aplicacion.Normas.TraerFiltrado("_TT", Identificador)
      Case "NotasDebitoTodas", "NotasDebitoAgrupadas", "+SubND2"
         Set oRs = Aplicacion.NotasDebito.TraerFiltrado("_TT", Identificador)
      Case "NotasCreditoTodas", "NotasCreditoAgrupadas", "+SubNC2"
         Set oRs = Aplicacion.NotasCredito.TraerFiltrado("_TT", Identificador)
      Case "Obras1", "Obras2", "HistObras1", "HistObras2"
         If glbParametrizacionNivel1 Then
            Set oRs = Aplicacion.Obras.TraerFiltrado("_TT_DetallesParametrizados", Array(Identificador, 1))
         Else
            Set oRs = Aplicacion.Obras.TraerFiltrado("_TT", Identificador)
         End If
      Case "OrdenesCompraTodas", "+SubOC2"
         Set oRs = Aplicacion.OrdenesCompra.TraerFiltrado("_TT", Identificador)
      Case "OrdenesTrabajoTodas", "+SubOT2"
         Set oRs = Aplicacion.OrdenesTrabajo.TraerFiltrado("_TT", Identificador)
      Case "+SubOp2", "OPagoPorMes", "OPagoTodas", "OPagoEnCaja", "OPagoEnCajaObra", "OPagoALaFirma"
         Set oRs = Aplicacion.OrdenesPago.TraerFiltrado("_TT", Identificador)
         If Not IsNull(oRs.Fields("IdOPComplementariaFF").Value) Then
            mIcono = "OPago"
            mFecha = oRs.Fields("Fecha Pago").Value
            Select Case Ultimo_Nodo
               Case "OPagoTodas"
                  Set oRs = Aplicacion.OrdenesPago.TraerTodos
               Case "OPagoALaFirma"
                  Set oRs = Aplicacion.OrdenesPago.TraerFiltrado("_ALaFirma")
               Case "OPagoEnCaja"
                  Set oRs = Aplicacion.OrdenesPago.TraerFiltrado("_EnCaja")
               Case "OPagoEnCajaObra"
                  Set oRs = Aplicacion.OrdenesPago.TraerFiltrado("_EnCaja", "CO")
               Case "+SubOp2"
                  mFechaDesde = DateSerial(Year(mFecha), Month(mFecha), 1)
                  mFechaHasta = DateAdd("m", 1, mFechaDesde)
                  mFechaHasta = DateAdd("d", -1, mFechaHasta)
                  Set oRs = Aplicacion.OrdenesPago.TraerFiltrado("Fecha", Array(mFechaDesde, mFechaHasta))
            End Select
            mUno = False
         End If
      Case "OtrosIngresosAlmacenTodos", "+SubOI2"
         Set oRs = Aplicacion.OtrosIngresosAlmacen.TraerFiltrado("_TT_DetallesParametrizados", Array(Identificador, 1))
      Case "Paises"
         Set oRs = Aplicacion.Paises.TraerFiltrado("_TT", Identificador)
      Case "PartesProduccion"
         'Set oRs = Aplicacion.PartesProduccion.TraerFiltrado("_TT", Identificador)
      Case "+SubPo1", "+SubPe2", "PedidosTodos", "PedidosSubcontratosTodos", "+SubPS2", "PedidosPendientes"
         Set oRs = Aplicacion.Pedidos.TraerFiltrado("_TT", Identificador)
         Lista.Sorted = True
         Lista.SortOrder = lvwDescending
         Lista.SortKey = 0
      Case "PedidosAbiertos"
         Set oRs = Aplicacion.PedidosAbiertos.TraerFiltrado("_TT", Identificador)
      Case "Planos"
         Set oRs = Aplicacion.Planos.TraerFiltrado("_TT", Identificador)
      Case "PlazosEntrega"
         Set oRs = Aplicacion.PlazosEntrega.TraerFiltrado("_TT", Identificador)
      Case "PlazosFijosTodos", "PlazosFijosAVencer", "PlazosFijosVencidos"
         Set oRs = Aplicacion.PlazosFijos.TraerFiltrado("_TT", Identificador)
      Case "PosicionesImportacion"
         Set oRs = Aplicacion.PosicionesImportacion.TraerFiltrado("_TT", Identificador)
      Case "Presupuestos", "+SubPr2", "PresupuestosTodos"
         Set oRs = Aplicacion.Presupuestos.TraerFiltrado("_TT", Identificador)
      Case "PresupuestoFinanciero"
         Set oRs = Aplicacion.RubrosContables.TraerFiltrado("_TT_PresupuestoFinanciero", Identificador)
      Case "+SubPEb"
         Columnas = VBA.Split(Arbol.SelectedItem.Key, " ")
         Set oRs = Aplicacion.Cuentas.TraerFiltrado("_TT_PresupuestoEconomico", Array(Columnas(1), Identificador))
         Lista.SelectedItem.Tag = Identificador
      Case "PresupuestoObrasGruposMateriales"
         'Set oRs = Aplicacion.PresupuestoGruposMateriales.TraerFiltrado("_TT", Identificador)
      Case "PresupuestoObrasRubros"
         Set oRs = Aplicacion.PresupuestoObrasRubros.TraerFiltrado("_TT", Identificador)
      Case "ProveedoresEventuales"
         Set oRs = Aplicacion.Proveedores.TraerFiltrado("_TT_Eventual", Identificador)
      Case "ProveedoresResumen"
         Set oRs = Aplicacion.Proveedores.TraerFiltrado("_UnRegistroResumen", Identificador)
      Case "ProveedoresDetalle"
         Set oRs = Aplicacion.Proveedores.TraerFiltrado("_TT", Identificador)
      Case "ProveedoresAConfirmar"
         Lista.ListItems.Remove (Lista.object.SelectedItem.Index)
         Exit Sub
      Case "Provincias"
         Set oRs = Aplicacion.Provincias.TraerFiltrado("_TT", Identificador)
      Case "PuntosVenta"
         Set oRs = Aplicacion.PuntosVenta.TraerFiltrado("_TT", Identificador)
      Case "Rangos"
         Set oRs = Aplicacion.Rangos.TraerFiltrado("_TT", Identificador)
      Case "Recepciones", "RecepcionesTodas", "RecepcionesUltimos3Meses", "+SubRP2"
         Set oRs = Aplicacion.Recepciones.TraerFiltrado("_TT", Identificador)
      Case "Recepciones1", "Recepciones1Todas", "+SubR22"
         Set oRs = Aplicacion.Recepciones.TraerFiltrado("_TT", Identificador)
      Case "RecibosTodos", "RecibosAgrupados", "+SubRE2"
         Set oRs = Aplicacion.Recibos.TraerFiltrado("_TT", Identificador)
      Case "Relaciones"
         Set oRs = Aplicacion.Relaciones.TraerFiltrado("_TT", Identificador)
      Case "RemitosTodos", "RemitosAgrupados", "+SubRM2"
         Set oRs = Aplicacion.Remitos.TraerFiltrado("_TT", Identificador)
      Case "Requerimientos", "RequerimientosTodos", "RequerimientosObras", "RequerimientosCC", "+ObrXRM", "HRequerimientos", "+ObHXRM", _
            "RequerimientosAgrupados", "+SubRq2", "RequerimientosAConfirmar", "+SubRo1", "RequerimientosALiberar"
         Set oRs = Aplicacion.Requerimientos.TraerFiltrado("_TT", Identificador)
      Case "Reservas"
         Set oRs = Aplicacion.Reservas.TraerFiltrado("_TT", Identificador)
      Case "ResumenesParaConciliacionTodos", "+SubRC2"
         Set oRs = Aplicacion.Conciliaciones.TraerFiltrado("_TT", Identificador)
      Case "Revaluos"
         Set oRs = Aplicacion.Revaluos.TraerFiltrado("_TT", Identificador)
      Case "Rubros"
         Set oRs = Aplicacion.Rubros.TraerFiltrado("_TT", Identificador)
      Case "RubrosContablesGastosPorObra"
         Set oRs = Aplicacion.RubrosContables.TraerFiltrado("_TT", Identificador)
      Case "RubrosContablesFinancieros"
         Set oRs = Aplicacion.RubrosContables.TraerFiltrado("_TT_Financieros", Identificador)
      Case "SalidaMaterialesTodas", "+SubSA2"
         Set oRs = Aplicacion.SalidasMateriales.TraerFiltrado("_TT", Identificador)
      Case "SalidaMaterialesTodas1", "+SubS22"
         Set oRs = Aplicacion.SalidasMateriales.TraerFiltrado("_TT", Identificador)
      Case "Schedulers"
         Set oRs = Aplicacion.Schedulers.TraerFiltrado("_TT", Identificador)
      Case "Sectores"
         Set oRs = Aplicacion.Sectores.TraerFiltrado("_TT", Identificador)
      Case "Series"
         Set oRs = Aplicacion.Series.TraerFiltrado("_TT", Identificador)
      Case "SolicitudesCompra", "SolicitudesCompraTodas", _
            "SolicitudesCompraAgrupadas", "+SubSC1", "+SubSC2"
         Set oRs = Aplicacion.SolicitudesCompra.TraerFiltrado("_TT", Identificador)
'      Case "Subdiarios", "SubdiariosTodos", "SubdiariosAgrupados", "+SubSd1", "+SubSd2"
'         Set oRs = Aplicacion.Subdiarios.TraerFiltrado("_TT", Identificador)
      Case "Subcontratos"
         Set oRs = Aplicacion.Subcontratos.TraerFiltrado("_TT", Identificador)
      Case "Subrubros"
         Set oRs = Aplicacion.Subrubros.TraerFiltrado("_TT", Identificador)
      Case "TarifasFletes"
         Set oRs = Aplicacion.TarifasFletes.TraerFiltrado("_TT", Identificador)
      Case "TarjetasCredito"
         Set oRs = Aplicacion.TarjetasCredito.TraerFiltrado("_TT", Identificador)
      Case "Tipos"
         Set oRs = Aplicacion.Tipos.TraerFiltrado("_TT", Identificador)
      Case "TiposArticulos"
         Set oRs = Aplicacion.Tipos.TraerFiltrado("_TT_PorGrupo", Array(Identificador, 1))
      Case "TiposComprobante"
         Set oRs = Aplicacion.TiposComprobante.TraerFiltrado("_TT", Identificador)
      Case "TiposCuentaGrupos"
         Set oRs = Aplicacion.TiposCuentaGrupos.TraerFiltrado("_TT", Identificador)
      Case "TiposRosca"
         Set oRs = Aplicacion.TiposRosca.TraerFiltrado("_TT", Identificador)
      Case "TTermicos"
         Set oRs = Aplicacion.TTermicos.TraerFiltrado("_TT", Identificador)
      Case "Traducciones"
         Set oRs = Aplicacion.Traducciones.TraerFiltrado("_TT", Identificador)
      Case "Transportistas", "Transportistas1"
         Set oRs = Aplicacion.Transportistas.TraerFiltrado("_TT", Identificador)
      Case "Ubicaciones"
         Set oRs = Aplicacion.Ubicaciones.TraerFiltrado("_TT", Identificador)
      Case "Unidades"
         Set oRs = Aplicacion.Unidades.TraerFiltrado("_TT", Identificador)
      Case "UnidadesOperativas"
         Set oRs = Aplicacion.UnidadesOperativas.TraerFiltrado("_TT", Identificador)
      Case "ValesSalidaTodos", "+SubVS2"
         Set oRs = Aplicacion.ValesSalida.TraerFiltrado("_TT", Identificador)
      Case "Valores", "+SubVl1", "ValoresTodos"
         Set oRs = Aplicacion.Valores.TraerFiltrado("_TT", Identificador)
      Case "Vendedores"
         Set oRs = Aplicacion.Vendedores.TraerFiltrado("_TT", Identificador)
      Case "VentasCuotasOperacion"
         Set oRs = Aplicacion.VentasEnCuotas.TraerFiltrado("_TT", Identificador)
      Case "VentasCuotasGeneracion"
         Set oRs = Aplicacion.VentasEnCuotas.TraerFiltrado("_CuotasGeneradas_UnNumero", Identificador)
      
      Case Else
'         MsgBox "No implementado en esta versión"
         Exit Sub
   End Select
   
   Lista.UltimaAccion = TipoAccion
   
   If Not oRs Is Nothing Then
      If oRs.RecordCount > 0 Then
         If mUno Then
            Set Lista.RecordSource = oRs
         Else
            Set Lista.DataSource = oRs
            Lista.IconoGrande = mIcono
            Lista.IconoPequeño = mIcono
         End If
      End If
   End If
   
   If Len(mIdiomaInicial) > 0 Then CambiarLenguaje Me, mIdiomaInicial, glbIdiomaActual, ""

Salida:
   Set oRs = Nothing
   
   If IdentificadorOriginal = -1 And glbCargaEnSerie And mEdicionEnSerie Then Editar -1, Identificador

End Sub

Public Sub ImprimeProveedores(ByVal TipoSalida As String)

   Dim oW As Word.Application
   Dim oRs As ADOR.Recordset
   Dim oL As ListItem
   Dim i As Integer
   
   Me.MousePointer = vbHourglass
      
   Set oW = CreateObject("Word.Application")
   
   With oW
      .Visible = True
      
      With .Documents.Add(glbPathPlantillas & "\Proveedores.dot")
         oW.Selection.HomeKey Unit:=wdStory
         oW.Selection.MoveDown Unit:=wdLine, Count:=5
         oW.Selection.MoveLeft Unit:=wdCell, Count:=1
          
         For Each oL In Lista.ListItems
            Set oRs = Aplicacion.Proveedores.TraerFiltrado("_TT", oL.Tag)
         
            With oRs
               Do Until .EOF
                  oW.Selection.MoveRight Unit:=wdCell
                  oW.Selection.TypeText Text:="" & .Fields("Razon social").Value
                  oW.Selection.MoveRight Unit:=wdCell
                  oW.Selection.TypeText Text:="" & .Fields("Nombre de fantasia").Value
                  oW.Selection.MoveRight Unit:=wdCell
                  oW.Selection.TypeText Text:="" & .Fields("Direccion").Value
                  oW.Selection.MoveRight Unit:=wdCell
                  oW.Selection.TypeText Text:="" & .Fields("Localidad").Value
                  oW.Selection.MoveRight Unit:=wdCell
                  oW.Selection.TypeText Text:="" & .Fields("Cod.postal").Value
                  oW.Selection.MoveRight Unit:=wdCell
                  oW.Selection.TypeText Text:="" & .Fields("Provincia").Value
                  oW.Selection.MoveRight Unit:=wdCell
                  oW.Selection.TypeText Text:="" & .Fields("Pais").Value
                  oW.Selection.MoveRight Unit:=wdCell
                  oW.Selection.MoveRight Unit:=wdCell
                  oW.Selection.TypeText Text:="" & .Fields("Telefono").Value
                  oW.Selection.MoveRight Unit:=wdCell
                  oW.Selection.TypeText Text:="" & .Fields("Telef.adic.").Value
                  oW.Selection.MoveRight Unit:=wdCell
                  oW.Selection.TypeText Text:="" & .Fields("Fax").Value
                  oW.Selection.MoveRight Unit:=wdCell
                  oW.Selection.TypeText Text:="" & .Fields("Cuit").Value
                  oW.Selection.MoveRight Unit:=wdCell
                  oW.Selection.TypeText Text:="" & .Fields("Condicion IVA").Value
                  oW.Selection.MoveRight Unit:=wdCell
                  oW.Selection.TypeText Text:="" & .Fields("Email").Value
                  oW.Selection.MoveRight Unit:=wdCell
                  oW.Selection.MoveRight Unit:=wdCell
                  oW.Selection.TypeText Text:="" & .Fields("Contacto").Value
                  oW.Selection.MoveRight Unit:=wdCell
                  oW.Selection.TypeText Text:="" & .Fields("Actividad principal").Value
                  oW.Selection.MoveRight Unit:=wdCell
                  oW.Selection.TypeText Text:="" & .Fields("Cond. de compra").Value
                  oW.Selection.MoveRight Unit:=wdCell
                  oW.Selection.TypeText Text:="" & .Fields("Estado").Value
                  oW.Selection.MoveRight Unit:=wdCell
                  oW.Selection.TypeText Text:="" & .Fields("Fecha de alta").Value
                  oW.Selection.MoveRight Unit:=wdCell
                  oW.Selection.TypeText Text:="" & .Fields("Habitual").Value
                  .MoveNext
               Loop
            End With
         Next
          
         'Registro de numero de paginas, fecha y hora
         oW.Application.Run MacroName:="DatosDelPie"
          
         oRs.Close
         Set oRs = Nothing
          
         If TipoSalida = "I" Then
            oW.ActiveDocument.PrintOut False
            .Close False
         End If
      End With
      
      If TipoSalida = "I" Then .Quit
   End With
   
   Set oW = Nothing

   Me.MousePointer = vbDefault
      
End Sub

Public Sub CargarPermisos()

   Dim oRs As ADOR.Recordset
   Dim i As Integer
   
   If glbIdUsuario > 0 Then
      Set oRs = Aplicacion.Empleados.TraerFiltrado("_PorEmpleado", glbIdUsuario)
      With oRs
         If .RecordCount > 0 Then
            i = 0
            .MoveFirst
            Do While Not .EOF
               Accesos(i, 0) = .Fields("Nodo").Value
               If .Fields("Acceso").Value Then
                  Accesos(i, 1) = "Ok"
               Else
                  Accesos(i, 1) = ""
               End If
               If Not IsNull(.Fields("Nivel").Value) Then
                  Accesos(i, 2) = "" & .Fields("Nivel").Value
               Else
                  Accesos(i, 2) = "0"
               End If
               If Not IsNull(.Fields("FechaDesdeParaModificacion").Value) Then
                  Accesos(i, 3) = "" & .Fields("FechaInicialHabilitacion").Value & _
                              "|" & .Fields("FechaFinalHabilitacion").Value & _
                              "|" & .Fields("FechaDesdeParaModificacion").Value & "|"
                  If Not IsNull(.Fields("CantidadAccesos").Value) Then
                     Accesos(i, 3) = Accesos(i, 3) & .Fields("CantidadAccesos").Value
                  End If
               Else
                  Accesos(i, 3) = ""
               End If
               i = i + 1
               .MoveNext
            Loop
         End If
         .Close
      End With
      Set oRs = Nothing
   End If

End Sub

Public Function ControlAcceso(clave As String) As Boolean

   Dim i As Integer
   
   For i = 0 To UBound(Accesos)
      If Accesos(i, 0) = clave Then
         If Accesos(i, 1) = "Ok" Then
            ControlAcceso = True
         Else
            ControlAcceso = False
         End If
         Exit Function
      End If
   Next

   ControlAcceso = False

End Function

Public Function ControlAccesoNivel(clave As String) As Integer

   Dim i As Integer
   
   For i = 0 To UBound(Accesos)
      If Accesos(i, 0) = clave Then
         If Accesos(i, 1) = "Ok" Then
            ControlAccesoNivel = Accesos(i, 2)
            Exit Function
         Else
            Exit For
         End If
      End If
   Next

   ControlAccesoNivel = 10

End Function

Public Function ControlAccesoNivelExistente(clave As String) As Boolean

   Dim mExiste As Boolean
   Dim i As Integer
   
   mExiste = False
   For i = 0 To UBound(Accesos)
      If Accesos(i, 0) = clave Then
         mExiste = True
         Exit For
      End If
   Next

   ControlAccesoNivelExistente = mExiste

End Function

Public Function ControlAccesoOpciones(clave As String) As String

   Dim i As Integer
   
   For i = 0 To UBound(Accesos)
      If Accesos(i, 0) = clave Then
         If Accesos(i, 1) = "Ok" Then
            ControlAccesoOpciones = Accesos(i, 3)
            Exit Function
         Else
            Exit For
         End If
      End If
   Next

   ControlAccesoOpciones = ""

End Function

Public Sub ImprimirConExcelDesdeRs(ByVal oRs As ADOR.Recordset, ByVal Titulo As String)

   Dim s As String
   Dim i As Integer, fl As Integer, cl As Integer
   Dim oEx As Excel.Application
   
   Set oEx = CreateObject("Excel.Application")
   
   With oEx
      .Visible = True
      With .Workbooks.Add(glbPathPlantillas & "\Planilla.xlt")
         With .ActiveSheet
            .Name = Titulo
            For i = 1 To oRs.Fields.Count - 1
               .Cells(1, i) = oRs.Fields(i).Name
            Next
            If oRs.RecordCount > 0 Then
               fl = 2
               oRs.MoveFirst
               Do While Not oRs.EOF
                  For i = 1 To oRs.Fields.Count - 1
                     If Not IsNull(oRs.Fields(i).Value) Then
                        If oRs.Fields(i).Type = adLongVarChar Or oRs.Fields(i).Type = adLongVarWChar Then
                           RichTextBox1.TextRTF = oRs.Fields(i).Value
                           .Cells(fl, i) = RichTextBox1.Text
                        Else
                           .Cells(fl, i) = oRs.Fields(i).Value
                        End If
                     Else
                        .Cells(fl, i) = " "
                     End If
                  Next
                  fl = fl + 1
                  oRs.MoveNext
               Loop
            End If
            .Range("A1").Select
         End With
         oEx.Run "ArmarFormato"
      End With
   End With
   
   Set oEx = Nothing

End Sub

Public Sub CopiarAlClipboard()

   Dim s1 As String
   s1 = Lista.GetString
   If Len(s1) Then
      With Clipboard
         .Clear
         .SetText s1
      End With
   End If

End Sub

Public Sub Refrescar()

   Dim Nodo As Node
   Dim mvarBorrado As Boolean
   Dim oRs As ADOR.Recordset

   Arbol.Nodes(1).Selected = True
   Lista.ListItems.Clear
   
   Do While True
      mvarBorrado = False
      For Each Nodo In Arbol.Nodes
         If mId(Nodo.Key, 1, 1) = "+" Then
            Arbol.Nodes.Remove Nodo.Key
            mvarBorrado = True
            Exit For
         End If
      Next
      If Not mvarBorrado Then
         Exit Do
      End If
   Loop
   
   Set oRs = Aplicacion.Articulos.TraerFiltrado("_ParaMenu")
   GrabarMenu oRs
   oRs.Close
   Set oRs = Nothing

End Sub

Public Sub VerNovedadesEventos()

   On Error Resume Next
   If Aplicacion.Empleados.TieneNovedades(glbIdUsuario) Then
      Dim oF As frmNovedadesUsuario
      Set oF = New frmNovedadesUsuario
      oF.Show vbModal, Me
      VerNovedades = False
   End If

End Sub

Public Sub VerAyuda()

   Call ShellExecute(Me.hwnd, "open", glbPathPlantillas & "\BDLProntoManual.htm", vbNullString, vbNullString, SW_SHOWNORMAL)

End Sub

Public Sub ProcesarPedidosEstadoObras()

   Dim goMailOL As CEmailOL
   Dim oF As frmInformacion
   Dim lStatus, i As Long
   Dim mLista As String, mSubject As String, mBody As String, mAttachment As String
   Dim mInforme As String, mCodigoObra As String
   Dim mDatos1() As String
   Dim mDatos2() As String
   
   On Error GoTo Salida
   
   Set oF = New frmInformacion
   oF.Label1.Caption = "PROCESAMIENTO DE PEDIDOS DE ESTADO DE OBRAS"
   oF.Show , Me
   
   mInforme = App.Path & "\EstadoObras.xls"
   
   Set goMailOL = New CEmailOL
   lStatus = goMailOL.LeerPedidosEstadoObras(oF)
   
   If Len(goMailOL.RespuestasOK) Then
      mDatos1 = VBA.Split(goMailOL.RespuestasOK, "|")
      For i = 0 To UBound(mDatos1)
         mDatos2 = VBA.Split(mDatos1(i), "*")
         mCodigoObra = Trim(mId(mDatos2(0), 15, 100))
         GenerarInformeEstadoObra mCodigoObra, 2
         If Len(Trim(Dir(mInforme))) <> 0 Then
            mAttachment = mInforme
            mLista = mDatos2(1)
            mSubject = "RE: " & mDatos2(0)
            mBody = "" & vbCrLf & vbCrLf & "     Informe estado de obra : " & mCodigoObra & vbCrLf
            lStatus = goMailOL.Send(mLista, True, mSubject, mBody, mAttachment)
            Kill mInforme
            If lStatus <> 0 Then
               MsgBox "No se pudo generar el informe de la obra " & mCodigoObra & " pedido por " & mDatos2(1), vbCritical
            End If
         Else
            MsgBox "No se pudo generar el informe de la obra " & mCodigoObra & " pedido por " & mDatos2(1), vbCritical
         End If
      Next
   End If
   
Salida:
   
   Unload oF
   Set oF = Nothing
   
   Set goMailOL = Nothing
   
End Sub

Public Sub GenerarInformeEstadoObra(ByVal CodigoObra As String, ByVal TipoSalida As Integer)

   Dim oAp As ComPronto.Aplicacion
   Dim s As String
   Dim fl As Integer, cl As Integer
   Dim mIdObra As Long, mReq As Long, mAco As Long, i As Long
   Dim oEx As Excel.Application
   Dim oRs As ADOR.Recordset
   Dim oRsPed As ADOR.Recordset
   Dim oRsRec As ADOR.Recordset
   Dim oRsFac As ADOR.Recordset
   
   On Error GoTo Salida
   
   Set oRs = Aplicacion.Obras.TraerFiltrado("_PorNumero", CodigoObra)
   
   If oRs.RecordCount = 0 Then
      GoTo Salida
   End If
   
   mReq = -1
   mAco = -1
   mIdObra = oRs.Fields(0).Value
   oRs.Close
         
   Set oAp = Aplicacion
   oAp.Tarea ("Obras_GenerarEstado")
   Set oRs = oAp.Obras.TraerFiltrado("_EstadoObras", Array(mIdObra, mReq, mAco))
         
   Set oEx = CreateObject("Excel.Application")
   
   With oEx
      
      .Visible = True
      
      With .Workbooks.Add(glbPathPlantillas & "\EstadoObras.xlt")
         
         With .ActiveSheet

            fl = 6
            
            If oRs.RecordCount > 0 Then
               
               oRs.MoveFirst
               Do While Not oRs.EOF
               
                  s = ""
                  If Not IsNull(oRs.Fields("Observaciones").Value) Then
                     RichTextBox1.TextRTF = oRs.Fields("Observaciones").Value
                     s = RichTextBox1.Text
                     s = Replace(s, Chr(13) + Chr(10) + Chr(13) + Chr(10), "")
                  End If
         
                  .Cells(fl, 1) = oRs.Fields("Comprobante").Value
                  .Cells(fl, 2) = oRs.Fields("Numero").Value
                  .Cells(fl, 3) = CDate(oRs.Fields("Fecha").Value)
                  If Not IsNull(oRs.Fields("Emisor").Value) Then .Cells(fl, 4) = oRs.Fields("Emisor").Value
                  If Not IsNull(oRs.Fields("Item").Value) Then .Cells(fl, 5) = oRs.Fields("Item").Value
                  If Not IsNull(oRs.Fields("Fecha nec.").Value) Then .Cells(fl, 6) = CDate(oRs.Fields("Fecha nec.").Value)
                  If Not IsNull(oRs.Fields("Fecha ult.firma").Value) Then .Cells(fl, 7) = CDate(oRs.Fields("Fecha ult.firma").Value)
                  If Not IsNull(oRs.Fields("Articulo").Value) Then .Cells(fl, 8) = oRs.Fields("Articulo").Value
                  .Cells(fl, 9) = s
                  If Not IsNull(oRs.Fields("Cantidad").Value) Then .Cells(fl, 10) = oRs.Fields("Cantidad").Value
                  If Not IsNull(oRs.Fields("Unidad en").Value) Then .Cells(fl, 11) = oRs.Fields("Unidad en").Value
                  If Not IsNull(oRs.Fields("Med.1").Value) Then .Cells(fl, 12) = oRs.Fields("Med.1").Value
                  If Not IsNull(oRs.Fields("Med.2").Value) Then .Cells(fl, 13) = oRs.Fields("Med.2").Value
                  If Not IsNull(oRs.Fields("Cant.Ped.").Value) Then .Cells(fl, 14) = oRs.Fields("Cant.Ped.").Value
                  If Not IsNull(oRs.Fields("Cant.Rec.").Value) Then .Cells(fl, 15) = oRs.Fields("Cant.Rec.").Value
                  If Not IsNull(oRs.Fields("Cant.Fac.").Value) Then .Cells(fl, 16) = oRs.Fields("Cant.Fac.").Value
                  
                  If oRs.Fields("Comprobante").Value = "R.M." Then
                     Set oRsPed = oAp.Obras.TraerFiltrado("_EstadoObras_DetallePedidosDesdeRM", oRs.Fields("Id").Value)
                     Set oRsRec = oAp.Obras.TraerFiltrado("_EstadoObras_DetalleRecepcionesDesdeRM", oRs.Fields("Id").Value)
                     Set oRsFac = oAp.Obras.TraerFiltrado("_EstadoObras_DetalleFacturasAsignadas", Array(EnumFormularios.RequerimientoMateriales, oRs.Fields("Id").Value))
                  Else
                     Set oRsPed = oAp.Obras.TraerFiltrado("_EstadoObras_DetallePedidosDesdeAcopio", oRs.Fields("Id").Value)
                     Set oRsRec = oAp.Obras.TraerFiltrado("_EstadoObras_DetalleRecepcionesDesdeAcopio", oRs.Fields("Id").Value)
                     Set oRsFac = oAp.Obras.TraerFiltrado("_EstadoObras_DetalleFacturasAsignadas", Array(EnumFormularios.ListaAcopio, oRs.Fields("Id").Value))
                  End If
                  
                  If Not (oRsPed.EOF And oRsRec.EOF And oRsFac.EOF) Then
                     Do While Not (oRsPed.EOF And oRsRec.EOF And oRsFac.EOF)
                        If Not oRsPed.EOF Then
                           .Cells(fl, 18) = "Ped."
                           .Cells(fl, 19) = oRsPed.Fields("Pedido").Value
                           .Cells(fl, 20) = oRsPed.Fields("Fecha").Value
                           .Cells(fl, 21) = oRsPed.Fields("Comprador").Value
                           .Cells(fl, 22) = oRsPed.Fields("Proveedor").Value
                           .Cells(fl, 23) = oRsPed.Fields("Importe s/iva").Value
                           .Cells(fl, 24) = oRsPed.Fields("F.entrega").Value
                           .Cells(fl, 25) = ""
                           oRsPed.MoveNext
                        End If
                        If Not oRsRec.EOF Then
                           .Cells(fl, 27) = "Rec."
                           .Cells(fl, 28) = oRsRec.Fields("NumeroRecepcionAlmacen").Value
                           .Cells(fl, 29) = oRsRec.Fields("Recepcion").Value
                           .Cells(fl, 30) = oRsRec.Fields("Fecha").Value
                           .Cells(fl, 31) = oRsRec.Fields("Cantidad").Value
                           .Cells(fl, 32) = oRsRec.Fields("Unid.").Value
                           oRsRec.MoveNext
                        ElseIf Not oRsFac.EOF Then
                           .Cells(fl, 27) = "Fac."
                           .Cells(fl, 28) = ""
                           .Cells(fl, 29) = oRsFac.Fields("Nro.factura").Value
                           .Cells(fl, 30) = oRsFac.Fields("Fecha fac.").Value
                           .Cells(fl, 31) = ""
                           .Cells(fl, 32) = ""
                           oRsFac.MoveNext
                        End If
                        fl = fl + 1
                     Loop
                  Else
                     fl = fl + 1
                  End If
                  
                  oRsPed.Close
                  oRsRec.Close
                  oRsFac.Close
            
                  oRs.MoveNext
                  
               Loop
               
            End If
                  
         End With
         
'         oEx.Run "ArmarInforme", Lista
         If TipoSalida = 2 Then
            .SaveAs App.Path & "\EstadoObras.xls"
            .Close False
         End If
      
      End With
      
      If TipoSalida = 2 Then .Quit
   
   End With
   
Salida:

   Set oRs = Nothing
   Set oRsPed = Nothing
   Set oRsRec = Nothing
   Set oRsFac = Nothing
   Set oAp = Nothing
   Set oEx = Nothing

End Sub

Public Function ArmarPlanDeCuentas(ByVal mCodigo As Integer) As ADOR.Recordset

   Dim oRs As ADOR.Recordset
   Dim i As Integer, mMargen As Integer
   Dim mControl(5) As String
   Dim mVector

   If BuscarClaveINI("Permitir multiplan de cuentas") = "SI" Then
      Dim oF As frm_Aux
      Dim mOk As Boolean
      Set oF = New frm_Aux
      With oF
         .Label2(0).Caption = "Fecha consulta :"
         .Label2(0).Visible = True
         .DTFields(0).Value = Date
         .DTFields(0).Visible = True
         .Label1.Visible = False
         .Text1.Visible = False
         .cmd(0).Top = .DTFields(0).Top + .DTFields(0).Height + 100
         .cmd(1).Top = .cmd(0).Top
         .Height = .Height * 0.6
         .Show vbModal, Me
         mOk = .Ok
         mFechaParaPlanCuentas = .DTFields(0).Value
      End With
      Unload oF
      Set oF = Nothing
      If mOk Then
         Set oRs = Aplicacion.Cuentas.TraerFiltrado("_PorJerarquia", Array(mCodigo, mFechaParaPlanCuentas))
      Else
         Set oRs = Aplicacion.Cuentas.TraerFiltrado("_PorJerarquia", mCodigo)
      End If
   Else
      Set oRs = Aplicacion.Cuentas.TraerFiltrado("_PorJerarquia", mCodigo)
   End If
   
   With oRs
      If .RecordCount > 0 Then
         .MoveFirst
         mVector = VBA.Split(IIf(IsNull(.Fields("Jerarquia").Value), "0.0.00.00.000", .Fields("Jerarquia").Value), ".")
         For i = 0 To 4: mControl(i) = mVector(i): Next
         mMargen = 0
         Do While Not .EOF
            mVector = VBA.Split(IIf(IsNull(.Fields("Jerarquia").Value), "0.0.00.00.000", .Fields("Jerarquia").Value), ".")
            For i = 0 To 4
               If i <= UBound(mVector) Then
                  If mControl(i) <> mVector(i) Then
                     mControl(i) = mVector(i)
                     If Len(mVector(i)) = 0 Then
                        mMargen = 0
                     Else
                        If CInt(mVector(i)) <> 0 Then mMargen = i * 5
                     End If
                  End If
               Else
                  mMargen = 0
               End If
            Next
            .Fields("Descripcion").Value = VBA.mId(Space(mMargen) & .Fields("Descripcion").Value, 1, 100)
            .Update
            .MoveNext
         Loop
         .MoveFirst
      End If
   End With
   
   Set ArmarPlanDeCuentas = oRs
   
   Set oRs = Nothing
   
End Function

Public Sub GenerarDiferenciasCambio(ByRef Lista As DbListView)

   Dim oAp As ComPronto.Aplicacion
   Dim oDif As ComPronto.DiferenciaCambio
   Dim oPar As ComPronto.Parametro
   Dim oComp As ComPronto.ComprobanteProveedor
   Dim iFilas As Integer
   Dim mNum As Long
   Dim Filas
   Dim Columnas
         
   Set oAp = Aplicacion
            
   Filas = VBA.Split(Lista.GetString, vbCrLf)
   
   For iFilas = LBound(Filas) + 1 To UBound(Filas)
      
      Columnas = VBA.Split(Filas(iFilas), vbTab)
      
'      Set oPar = oAp.Parametros.Item(1)
'      With oPar.Registro
'         mNum = .Fields("ProximoComprobanteProveedorReferencia").Value
'
'         .Fields("ProximoComprobanteProveedorReferencia").Value = mNum + 1
'      End With
'      oPar.Guardar
'      Set oPar = Nothing
            
      
            
            
      Set oDif = oAp.DiferenciasCambio.Item(Columnas(0))
      With oDif.Registro
         .Fields("Estado").Value = "SI"
      
      
      End With
      oDif.Guardar
      Set oDif = Nothing
   
   
   
   
   Next

   Set oAp = Nothing

End Sub

Public Sub CargarArbol()

   Dim oRs As ADOR.Recordset
   Dim mExisteProntoMantenimiento As Boolean
   
   Set oRs = Aplicacion.Articulos.TraerFiltrado("_BD_ProntoMantenimientoExiste")
   mExisteProntoMantenimiento = False
   If oRs.RecordCount > 0 Then
      mExisteProntoMantenimiento = True
   End If
   oRs.Close
   Set oRs = Nothing
   
   ArbolDefault.Nodes.Clear
   Arbol.Nodes.Clear
   If Lista.ColumnHeaders.Count > 0 Then
      Lista.ListItems.Clear
      Lista.ColumnHeaders.Clear
   End If
   
   With ArbolDefault.Nodes
      .Add , , "Ppal", glbEmpresaSegunString, "Ppal", "Ppal"
      
      .Add "Ppal", tvwChild, "Tablas Generales", "Tablas Generales", "TablasG", "TablasG"
'      .Add "Tablas Generales", tvwChild, "CentrosCosto", "Centros de costo", "CentrosCosto", "CentrosCosto"
      .Add "Tablas Generales", tvwChild, "ArchivosATransmitirDestinos", "Destinos para transmisiones de novedades", "ArchivosATransmitirDestinos", "ArchivosATransmitirDestinos"
      .Add "Tablas Generales", tvwChild, "Localidades", "Localidades", "Localidades", "Localidades"
      .Add "Tablas Generales", tvwChild, "Monedas", "Monedas", "Monedas", "Monedas"
      .Add "Tablas Generales", tvwChild, "Paises", "Paises", "Paises", "Paises"
      .Add "Tablas Generales", tvwChild, "Provincias", "Provincias", "Provincias", "Provincias"
      .Add "Tablas Generales", tvwChild, "TiposComprobante", "Tipos de comprobante", "TiposComprobante", "TiposComprobante"
      .Add "Tablas Generales", tvwChild, "Traducciones", "Traducciones", "Traducciones", "Traducciones"
      .Add "Tablas Generales", tvwChild, "Transportistas", "Transportistas", "Transportistas", "Transportistas"
      
      .Add "Ppal", tvwChild, "Articulos", "Articulos", "Articulos", "Articulos"
      .Add "Articulos", tvwChild, "ArticulosTodos", "Articulos (Todos)", "Articulos", "Articulos"
      .Add "ArticulosTodos", tvwChild, "ArticulosTodosDetallados", "Articulos (Todos detallados)", "Articulos", "Articulos"
      .Add "ArticulosTodos", tvwChild, "ArticulosTodosResumidos", "Articulos (Todos resumidos)", "Articulos", "Articulos"
      .Add "Articulos", tvwChild, "ArticulosRubros", "Articulos (Por rubros)", "Articulos", "Articulos"
      .Add "Articulos", tvwChild, "ArticulosEquiposTerceros", "Articulos (Equipos de terceros)", "Articulos", "Articulos"
      .Add "Articulos", tvwChild, "ArticulosInactivos", "Articulos inactivos", "Articulos", "Articulos"
      If mExisteProntoMantenimiento Then
         .Add "Articulos", tvwChild, "ArticulosProntoMantenimiento", "Articulos Pronto Mantenimiento", "Articulos", "Articulos"
      End If
      .Add "Articulos", tvwChild, "DefinicionesArt", "Definicion de Mascaras de Articulos", "DefinicionesArt", "DefinicionesArt"
      .Add "DefinicionesArt", tvwChild, "DefinicionesArtTodos", "Definicion de Mascaras de Articulos (Todas)", "DefinicionesArt", "DefinicionesArt"
      .Add "DefinicionesArt", tvwChild, "DefinicionesArtRubros", "Definicion de Mascaras de Articulos (Por rubros)", "DefinicionesArt", "DefinicionesArt"
      .Add "Articulos", tvwChild, "Rubros", "Rubros", "Rubros", "Rubros"
      .Add "Articulos", tvwChild, "Subrubros", "Subrubros", "Subrubros", "Subrubros"
'      .Add "Articulos", tvwChild, "Familias", "Familias", "Familias", "Familias"
      .Add "Articulos", tvwChild, "Conjuntos", "Conjuntos", "Conjuntos", "Conjuntos"
      .Add "Conjuntos", tvwChild, "ConjuntosTodos", "Conjuntos (Todos)", "Conjuntos", "Conjuntos"
      .Add "Conjuntos", tvwChild, "ConjuntosFinales", "Conjuntos (Finales)", "Conjuntos", "Conjuntos"
      .Add "Conjuntos", tvwChild, "ConjuntosDependientes", "Subconjuntos", "Conjuntos", "Conjuntos"
      .Add "Articulos", tvwChild, "ItemsPopUpMateriales", "Definicion de items para menu desplegable de materiales", "ItemsPopUpMateriales", "ItemsPopUpMateriales"
      .Add "Articulos", tvwChild, "Depositos", "Depositos", "Depositos", "Depositos"
      .Add "Articulos", tvwChild, "Ubicaciones", "Ubicaciones", "Ubicaciones", "Ubicaciones"
      .Add "Articulos", tvwChild, "Tablas relacionadas", "Tablas relacionadas", "TablasG", "TablasG"
      .Add "Tablas relacionadas", tvwChild, "Acabados", "Acabados", "Acabados", "Acabados"
      .Add "Tablas relacionadas", tvwChild, "AlimentacionesElectricas", "Alimentaciones Electricas", "AlimentacionesElectricas", "AlimentacionesElectricas"
      .Add "Tablas relacionadas", tvwChild, "AniosNorma", "Años y Adenda de Normas", "AniosNorma", "AniosNorma"
      .Add "Tablas relacionadas", tvwChild, "Biselados", "Biselados", "Biselados", "Biselados"
      .Add "Tablas relacionadas", tvwChild, "Calidades", "Calidades", "Calidades", "Calidades"
      .Add "Tablas relacionadas", tvwChild, "CalidadesClad", "Calidades clad", "CalidadesClad", "CalidadesClad"
      .Add "Tablas relacionadas", tvwChild, "Codigos", "Codigos", "Codigos", "Codigos"
      .Add "Tablas relacionadas", tvwChild, "CodigosUniversales", "Codigos Universales", "CodigosUniversales", "CodigosUniversales"
      .Add "Tablas relacionadas", tvwChild, "Colores", "Colores", "Colores", "Colores"
      .Add "Tablas relacionadas", tvwChild, "ControlesCalidad", "Controles de Calidad", "ControlesCalidad", "ControlesCalidad"
      .Add "Tablas relacionadas", tvwChild, "Densidades", "Densidades", "Densidades", "Densidades"
      .Add "Tablas relacionadas", tvwChild, "Formas", "Formas", "Formas", "Formas"
      .Add "Tablas relacionadas", tvwChild, "Grados", "Grados", "Grados", "Grados"
      .Add "Tablas relacionadas", tvwChild, "Marcas", "Marcas", "Marcas", "Marcas"
      .Add "Tablas relacionadas", tvwChild, "Materiales", "Materiales", "Materiales", "Materiales"
      .Add "Tablas relacionadas", tvwChild, "Modelos", "Modelos", "Modelos", "Modelos"
      .Add "Tablas relacionadas", tvwChild, "Normas", "Normas", "Normas", "Normas"
      .Add "Tablas relacionadas", tvwChild, "Rangos", "Rangos", "Rangos", "Rangos"
      .Add "Tablas relacionadas", tvwChild, "Relaciones", "Relaciones", "Relaciones", "Relaciones"
      .Add "Tablas relacionadas", tvwChild, "Schedulers", "Schedulers", "Schedulers", "Schedulers"
      .Add "Tablas relacionadas", tvwChild, "Series", "Series", "Series", "Series"
      .Add "Tablas relacionadas", tvwChild, "Tipos", "Tipos genericos", "Tipos", "Tipos"
      .Add "Tablas relacionadas", tvwChild, "TiposArticulos", "Tipos de articulo", "Tipos", "Tipos"
      .Add "Tablas relacionadas", tvwChild, "TiposRosca", "Tipos 2", "TiposRosca", "TiposRosca"
      .Add "Tablas relacionadas", tvwChild, "TTermicos", "Tratamientos Termicos", "TTermicos", "TTermicos"
      .Add "Tablas relacionadas", tvwChild, "Unidades", "Unidades", "Unidades", "Unidades"
      .Add "Tablas relacionadas", tvwChild, "AcotarTablas", "Acotamiento de Tablas", "AcotarTablas", "AcotarTablas"
      .Add "AcotarTablas", tvwChild, "AcoAcabados", "Acabados", "AcoAcabados", "AcoAcabados"
      .Add "AcotarTablas", tvwChild, "AcoBiselados", "Biselados", "AcoBiselados", "AcoBiselados"
      .Add "AcotarTablas", tvwChild, "AcoCalidades", "Calidades", "AcoCalidades", "AcoCalidades"
      .Add "AcotarTablas", tvwChild, "AcoCodigos", "Codigos", "AcoCodigos", "AcoCodigos"
      .Add "AcotarTablas", tvwChild, "AcoColores", "Colores", "AcoColores", "AcoColores"
      .Add "AcotarTablas", tvwChild, "AcoFormas", "Formas", "AcoFormas", "AcoFormas"
      .Add "AcotarTablas", tvwChild, "AcoGrados", "Grados", "AcoGrados", "AcoGrados"
      .Add "AcotarTablas", tvwChild, "AcoMarcas", "Marcas", "AcoMarcas", "AcoMarcas"
      .Add "AcotarTablas", tvwChild, "AcoMateriales", "Materiales", "AcoMateriales", "AcoMateriales"
      .Add "AcotarTablas", tvwChild, "AcoModelos", "Modelos", "AcoModelos", "AcoModelos"
      .Add "AcotarTablas", tvwChild, "AcoNormas", "Normas", "AcoNormas", "AcoNormas"
      .Add "AcotarTablas", tvwChild, "AcoSchedulers", "Schedulers", "AcoSchedulers", "AcoSchedulers"
      .Add "AcotarTablas", tvwChild, "AcoSeries", "Series", "AcoSeries", "AcoSeries"
      .Add "AcotarTablas", tvwChild, "AcoTipos", "Tipos", "AcoTipos", "AcoTipos"
      .Add "AcotarTablas", tvwChild, "AcoTiposRosca", "Tipos de rosca", "AcoTiposRosca", "AcoTiposRosca"
      .Add "AcotarTablas", tvwChild, "AcoTratamientos", "Tratamientos termicos", "AcoTratamientos", "AcoTratamientos"
      
      .Add "Ppal", tvwChild, "Personal", "Personal", "Empleados", "Empleados"
      .Add "Personal", tvwChild, "Empleados", "Personal", "Empleados", "Empleados"
      .Add "Empleados", tvwChild, "Empleados1", "De Obra", "Empleados", "Empleados"
      .Add "Empleados", tvwChild, "Empleados2", "Usuarios", "Empleados", "Empleados"
      .Add "Empleados", tvwChild, "Empleados3", "Todos", "Empleados", "Empleados"
      .Add "Personal", tvwChild, "Vendedores", "Vendedores", "Vendedores", "Vendedores"
      .Add "Personal", tvwChild, "Cargos", "Cargos", "Cargos", "Cargos"
      .Add "Personal", tvwChild, "Sectores", "Sectores", "Sectores", "Sectores"
      .Add "Personal", tvwChild, "AnticiposAlPersonal", "Anticipos al personal", "AnticiposAlPersonal", "AnticiposAlPersonal"
      .Add "Personal", tvwChild, "AnticiposAlPersonalSyJ", "Anticipos al personal (via SyJ)", "AnticiposAlPersonal", "AnticiposAlPersonal"
      
      .Add "Ppal", tvwChild, "Obras", "Obras", "Obras", "Obras"
      .Add "Obras", tvwChild, "UnidadesOperativas", "Unidades operativas", "UnidadesOperativas", "UnidadesOperativas"
      .Add "Obras", tvwChild, "GruposObras", "Grupos de obras", "GruposObras", "GruposObras"
      .Add "Obras", tvwChild, "Obras1", "Obras", "Obras", "Obras"
'      .Add "Obras", tvwChild, "Obras2", "Obras (Detalladas)", "Obras", "Obras"
      .Add "Obras", tvwChild, "Planos", "Planos", "Planos", "Planos"
      .Add "Obras", tvwChild, "Equipos", "Equipos", "Equipos", "Equipos"
'      .Add "Obras", tvwChild, "AnexosEquipos", "Anexos equipos", "AnexosEquipos", "AnexosEquipos"
'      .Add "Obras", tvwChild, "LAcopio", "Listas de Acopio", "LAcopio", "LAcopio"
      .Add "Obras", tvwChild, "LMateriales", "Lista de Materiales", "LMateriales", "LMateriales"
'      .Add "Obras", tvwChild, "LMaterialesPorObras", "Lista de Materiales (Por Obras)", "LMaterialesPorObras", "LMaterialesPorObras"
      .Add "Obras", tvwChild, "PresupuestoObrasRubros", "Rubros para presupuesto de obras", "PresupuestoObrasRubros", "PresupuestoObrasRubros"
      .Add "Obras", tvwChild, "PresupuestoObrasGruposMateriales", "Grupos de materiales para presupuesto de obras", "PresupuestoObrasGruposMateriales", "PresupuestoObrasGruposMateriales"
      .Add "Obras", tvwChild, "PresupuestoObras", "Presupuesto de obras", "PresupuestoObras", "PresupuestoObras"
      .Add "Obras", tvwChild, "CertificacionesObra", "Certificacion de obras", "CertificacionesObra", "CertificacionesObra"
      .Add "Obras", tvwChild, "Subcontratos", "Subcontratos", "Subcontratos", "Subcontratos"
      .Add "Obras", tvwChild, "PartesProduccion", "Partes de produccion (Auxiliares)", "PartesProduccion", "PartesProduccion"

      .Add "Ppal", tvwChild, "OrdenesTrabajo", "Ordenes de trabajo", "OrdenesTrabajo", "OrdenesTrabajo"
      .Add "OrdenesTrabajo", tvwChild, "OrdenesTrabajoAgrupadas", "Ordenes de trabajo por periodos", "OrdenesTrabajo", "OrdenesTrabajo"
      .Add "OrdenesTrabajo", tvwChild, "OrdenesTrabajoTodas", "Ordenes de trabajo (Todas)", "OrdenesTrabajo", "OrdenesTrabajo"
      
      .Add "Ppal", tvwChild, "Requerimientos", "Requerimientos de materiales", "Requerimientos", "Requerimientos"
      .Add "Requerimientos", tvwChild, "RequerimientosAgrupados", "Requerimientos por periodos", "Requerimientos", "Requerimientos"
      .Add "Requerimientos", tvwChild, "RequerimientosPorObra", "Requerimientos por obra", "Requerimientos", "Requerimientos"
      .Add "Requerimientos", tvwChild, "RequerimientosALiberar", "Requerimientos a liberar", "Requerimientos", "Requerimientos"
      .Add "Requerimientos", tvwChild, "RequerimientosAConfirmar", "Requerimientos a confirmar", "Requerimientos", "Requerimientos"
'      .Add "Requerimientos", tvwChild, "RequerimientosObras", "Requerimientos de obras", "Requerimientos_Items", "Requerimientos_Items"
'      .Add "Requerimientos", tvwChild, "RequerimientosCC", "Requerimientos por centro de costos", "Requerimientos_Items", "Requerimientos_Items"
      .Add "Requerimientos", tvwChild, "RequerimientosTodos", "Requerimientos (Todos)", "Requerimientos", "Requerimientos"
      .Add "Requerimientos", tvwChild, "SolicitudesCompra", "Solicitudes de compra", "SolicitudesCompra", "SolicitudesCompra"
      .Add "SolicitudesCompra", tvwChild, "SolicitudesCompraAgrupadas", "Solicitudes de compra por periodos", "SolicitudesCompra", "SolicitudesCompra"
      .Add "SolicitudesCompra", tvwChild, "SolicitudesCompraTodas", "Solicitudes de compra (Todos)", "SolicitudesCompra", "SolicitudesCompra"

      .Add "Ppal", tvwChild, "MovStock", "Movimientos de stock", "MovStock", "MovStock"
      .Add "MovStock", tvwChild, "Reservas", "Reservas de stock", "Reservas", "Reservas"
      .Add "MovStock", tvwChild, "AjustesStock", "Ajustes de stock", "AjustesStock", "AjustesStock"
      .Add "AjustesStock", tvwChild, "AjustesStockAgrupados", "Ajustes de stock (Por periodos)", "AjustesStock", "AjustesStock"
      .Add "AjustesStock", tvwChild, "AjustesStockTodos", "Ajustes de stock (Todas)", "AjustesStock", "AjustesStock"
      .Add "MovStock", tvwChild, "Recepciones", "Recepcion de proveedores", "Recepciones", "Recepciones"
      .Add "Recepciones", tvwChild, "RecepcionesAgrupadas", "Recepciones (Por periodos)", "Recepciones", "Recepciones"
      .Add "Recepciones", tvwChild, "RecepcionesUltimos3Meses", "Ultimos 3 meses", "Recepciones", "Recepciones"
      .Add "Recepciones", tvwChild, "RecepcionesTodas", "Recepciones (Todas)", "Recepciones", "Recepciones"
      .Add "MovStock", tvwChild, "Recepciones1", "Recepcion de proveedores", "Recepciones", "Recepciones"
      .Add "Recepciones1", tvwChild, "Recepciones1Agrupadas", "Recepciones (Por periodos)", "Recepciones", "Recepciones"
      .Add "Recepciones1", tvwChild, "Recepciones1Todas", "Recepciones (Todas)", "Recepciones", "Recepciones"
      .Add "MovStock", tvwChild, "CCalidades", "Controles de calidad", "CCalidades", "CCalidades"
      .Add "CCalidades", tvwChild, "CCalidadesPendientes", "Pendientes", "CCalidades", "CCalidades"
      .Add "CCalidades", tvwChild, "CCalidadesControlados", "Controlados", "CCalidades", "CCalidades"
      .Add "CCalidades", tvwChild, "CCalidadesUltimos3Meses", "Ultimos 3 meses", "CCalidades", "CCalidades"
      .Add "CCalidades", tvwChild, "CCalidadesTodos", "Todos", "CCalidades", "CCalidades"
      .Add "MovStock", tvwChild, "ValesSalida", "Solicitud de materiales a almacen", "ValesSalida", "ValesSalida"
      .Add "ValesSalida", tvwChild, "ValesSalidaAgrupados", "Solicitudes (Por periodos)", "ValesSalida", "ValesSalida"
      .Add "ValesSalida", tvwChild, "ValesSalidaTodos", "Solicitudes (Todas)", "ValesSalida", "ValesSalida"
      .Add "MovStock", tvwChild, "SalidaMateriales", "Salida de materiales de almacen", "SalidaMateriales", "SalidaMateriales"
      .Add "SalidaMateriales", tvwChild, "SalidaMaterialesAgrupadas", "Salidas (Por periodos)", "SalidaMateriales", "SalidaMateriales"
      .Add "SalidaMateriales", tvwChild, "SalidaMaterialesTodas", "Salidas (Todas)", "SalidaMateriales", "SalidaMateriales"
      .Add "MovStock", tvwChild, "SalidaMateriales1", "Salida de materiales de almacen", "SalidaMateriales", "SalidaMateriales"
      .Add "SalidaMateriales1", tvwChild, "SalidaMaterialesAgrupadas1", "Salidas (Por periodos)", "SalidaMateriales", "SalidaMateriales"
      .Add "SalidaMateriales1", tvwChild, "SalidaMaterialesTodas1", "Salidas (Todas)", "SalidaMateriales", "SalidaMateriales"
      .Add "MovStock", tvwChild, "OtrosIngresosAlmacen", "Otros ingresos a almacen", "OtrosIngresosAlmacen", "OtrosIngresosAlmacen"
      .Add "OtrosIngresosAlmacen", tvwChild, "OtrosIngresosAlmacenAgrupados", "Otros ingresos (Por periodos)", "OtrosIngresosAlmacen", "OtrosIngresosAlmacen"
      .Add "OtrosIngresosAlmacen", tvwChild, "OtrosIngresosAlmacenTodos", "Otros ingresos (Todos)", "OtrosIngresosAlmacen", "OtrosIngresosAlmacen"
      .Add "MovStock", tvwChild, "UnidadesEmpaque", "Unidades de empaque", "UnidadesEmpaque", "UnidadesEmpaque"
      .Add "UnidadesEmpaque", tvwChild, "UnidadesEmpaqueAgrupados", "Unidades de empaque (Por periodos)", "UnidadesEmpaque", "UnidadesEmpaque"
      .Add "UnidadesEmpaque", tvwChild, "UnidadesEmpaqueTodos", "Unidades de empaque (Todas)", "UnidadesEmpaque", "UnidadesEmpaque"
      
      .Add "Ppal", tvwChild, "CtrlTransp", "Control de transportes", "CtrlTransp", "CtrlTransp"
      .Add "CtrlTransp", tvwChild, "Transportistas1", "Transportistas", "Transportistas", "Transportistas"
      .Add "CtrlTransp", tvwChild, "Choferes", "Choferes", "Choferes", "Choferes"
      .Add "CtrlTransp", tvwChild, "Fletes", "Unidades", "Fletes", "Fletes"
      .Add "CtrlTransp", tvwChild, "TarifasFletes", "Tarifas fletes", "TarifasFletes", "TarifasFletes"
      .Add "CtrlTransp", tvwChild, "GastosFletes", "Gastos fletes", "GastosFletes", "GastosFletes"
      .Add "GastosFletes", tvwChild, "GastosFletesAgrupados", "Gastos fletes (Por periodos)", "GastosFletes", "GastosFletes"
      .Add "GastosFletes", tvwChild, "GastosFletesTodos", "Gastos fletes (Todos)", "GastosFletes", "GastosFletes"
      .Add "CtrlTransp", tvwChild, "LiquidacionesFletes", "Liquidaciones fletes", "LiquidacionesFletes", "LiquidacionesFletes"
      .Add "LiquidacionesFletes", tvwChild, "LiquidacionesFletesAgrupadas", "Liquidaciones fletes (Por periodos)", "LiquidacionesFletes", "LiquidacionesFletes"
      .Add "LiquidacionesFletes", tvwChild, "LiquidacionesFletesTodas", "Liquidaciones fletes (Todas)", "LiquidacionesFletes", "LiquidacionesFletes"

      .Add "Ppal", tvwChild, "Cotizaciones", "Cotizaciones", "Cotizaciones", "Cotizaciones"
      
      .Add "Ppal", tvwChild, "Comercial", "Comercial", "Comercial", "Comercial"
      .Add "Comercial", tvwChild, "Clientes", "Clientes", "Clientes", "Clientes"
      .Add "Clientes", tvwChild, "ClientesResumen", "Clientes (Resumido)", "Clientes", "Clientes"
      .Add "Clientes", tvwChild, "ClientesDetalle", "Clientes (Detallado)", "Clientes", "Clientes"
      .Add "Clientes", tvwChild, "ClientesAConfirmar", "Clientes a confirmar", "Clientes", "Clientes"
      .Add "Comercial", tvwChild, "PuntosVenta", "Puntos de Venta", "PuntosVenta", "PuntosVenta"
      .Add "Comercial", tvwChild, "Ganancias1", "Tabla de ganancias", "Ganancias", "Ganancias"
      .Add "Comercial", tvwChild, "IGCondiciones1", "Categorías de ganancias", "IGCondiciones", "IGCondiciones"
      .Add "Comercial", tvwChild, "IBCondiciones1", "Categorías de ingresos brutos", "IBCondiciones", "IBCondiciones"
      .Add "Comercial", tvwChild, "CondicionesCompra1", "Condiciones de venta", "CondicionesCompra", "CondicionesCompra"
      .Add "Comercial", tvwChild, "ListasPrecios", "Listas de precios", "ListasPrecios", "ListasPrecios"
      .Add "ListasPrecios", tvwChild, "ListasPreciosDefinicion", "Definicion de listas de precios", "ListasPrecios", "ListasPrecios"
      .Add "Comercial", tvwChild, "Conceptos", "Conceptos", "Conceptos", "Conceptos"
      .Add "Comercial", tvwChild, "OrdenesCompra", "Ordenes de compra", "OrdenesCompra", "OrdenesCompra"
      .Add "OrdenesCompra", tvwChild, "OrdenesCompraAgrupadas", "Ordenes de compra (Por periodos)", "OrdenesCompra", "OrdenesCompra"
      .Add "OrdenesCompra", tvwChild, "OrdenesCompraTodas", "Ordenes de compra (Todas)", "OrdenesCompra", "OrdenesCompra"
      .Add "Comercial", tvwChild, "Remitos", "Remitos", "Remitos", "Remitos"
      .Add "Remitos", tvwChild, "RemitosAgrupados", "Remitos (Por periodos)", "Remitos", "Remitos"
      .Add "Remitos", tvwChild, "RemitosTodos", "Remitos (Todos)", "Remitos", "Remitos"
      .Add "Comercial", tvwChild, "Facturas", "Facturas", "Facturas", "Facturas"
      .Add "Facturas", tvwChild, "FacturasAgrupadas", "Facturas (Por periodos)", "Facturas", "Facturas"
      .Add "Comercial", tvwChild, "FacturasContado", "Facturas contado", "Facturas", "Facturas"
      .Add "FacturasContado", tvwChild, "FacturasContadoAgrupadas", "Facturas (Por periodos)", "Facturas", "Facturas"
      .Add "FacturasContado", tvwChild, "FacturasContadoTodas", "Facturas (Todas)", "Facturas", "Facturas"
      .Add "Facturas", tvwChild, "FacturasTodas", "Facturas (Todas)", "Facturas", "Facturas"
      .Add "Comercial", tvwChild, "Devoluciones", "Devoluciones", "Devoluciones", "Devoluciones"
      .Add "Devoluciones", tvwChild, "DevolucionesAgrupadas", "Devoluciones (Por periodos)", "Devoluciones", "Devoluciones"
      .Add "Devoluciones", tvwChild, "DevolucionesTodas", "Devoluciones (Todas)", "Devoluciones", "Devoluciones"
      .Add "Comercial", tvwChild, "Recibos", "Recibos", "Recibos", "Recibos"
      .Add "Recibos", tvwChild, "RecibosAgrupados", "Recibos (Por periodos)", "Recibos", "Recibos"
      .Add "Recibos", tvwChild, "RecibosTodos", "Recibos (Todos)", "Recibos", "Recibos"
      .Add "Comercial", tvwChild, "NotasDebito", "Notas de Debito", "NotasDebito", "NotasDebito"
      .Add "NotasDebito", tvwChild, "NotasDebitoAgrupadas", "Notas de Debito (Por periodos)", "NotasDebito", "NotasDebito"
      .Add "NotasDebito", tvwChild, "NotasDebitoTodas", "Notas de Debito (Todas)", "NotasDebito", "NotasDebito"
      .Add "Comercial", tvwChild, "NotasCredito", "Notas de Credito", "NotasCredito", "NotasCredito"
      .Add "NotasCredito", tvwChild, "NotasCreditoAgrupadas", "Notas de Credito (Por periodos)", "NotasCredito", "NotasCredito"
      .Add "NotasCredito", tvwChild, "NotasCreditoTodas", "Notas de Credito (Todas)", "NotasCredito", "NotasCredito"
      .Add "Comercial", tvwChild, "DiferenciasCambio_C", "Diferencias de cambio (cobranzas)", "DiferenciasCambio_C", "DiferenciasCambio_C"
      .Add "DiferenciasCambio_C", tvwChild, "DiferenciasCambio_CP", "Pendientes", "DiferenciasCambio_C", "DiferenciasCambio_C"
      .Add "DiferenciasCambio_C", tvwChild, "DiferenciasCambio_CG", "Generadas - Anuladas", "DiferenciasCambio_C", "DiferenciasCambio_C"
      .Add "Comercial", tvwChild, "VentasCuotas", "Ventas en cuotas fijas", "VentasCuotas", "VentasCuotas"
      .Add "VentasCuotas", tvwChild, "VentasCuotasOperacion", "Ingreso de operacion de venta", "VentasCuotasOperacion", "VentasCuotasOperacion"
      .Add "VentasCuotas", tvwChild, "VentasCuotasGeneracion", "Generacion de comprobantes", "VentasCuotasOperacion", "VentasCuotasOperacion"
      .Add "VentasCuotas", tvwChild, "VentasCuotasCobranzas", "Registro de cobranzas", "VentasCuotasCobranzas", "VentasCuotasCobranzas"
      .Add "Comercial", tvwChild, "CtasCtesD", "Resumenes Cta. Cte.", "CtasCtesD", "CtasCtesD"
      
      .Add "Ppal", tvwChild, "Compras", "Compras", "Compras", "Compras"
      .Add "Compras", tvwChild, "Proveedores", "Proveedores", "Proveedores", "Proveedores"
      .Add "Proveedores", tvwChild, "ProveedoresResumen", "Proveedores (Resumido)", "Proveedores", "Proveedores"
      .Add "Proveedores", tvwChild, "ProveedoresDetalle", "Proveedores (Detallado)", "Proveedores", "Proveedores"
      .Add "Proveedores", tvwChild, "ProveedoresEventuales", "Proveedores eventuales", "Proveedores", "Proveedores"
      .Add "Proveedores", tvwChild, "ProveedoresAConfirmar", "Proveedores a confirmar", "Proveedores", "Proveedores"
      .Add "Compras", tvwChild, "Ganancias2", "Tabla de ganancias", "Ganancias", "Ganancias"
      .Add "Compras", tvwChild, "IGCondiciones2", "Categorías de ganancias", "IGCondiciones", "IGCondiciones"
      .Add "Compras", tvwChild, "IBCondiciones2", "Categorías de ingresos brutos", "IBCondiciones", "IBCondiciones"
      .Add "Compras", tvwChild, "ImpuestosDirectos", "Otros impuestos directos", "ImpuestosDirectos", "ImpuestosDirectos"
      .Add "Compras", tvwChild, "CondicionesCompra2", "Condiciones de compra", "CondicionesCompra", "CondicionesCompra"
      .Add "Compras", tvwChild, "PosicionesImportacion", "Posiciones de importacion", "PosicionesImportacion", "PosicionesImportacion"
      .Add "Compras", tvwChild, "CostosImportacion", "Costos de importacion", "CostosImportacion", "CostosImportacion"
      .Add "Compras", tvwChild, "ActividadesP", "Actividad principal de proveedores", "ActividadesP", "ActividadesP"
      .Add "Compras", tvwChild, "DistribucionesObras", "Matrices de distribucion de gastos por obras", "DistribucionesObras", "DistribucionesObras"
      .Add "Compras", tvwChild, "ConceptosOP", "Conceptos p/OP otros", "Conceptos", "Conceptos"
      .Add "Compras", tvwChild, "Presupuestos", "Solicitudes de cotizacion", "Presupuestos", "Presupuestos"
      .Add "Presupuestos", tvwChild, "PresupuestosAgrupados", "Solicitudes de cotizacion por periodos", "Presupuestos", "Presupuestos"
      .Add "Presupuestos", tvwChild, "PresupuestosTodos", "Todos", "Presupuestos", "Presupuestos"
      .Add "Compras", tvwChild, "Comparativas", "Comparativas", "Comparativas", "Comparativas"
      .Add "Comparativas", tvwChild, "ComparativasAgrupadas", "Comparativas por periodos", "Comparativas", "Comparativas"
      .Add "Comparativas", tvwChild, "ComparativasTodas", "Todas", "Comparativas", "Comparativas"
      .Add "Compras", tvwChild, "Pedidos", "Notas de pedido", "Pedidos", "Pedidos"
      .Add "Pedidos", tvwChild, "PedidosAgrupados", "Notas de pedido por periodos", "Pedidos", "Pedidos"
      .Add "Pedidos", tvwChild, "PedidosPendientes", "Pendientes", "Pedidos", "Pedidos"
      .Add "Pedidos", tvwChild, "PedidosPorObra", "Notas de pedido por obra", "Pedidos", "Pedidos"
      .Add "Pedidos", tvwChild, "PedidosTodos", "Todos", "Pedidos", "Pedidos"
      .Add "Pedidos", tvwChild, "PedidosSubcontratos", "Subcontratos", "Pedidos", "Pedidos"
      .Add "Pedidos", tvwChild, "PedidosAbiertos", "Notas de pedido abiertas", "Pedidos", "Pedidos"
      .Add "Pedidos", tvwChild, "Clausulas", "Clausulas para pedidos", "Clausulas", "Clausulas"
      .Add "Pedidos", tvwChild, "LugaresEntrega", "Lugares de entrega", "Pedidos", "Pedidos"
      .Add "Pedidos", tvwChild, "PlazosEntrega", "Plazos de entrega", "Pedidos", "Pedidos"
      .Add "PedidosSubcontratos", tvwChild, "PedidosSubcontratosAgrupados", "Subcontratos por periodos", "Pedidos", "Pedidos"
      .Add "PedidosSubcontratos", tvwChild, "PedidosSubcontratosTodos", "Subcontratos (Todos)", "Pedidos", "Pedidos"
      .Add "Compras", tvwChild, "AutorizacionesCompra", "Autorizaciones de compra", "AutorizacionesCompra", "AutorizacionesCompra"
      .Add "AutorizacionesCompra", tvwChild, "AutorizacionesCompraAgrupadas", "Autorizaciones de compra por periodos", "AutorizacionesCompra", "AutorizacionesCompra"
      .Add "AutorizacionesCompra", tvwChild, "AutorizacionesCompraTodas", "Todas", "AutorizacionesCompra", "AutorizacionesCompra"
      .Add "Compras", tvwChild, "FondosFijos", "Fondos fijos", "FondosFijos", "FondosFijos"
      .Add "Compras", tvwChild, "ComprobantesPrv", "Ingreso de Comprobantes", "ComprobantesPrv", "ComprobantesPrv"
      .Add "ComprobantesPrv", tvwChild, "ComprobantesPrvPorMes", "Ingreso de Comprobantes (Por periodos)", "ComprobantesPrv", "ComprobantesPrv"
      .Add "ComprobantesPrv", tvwChild, "ComprobantesAConfirmar", "Ingreso de Comprobantes (A confirmar)", "ComprobantesPrv", "ComprobantesPrv"
      .Add "ComprobantesPrv", tvwChild, "ComprobantesPrvTodos", "Ingreso de Comprobantes (Todos)", "ComprobantesPrv", "ComprobantesPrv"
      .Add "Compras", tvwChild, "OPago", "Ordenes de Pago", "OPago", "OPago"
      .Add "OPago", tvwChild, "OPagoPorMes", "Agrupadas por periodos", "OPago", "OPago"
      .Add "OPago", tvwChild, "OPagoALaFirma", "A la firma", "OPago", "OPago"
      .Add "OPago", tvwChild, "OPagoEnCaja", "En caja", "OPago", "OPago"
      If BuscarClaveINI("Habilitar caja obra en OP") = "SI" Then
         .Add "OPago", tvwChild, "OPagoEnCajaObra", "En caja obra", "OPago", "OPago"
      End If
      .Add "OPago", tvwChild, "OPagoAConfirmar", "A confirmar", "OPago", "OPago"
      .Add "OPago", tvwChild, "OPagoTodas", "Todas", "OPago", "OPago"
      .Add "Compras", tvwChild, "DiferenciasCambio", "Diferencias de cambio (pagos)", "DiferenciasCambio_P", "DiferenciasCambio_P"
      .Add "DiferenciasCambio", tvwChild, "DiferenciasCambio_PP", "Pendientes", "DiferenciasCambio_P", "DiferenciasCambio_P"
      .Add "DiferenciasCambio", tvwChild, "DiferenciasCambio_PG", "Generadas - Anuladas", "DiferenciasCambio_P", "DiferenciasCambio_P"
      .Add "Compras", tvwChild, "CtasCtesA", "Cuentas Corrientes", "CtasCtesA", "CtasCtesA"
      
      .Add "Ppal", tvwChild, "Contabilidad", "Contabilidad", "Contabilidad", "Contabilidad"
      .Add "Contabilidad", tvwChild, "EjerciciosContables", "Ejercicios contables", "EjerciciosContables", "EjerciciosContables"
      .Add "Contabilidad", tvwChild, "RubrosContables", "Rubros contables", "RubrosContables", "RubrosContables"
      .Add "RubrosContables", tvwChild, "RubrosContablesGastosPorObra", "Rubros contables p/cuentas de obra", "RubrosContables", "RubrosContables"
      .Add "RubrosContables", tvwChild, "RubrosContablesFinancieros", "Rubros contables financieros", "RubrosContables", "RubrosContables"
      .Add "Contabilidad", tvwChild, "PresupuestoFinanciero", "Presupuesto financiero por rubro contable", "PresupuestoFinanciero", "PresupuestoFinanciero"
      .Add "Contabilidad", tvwChild, "PresupuestoEconomico", "Presupuesto economico por cuenta", "PresupuestoEconomico", "PresupuestoEconomico"
      .Add "Contabilidad", tvwChild, "CashFlow", "Definicion de flujo de caja", "CashFlow", "CashFlow"
      .Add "Contabilidad", tvwChild, "TiposCuentaGrupos", "Grupos de cuenta", "TiposCuentaGrupos", "TiposCuentaGrupos"
      .Add "Contabilidad", tvwChild, "CuentasGastos", "Cuentas para obras", "CuentasGastos", "CuentasGastos"
      .Add "Contabilidad", tvwChild, "Cuentas", "Cuentas", "Cuentas", "Cuentas"
      .Add "Cuentas", tvwChild, "CuentasTodas", "Cuentas (Todas)", "Cuentas", "Cuentas"
      .Add "Contabilidad", tvwChild, "Subdiarios", "Subdiarios", "Subdiarios", "Subdiarios"
      .Add "Subdiarios", tvwChild, "SubdiariosAgrupados", "Subdiarios (Por periodos)", "Subdiarios", "Subdiarios"
      .Add "Subdiarios", tvwChild, "SubdiariosTodos", "Subdiarios (Todos)", "Subdiarios", "Subdiarios"
      .Add "Contabilidad", tvwChild, "Asientos", "Asientos", "Asientos", "Asientos"
      .Add "Asientos", tvwChild, "AsientosAgrupados", "Asientos (Por periodos)", "Asientos", "Asientos"
      .Add "Asientos", tvwChild, "AsientosTodos", "Asientos (Todos)", "Asientos", "Asientos"
      
      .Add "Ppal", tvwChild, "ActivoFijo", "Activo Fijo", "ActivoFijo", "ActivoFijo"
      .Add "ActivoFijo", tvwChild, "CoeficientesImpositivos", "Coeficientes Impositivos", "CoeficientesImpositivos", "CoeficientesImpositivos"
      .Add "ActivoFijo", tvwChild, "CoeficientesContables", "Coeficientes Contables", "CoeficientesContables", "CoeficientesContables"
      .Add "ActivoFijo", tvwChild, "GruposActivosFijos", "Grupos de activos fijos", "GruposActivosFijos", "GruposActivosFijos"
      .Add "ActivoFijo", tvwChild, "Revaluos", "Revaluos", "Revaluos", "Revaluos"
      .Add "ActivoFijo", tvwChild, "ModificacionActivoFijo", "Modificaciones a activo fijo", "ModificacionActivoFijo", "ModificacionActivoFijo"

      .Add "Ppal", tvwChild, "MovimientoBancos", "Movimientos de caja y bancos", "Bancos", "Bancos"
      .Add "MovimientoBancos", tvwChild, "Cajas", "Cajas", "Cajas", "Cajas"
      .Add "MovimientoBancos", tvwChild, "Bancos", "Bancos", "Bancos", "Bancos"
      .Add "MovimientoBancos", tvwChild, "CuentasBancarias", "Cuentas bancarias", "CuentasBancarias", "CuentasBancarias"
      .Add "MovimientoBancos", tvwChild, "BancoChequeras", "Chequeras", "BancoChequeras", "BancoChequeras"
      .Add "MovimientoBancos", tvwChild, "TarjetasCredito", "Tarjetas de credito", "TarjetasCredito", "TarjetasCredito"
      .Add "MovimientoBancos", tvwChild, "Valores", "Valores", "Valores", "Valores"
      .Add "Valores", tvwChild, "ValoresRecibidos", "Valores recibidos (Por periodos)", "Valores", "Valores"
      .Add "Valores", tvwChild, "ValoresEmitidos", "Valores emitidos (Por periodos)", "Valores", "Valores"
      .Add "Valores", tvwChild, "ValoresTodos", "Valores (Todos)", "Valores", "Valores"
      .Add "MovimientoBancos", tvwChild, "DepositosBancarios", "Depositos bancarios", "DepositosBancarios", "DepositosBancarios"
      .Add "DepositosBancarios", tvwChild, "DepositosBancariosAgrupados", "Depositos (Por periodos)", "DepositosBancarios", "DepositosBancarios"
      .Add "DepositosBancarios", tvwChild, "DepositosBancariosTodos", "Depositos (Todos)", "DepositosBancarios", "DepositosBancarios"
      .Add "MovimientoBancos", tvwChild, "GastosBancarios", "Debitos y creditos bancarios", "GastosBancarios", "GastosBancarios"
      .Add "GastosBancarios", tvwChild, "GastosBancariosAgrupados", "Por periodos", "GastosBancarios", "GastosBancarios"
      .Add "GastosBancarios", tvwChild, "GastosBancariosTodos", "Todos", "GastosBancarios", "GastosBancarios"
      .Add "MovimientoBancos", tvwChild, "ConciliacionesCajas", "Conciliacion de cajas", "ConciliacionesCajas", "ConciliacionesCajas"
      .Add "MovimientoBancos", tvwChild, "Conciliaciones", "Conciliacion de bancos", "Conciliaciones", "Conciliaciones"
      .Add "MovimientoBancos", tvwChild, "ConciliacionesTarjetas", "Conciliacion de tarjetas de credito", "Conciliaciones", "Conciliaciones"
      .Add "MovimientoBancos", tvwChild, "ChequesPendientes", "Cheques pendientes", "ChequesPendientes", "ChequesPendientes"
      .Add "MovimientoBancos", tvwChild, "ResumenesParaConciliacion", "Resumenes de Conciliacion", "ResumenesParaConciliacion", "ResumenesParaConciliacion"
      .Add "ResumenesParaConciliacion", tvwChild, "ResumenesParaConciliacionAgrupados", "Resumenes de Conciliacion por periodos", "ResumenesParaConciliacion", "ResumenesParaConciliacion"
      .Add "ResumenesParaConciliacion", tvwChild, "ResumenesParaConciliacionTodos", "Todos", "ResumenesParaConciliacion", "ResumenesParaConciliacion"
      .Add "MovimientoBancos", tvwChild, "EmisionCheques", "Emision de cheques", "EmisionCheques", "EmisionCheques"
      .Add "EmisionCheques", tvwChild, "EmisionChequesTodosEmitidos", "Emision de cheques (Emitidos)", "EmisionCheques", "EmisionCheques"
      .Add "EmisionCheques", tvwChild, "EmisionChequesTodosNoEmitidos", "Emision de cheques (No emitidos)", "EmisionCheques", "EmisionCheques"
      .Add "EmisionCheques", tvwChild, "EmisionChequesTodosNoEmitidosPorCuenta", "Emision de cheques (No emitidos por cuenta)", "EmisionCheques", "EmisionCheques"
      .Add "MovimientoBancos", tvwChild, "PlazosFijos", "Plazos fijos", "PlazosFijos", "PlazosFijos"
      .Add "PlazosFijos", tvwChild, "PlazosFijosAVencer", "Plazos fijos (A vencer)", "PlazosFijos", "PlazosFijos"
      .Add "PlazosFijos", tvwChild, "PlazosFijosVencidos", "Plazos fijos (Vencidos)", "PlazosFijos", "PlazosFijos"
      .Add "PlazosFijos", tvwChild, "PlazosFijosTodos", "Plazos fijos (Todos)", "PlazosFijos", "PlazosFijos"
      
      .Add "Ppal", tvwChild, "Historicos", "Movimientos historicos", "Historicos", "Historicos"
      .Add "Historicos", tvwChild, "HistObras", "Obras inactivas", "HistObras", "HistObras"
      .Add "HistObras", tvwChild, "HistObras1", "Obras", "HistObras", "HistObras"
      .Add "HistObras", tvwChild, "HistObras2", "Obras (Detalladas)", "HistObras", "HistObras"
'      .Add "Historicos", tvwChild, "HLAcopios", "Listas de Acopio", "HLAcopios", "HLAcopios"
      .Add "Historicos", tvwChild, "HLMateriales", "Lista de Materiales", "HLMateriales", "HLMateriales"
      .Add "Historicos", tvwChild, "HRequerimientos", "Requerimientos de materiales", "HRequerimientos", "HRequerimientos"
      .Add "Historicos", tvwChild, "HPedidos", "Notas de Pedido", "HPedidos", "HPedidos"
      .Add "Historicos", tvwChild, "HChequeras", "Chequeras", "HChequeras", "HChequeras"
   
      .Add "Ppal", tvwChild, "PpalSAT", "Comprobantes PRONTO SAT", "ProntoSAT", "ProntoSAT"
      .Add "PpalSAT", tvwChild, "PedidosSAT", "Notas de pedido", "Pedidos", "Pedidos"
      .Add "PedidosSAT", tvwChild, "PedidosAgrupadosSAT", "Notas de pedido SAT (Por periodos)", "Pedidos", "Pedidos"
      .Add "PedidosSAT", tvwChild, "PedidosPorObraSAT", "Notas de pedido por origen SAT", "Pedidos", "Pedidos"
      .Add "PedidosSAT", tvwChild, "PedidosTodosSAT", "Pedidos SAT (Todos)", "Pedidos", "Pedidos"
      .Add "PpalSAT", tvwChild, "AjustesStockSAT", "Ajustes de stock", "AjustesStock", "AjustesStock"
      .Add "AjustesStockSAT", tvwChild, "AjustesStockAgrupadosSAT", "Ajustes de stock SAT (Por periodos)", "AjustesStock", "AjustesStock"
      .Add "AjustesStockSAT", tvwChild, "AjustesStockTodosSAT", "Ajustes de stock SAT (Todas)", "AjustesStock", "AjustesStock"
      .Add "PpalSAT", tvwChild, "RecepcionesSAT", "Recepcion de proveedores", "Recepciones", "Recepciones"
      .Add "RecepcionesSAT", tvwChild, "RecepcionesAgrupadasSAT", "Recepciones SAT (Por periodos)", "Recepciones", "Recepciones"
      .Add "RecepcionesSAT", tvwChild, "RecepcionesTodasSAT", "Recepciones SAT (Todas)", "Recepciones", "Recepciones"
      .Add "PpalSAT", tvwChild, "SalidaMaterialesSAT", "Salida de materiales de almacen", "SalidaMateriales", "SalidaMateriales"
      .Add "SalidaMaterialesSAT", tvwChild, "SalidaMaterialesAgrupadasSAT", "Salidas SAT (Por periodos)", "SalidaMateriales", "SalidaMateriales"
      .Add "SalidaMaterialesSAT", tvwChild, "SalidaMaterialesTodasSAT", "Salidas SAT (Todas)", "SalidaMateriales", "SalidaMateriales"
      .Add "PpalSAT", tvwChild, "OtrosIngresosAlmacenSAT", "Otros ingresos a almacen", "OtrosIngresosAlmacen", "OtrosIngresosAlmacen"
      .Add "OtrosIngresosAlmacenSAT", tvwChild, "OtrosIngresosAlmacenAgrupadosSAT", "Otros ingresos SAT (Por periodos)", "OtrosIngresosAlmacen", "OtrosIngresosAlmacen"
      .Add "OtrosIngresosAlmacenSAT", tvwChild, "OtrosIngresosAlmacenTodosSAT", "Otros ingresos SAT (Todos)", "OtrosIngresosAlmacen", "OtrosIngresosAlmacen"
   End With
   
   On Error Resume Next
   
   Dim i As Integer
   Dim mNodo As Node
   
   Arbol.Nodes.Add , , "Ppal", glbEmpresaSegunString, "Ppal", "Ppal"
   For i = 2 To ArbolDefault.Nodes.Count
      With Arbol.Nodes
         If ControlAcceso(ArbolDefault.Nodes(i).Key) Then
            .Add ArbolDefault.Nodes(i).Parent.Key, tvwChild, _
               ArbolDefault.Nodes(i).Key, ArbolDefault.Nodes(i).Text, _
               ArbolDefault.Nodes(i).Image, ArbolDefault.Nodes(i).SelectedImage
         End If
      End With
   Next
   Arbol.Nodes(1).Expanded = True
   
   For Each mNodo In Arbol.Nodes
      If mNodo.Parent = glbEmpresaSegunString Then
         mNodo.Bold = True
      End If
   Next
   Set mNodo = Nothing
   
End Sub

Public Sub AnalizarStringConnection()

   On Error GoTo 0
   
   Dim mArchivoDefinicionConexion As String, mPronto As String
   
   mPronto = "M:\Pronto"
   mArchivoDefinicionConexion = Dir(mPronto, vbArchive)
   If mArchivoDefinicionConexion = "" Then
      mPronto = App.Path & "\" & App.Title
      mArchivoDefinicionConexion = Dir(mPronto, vbArchive)
      If mArchivoDefinicionConexion = "" Then Exit Sub
   End If
   
   Dim MydsEncrypt As dsEncrypt
   Dim mArchivoConexion As String, mConexion As String, mEmpresa As String
   Dim mString As String
   Dim i As Integer, mPos As Integer
   Dim mVariosString As Boolean, mOk As Boolean
   Dim mVectorConexiones, mVectorConexion
   
   Set MydsEncrypt = New dsEncrypt
   MydsEncrypt.KeyString = ("EDS")
   
   mArchivoConexion = LeerArchivoSecuencial(mPronto)
   Do While Len(mArchivoConexion) > 0 And _
         (Asc(Right(mArchivoConexion, 1)) = 10 Or Asc(Right(mArchivoConexion, 1)) = 13)
      mArchivoConexion = mId(mArchivoConexion, 1, Len(mArchivoConexion) - 1)
   Loop
   mArchivoConexion = MydsEncrypt.Encrypt(mArchivoConexion)
   mVectorConexiones = VBA.Split(mArchivoConexion, vbCrLf)

   mVariosString = False
   mConexion = ""
   mEmpresa = ""
   For i = 0 To UBound(mVectorConexiones)
      If Len(mVectorConexiones(i)) > 0 Then
         mVectorConexion = VBA.Split(mVectorConexiones(i), "|")
         If Len(mVectorConexion(1)) > 0 Then
            If Len(mConexion) > 0 Then
               mVariosString = True
            Else
               mEmpresa = mVectorConexion(0)
               mConexion = mVectorConexion(1)
            End If
         End If
      End If
   Next
   
   If Not mVariosString Then
      
      mString = MydsEncrypt.Encrypt(mConexion)
'      GuardarArchivoSecuencial GetWinDir & "\" & App.Title, mString
   
   Else
      
      Dim oRs As ADOR.Recordset
      Set oRs = CreateObject("Ador.Recordset")
      With oRs
         .Fields.Append "IdAux", adInteger
         .Fields.Append "Titulo", adVarChar, 250
         .Open
      End With
      For i = 0 To UBound(mVectorConexiones)
         If Len(mVectorConexiones(i)) > 0 Then
            mVectorConexion = VBA.Split(mVectorConexiones(i), "|")
            If Len(mVectorConexion(1)) > 0 Then
               oRs.AddNew
               oRs.Fields("IdAux").Value = i
               oRs.Fields("Titulo").Value = mVectorConexion(0)
               oRs.Update
            End If
         End If
      Next
   
      Dim oF As frmStringConnection
      Set oF = New frmStringConnection
      With oF
         Set .RecordsetDeStrings = oRs
         .Show vbModal, Me
         mOk = .Ok
         If mOk Then
            If IsNumeric(.DataCombo1(0).BoundText) Then
               mPos = .DataCombo1(0).BoundText
            Else
               mPos = -1
            End If
         End If
      End With
      Unload oF
      Set oF = Nothing
      Set oRs = Nothing
   
      If Not mOk Then End
   
      If mPos <> -1 Then
         mVectorConexion = VBA.Split(mVectorConexiones(mPos), "|")
         mEmpresa = mVectorConexion(0)
         mString = mVectorConexion(1)
         mString = MydsEncrypt.Encrypt(mString)
'         GuardarArchivoSecuencial GetWinDir & "\" & App.Title, mString
      Else
         End
      End If
   
   End If

   Set MydsEncrypt = Nothing
   
   glbStringConexion = mString
   glbEmpresaSegunString = mEmpresa
   
End Sub

Public Sub CargarPopUpMenu()

   Dim clave As String
   Dim oCtrl As Control
   Dim i As Integer
   
   On Error GoTo Mal
   
   For Each oCtrl In Me.Controls
      If TypeOf oCtrl Is Menu Then
         If oCtrl.Tag <> "" Then
            clave = oCtrl.Name & oCtrl.Index
            If ControlAccesoNivel(clave) > 5 Then
               oCtrl.Visible = False
            Else
               oCtrl.Visible = True
               oCtrl.Enabled = True
            End If
         End If
      End If
   Next

   For i = 1 To Toolbar1.Buttons.Count
      clave = Toolbar1.Buttons.Item(i).Key
      If Len(clave) > 0 Then
         If ControlAccesoNivel("btn_" & clave) = 1 Then
            Toolbar1.Buttons.Item(i).Enabled = True
         Else
            Toolbar1.Buttons.Item(i).Enabled = False
         End If
      End If
   Next
   
   If BuscarClaveINI("Activar popup de materiales") <> "SI" Then
      Toolbar1.Buttons("MenuPopUp").Enabled = False
   End If
   
   If glbAdministrador Then
      With mnuMaster(4)
         .Enabled = True
         .Visible = True
      End With
      With MnuSeg(0)
         .Enabled = True
         .Visible = True
      End With
   End If
   
   Exit Sub
   
Mal:
   Select Case Err.Number
      Case 387
         oCtrl.Enabled = False
         Resume Next
      Case Else
         MsgBox "Se ha producido un error al registrar los datos" & vbCrLf & Err.Number & " -> " & Err.Description, vbCritical
   End Select

End Sub

Public Sub RegistrosDocumentosAExportar(ByVal Documento As String, _
                                        ByVal Posicion As Integer, _
                                        Optional ByVal Borrador As String)

   Dim Filas
   Dim Columnas
   Dim iFilas As Integer, mvarAgrupar As Integer, i As Integer, mCopias As Integer
   Dim s As String, mCarpeta As String, mImprime As String, mInfo As String
   Dim mImprimeAdjuntos As String, mError As String
   Dim mOk As Boolean, mErr As Boolean
   
   If IsMissing(Borrador) Then Borrador = "SI"
   
   Filas = VBA.Split(Lista.GetString, vbCrLf)
   
   s = ""
   For iFilas = LBound(Filas) + 1 To UBound(Filas)
      Columnas = VBA.Split(Filas(iFilas), vbTab)
      If Posicion > UBound(Columnas) Then Exit Sub
      mErr = False
      If Documento = "Pedidos" And Not Borrador = "SI" Then
         If Not CircuitoFirmasCompleto(NotaPedido, Columnas(Posicion), Columnas(12)) Then
            mError = mError & vbCrLf & " " & Columnas(1)
            mErr = True
         End If
      End If
      If Not mErr Then s = s & Columnas(Posicion) & "|"
   Next
   If Len(mError) > 0 Then MsgBox "Los siguientes pedidos no tienen el circuito de " & _
                                    "firmas completo y no se emitiran :" & mError, vbExclamation
   If Len(s) = 0 Then
      MsgBox "No hay documentos para exportar!", vbExclamation
      Exit Sub
   Else
      s = mId(s, 1, Len(s) - 1)
   End If
   
   mCarpeta = BuscarClaveINI("Carpeta generacion pedidos")
   If Len(mCarpeta) = 0 Then mCarpeta = "C:\"
   mCopias = Val(BuscarClaveINI("CopiasPedidos"))
   If mCopias = 0 Then mCopias = 2
   
   Dim oF As frmExportarDocumentos
   Set oF = New frmExportarDocumentos
   With oF
      With .Label1
         .Caption = "Cantidad de copias:"
         .Visible = True
      End With
      With .Text1
         .Text = 1
         .Visible = True
      End With
      If Documento = "Pedidos" Then
         .Check2.Visible = True
         With .Check3
            .Caption = "Emitir documentos adjuntos :"
            .Value = 0
            .Visible = True
         End With
         .Text1.Text = mCopias
      End If
      .txtCarpeta.Text = mCarpeta
      .Show vbModal, Me
      mOk = .Ok
      mCarpeta = Trim(.txtCarpeta.Text)
      If .Check1 = 0 Then
         mImprime = "NO"
      Else
         mImprime = "SI"
      End If
      If .Check3 = 0 Then
         mImprimeAdjuntos = "NO"
      Else
         mImprimeAdjuntos = "SI"
      End If
      mvarAgrupar = .Check2.Value
      mCopias = Val(.Text1.Text)
   End With
   
   Unload oF
   Set oF = Nothing

   If mOk Then
      'Vector mInfo :
      '                0 Auxiliar
      '                1 S=Sin costos, C=Con costos (solo para pedidos)
      '                2 Index : 0=Impresion, 1=Word, 2=Grabar en app.path en Word, 3=Grabar en carpeta definida en Word
      '                3 Carpeta donde se guardaran los documentos
      '                4 SI=Con impresion, NO=Sin impresion
      '                5 Cantidad de copias a imprimir
      '                6 Tipo de formulario (solo para RM)
      '                7 S=Con avances, N=Sin avances (solo para listas de materiales
      If Len(mCarpeta) > 0 Then
         If mId(mCarpeta, Len(mCarpeta), 1) = "\" Then mCarpeta = mId(mCarpeta, 1, Len(mCarpeta) - 1)
      End If
      ExportarDocumentos Documento, s, "|C|3|" & mCarpeta & "|" & mImprime & "|" & _
                        mCopias & "|Legal|S|" & mvarAgrupar & "|" & Borrador & "|" & _
                        mImprimeAdjuntos & "|"
   End If

End Sub

Private Sub EmisionDeCheques()
   
   Dim mvarOK As Boolean
   Dim mPrinter As String, mPrinterAnt As String
   
   mPrinterAnt = Printer.DeviceName & " on " & Printer.Port
   
   Dim oF As frmCopiasImpresion
   Set oF = New frmCopiasImpresion
   With oF
      .txtCopias.Visible = False
      .lblCopias.Visible = False
      .Frame1.Visible = False
      .Show vbModal, Me
   End With
   mvarOK = oF.Ok
   mPrinter = oF.Combo1.Text
   Unload oF
   Set oF = Nothing
   If Not mvarOK Then
      Exit Sub
   End If

   On Error GoTo Mal
   
   Dim oW As Word.Application
   Dim cALetra As New clsNum2Let
   Dim oRs As ADOR.Recordset
   Dim oRs1 As ADOR.Recordset
   Dim mDiaYMesEmision As String, mBeneficiario As String, mImporteLetras1 As String, mImporteLetras2 As String
   Dim mIdCuentasBancarias As String, mError As String, mDelanteDelImporte As String, mFormatoCheque As String
   Dim mImporte As String
   Dim mFecha As Date, mFechaValor As Date
   Dim mItem As Integer, iFilas As Integer, mPos As Integer, i As Integer, X As Integer, mAviso As Integer
   Dim mEmiteDe As Boolean
   Dim oL As ListItem
   Dim Filas, Columnas, mVectorIdCuentasBancarias
   
   Filas = VBA.Split(Lista.GetString, vbCrLf)
   
   mIdCuentasBancarias = ""
   For iFilas = LBound(Filas) + 1 To UBound(Filas)
      Columnas = VBA.Split(Filas(iFilas), vbTab)
      If IsNumeric(Columnas(3)) Then
         If InStr(1, mIdCuentasBancarias, Columnas(3) & "|") = 0 Then
            mIdCuentasBancarias = mIdCuentasBancarias & Columnas(3) & "|"
         End If
      End If
   Next
   If Len(mIdCuentasBancarias) > 0 Then
      mIdCuentasBancarias = mId(mIdCuentasBancarias, 1, Len(mIdCuentasBancarias) - 1)
   End If
   
   If BuscarClaveINI("Emite DE en plantilla de cheques") = "SI" Then mEmiteDe = True Else mEmiteDe = False
   mDelanteDelImporte = "" & BuscarClaveINI("Imprimir delante del importe en plantilla de cheques")
   mFormatoCheque = BuscarClaveINI("Formato condicional para plantilla de cheques")
   
   mVectorIdCuentasBancarias = VBA.Split(mIdCuentasBancarias, "|")
   mError = ""
   
   If BuscarClaveINI("Controlar caracteres beneficiarios en emision de cheques") = "SI" Then
      Filas = VBA.Split(Lista.GetString, vbCrLf)
      For iFilas = LBound(Filas) + 1 To UBound(Filas)
         Columnas = VBA.Split(Filas(iFilas), vbTab)
         If IsNumeric(Columnas(3)) Then
            Set oRs = Aplicacion.CuentasBancarias.TraerFiltrado("_PorId", Columnas(3))
            If oRs.RecordCount > 0 Then
               X = IIf(IsNull(oRs.Fields("CaracteresBeneficiario").Value), 0, oRs.Fields("CaracteresBeneficiario").Value)
               If X <> 0 Then
                  Set oRs1 = Aplicacion.Valores.TraerFiltrado("_DatosParaEmisionDeCheque", Columnas(2))
                  If Not IsNull(oRs1.Fields("ChequesALaOrdenDe").Value) Then
                     mBeneficiario = oRs1.Fields("ChequesALaOrdenDe").Value
                  ElseIf Not IsNull(oRs1.Fields("RazonSocial").Value) Then
                     mBeneficiario = oRs1.Fields("RazonSocial").Value
                  Else
                     mBeneficiario = ""
                  End If
                  If Not IsNull(oRs1.Fields("NoALaOrden").Value) And oRs1.Fields("NoALaOrden").Value = "SI" Then
                     mBeneficiario = mBeneficiario & " - NO A LA ORDEN"
                  End If
                  If Len(mBeneficiario) > X Then
                     mError = mError & "Cheque " & Columnas(1) & " beneficiario : " & mBeneficiario & vbCrLf
                  End If
                  oRs1.Close
               End If
            End If
            oRs.Close
         End If
      Next
      If Len(mError) > 0 Then
         MsgBox "Los siguientes valores tienen el nombre del beneficiario muy largos : " & vbCrLf & mError, vbExclamation
         GoTo Salida
      End If
   End If
      
   Set oW = CreateObject("Word.Application")
   oW.Visible = True
   
   For i = LBound(mVectorIdCuentasBancarias) To UBound(mVectorIdCuentasBancarias)
      Set oRs = Aplicacion.CuentasBancarias.TraerFiltrado("_PorIdConCuenta", mVectorIdCuentasBancarias(i))
      If oRs.RecordCount > 0 Then
         If IsNull(oRs.Fields("PlantillaChequera").Value) Then
            mError = mError & "La cuenta del banco " & oRs.Fields("Banco").Value & " no tiene definida la plantilla de impresion." & vbCrLf
         ElseIf IsNull(oRs.Fields("ChequesPorPlancha").Value) Or oRs.Fields("ChequesPorPlancha").Value = 0 Then
            mError = mError & "La cuenta del banco " & oRs.Fields("Banco").Value & " no tiene definida los cheques por plancha." & vbCrLf
         Else
            mItem = 0
            oW.Documents.Add (glbPathPlantillas & "\" & oRs.Fields("PlantillaChequera").Value)
      
            mAviso = MsgBox("Se emitiran los cheques de la cuenta " & oRs.Fields("Banco").Value & vbCrLf & _
                              "Desea continuar ?", vbYesNo, "Impresion de cheques")
            If mAviso = vbNo Then
               oRs.Close
               GoTo Salida
            End If
            
            Filas = VBA.Split(Lista.GetString, vbCrLf)
            For iFilas = LBound(Filas) + 1 To UBound(Filas)
               Columnas = VBA.Split(Filas(iFilas), vbTab)
               If IsNumeric(Columnas(3)) And CInt(Columnas(3)) = oRs.Fields("IdCuentaBancaria").Value Then
                  If mItem = oRs.Fields("ChequesPorPlancha").Value Then
                     If Len(mPrinter) > 0 Then oW.ActivePrinter = mPrinter
                     oW.Documents(1).PrintOut False
                     If Len(mPrinterAnt) > 0 Then oW.ActivePrinter = mPrinterAnt
                     oW.Documents(1).Close False
                     oW.Documents.Add (glbPathPlantillas & "\" & oRs.Fields("PlantillaChequera").Value)
                     mItem = 0
                  End If
                     
                  mItem = mItem + 1
                  
                  Set oRs1 = Aplicacion.Valores.TraerFiltrado("_DatosParaEmisionDeCheque", Columnas(2))
                  
                  If Not IsNull(oRs1.Fields("ChequesALaOrdenDe").Value) Then
                     mBeneficiario = oRs1.Fields("ChequesALaOrdenDe").Value
                  ElseIf Not IsNull(oRs1.Fields("RazonSocial").Value) Then
                     mBeneficiario = oRs1.Fields("RazonSocial").Value
                  Else
                     mBeneficiario = ""
                  End If
                  If Not IsNull(oRs1.Fields("NoALaOrden").Value) And oRs1.Fields("NoALaOrden").Value = "SI" Then
                     mBeneficiario = mBeneficiario & " - NO A LA ORDEN"
                  End If
                  mFecha = oRs1.Fields("FechaComprobante").Value
                  mFechaValor = oRs1.Fields("FechaValor").Value
                  mDiaYMesEmision = "" & Day(mFecha) & " de " & NombreMes(Month(mFecha))
            
                  mImporte = Format(oRs1.Fields("Importe").Value, "#,##0.00")
                  If mFormatoCheque = "02" Then
                     mImporte = Replace(Replace(Replace(mImporte, ".", "|"), ",", "."), "|", ",")
                  End If
                  cALetra.Numero = oRs1.Fields("Importe").Value
                  mImporteLetras1 = cALetra.ALetra
                  mImporteLetras1 = Replace(mImporteLetras1, "pesos", "")
                  mImporteLetras1 = Replace(mImporteLetras1, "Cts.", "")
                  If Len(mImporteLetras1) > 55 Then
                     mPos = 0
                     mPos = InStrRev(mId(mImporteLetras1, 1, 55), " ")
                     mImporteLetras2 = mId(mImporteLetras1, mPos + 1, Len(mImporteLetras1) - mPos)
                     mImporteLetras1 = mId(mImporteLetras1, 1, mPos)
                  Else
                     mImporteLetras2 = ""
                  End If
            
                  oW.ActiveDocument.FormFields("Importe" & mItem).Result = mDelanteDelImporte & mImporte
                  oW.ActiveDocument.FormFields("DiaEmision" & mItem).Result = "" & Format(Day(mFecha), "00")
                  oW.ActiveDocument.FormFields("MesEmision" & mItem).Result = "" & NombreMes(Month(mFecha))
                  oW.ActiveDocument.FormFields("AñoEmision" & mItem).Result = "" & Year(mFecha)
                  oW.ActiveDocument.FormFields("DiaPago" & mItem).Result = "" & Format(Day(mFechaValor), "00")
                  oW.ActiveDocument.FormFields("MesPago" & mItem).Result = "" & NombreMes(Month(mFechaValor))
                  oW.ActiveDocument.FormFields("AñoPago" & mItem).Result = "" & Year(mFechaValor)
                  oW.ActiveDocument.FormFields("PagueseA" & mItem).Result = mBeneficiario
                  oW.ActiveDocument.FormFields("ImporteLetrasA" & mItem).Result = mImporteLetras1
                  oW.ActiveDocument.FormFields("ImporteLetrasB" & mItem).Result = mImporteLetras2
                  
                  If mEmiteDe Then
                     oW.ActiveDocument.FormFields("De" & mItem).Result = "DE"
                  End If
         
                  oRs1.Close
                  
                  Aplicacion.Tarea "Valores_MarcarComoEmitido", Array(Columnas(2), glbIdUsuario)
                  For Each oL In Lista.ListItems
                     If oL.ListSubItems(1) = Columnas(2) Then
                        oL.ListSubItems(19) = "SI"
                        oL.ListSubItems(20) = "" & Date
                        oL.ListSubItems(21) = "" & glbNombreUsuario
                        Exit For
                     End If
                  Next
               End If
            Next
            If mItem > 0 Then
               If Len(mPrinter) > 0 Then oW.ActivePrinter = mPrinter
               oW.Documents(1).PrintOut False
               If Len(mPrinterAnt) > 0 Then oW.ActivePrinter = mPrinterAnt
               oW.Documents(1).Close False
            End If
         End If
      End If
      oRs.Close
   Next
   
   oW.Quit
   
Salida:
   Set oW = Nothing
   Set cALetra = Nothing
   Set oRs = Nothing
   Set oRs1 = Nothing
   
   Exit Sub
   
Mal:
   MsgBox "Se ha producido un error en la emision :" & vbCrLf & Err.Number & " -> " & Err.Description, vbCritical
   Resume Salida

End Sub

Public Function ArmaConciliacionCaja(ByVal mIdCaja As Long, ByVal mIdCuentaBancaria As Long, _
         ByVal mFechaDesde As Date, ByVal mFechaHasta As Date, ByVal mTodos As Integer, _
         Optional ByVal mIdTarjetaCredito As Long) As ADOR.Recordset

   Dim oRs As ADOR.Recordset
   Dim mIdCuenta As Long
   Dim mSaldo As Double, mSaldoPesos As Double
   Dim mFechaArranqueCajaYBancos As Date, mFechaInicial As Date
   
   On Error GoTo Mal
   
   mIdCuenta = 0
   If mIdCaja > 0 Then
      Set oRs = Aplicacion.Cajas.TraerFiltrado("_PorId", mIdCaja)
      If oRs.RecordCount > 0 Then
         mIdCuenta = oRs.Fields("IdCuenta").Value
      End If
   ElseIf mIdTarjetaCredito > 0 Then
      Set oRs = Aplicacion.TarjetasCredito.TraerFiltrado("_PorId", mIdTarjetaCredito)
      If oRs.RecordCount > 0 Then
         mIdCuenta = oRs.Fields("IdCuenta").Value
      End If
   Else
      Set oRs = Aplicacion.CuentasBancarias.TraerFiltrado("_PorIdConCuenta", mIdCuentaBancaria)
      If oRs.RecordCount > 0 Then
         mIdCuenta = oRs.Fields("IdCuenta").Value
      End If
   End If
   oRs.Close
   
   mFechaInicial = DateSerial(2000, 1, 1)
   Set oRs = Aplicacion.Parametros.TraerFiltrado("_PorId", 1)
   If Not IsNull(oRs.Fields("FechaArranqueCajaYBancos").Value) Then
      mFechaArranqueCajaYBancos = oRs.Fields("FechaArranqueCajaYBancos").Value
   Else
      mFechaArranqueCajaYBancos = DateSerial(2000, 1, 1)
   End If
   oRs.Close
   
   mSaldo = 0
   mSaldoPesos = 0
   Set oRs = Aplicacion.Cuentas.TraerFiltrado("_MayorPorIdCuentaEntreFechas", _
               Array(mIdCuenta, mFechaInicial, DateAdd("d", -1, mFechaArranqueCajaYBancos)))
   If oRs.RecordCount > 0 Then
      mSaldo = IIf(IsNull(oRs.Fields("Saldo").Value), 0, oRs.Fields("Saldo").Value)
      mSaldoPesos = IIf(IsNull(oRs.Fields("Saldo").Value), 0, oRs.Fields("Saldo").Value)
   End If
   oRs.Close
   
   If mIdCaja > 0 Then
      Set oRs = CopiarTodosLosRegistros(Aplicacion.Valores.TraerFiltrado("_MovimientosPorIdCaja", Array(mIdCaja, mFechaDesde, mFechaHasta, mTodos)))
   ElseIf mIdTarjetaCredito > 0 Then
      Set oRs = CopiarTodosLosRegistros(Aplicacion.Valores.TraerFiltrado("_MovimientosPorIdTarjetaCredito", Array(mIdTarjetaCredito, mFechaDesde, mFechaHasta, mTodos)))
   Else
      Set oRs = CopiarTodosLosRegistros(Aplicacion.Bancos.TraerFiltrado("_MovimientosPorCuenta", Array(mIdCuentaBancaria, mFechaDesde, mFechaHasta, mTodos)))
   End If
   With oRs
      If .RecordCount > 0 Then
         .MoveFirst
         Do While Not .EOF
            If .Fields("Fec.Comp.").Value >= mFechaArranqueCajaYBancos Then
               If Not IsNull(.Fields("Ingresos").Value) Then
                  mSaldo = mSaldo + .Fields("Ingresos").Value
               End If
               If Not IsNull(.Fields("Ingresos $").Value) Then
                  mSaldoPesos = mSaldoPesos + IIf(IsNull(.Fields("Ingresos $").Value), 0, .Fields("Ingresos $").Value)
               End If
               If Not IsNull(.Fields("Egresos").Value) Then
                  mSaldo = mSaldo - .Fields("Egresos").Value
               End If
               If Not IsNull(.Fields("Egresos $").Value) Then
                  mSaldoPesos = mSaldoPesos - IIf(IsNull(.Fields("Egresos $").Value), 0, .Fields("Egresos $").Value)
               End If
               .Fields("Saldo").Value = mSaldo
               .Fields("Saldo $").Value = mSaldoPesos
            End If
            If mTodos = -1 And .Fields("Tipo").Value = "INI" Then
               .Delete
            End If
            .MoveNext
         Loop
         .MoveFirst
      End If
   End With

   Set ArmaConciliacionCaja = oRs
   
   Set oRs = Nothing
   
   Exit Function

Mal:

   Set ArmaConciliacionCaja = Nothing
   Set oRs = Nothing

End Function

Public Sub CambiarBeneficiarioCheques(ByVal Filas As Variant)

   Dim mvarOK As Boolean
   Dim mvarNoALaOrden As String, mvarBeneficiario As String
   Dim oF As frm_Aux
   Dim oL As ListItem
   Dim Columnas
   
   Filas = VBA.Split(Lista.GetString, vbCrLf)
   Columnas = VBA.Split(Filas(1), vbTab)
            
   mvarBeneficiario = Columnas(8)
   mvarNoALaOrden = Columnas(9)
   
   Set oF = New frm_Aux
   With oF
      .Width = .Width * 2
      .Caption = "Cambiar beneficiario de cheque"
      .Label1.Caption = "Beneficiario :"
      With .Text1
         .Width = .Width * 4
         .Text = mvarBeneficiario
      End With
      With .Check1
         .Left = oF.Label1.Left
         .Top = oF.DTFields(1).Top
         .Width = oF.Text1.Width / 3
         .Caption = "No a la Orden :"
         If mvarNoALaOrden = "SI" Then
            .Value = 1
         Else
            .Value = 0
         End If
         .Visible = True
      End With
      .Show vbModal, Me
      mvarBeneficiario = oF.Text1.Text
      If .Check1.Value = 0 Then
         mvarNoALaOrden = "NO"
      Else
         mvarNoALaOrden = "SI"
      End If
      mvarOK = .Ok
   End With
   Unload oF
   Set oF = Nothing
   If Not mvarOK Then
      Exit Sub
   End If

   If IsNumeric(Columnas(2)) Then
      Aplicacion.Tarea "Valores_ModificarBeneficiario", Array(Columnas(2), mvarBeneficiario, mvarNoALaOrden)
      For Each oL In Lista.ListItems
         If oL.ListSubItems(1) = Columnas(2) Then
            oL.ListSubItems(7) = "" & mvarBeneficiario
            oL.ListSubItems(8) = "" & mvarNoALaOrden
            Exit For
         End If
      Next
   End If
         
End Sub

Public Sub EliminarComprobantesAConfirmar()

   Dim Filas
   Dim Columnas
   Dim iFilas As Integer
   
   Me.MousePointer = vbHourglass
   DoEvents

   Filas = VBA.Split(Lista.GetString, vbCrLf)
   
   For iFilas = LBound(Filas) + 1 To UBound(Filas)
      Columnas = VBA.Split(Filas(iFilas), vbTab)
      Aplicacion.Tarea "ComprobantesProveedores_EliminarComprobanteAConfirmar", Columnas(2)
   Next
   Set Lista.DataSource = Aplicacion.ComprobantesProveedores.TraerFiltrado("_AConfirmar")
   
   Me.MousePointer = vbDefault

End Sub

Public Sub EliminarRMAConfirmar()

   Dim Filas
   Dim Columnas
   Dim iFilas As Integer
   
   Me.MousePointer = vbHourglass
   DoEvents

   Filas = VBA.Split(Lista.GetString, vbCrLf)
   
   For iFilas = LBound(Filas) + 1 To UBound(Filas)
      Columnas = VBA.Split(Filas(iFilas), vbTab)
      Aplicacion.Tarea "Requerimientos_EliminarRequerimientosAConfirmar", Columnas(2)
   Next
   Set Lista.DataSource = Aplicacion.Requerimientos.TraerFiltrado("_AConfirmar")
   
   Me.MousePointer = vbDefault

End Sub

Public Sub GeneracionDeFacturasAnuladas()

   Dim oF As frmExcel1
   Set oF = New frmExcel1
   With oF
      .Codigo = "AnuFac"
      .Titulo = "Generacion automatica de facturas de venta anuladas"
      .Show vbModal, Me
   End With
   Unload oF
   Set oF = Nothing

End Sub

Public Sub GeneracionDeFacturasAnuladasExistentes()

   Dim oF As frmExcel1
   Set oF = New frmExcel1
   With oF
      .Codigo = "AnuFac1"
      .Titulo = "Anulacion masiva de facturas de venta existentes"
      .Show vbModal, Me
   End With
   Unload oF
   Set oF = Nothing

End Sub

Public Sub ImportacionConjuntos()

   Dim oAp As ComPronto.Aplicacion
   Dim oConj As ComPronto.Conjunto
   Dim oRsAux1 As ADOR.Recordset
   Dim oEx As Excel.Application
   Dim oF As Form
   Dim mOk As Boolean
   Dim mArchivo As String, mCodigo As String, mAbreviatura As String
   Dim mError As String, mConjunto As String
   Dim mIdUnidadPorUnidad As Integer, mIdUnidad As Integer, fl As Integer
   Dim mIdArticulo As Long
   Dim mCantidad As Double

   On Error GoTo Mal

   Set oF = New frmPathPresto
   With oF
      .Id = 3
      .Show vbModal
      mOk = .Ok
      If mOk Then
         mArchivo = .FileBrowser1(0).Text
      End If
   End With
   Unload oF
   Set oF = Nothing

   If Not mOk Then Exit Sub

   Set oAp = Aplicacion

   Set oRsAux1 = oAp.Parametros.TraerFiltrado("_PorId", 1)
   mIdUnidadPorUnidad = oRsAux1.Fields("IdUnidadPorUnidad").Value
   oRsAux1.Close
   
   Set oF = New frmAviso
   With oF
      .Label1 = "Iniciando EXCEL ..."
      .Show
      .Refresh
      DoEvents
   End With

   oF.Label1 = oF.Label1 & vbCrLf & "Procesando conjuntos ..."
   oF.Label2 = ""
   oF.Label3 = ""
   DoEvents

   mError = ""
   mConjunto = ""
   fl = 2
   
   Set oEx = CreateObject("Excel.Application")
   With oEx
      
      .Visible = True
      .WindowState = xlMinimized
      Me.Refresh
      
      With .Workbooks.Open(mArchivo)
         With .ActiveSheet
            Do While True
               If Len(Trim(.Cells(fl, 2))) > 0 Then
                  mConjunto = .Cells(fl, 2)
                  
                  If Not oConj Is Nothing Then
                     oConj.Guardar
                     Set oConj = Nothing
                  End If
                  
                  oF.Label2 = "Conjunto : " & mConjunto
                  DoEvents
                  
                  mCodigo = .Cells(fl, 1)
                  Set oRsAux1 = oAp.Articulos.TraerFiltrado("_PorCodigo", mCodigo)
                  mIdArticulo = 0
                  If oRsAux1.RecordCount > 0 Then
                     mIdArticulo = oRsAux1.Fields(0).Value
                  Else
                     mError = mError & vbCrLf & "El conjunto " & mConjunto & _
                              " tiene un codigo inexistente"
                  End If
                  oRsAux1.Close
                  
                  If mIdArticulo <> 0 Then
                     Set oRsAux1 = oAp.Conjuntos.TraerFiltrado("_PorIdArticulo", mIdArticulo)
                     If oRsAux1.RecordCount > 0 Then
                        mError = mError & vbCrLf & "El conjunto " & mConjunto & " ya existe"
                     Else
                        Set oConj = oAp.Conjuntos.Item(-1)
                        With oConj.Registro
                           .Fields("IdArticulo").Value = mIdArticulo
                           .Fields("IdRealizo").Value = glbIdUsuario
                           .Fields("FechaRegistro").Value = Date
                        End With
                     End If
                     oRsAux1.Close
                  End If
               End If
               
               If Len(Trim(.Cells(fl, 4))) > 0 Then
                  If Not oConj Is Nothing Then
                     mCantidad = CDbl(.Cells(fl, 5))
                     
                     mCodigo = .Cells(fl, 3)
                     Set oRsAux1 = oAp.Articulos.TraerFiltrado("_PorCodigo", mCodigo)
                     mIdArticulo = 0
                     If oRsAux1.RecordCount > 0 Then
                        mIdArticulo = oRsAux1.Fields(0).Value
                     Else
                        mError = mError & vbCrLf & "El componente " & .Cells(fl, 4) & _
                                 " del conjunto" & mConjunto & ", tiene un codigo inexistente"
                     End If
                     oRsAux1.Close
                     
                     mAbreviatura = .Cells(fl, 6)
                     Set oRsAux1 = oAp.Unidades.TraerFiltrado("_PorAbreviatura", mAbreviatura)
                     mIdUnidad = 0
                     If oRsAux1.RecordCount > 0 Then
                        mIdUnidad = oRsAux1.Fields(0).Value
                     Else
                        mError = mError & vbCrLf & "El componente " & .Cells(fl, 4) & _
                                 " del conjunto" & mConjunto & ", tiene la unidad inexistente"
                        mIdUnidad = mIdUnidadPorUnidad
                     End If
                     oRsAux1.Close
                     
                     With oConj.DetConjuntos.Item(-1)
                        With .Registro
                           .Fields("IdArticulo").Value = mIdArticulo
                           .Fields("IdUnidad").Value = mIdUnidad
                           .Fields("Cantidad").Value = mCantidad
                        End With
                        .Modificado = True
                     End With
                  End If
               End If
               
               If Len(Trim(.Cells(fl, 2))) = 0 And Len(Trim(.Cells(fl, 4))) = 0 Then
                  If Not oConj Is Nothing Then
                     oConj.Guardar
                     Set oConj = Nothing
                  End If
                  Exit Do
               End If
               
               fl = fl + 1
            Loop
         End With
         .Close False
      End With
      .Quit
   End With
   
Salida:

   Unload oF
   Set oF = Nothing

   If Len(mError) > 0 Then
      mError = "El proceso ha concluido con los siguientes errores :" & vbCrLf & mError
      Set oF = New frmConsulta1
      With oF
         .Id = 12
         oF.rchTexto.Text = mError
         .Show vbModal, Me
      End With
      Unload oF
      Set oF = Nothing
   End If

   Set oRsAux1 = Nothing
   Set oAp = Nothing
   Set oEx = Nothing

   Exit Sub

Mal:

   MsgBox "Se ha producido un error al registrar los datos" & vbCrLf & Err.Number & " -> " & Err.Description, vbCritical
   Resume Salida

End Sub

Public Sub ImportacionComprobantesProveedores()

   Dim oAp As ComPronto.Aplicacion
   Dim oCP As ComPronto.ComprobanteProveedor
   Dim oPr As ComPronto.Proveedor
   Dim oPar As ComPronto.Parametro
   Dim oRsAux1 As ADOR.Recordset
   Dim oRsAux2 As ADOR.Recordset
   Dim oF As Form
   Dim oEx As Excel.Application
   Dim mOk As Boolean, mConProblemas As Boolean
   Dim mArchivo As String, mComprobante As String, mCuit As String, mLetra As String
   Dim mBienesOServicios As String, mObservaciones As String, mRazonSocial As String
   Dim mIncrementarReferencia As String, mNumeroCAI As String
   Dim mFechaFactura As Date, mFechaVencimientoCAI As Date, mFechaRecepcion As Date
   Dim mIdMonedaPesos As Integer, mIdTipoComprobanteFacturaCompra As Integer
   Dim mIdUnidadPorUnidad As Integer, fl As Integer, mContador As Integer
   Dim mIdCuentaIvaCompras1 As Integer, mIdCuenta As Long, mIdObra As Integer
   Dim mIdCuentaGasto As Integer, i As Integer, mvarProvincia As Integer
   Dim mvarIBCondicion As Integer, mvarIdIBCondicion As Integer
   Dim mvarIGCondicion As Integer, mvarIdTipoRetencionGanancia As Integer
   Dim mIdTipoComprobante As Integer
   Dim mIdProveedor As Long, mNumeroComprobante1 As Long, mNumeroComprobante2 As Long
   Dim mCodigoCuenta As Long, mNumeroReferencia As Long
   Dim mvarCotizacionDolar As Single, mPorcentajeIVA As Single, mPorcentajeIVAInf As Single
   Dim mBruto As Double, mIva1 As Double, mTotalItem As Double, mPercepcion As Double
   Dim mTotalBruto As Double, mTotalIva1 As Double, mTotalComprobante As Double
   Dim mTotalPercepcion As Double, mAjusteIVA As Double, mTotalAjusteIVA As Double
   Dim mIdCuentaIvaCompras(10) As Long
   Dim mIVAComprasPorcentaje(10) As Single

   On Error GoTo Mal

   Set oF = New frmPathPresto
   With oF
      .Id = 2
      .Show vbModal
      mOk = .Ok
      If mOk Then
         mArchivo = .FileBrowser1(0).Text
         mIdObra = .dcfields(0).BoundText
         mFechaRecepcion = .DTFields(0).Value
         mNumeroReferencia = Val(.Text1.Text)
      End If
   End With
   Unload oF
   Set oF = Nothing

   If Not mOk Then Exit Sub

   Set oAp = Aplicacion

   mIncrementarReferencia = BuscarClaveINI("IncrementarReferenciaEnImportacionDeComprobantes")
   
   Set oRsAux1 = oAp.Parametros.TraerFiltrado("_PorId", 1)
   mIdMonedaPesos = oRsAux1.Fields("IdMoneda").Value
   mIdTipoComprobanteFacturaCompra = oRsAux1.Fields("IdTipoComprobanteFacturaCompra").Value
   mIdUnidadPorUnidad = oRsAux1.Fields("IdUnidadPorUnidad").Value
   For i = 1 To 10
      If Not IsNull(oRsAux1.Fields("IdCuentaIvaCompras" & i).Value) Then
         mIdCuentaIvaCompras(i) = oRsAux1.Fields("IdCuentaIvaCompras" & i).Value
         mIVAComprasPorcentaje(i) = oRsAux1.Fields("IVAComprasPorcentaje" & i).Value
      Else
         mIdCuentaIvaCompras(i) = 0
         mIVAComprasPorcentaje(i) = 0
      End If
   Next
   oRsAux1.Close
   
   Set oF = New frmAviso
   With oF
      .Label1 = "Iniciando EXCEL ..."
      .Show
      .Refresh
      DoEvents
   End With

   oF.Label1 = oF.Label1 & vbCrLf & "Procesando comprobantes ..."
   oF.Label2 = ""
   oF.Label3 = ""
   DoEvents

   fl = 7
   mContador = 0
   
   Set oEx = CreateObject("Excel.Application")
   With oEx
      .Visible = True
      .WindowState = xlMinimized
      Me.Refresh
      With .Workbooks.Open(mArchivo)
         .Sheets("PROVEEDORES").Select
         With .ActiveSheet
            Do While True
               If Len(Trim(.Cells(fl, 2))) > 0 Then
                  mConProblemas = False
                  mContador = mContador + 1
                  oF.Label2 = "Comprobante : " & .Cells(fl, 5)
                  oF.Label3 = "" & mContador
                  DoEvents
               
                  If Len(.Cells(fl, 3)) > 0 Then
                     mIdTipoComprobante = .Cells(fl, 3)
                  Else
                     mIdTipoComprobante = mIdTipoComprobanteFacturaCompra
                  End If
                  mLetra = .Cells(fl, 4)
                  mComprobante = .Cells(fl, 5)
                  mNumeroComprobante1 = 0
                  mNumeroComprobante2 = 0
                  If InStr(1, mComprobante, "-") <> 0 Then
                     mNumeroComprobante1 = CLng(mId(mComprobante, 1, InStr(1, mComprobante, "-") - 1))
                     If mNumeroComprobante1 > 9999 Then
                        MsgBox "El punto de venta no puede tener mas de 4 digitos. (Fila " & fl & ")", vbExclamation
                        GoTo Salida
                     End If
                     mNumeroComprobante2 = CLng(mId(mComprobante, InStr(1, mComprobante, "-") + 1, 100))
                     If mNumeroComprobante2 > 99999999 Then
                        MsgBox "El numero de comprobante no puede tener mas de 8 digitos. (Fila " & fl & ")", vbExclamation
                        GoTo Salida
                     End If
                  End If
                  mRazonSocial = .Cells(fl, 6)
                  mCuit = .Cells(fl, 7)
                  mPorcentajeIVAInf = CSng(.Cells(fl, 8))
                  mFechaFactura = CDate(.Cells(fl, 2))
                  mNumeroCAI = .Cells(fl, 15)
                  If IsDate(.Cells(fl, 17)) Then
                     mFechaVencimientoCAI = CDate(.Cells(fl, 17))
                  Else
                     mFechaVencimientoCAI = 0
                  End If
                  
                  mIdProveedor = 0
                  Set oRsAux1 = oAp.Proveedores.TraerFiltrado("_PorCuit", mCuit)
                  If oRsAux1.RecordCount > 0 Then
                     mIdProveedor = oRsAux1.Fields(0).Value
                     mvarProvincia = IIf(IsNull(oRsAux1.Fields("IdProvincia").Value), 0, oRsAux1.Fields("IdProvincia").Value)
                     mvarIBCondicion = IIf(IsNull(oRsAux1.Fields("IBCondicion").Value), 0, oRsAux1.Fields("IBCondicion").Value)
                     mvarIdIBCondicion = IIf(IsNull(oRsAux1.Fields("IdIBCondicionPorDefecto").Value), 0, oRsAux1.Fields("IdIBCondicionPorDefecto").Value)
                     mvarIGCondicion = IIf(IsNull(oRsAux1.Fields("IGCondicion").Value), 0, oRsAux1.Fields("IGCondicion").Value)
                     mvarIdTipoRetencionGanancia = IIf(IsNull(oRsAux1.Fields("IdTipoRetencionGanancia").Value), 0, oRsAux1.Fields("IdTipoRetencionGanancia").Value)
                     mBienesOServicios = IIf(IsNull(oRsAux1.Fields("BienesOServicios").Value), "B", oRsAux1.Fields("BienesOServicios").Value)
                  Else
                     Set oPr = oAp.Proveedores.Item(-1)
                     With oPr.Registro
                        .Fields("Confirmado").Value = "NO"
                        .Fields("RazonSocial").Value = mId(mRazonSocial, 1, 50)
                        .Fields("CUIT").Value = mCuit
                        .Fields("EnviarEmail").Value = 1
                     End With
                     oPr.Guardar
                     mIdProveedor = oPr.Registro.Fields(0).Value
                     Set oPr = Nothing
                     mvarProvincia = 0
                     mvarIBCondicion = 0
                     mvarIdIBCondicion = 0
                     mvarIGCondicion = 0
                     mvarIdTipoRetencionGanancia = 0
                     mBienesOServicios = "B"
                  End If
                  oRsAux1.Close
               
                  Set oRsAux1 = oAp.ComprobantesProveedores.TraerFiltrado("_PorNumeroComprobante", _
                                 Array(mIdProveedor, mLetra, mNumeroComprobante1, mNumeroComprobante2, -1, -1))
                  If oRsAux1.RecordCount = 0 Then
                     mvarCotizacionDolar = Cotizacion(mFechaFactura, glbIdMonedaDolar)
                     If mvarCotizacionDolar = 0 Then
                        mConProblemas = True
                     End If
                     Set oCP = oAp.ComprobantesProveedores.Item(-1)
                     With oCP
                        With .Registro
                           .Fields("IdTipoComprobante").Value = mIdTipoComprobante
                           .Fields("IdObra").Value = mIdObra
                           .Fields("FechaComprobante").Value = mFechaFactura
                           .Fields("FechaRecepcion").Value = mFechaRecepcion
                           .Fields("FechaVencimiento").Value = mFechaFactura
                           .Fields("IdMoneda").Value = mIdMonedaPesos
                           .Fields("CotizacionMoneda").Value = 1
                           .Fields("CotizacionDolar").Value = mvarCotizacionDolar
                           .Fields("IdProveedor").Value = mIdProveedor
                           .Fields("Letra").Value = mLetra
                           .Fields("NumeroComprobante1").Value = mNumeroComprobante1
                           .Fields("NumeroComprobante2").Value = mNumeroComprobante2
                           If (mvarIBCondicion = 2 Or mvarIBCondicion = 3) And mvarIdIBCondicion <> 0 Then
                              .Fields("IdIBCondicion").Value = mvarIdIBCondicion
                           Else
                              .Fields("IdIBCondicion").Value = Null
                           End If
                           If (mvarIGCondicion = 2 Or mvarIGCondicion = 3) And mvarIdTipoRetencionGanancia <> 0 Then
                              .Fields("IdTipoRetencionGanancia").Value = mvarIdTipoRetencionGanancia
                           Else
                              .Fields("IdTipoRetencionGanancia").Value = Null
                           End If
                           .Fields("IdProvinciaDestino").Value = mvarProvincia
                           .Fields("BienesOServicios").Value = mBienesOServicios
                           .Fields("NumeroCAI").Value = mNumeroCAI
                           If mFechaVencimientoCAI <> 0 Then
                              .Fields("FechaVencimientoCAI").Value = mFechaVencimientoCAI
                           Else
                              .Fields("FechaVencimientoCAI").Value = Null
                           End If
                        End With
                     End With
                     
                     mTotalBruto = 0
                     mTotalIva1 = 0
                     mTotalPercepcion = 0
                     mTotalComprobante = 0
                     mTotalAjusteIVA = 0
                     mObservaciones = ""
                     Do While Len(Trim(.Cells(fl, 2))) > 0 And mComprobante = .Cells(fl, 5) And mCuit = .Cells(fl, 7)
                        mCodigoCuenta = CLng(.Cells(fl, 9))
                        mBruto = Abs(CDbl(.Cells(fl, 10)))
                        mIva1 = Abs(CDbl(.Cells(fl, 11)))
                        mPercepcion = Abs(CDbl(.Cells(fl, 12)))
                        mTotalItem = Abs(CDbl(.Cells(fl, 13)))
                        mObservaciones = mObservaciones & .Cells(fl, 19) & vbCrLf
                        
                        mTotalBruto = mTotalBruto + mBruto
                        mTotalIva1 = mTotalIva1 + mIva1
                        mTotalPercepcion = mTotalPercepcion + mPercepcion
                        mTotalComprobante = mTotalComprobante + mTotalItem
                        mAjusteIVA = 0
                        
                        mPorcentajeIVA = 0
                        If mIva1 <> 0 And mBruto <> 0 Then
                           mPorcentajeIVA = Round(mIva1 / mBruto * 100, 1)
                        End If
                        
                        mIdCuentaIvaCompras1 = 0
                        If mIva1 <> 0 Then
                           If mPorcentajeIVAInf <> 0 Then
                              For i = 1 To 10
                                 If mIVAComprasPorcentaje(i) = mPorcentajeIVAInf Then
                                    mIdCuentaIvaCompras1 = mIdCuentaIvaCompras(i)
                                    mAjusteIVA = mIva1 - Round(mBruto * mPorcentajeIVAInf / 100, 2)
                                    mIva1 = Round(mBruto * mPorcentajeIVAInf / 100, 2)
                                    mPorcentajeIVA = mPorcentajeIVAInf
                                    Exit For
                                 End If
                              Next
                           End If
                           If mIdCuentaIvaCompras1 = 0 Then
                              If mPorcentajeIVA <> 0 Then
                                 For i = 1 To 10
                                    If mIVAComprasPorcentaje(i) = mPorcentajeIVA Then
                                       mIdCuentaIvaCompras1 = mIdCuentaIvaCompras(i)
                                       Exit For
                                    End If
                                 Next
                              End If
                           End If
                           If mIdCuentaIvaCompras1 = 0 Then
                              mConProblemas = True
                           End If
                        End If
                        
                        mTotalAjusteIVA = mTotalAjusteIVA + mAjusteIVA
                        
                        mIdCuenta = 0
                        mIdCuentaGasto = 0
                        If mCodigoCuenta > 1000 Then
                           Set oRsAux2 = oAp.Cuentas.TraerFiltrado("_PorCodigo", mCodigoCuenta)
                           If oRsAux2.RecordCount > 0 Then
                              mIdCuenta = oRsAux2.Fields(0).Value
                           End If
                        Else
                           Set oRsAux2 = oAp.CuentasGastos.TraerFiltrado("_PorId", mCodigoCuenta)
                           If oRsAux2.RecordCount > 0 Then
                              mIdCuentaGasto = oRsAux2.Fields(0).Value
                           End If
                        End If
                        oRsAux2.Close
                        If mIdCuentaGasto = 0 And mIdCuenta = 0 Then
                           mConProblemas = True
                        End If
                        If mIdCuenta = 0 Then
                           Set oRsAux2 = oAp.Cuentas.TraerFiltrado("_PorObraCuentaGasto", Array(mIdObra, mIdCuentaGasto))
                           If oRsAux2.RecordCount > 0 Then
                              mIdCuenta = oRsAux2.Fields(0).Value
                              mCodigoCuenta = oRsAux2.Fields("Codigo").Value
                           End If
                           oRsAux2.Close
                           If mIdCuentaGasto = 0 Then
                              mConProblemas = True
                           End If
                        End If
                        
                        With oCP.DetComprobantesProveedores.Item(-1)
                           With .Registro
                              .Fields("IdObra").Value = mIdObra
                              .Fields("IdCuentaGasto").Value = mIdCuentaGasto
                              .Fields("IdCuenta").Value = mIdCuenta
                              .Fields("CodigoCuenta").Value = mCodigoCuenta
                              .Fields("Importe").Value = mBruto
                              If mIdCuentaIvaCompras1 <> 0 Then
                                 .Fields("IdCuentaIvaCompras1").Value = mIdCuentaIvaCompras1
                                 .Fields("IVAComprasPorcentaje1").Value = mPorcentajeIVA
                                 .Fields("ImporteIVA1").Value = mIva1
                                 .Fields("AplicarIVA1").Value = "SI"
                              Else
                                 .Fields("IdCuentaIvaCompras1").Value = Null
                                 .Fields("IVAComprasPorcentaje1").Value = 0
                                 .Fields("ImporteIVA1").Value = 0
                                 .Fields("AplicarIVA1").Value = "NO"
                              End If
                              .Fields("IdCuentaIvaCompras2").Value = Null
                              .Fields("IVAComprasPorcentaje2").Value = 0
                              .Fields("ImporteIVA2").Value = 0
                              .Fields("AplicarIVA2").Value = "NO"
                              .Fields("IdCuentaIvaCompras3").Value = Null
                              .Fields("IVAComprasPorcentaje3").Value = 0
                              .Fields("ImporteIVA3").Value = 0
                              .Fields("AplicarIVA3").Value = "NO"
                              .Fields("IdCuentaIvaCompras4").Value = Null
                              .Fields("IVAComprasPorcentaje4").Value = 0
                              .Fields("ImporteIVA4").Value = 0
                              .Fields("AplicarIVA4").Value = "NO"
                              .Fields("IdCuentaIvaCompras5").Value = Null
                              .Fields("IVAComprasPorcentaje5").Value = 0
                              .Fields("ImporteIVA5").Value = 0
                              .Fields("AplicarIVA5").Value = "NO"
                              .Fields("IdCuentaIvaCompras6").Value = Null
                              .Fields("IVAComprasPorcentaje6").Value = 0
                              .Fields("ImporteIVA6").Value = 0
                              .Fields("AplicarIVA6").Value = "NO"
                              .Fields("IdCuentaIvaCompras7").Value = Null
                              .Fields("IVAComprasPorcentaje7").Value = 0
                              .Fields("ImporteIVA7").Value = 0
                              .Fields("AplicarIVA7").Value = "NO"
                              .Fields("IdCuentaIvaCompras8").Value = Null
                              .Fields("IVAComprasPorcentaje8").Value = 0
                              .Fields("ImporteIVA8").Value = 0
                              .Fields("AplicarIVA8").Value = "NO"
                              .Fields("IdCuentaIvaCompras9").Value = Null
                              .Fields("IVAComprasPorcentaje9").Value = 0
                              .Fields("ImporteIVA9").Value = 0
                              .Fields("AplicarIVA9").Value = "NO"
                              .Fields("IdCuentaIvaCompras10").Value = Null
                              .Fields("IVAComprasPorcentaje10").Value = 0
                              .Fields("ImporteIVA10").Value = 0
                              .Fields("AplicarIVA10").Value = "NO"
                           End With
                           .Modificado = True
                        End With
                     
                        fl = fl + 1
                     Loop
                     
                     With oCP
                        With .Registro
                           .Fields("NumeroReferencia").Value = mNumeroReferencia
'                           If mConProblemas Then
                              .Fields("Confirmado").Value = "NO"
'                           Else
'                              .Fields("Confirmado").Value = "SI"
'                           End If
                           .Fields("TotalBruto").Value = mTotalBruto
                           .Fields("TotalIva1").Value = mTotalIva1
                           .Fields("TotalIva2").Value = 0
                           .Fields("AjusteIVA").Value = mTotalAjusteIVA
                           .Fields("TotalBonificacion").Value = 0
                           .Fields("TotalComprobante").Value = mTotalComprobante
                           .Fields("PorcentajeBonificacion").Value = 0
                           .Fields("TotalIVANoDiscriminado").Value = 0
                           If Len(mObservaciones) > 2 Then .Fields("Observaciones").Value = mObservaciones
                           If mIncrementarReferencia <> "SI" Then
                              .Fields("AutoincrementarNumeroReferencia").Value = "NO"
                           End If
                        End With
                        .Guardar
                     End With
                     Set oCP = Nothing
                  
'                     If BuscarClaveINI("IncrementarReferenciaEnImportacionDeComprobantes") = "SI" Then
'                        Set oPar = oAp.Parametros.Item(1)
'                        oPar.Registro.Fields("ProximoComprobanteProveedorReferencia").Value = mNumeroReferencia + 1
'                        oPar.Guardar
'                        Set oPar = Nothing
'                     End If
                     
                     mNumeroReferencia = mNumeroReferencia + 1
                  Else
                     fl = fl + 1
                  End If
                  oRsAux1.Close
               Else
                  Exit Do
               End If
            Loop
         End With
         .Close False
      End With
      .Quit
   End With
   
Salida:
   Unload oF
   Set oF = Nothing

   Set oRsAux1 = Nothing
   Set oRsAux2 = Nothing
   Set oAp = Nothing
   Set oEx = Nothing
   Set oCP = Nothing

   Exit Sub

Mal:
   MsgBox "Se ha producido un error al registrar los datos" & vbCrLf & Err.Number & " -> " & Err.Description, vbCritical
   Resume Salida

End Sub

Public Sub ImportacionComprobantesFondoFijo()

   Dim oAp As ComPronto.Aplicacion
   Dim oCP As ComPronto.ComprobanteProveedor
   Dim oPr As ComPronto.Proveedor
   Dim oPar As ComPronto.Parametro
   Dim oOP As ComPronto.OrdenPago
   Dim oRsAux1 As ADOR.Recordset
   Dim oRsAux2 As ADOR.Recordset
   Dim oF As Form
   Dim oEx As Excel.Application
   Dim mOk As Boolean, mConProblemas As Boolean
   Dim mArchivo As String, mComprobante As String, mCuit As String, mLetra As String
   Dim mBienesOServicios As String, mObservaciones As String, mRazonSocial As String
   Dim mIncrementarReferencia As String, mCondicionCompra As String
   Dim mNumeroCAI As String, mFecha1 As String, mError As String
   Dim mInformacionAuxiliar As String, mCuitDefault As String
   Dim mFechaFactura As Date, mFechaVencimientoCAI As Date, mFechaRecepcion As Date
   Dim mIdMonedaPesos As Integer, mIdTipoComprobanteFacturaCompra As Integer, mIdUnidadPorUnidad As Integer, fl As Integer
   Dim mContador As Integer, mIdCuentaIvaCompras1 As Integer, mIdCuenta As Long, mIdObra As Integer, mIdCuentaGasto As Integer
   Dim i As Integer, mvarProvincia As Integer, mvarIBCondicion As Integer, mvarIdIBCondicion As Integer, mIdEtapa As Integer
   Dim mvarIGCondicion As Integer, mvarIdTipoRetencionGanancia As Integer, mIdTipoComprobante As Integer, mIdCuentaFF As Integer
   Dim mIdUO As Integer, mIdCodigoIva As Integer, mPosicionPorcentajeIva As Integer
   Dim mIdProveedor As Long, mNumeroComprobante1 As Long, mNumeroComprobante2 As Long, mCodigoCuenta As Long
   Dim mNumeroReferencia As Long, mCodigoCuentaFF As Long, mNumeroOP As Long, mIdOrdenPago As Long, mAux1 As Long, mAux2 As Long
   Dim mNumeroRendicion As Long, mNumeroRequerimiento As Long, mNumeroItem As Long, mIdDetallePedido As Long, mIdDetalleRecepcion As Long
   Dim mvarCotizacionDolar As Single, mPorcentajeIVA As Single
   Dim mBruto As Double, mIva1 As Double, mTotalItem As Double, mPercepcion As Double, mTotalBruto As Double, mTotalIva1 As Double
   Dim mTotalComprobante As Double, mTotalPercepcion As Double, mValores As Double, mAjusteIVA As Double, mTotalAjusteIVA As Double
   Dim mLetraOk As Boolean
   Dim mIdCuentaIvaCompras(10) As Long
   Dim mIVAComprasPorcentaje(10) As Single

   On Error GoTo Mal

   Set oF = New frmPathPresto
   With oF
      .Id = 2
      .Show vbModal
      mOk = .Ok
      If mOk Then
         mArchivo = .FileBrowser1(0).Text
         mIdObra = .dcfields(0).BoundText
         mFechaRecepcion = .DTFields(0).Value
         mNumeroReferencia = Val(.Text1.Text)
      End If
   End With
   Unload oF
   Set oF = Nothing

   If Not mOk Then Exit Sub

   Set oAp = Aplicacion

   mIncrementarReferencia = BuscarClaveINI("IncrementarReferenciaEnImportacionDeComprobantes")
   mCondicionCompra = BuscarClaveINI("Condicion de compra default para fondos fijos")
   mFecha1 = BuscarClaveINI("Fecha recepcion igual fecha comprobante en fondo fijo")
   mCuitDefault = BuscarClaveINI("Cuit por defecto en la importacion de fondos fijos")
   mLetraOk = False
   If BuscarClaveINI("Desactivar control letra comprobante proveedor") = "SI" Then mLetraOk = True
   
   Set oRsAux1 = oAp.Parametros.TraerFiltrado("_PorId", 1)
   mIdMonedaPesos = oRsAux1.Fields("IdMoneda").Value
   mIdTipoComprobanteFacturaCompra = oRsAux1.Fields("IdTipoComprobanteFacturaCompra").Value
   mIdUnidadPorUnidad = IIf(IsNull(oRsAux1.Fields("IdUnidadPorUnidad").Value), 0, oRsAux1.Fields("IdUnidadPorUnidad").Value)
   gblFechaUltimoCierre = IIf(IsNull(oRsAux1.Fields("FechaUltimoCierre").Value), DateSerial(1980, 1, 1), oRsAux1.Fields("FechaUltimoCierre").Value)
   For i = 1 To 10
      If Not IsNull(oRsAux1.Fields("IdCuentaIvaCompras" & i).Value) Then
         mIdCuentaIvaCompras(i) = oRsAux1.Fields("IdCuentaIvaCompras" & i).Value
         mIVAComprasPorcentaje(i) = oRsAux1.Fields("IVAComprasPorcentaje" & i).Value
      Else
         mIdCuentaIvaCompras(i) = 0
         mIVAComprasPorcentaje(i) = 0
      End If
   Next
   oRsAux1.Close
   
   mIdUO = 0
   Set oRsAux1 = oAp.Obras.TraerFiltrado("_PorId", mIdObra)
   If oRsAux1.RecordCount > 0 Then
      mIdUO = IIf(IsNull(oRsAux1.Fields("IdUnidadOperativa").Value), 0, oRsAux1.Fields("IdUnidadOperativa").Value)
   End If
   oRsAux1.Close
   
   Set oF = New frmAviso
   With oF
      .Label1 = "Iniciando EXCEL ..."
      .Show
      .Refresh
      DoEvents
   End With

   oF.Label1 = oF.Label1 & vbCrLf & "Procesando fondo fijo ..."
   oF.Label2 = ""
   oF.Label3 = ""
   DoEvents

   fl = 7
   mContador = 0
   mNumeroRendicion = 0
   
   Set oEx = CreateObject("Excel.Application")
   With oEx
      
      .Visible = True
      .WindowState = xlMinimized
      Me.Refresh
      
      With .Workbooks.Open(mArchivo)
         .Sheets("FF").Select
         With .ActiveSheet
            Do While True
               If Len(Trim(.Cells(fl, 2))) > 0 Then
                  mConProblemas = False
                  
                  If mNumeroRendicion = 0 And IsNumeric(.Cells(2, 13)) Then
                     mNumeroRendicion = .Cells(2, 13)
                  End If
                  
                  mContador = mContador + 1
                  oF.Label2 = "Comprobante : " & .Cells(fl, 5)
                  oF.Label3 = "" & mContador
                  DoEvents
               
                  If Len(.Cells(fl, 3)) > 0 Then
                     mIdTipoComprobante = .Cells(fl, 3)
                  Else
                     mIdTipoComprobante = mIdTipoComprobanteFacturaCompra
                  End If
                  mLetra = Trim(.Cells(fl, 4))
                  If InStr(1, "A B C M", mLetra) = 0 And Not mLetraOk Then
                     mError = mError & vbCrLf & "Fila " & fl & "  - Letra de comprobante incorrecta"
                     fl = fl + 1
                     GoTo FinLoop
                  End If
                  mComprobante = .Cells(fl, 5)
                  mNumeroComprobante1 = 0
                  mNumeroComprobante2 = 0
                  If InStr(1, mComprobante, "-") <> 0 Then
                     mNumeroComprobante1 = CLng(mId(mComprobante, 1, InStr(1, mComprobante, "-") - 1))
                     If mNumeroComprobante1 > 9999 Then
                        mError = mError & vbCrLf & "Fila " & fl & "  - El punto de venta no puede tener mas de 4 digitos."
                        fl = fl + 1
                        GoTo FinLoop
                     End If
                     mNumeroComprobante2 = CLng(mId(mComprobante, InStr(1, mComprobante, "-") + 1, 100))
                     If mNumeroComprobante2 > 99999999 Then
                        mError = mError & vbCrLf & "Fila " & fl & "  - El numero de comprobante no puede tener mas de 8 digitos."
                        fl = fl + 1
                        GoTo FinLoop
                     End If
                  End If
                  mRazonSocial = .Cells(fl, 6)
                  mCuit = .Cells(fl, 7)
                  mFechaFactura = CDate(.Cells(fl, 2))
                  mNumeroCAI = .Cells(fl, 15)
                  If IsDate(.Cells(fl, 17)) Then
                     mFechaVencimientoCAI = CDate(.Cells(fl, 17))
                  Else
                     mFechaVencimientoCAI = 0
                  End If
                  mInformacionAuxiliar = .Cells(fl, 18)

                  If mFecha1 = "SI" Then mFechaRecepcion = mFechaFactura
                  
                  If mFechaRecepcion > gblFechaUltimoCierre Then
                     If Len(mCuit) = 0 Then mCuit = mCuitDefault
                     If Len(mCuit) = 0 Then
                        mError = mError & vbCrLf & "Fila " & fl & "  - Cuit inexistente"
                        fl = fl + 1
                        GoTo FinLoop
                     Else
                        If Not VerificarCuit(mCuit) Then
                           mError = mError & vbCrLf & "Fila " & fl & "  - Cuit invalido : " & mCuit
                           fl = fl + 1
                           GoTo FinLoop
                        End If
                     End If
                     mIdProveedor = 0
                     Set oRsAux1 = oAp.Proveedores.TraerFiltrado("_PorCuit", mCuit)
                     If oRsAux1.RecordCount > 0 Then
                        mIdProveedor = oRsAux1.Fields(0).Value
                        mvarProvincia = IIf(IsNull(oRsAux1.Fields("IdProvincia").Value), 0, oRsAux1.Fields("IdProvincia").Value)
                        mvarIBCondicion = IIf(IsNull(oRsAux1.Fields("IBCondicion").Value), 0, oRsAux1.Fields("IBCondicion").Value)
                        mvarIdIBCondicion = IIf(IsNull(oRsAux1.Fields("IdIBCondicionPorDefecto").Value), 0, oRsAux1.Fields("IdIBCondicionPorDefecto").Value)
                        mvarIGCondicion = IIf(IsNull(oRsAux1.Fields("IGCondicion").Value), 0, oRsAux1.Fields("IGCondicion").Value)
                        mvarIdTipoRetencionGanancia = IIf(IsNull(oRsAux1.Fields("IdTipoRetencionGanancia").Value), 0, oRsAux1.Fields("IdTipoRetencionGanancia").Value)
                        mBienesOServicios = IIf(IsNull(oRsAux1.Fields("BienesOServicios").Value), "B", oRsAux1.Fields("BienesOServicios").Value)
                        mIdCodigoIva = IIf(IsNull(oRsAux1.Fields("IdCodigoIva").Value), 0, oRsAux1.Fields("IdCodigoIva").Value)
                     Else
                        If mLetra = "C" Then
                           mIdCodigoIva = 6
                        Else
                           mIdCodigoIva = 1
                        End If
                        Set oPr = oAp.Proveedores.Item(-1)
                        With oPr.Registro
                           .Fields("Confirmado").Value = "NO"
                           .Fields("RazonSocial").Value = mId(mRazonSocial, 1, 50)
                           .Fields("CUIT").Value = mCuit
                           .Fields("EnviarEmail").Value = 1
                           If mIdCodigoIva <> 0 Then .Fields("IdCodigoIva").Value = mIdCodigoIva
                           If IsNumeric(mCondicionCompra) Then
                              .Fields("IdCondicionCompra").Value = CInt(mCondicionCompra)
                           End If
                        End With
                        oPr.Guardar
                        mIdProveedor = oPr.Registro.Fields(0).Value
                        Set oPr = Nothing
                        mvarProvincia = 0
                        mvarIBCondicion = 0
                        mvarIdIBCondicion = 0
                        mvarIGCondicion = 0
                        mvarIdTipoRetencionGanancia = 0
                        mBienesOServicios = "B"
                     End If
                     oRsAux1.Close
                     
                     mCodigoCuentaFF = .Cells(fl, 20)
                     mIdCuentaFF = 0
                     Set oRsAux1 = oAp.Cuentas.TraerFiltrado("_PorCodigo", mCodigoCuentaFF)
                     If oRsAux1.RecordCount > 0 Then
                        mIdCuentaFF = oRsAux1.Fields(0).Value
                     End If
                  
                     Set oRsAux1 = oAp.ComprobantesProveedores.TraerFiltrado("_PorNumeroComprobante", _
                                    Array(mIdProveedor, mLetra, mNumeroComprobante1, mNumeroComprobante2, -1, mIdTipoComprobante))
                     If oRsAux1.RecordCount = 0 Then
                        mvarCotizacionDolar = Cotizacion(mFechaFactura, glbIdMonedaDolar)
                        If mvarCotizacionDolar = 0 Then
                           mConProblemas = True
                        End If
                        Set oCP = oAp.ComprobantesProveedores.Item(-1)
                        With oCP
                           With .Registro
                              .Fields("IdTipoComprobante").Value = mIdTipoComprobante
                              .Fields("IdObra").Value = mIdObra
                              .Fields("FechaComprobante").Value = mFechaFactura
                              .Fields("FechaRecepcion").Value = mFechaRecepcion
                              .Fields("FechaVencimiento").Value = mFechaFactura
                              .Fields("FechaAsignacionPresupuesto").Value = mFechaFactura
                              .Fields("IdMoneda").Value = mIdMonedaPesos
                              .Fields("CotizacionMoneda").Value = 1
                              .Fields("CotizacionDolar").Value = mvarCotizacionDolar
                              .Fields("IdProveedorEventual").Value = mIdProveedor
                              .Fields("IdProveedor").Value = Null
                              .Fields("IdCuenta").Value = mIdCuentaFF
                              .Fields("IdOrdenPago").Value = Null ' -9
                              .Fields("Letra").Value = mLetra
                              .Fields("NumeroComprobante1").Value = mNumeroComprobante1
                              .Fields("NumeroComprobante2").Value = mNumeroComprobante2
                              .Fields("NumeroRendicionFF").Value = mNumeroRendicion
                              If (mvarIBCondicion = 2 Or mvarIBCondicion = 3) And mvarIdIBCondicion <> 0 Then
                                 .Fields("IdIBCondicion").Value = mvarIdIBCondicion
                              Else
                                 .Fields("IdIBCondicion").Value = Null
                              End If
                              If (mvarIGCondicion = 2 Or mvarIGCondicion = 3) And mvarIdTipoRetencionGanancia <> 0 Then
                                 .Fields("IdTipoRetencionGanancia").Value = mvarIdTipoRetencionGanancia
                              Else
                                 .Fields("IdTipoRetencionGanancia").Value = Null
                              End If
                              .Fields("IdProvinciaDestino").Value = mvarProvincia
                              .Fields("BienesOServicios").Value = Null
                              .Fields("NumeroCAI").Value = mNumeroCAI
                              If mFechaVencimientoCAI <> 0 Then
                                 .Fields("FechaVencimientoCAI").Value = mFechaVencimientoCAI
                              Else
                                 .Fields("FechaVencimientoCAI").Value = Null
                              End If
                              .Fields("DestinoPago").Value = "O"
                              .Fields("InformacionAuxiliar").Value = mInformacionAuxiliar
                              If mIdCodigoIva <> 0 Then .Fields("IdCodigoIva").Value = mIdCodigoIva
                              .Fields("CircuitoFirmasCompleto").Value = "SI"
                           End With
                        End With
                        
                        mTotalBruto = 0
                        mTotalIva1 = 0
                        mTotalPercepcion = 0
                        mTotalComprobante = 0
                        mTotalAjusteIVA = 0
                        mObservaciones = "Rendicion : " & mNumeroRendicion & vbCrLf
                        Do While Len(Trim(.Cells(fl, 2))) > 0 And mComprobante = .Cells(fl, 5) And (mCuit = .Cells(fl, 7) Or mCuit = mCuitDefault)
                           mCodigoCuenta = CLng(.Cells(fl, 9))
                           mBruto = Abs(CDbl(.Cells(fl, 10)))
                           mIva1 = Round(Abs(CDbl(.Cells(fl, 11))), 4)
                           mPercepcion = Abs(CDbl(.Cells(fl, 12)))
                           mTotalItem = Round(Abs(CDbl(.Cells(fl, 13))), 2)
                           mObservaciones = mObservaciones & .Cells(fl, 19) & vbCrLf
                           mAjusteIVA = 0
                           If Len(.Cells(5, 24)) > 0 Then mAjusteIVA = CDbl(.Cells(fl, 24))
                           mAux1 = 0
                           If Len(.Cells(fl, 25)) > 0 And IsNumeric(.Cells(fl, 25)) Then mAux1 = CLng(.Cells(fl, 25))
                           mPosicionPorcentajeIva = CInt(.Cells(fl, 8))
                           
                           mNumeroRequerimiento = 0
                           If Len(.Cells(fl, 27)) > 0 And IsNumeric(.Cells(fl, 27)) Then mNumeroRequerimiento = CLng(.Cells(fl, 27))
                           mNumeroItem = 0
                           If Len(.Cells(fl, 28)) > 0 And IsNumeric(.Cells(fl, 28)) Then mNumeroItem = CLng(.Cells(fl, 28))
                           mIdDetallePedido = 0
                           mIdDetalleRecepcion = 0
                           If mNumeroRequerimiento > 0 Then
                              Set oRsAux2 = oAp.Requerimientos.TraerFiltrado("_DatosPorNumeroItem", Array(mNumeroRequerimiento, mNumeroItem))
                              If oRsAux2.RecordCount > 0 Then
                                 mIdDetallePedido = oRsAux2.Fields("IdDetallePedido").Value
                                 mIdDetalleRecepcion = oRsAux2.Fields("IdDetalleRecepcion").Value
                              End If
                              oRsAux2.Close
                           End If
                           
                           mTotalBruto = mTotalBruto + mBruto
                           mTotalIva1 = mTotalIva1 + mIva1
                           mTotalPercepcion = mTotalPercepcion + mPercepcion
                           mTotalComprobante = mTotalComprobante + mTotalItem
                           mTotalAjusteIVA = mTotalAjusteIVA + mAjusteIVA
                           
                           mPorcentajeIVA = 0
                           If mIva1 <> 0 And mBruto <> 0 Then mPorcentajeIVA = Round(mIva1 / mBruto * 100, 1)
                           
                           mIdCuentaIvaCompras1 = 0
                           If mPorcentajeIVA <> 0 Then
                              For i = 1 To 10
                                 If mIVAComprasPorcentaje(i) = mPorcentajeIVA Then
                                    mIdCuentaIvaCompras1 = mIdCuentaIvaCompras(i)
                                    Exit For
                                 End If
                              Next
                              If mIdCuentaIvaCompras1 = 0 Then
                                 mPorcentajeIVA = Round(mIva1 / mBruto * 100, 2)
                                 For i = 1 To 10
                                    If mIVAComprasPorcentaje(i) = mPorcentajeIVA Then
                                       mIdCuentaIvaCompras1 = mIdCuentaIvaCompras(i)
                                       Exit For
                                    End If
                                 Next
                              End If
                           End If
                           If mTotalIva1 <> 0 And mIdCuentaIvaCompras1 = 0 Then mConProblemas = True
                           
                           mIdCuenta = 0
                           mIdCuentaGasto = 0
                           If mCodigoCuenta > 1000 Then
                              Set oRsAux2 = oAp.Cuentas.TraerFiltrado("_PorCodigo", mCodigoCuenta)
                              If oRsAux2.RecordCount > 0 Then
                                 mIdCuenta = oRsAux2.Fields(0).Value
                                 If IsNumeric(.Cells(fl, 23)) And Not IsNull(oRsAux2.Fields("IdObra").Value) Then
                                    mIdObra = oRsAux2.Fields("IdObra").Value
                                 End If
                              End If
                           Else
                              Set oRsAux2 = oAp.CuentasGastos.TraerFiltrado("_PorId", mCodigoCuenta)
                              If oRsAux2.RecordCount > 0 Then mIdCuentaGasto = oRsAux2.Fields(0).Value
                           End If
                           oRsAux2.Close
                           If mIdCuentaGasto = 0 And mIdCuenta = 0 Then
                              mConProblemas = True
                           End If
                           If mIdCuenta = 0 Then
                              Set oRsAux2 = oAp.Cuentas.TraerFiltrado("_PorObraCuentaGasto", Array(mIdObra, mIdCuentaGasto))
                              If oRsAux2.RecordCount > 0 Then
                                 mIdCuenta = oRsAux2.Fields(0).Value
                                 mCodigoCuenta = oRsAux2.Fields("Codigo").Value
                              End If
                              oRsAux2.Close
                              If mIdCuentaGasto = 0 Then mConProblemas = True
                           End If
                           
                           mAux2 = 0
                           If mAux1 <> 0 Then
                              Set oRsAux2 = oAp.RubrosContables.TraerFiltrado("_PorCodigo", mAux1)
                              If oRsAux2.RecordCount > 0 Then mAux2 = oRsAux2.Fields(0).Value
                              oRsAux2.Close
                           End If
                           
                           With oCP.DetComprobantesProveedores.Item(-1)
                              With .Registro
                                 .Fields("IdObra").Value = mIdObra
                                 .Fields("IdCuentaGasto").Value = mIdCuentaGasto
                                 .Fields("IdCuenta").Value = mIdCuenta
                                 .Fields("CodigoCuenta").Value = mCodigoCuenta
                                 .Fields("Importe").Value = mBruto
                                 If mIdCuentaIvaCompras1 <> 0 Then
                                    .Fields("IdCuentaIvaCompras1").Value = mIdCuentaIvaCompras1
                                    .Fields("IVAComprasPorcentaje1").Value = mPorcentajeIVA
                                    .Fields("ImporteIVA1").Value = Round(mIva1 + 0.001, 2)
                                    .Fields("AplicarIVA1").Value = "SI"
                                 Else
                                    .Fields("IdCuentaIvaCompras1").Value = Null
                                    .Fields("IVAComprasPorcentaje1").Value = 0
                                    .Fields("ImporteIVA1").Value = 0
                                    .Fields("AplicarIVA1").Value = "NO"
                                 End If
                                 .Fields("IdCuentaIvaCompras2").Value = Null
                                 .Fields("IVAComprasPorcentaje2").Value = 0
                                 .Fields("ImporteIVA2").Value = 0
                                 .Fields("AplicarIVA2").Value = "NO"
                                 .Fields("IdCuentaIvaCompras3").Value = Null
                                 .Fields("IVAComprasPorcentaje3").Value = 0
                                 .Fields("ImporteIVA3").Value = 0
                                 .Fields("AplicarIVA3").Value = "NO"
                                 .Fields("IdCuentaIvaCompras4").Value = Null
                                 .Fields("IVAComprasPorcentaje4").Value = 0
                                 .Fields("ImporteIVA4").Value = 0
                                 .Fields("AplicarIVA4").Value = "NO"
                                 .Fields("IdCuentaIvaCompras5").Value = Null
                                 .Fields("IVAComprasPorcentaje5").Value = 0
                                 .Fields("ImporteIVA5").Value = 0
                                 .Fields("AplicarIVA5").Value = "NO"
                                 .Fields("IdCuentaIvaCompras6").Value = Null
                                 .Fields("IVAComprasPorcentaje6").Value = 0
                                 .Fields("ImporteIVA6").Value = 0
                                 .Fields("AplicarIVA6").Value = "NO"
                                 .Fields("IdCuentaIvaCompras7").Value = Null
                                 .Fields("IVAComprasPorcentaje7").Value = 0
                                 .Fields("ImporteIVA7").Value = 0
                                 .Fields("AplicarIVA7").Value = "NO"
                                 .Fields("IdCuentaIvaCompras8").Value = Null
                                 .Fields("IVAComprasPorcentaje8").Value = 0
                                 .Fields("ImporteIVA8").Value = 0
                                 .Fields("AplicarIVA8").Value = "NO"
                                 .Fields("IdCuentaIvaCompras9").Value = Null
                                 .Fields("IVAComprasPorcentaje9").Value = 0
                                 .Fields("ImporteIVA9").Value = 0
                                 .Fields("AplicarIVA9").Value = "NO"
                                 .Fields("IdCuentaIvaCompras10").Value = Null
                                 .Fields("IVAComprasPorcentaje10").Value = 0
                                 .Fields("ImporteIVA10").Value = 0
                                 .Fields("AplicarIVA10").Value = "NO"
                                 If mAux2 > 0 Then .Fields("IdRubroContable").Value = mAux2
                                 If mIdDetallePedido > 0 Then .Fields("IdDetallePedido").Value = mIdDetallePedido
                                 If mIdDetalleRecepcion > 0 Then .Fields("IdDetalleRecepcion").Value = mIdDetalleRecepcion
                              End With
                              .Modificado = True
                           End With
                        
                           fl = fl + 1
                        Loop
                        
                        With oCP
                           With .Registro
                              .Fields("NumeroReferencia").Value = mNumeroReferencia
   '                           If mConProblemas Then
                                 .Fields("Confirmado").Value = "NO"
   '                           Else
   '                              .Fields("Confirmado").Value = "SI"
   '                           End If
                              .Fields("TotalBruto").Value = mTotalBruto
                              .Fields("TotalIva1").Value = mTotalIva1
                              .Fields("TotalIva2").Value = 0
                              .Fields("TotalBonificacion").Value = 0
                              .Fields("TotalComprobante").Value = mTotalComprobante
                              .Fields("PorcentajeBonificacion").Value = 0
                              .Fields("TotalIVANoDiscriminado").Value = 0
                              .Fields("AjusteIVA").Value = mTotalAjusteIVA
                              If Len(mObservaciones) > 2 Then .Fields("Observaciones").Value = mObservaciones
                              If mIncrementarReferencia <> "SI" Then .Fields("AutoincrementarNumeroReferencia").Value = "NO"
                           End With
                           .Guardar
                        End With
                        Set oCP = Nothing
                     
   '                     If BuscarClaveINI("IncrementarReferenciaEnImportacionDeComprobantes") = "SI" Then
   '                        Set oPar = oAp.Parametros.Item(1)
   '                        oPar.Registro.Fields("ProximoComprobanteProveedorReferencia").Value = mNumeroReferencia + 1
   ''                        oPar.Registro.Fields("ProximaOrdenPago").Value = mNumeroOP + 1
   '                        oPar.Guardar
   '                        Set oPar = Nothing
   '                     End If
                        
                        mNumeroReferencia = mNumeroReferencia + 1
                     Else
                        fl = fl + 1
                     End If
                     oRsAux1.Close
                  Else
                     mError = mError & vbCrLf & "Fila " & fl & "  - Fecha es anterior al ultimo cierre contable : " & mComprobante
                     fl = fl + 1
                  End If
               Else
                  Exit Do
               End If
FinLoop:
            Loop
         
'            'REGISTRAR OP CONTRA COMPROBANTES DE FONDO FIJO
'            Set oPar = oAp.Parametros.Item(1)
'            mNumeroOP = oPar.Registro.Fields("ProximaOrdenPago").Value
'
'            Set oOP = oAp.OrdenesPago.Item(-1)
'            With oOP
'               With .Registro
'                  .Fields("NumeroOrdenPago").Value = mNumeroOP
'                  .Fields("FechaOrdenPago").Value = mFechaRecepcion
'                  .Fields("IdProveedor").Value = Null
'                  .Fields("IdCuenta").Value = mIdCuentaFF
'                  .Fields("IdMoneda").Value = mIdMonedaPesos
'                  .Fields("CotizacionMoneda").Value = 1
'                  .Fields("CotizacionDolar").Value = mvarCotizacionDolar
'                  .Fields("IdObraOrigen").Value = mIdObra
'                  .Fields("Tipo").Value = "FF"
'                  .Fields("Dolarizada").Value = "NO"
'                  .Fields("Exterior").Value = "NO"
'                  .Fields("AsientoManual").Value = "NO"
'                  .Fields("IdUsuarioIngreso").Value = glbIdUsuario
'                  .Fields("FechaIngreso").Value = Now
'                  .Fields("Observaciones").Value = mObservaciones
'                  .Fields("BaseGanancias").Value = Null
'                  .Fields("RetencionIVA").Value = Null
'                  .Fields("RetencionGanancias").Value = Null
'                  .Fields("RetencionIBrutos").Value = Null
'                  .Fields("RetencionSUSS").Value = Null
'               End With
'            End With
'
'            mValores = 0
'            Set oRsAux1 = oAp.ComprobantesProveedores.TraerFiltrado("_PorIdOrdenPago", -9)
'            With oRsAux1
'               If .RecordCount > 0 Then
'                  Do While Not .EOF
'                     mValores = mValores + .Fields("TotalComprobante").Value
'                     .MoveNext
'                  Loop
'               End If
'            End With
'
'            'VALORES
'            With oOP.DetOrdenesPagoValores.Item(-1)
'               With .Registro
'                  .Fields("IdTipoValor").Value = 33
'                  .Fields("Importe").Value = mValores
'                  .Fields("IdCaja").Value = mIdCuentaFF
'               End With
'               .Modificado = True
'            End With
'
'            With oOP
'               With .Registro
'                  .Fields("Confirmado").Value = "NO"
'                  .Fields("Valores").Value = mValores
'                  .Fields("Acreedores").Value = 0
'               End With
'               .Guardar
'               mIdOrdenPago = .Registro.Fields(0).Value
'            End With
'            Set oOP = Nothing
'
'            With oPar.Registro
'               .Fields("ProximaOrdenPago").Value = mNumeroOP + 1
'            End With
'            oPar.Guardar
'            Set oPar = Nothing
'
'            With oRsAux1
'               If .RecordCount > 0 Then
'                  Do While Not .EOF
'                     Set oCP = oAp.ComprobantesProveedores.Item(.Fields(0).Value)
'                     oCP.Registro.Fields("IdOrdenPago").Value = mIdOrdenPago
'                     oCP.Guardar
'                     .MoveNext
'                  Loop
'               End If
'               .Close
'            End With
'            Set oRsAux1 = Nothing
         
         End With
         .Close False
      End With
      .Quit
   End With
   
   If Len(mError) > 0 Then
      MsgBox "Los siguientes comprobantes no se importaron porque" & vbCrLf & mError, vbExclamation
   End If

Salida:

   Unload oF
   Set oF = Nothing

   Set oRsAux1 = Nothing
   Set oRsAux2 = Nothing
   Set oAp = Nothing
   Set oEx = Nothing
   Set oCP = Nothing
   Set oOP = Nothing

   Exit Sub

Mal:

   MsgBox "Se ha producido un error al registrar los datos" & vbCrLf & Err.Number & " -> " & Err.Description, vbCritical
   Resume Salida

End Sub

Public Sub ImportacionComprobantesFondoFijo1()

   Dim oAp As ComPronto.Aplicacion
   Dim oCP As ComPronto.ComprobanteProveedor
   Dim oPr As ComPronto.Proveedor
   Dim oPar As ComPronto.Parametro
   Dim oOP As ComPronto.OrdenPago
   Dim oRsAux1 As ADOR.Recordset
   Dim oRsAux2 As ADOR.Recordset
   Dim oF As Form
   Dim oEx As Excel.Application
   Dim mOk As Boolean, mConProblemas As Boolean
   Dim mArchivo As String, mComprobante As String, mCuit As String, mLetra As String
   Dim mBienesOServicios As String, mObservaciones As String, mRazonSocial As String
   Dim mIncrementarReferencia As String, mCondicionCompra As String, mCodProv As String
   Dim mNumeroCAI As String, mFecha1 As String, mError As String, mCodObra As String
   Dim mInformacionAuxiliar As String, mCuitDefault As String
   Dim mFechaFactura As Date, mFechaVencimientoCAI As Date, mFechaRecepcion As Date
   Dim mIdMonedaPesos As Integer, mIdTipoComprobanteFacturaCompra As Integer
   Dim mIdUnidadPorUnidad As Integer, fl As Integer, mContador As Integer
   Dim mIdCuentaIvaCompras1 As Integer, mIdCuentaGasto As Integer, i As Integer
   Dim mvarProvincia As Integer, mIdTipoComprobante As Integer, mIdCuentaFF As Integer
   Dim mIdUO As Integer, mIdCodigoIva As Integer
   Dim mIdProveedor As Long, mNumeroComprobante1 As Long, mNumeroComprobante2 As Long
   Dim mCodigoCuenta As Long, mNumeroReferencia As Long, mCodigoCuentaFF As Long
   Dim mNumeroOP As Long, mIdOrdenPago As Long, mAux1 As Long, mAux2 As Long
   Dim mNumeroRendicion As Long, mIdCuenta As Long, mIdCuenta1 As Long, mIdObra As Long
   Dim mCodigoCuenta1 As Long
   Dim mvarCotizacionDolar As Single, mPorcentajeIVA As Single
   Dim mTotalItem As Double, mIva1 As Double, mGravado As Double, mNoGravado As Double
   Dim mTotalBruto As Double, mTotalIva1 As Double, mTotalComprobante As Double
   Dim mIdCuentaIvaCompras(10) As Long
   Dim mIVAComprasPorcentaje(10) As Single

   On Error GoTo Mal

   Set oF = New frmPathPresto
   With oF
      .Id = 14
      .Show vbModal
      mOk = .Ok
      If mOk Then
         mArchivo = .FileBrowser1(0).Text
         mFechaRecepcion = .DTFields(0).Value
         mNumeroReferencia = Val(.Text1.Text)
      End If
   End With
   Unload oF
   Set oF = Nothing

   If Not mOk Then Exit Sub

   Set oAp = Aplicacion

   mIncrementarReferencia = BuscarClaveINI("IncrementarReferenciaEnImportacionDeComprobantes")
   mCondicionCompra = BuscarClaveINI("Condicion de compra default para fondos fijos")
   mFecha1 = BuscarClaveINI("Fecha recepcion igual fecha comprobante en fondo fijo")
   mCuitDefault = BuscarClaveINI("Cuit por defecto en la importacion de fondos fijos")
   
   Set oRsAux1 = oAp.Parametros.TraerFiltrado("_PorId", 1)
   mIdMonedaPesos = oRsAux1.Fields("IdMoneda").Value
   mIdTipoComprobanteFacturaCompra = oRsAux1.Fields("IdTipoComprobanteFacturaCompra").Value
   mIdUnidadPorUnidad = IIf(IsNull(oRsAux1.Fields("IdUnidadPorUnidad").Value), 0, oRsAux1.Fields("IdUnidadPorUnidad").Value)
   gblFechaUltimoCierre = IIf(IsNull(oRsAux1.Fields("FechaUltimoCierre").Value), DateSerial(1980, 1, 1), oRsAux1.Fields("FechaUltimoCierre").Value)
   For i = 1 To 10
      If Not IsNull(oRsAux1.Fields("IdCuentaIvaCompras" & i).Value) Then
         mIdCuentaIvaCompras(i) = oRsAux1.Fields("IdCuentaIvaCompras" & i).Value
         mIVAComprasPorcentaje(i) = oRsAux1.Fields("IVAComprasPorcentaje" & i).Value
      Else
         mIdCuentaIvaCompras(i) = 0
         mIVAComprasPorcentaje(i) = 0
      End If
   Next
   oRsAux1.Close
   
   mIdUO = 0
   Set oRsAux1 = oAp.Obras.TraerFiltrado("_PorId", mIdObra)
   If oRsAux1.RecordCount > 0 Then
      mIdUO = IIf(IsNull(oRsAux1.Fields("IdUnidadOperativa").Value), 0, oRsAux1.Fields("IdUnidadOperativa").Value)
   End If
   oRsAux1.Close
   
   Set oF = New frmAviso
   With oF
      .Label1 = "Iniciando EXCEL ..."
      .Show
      .Refresh
      DoEvents
   End With

   oF.Label1 = oF.Label1 & vbCrLf & "Procesando fondo fijo ..."
   oF.Label2 = ""
   oF.Label3 = ""
   DoEvents

   fl = 11
   mContador = 0
   mNumeroRendicion = 0
   mTotalBruto = 0
   mTotalIva1 = 0
   mTotalComprobante = 0
   
   Set oEx = CreateObject("Excel.Application")
   With oEx
      .Visible = True
      .WindowState = xlMinimized
      Me.Refresh
      
      With .Workbooks.Open(mArchivo)
         '.Sheets("FF").Select
         With .ActiveSheet
            mFechaFactura = CDate(.Cells(2, 13))
            mObservaciones = .Cells(6, 12)
            mCodProv = .Cells(4, 10)
            mCodObra = .Cells(4, 14)
            mNumeroComprobante2 = CLng(Year(mFechaFactura) & Format(Month(mFechaFactura), "00") & Format(Day(mFechaFactura), "00"))
            
            mIdProveedor = 0
            Set oRsAux1 = oAp.Proveedores.TraerFiltrado("_PorCodigoEmpresa", mCodProv)
            If oRsAux1.RecordCount > 0 Then
               mIdProveedor = IIf(IsNull(oRsAux1.Fields("IdProveedor").Value), 0, oRsAux1.Fields("IdProveedor").Value)
               mIdCodigoIva = IIf(IsNull(oRsAux1.Fields("IdCodigoIva").Value), 0, oRsAux1.Fields("IdCodigoIva").Value)
            End If
            oRsAux1.Close
            If mIdProveedor = 0 Then
               MsgBox "Proveedor inexistente (Codigo " & mCodProv & ")", vbExclamation
               GoTo Salida
            End If
            
            mIdObra = 0
            mIdCuentaFF = 0
            Set oRsAux1 = oAp.Obras.TraerFiltrado("_PorNumero", mCodObra)
            If oRsAux1.RecordCount > 0 Then
               mIdObra = IIf(IsNull(oRsAux1.Fields("IdObra").Value), 0, oRsAux1.Fields("IdObra").Value)
               mIdCuentaFF = IIf(IsNull(oRsAux1.Fields("IdCuentaContableFF").Value), 0, oRsAux1.Fields("IdCuentaContableFF").Value)
            End If
            oRsAux1.Close
            If mIdObra = 0 Then
               MsgBox "Obra inexistente (Codigo " & mCodObra & ")", vbExclamation
               GoTo Salida
            End If
            If mIdCuentaFF = 0 Then
               MsgBox "Cuenta de fondo fijo obra " & mCodObra & ", inexistente", vbExclamation
               GoTo Salida
            End If
            
            If mFechaFactura <= gblFechaUltimoCierre Then
               MsgBox "La fecha del fondo fijo es anterior a la fecha de cierre contable", vbExclamation
               GoTo Salida
            End If
            
            Set oCP = oAp.ComprobantesProveedores.Item(-1)
            With oCP
               With .Registro
                  .Fields("NumeroReferencia").Value = mNumeroReferencia
                  .Fields("Confirmado").Value = "NO"
                  .Fields("IdTipoComprobante").Value = mIdTipoComprobanteFacturaCompra
                  .Fields("IdObra").Value = mIdObra
                  .Fields("FechaComprobante").Value = mFechaFactura
                  .Fields("FechaRecepcion").Value = mFechaFactura
                  .Fields("FechaVencimiento").Value = mFechaFactura
                  .Fields("FechaAsignacionPresupuesto").Value = mFechaFactura
                  .Fields("IdMoneda").Value = mIdMonedaPesos
                  .Fields("CotizacionMoneda").Value = 1
                  .Fields("CotizacionDolar").Value = mvarCotizacionDolar
                  .Fields("IdProveedorEventual").Value = mIdProveedor
                  .Fields("IdProveedor").Value = Null
                  .Fields("IdCuenta").Value = mIdCuentaFF
                  .Fields("IdOrdenPago").Value = Null
                  .Fields("Letra").Value = "A"
                  .Fields("NumeroComprobante1").Value = 1
                  .Fields("NumeroComprobante2").Value = mNumeroComprobante2
                  .Fields("NumeroRendicionFF").Value = mNumeroComprobante2
                  .Fields("IdIBCondicion").Value = Null
                  .Fields("IdTipoRetencionGanancia").Value = Null
                  .Fields("BienesOServicios").Value = Null
                  .Fields("NumeroCAI").Value = mNumeroComprobante2
                  .Fields("FechaVencimientoCAI").Value = mFechaFactura
                  .Fields("DestinoPago").Value = "O"
                  If mIdCodigoIva <> 0 Then .Fields("IdCodigoIva").Value = mIdCodigoIva
                  .Fields("CircuitoFirmasCompleto").Value = "SI"
               End With
            End With
            
            Do While True
               If Len(Trim(.Cells(fl, 2))) > 0 Then
                  mConProblemas = False
                  
                  mContador = mContador + 1
                  oF.Label2 = "Comprobante : " & .Cells(fl, 5)
                  oF.Label3 = "" & mContador
                  DoEvents
               
                  mCodigoCuenta = CLng(.Cells(fl, 13))
                  mTotalItem = Round(CDbl(.Cells(fl, 6)), 2)
                  mIva1 = Round(CDbl(.Cells(fl, 8)), 2)
                  mGravado = Round(CDbl(.Cells(fl, 9)), 2)
                  mNoGravado = Round(CDbl(.Cells(fl, 10)), 2)
                  
                  mTotalBruto = mTotalBruto + (mGravado + mNoGravado)
                  mTotalIva1 = mTotalIva1 + mIva1
                  mTotalComprobante = mTotalComprobante + mTotalItem
                  
                  If fl = 11 And mGravado <> 0 Then
                     mPorcentajeIVA = Round(mIva1 / mGravado * 100, 1)
                  Else
                     mPorcentajeIVA = Val(.Cells(fl, 7))
                  End If
                  
                  mIdCuentaIvaCompras1 = 0
                  If mPorcentajeIVA <> 0 Then
                     For i = 1 To 10
                        If mIVAComprasPorcentaje(i) = mPorcentajeIVA Then
                           mIdCuentaIvaCompras1 = mIdCuentaIvaCompras(i)
                           Exit For
                        End If
                     Next
                  End If
                  If mIva1 <> 0 And mIdCuentaIvaCompras1 = 0 Then
                     MsgBox "No se encontro la cuenta de iva para el porcentaje " & mPorcentajeIVA, vbExclamation
                     GoTo Salida
                  End If
                     
                  mIdCuenta = 0
                  mIdCuenta1 = 0
                  mIdCuentaGasto = 0
                  mCodigoCuenta1 = 0
                  Set oRsAux2 = oAp.Cuentas.TraerFiltrado("_PorCodigo", mCodigoCuenta)
                  If oRsAux2.RecordCount > 0 Then
                     mIdCuenta = oRsAux2.Fields(0).Value
                  End If
                  oRsAux2.Close
                  Set oRsAux2 = oAp.Cuentas.TraerFiltrado("_PorObraCuentaMadre", Array(mIdObra, mIdCuenta))
                  If oRsAux2.RecordCount > 0 Then
                     mIdCuenta1 = oRsAux2.Fields(0).Value
                     mIdCuentaGasto = IIf(IsNull(oRsAux2.Fields("IdCuentaGasto").Value), 0, oRsAux2.Fields("IdCuentaGasto").Value)
                     mCodigoCuenta1 = IIf(IsNull(oRsAux2.Fields("Codigo").Value), 0, oRsAux2.Fields("Codigo").Value)
                  End If
                  oRsAux2.Close
                  If mIdCuentaGasto = 0 And mIdCuenta1 = 0 Then
                     MsgBox "No se encontro la cuenta contable " & mCodigoCuenta, vbExclamation
                     GoTo Salida
                  End If
                  
                  If mGravado <> 0 Or mIva1 <> 0 Then
                     With oCP.DetComprobantesProveedores.Item(-1)
                        With .Registro
                           .Fields("IdObra").Value = mIdObra
                           .Fields("IdCuentaGasto").Value = mIdCuentaGasto
                           .Fields("IdCuenta").Value = mIdCuenta1
                           .Fields("CodigoCuenta").Value = mCodigoCuenta1
                           .Fields("Importe").Value = mGravado
                           If mIdCuentaIvaCompras1 <> 0 Then
                              .Fields("IdCuentaIvaCompras1").Value = mIdCuentaIvaCompras1
                              .Fields("IVAComprasPorcentaje1").Value = mPorcentajeIVA
                              .Fields("ImporteIVA1").Value = mIva1
                              .Fields("AplicarIVA1").Value = "SI"
                           Else
                              .Fields("IdCuentaIvaCompras1").Value = Null
                              .Fields("IVAComprasPorcentaje1").Value = 0
                              .Fields("ImporteIVA1").Value = 0
                              .Fields("AplicarIVA1").Value = "NO"
                           End If
                           .Fields("IdCuentaIvaCompras2").Value = Null
                           .Fields("IVAComprasPorcentaje2").Value = 0
                           .Fields("ImporteIVA2").Value = 0
                           .Fields("AplicarIVA2").Value = "NO"
                           .Fields("IdCuentaIvaCompras3").Value = Null
                           .Fields("IVAComprasPorcentaje3").Value = 0
                           .Fields("ImporteIVA3").Value = 0
                           .Fields("AplicarIVA3").Value = "NO"
                           .Fields("IdCuentaIvaCompras4").Value = Null
                           .Fields("IVAComprasPorcentaje4").Value = 0
                           .Fields("ImporteIVA4").Value = 0
                           .Fields("AplicarIVA4").Value = "NO"
                           .Fields("IdCuentaIvaCompras5").Value = Null
                           .Fields("IVAComprasPorcentaje5").Value = 0
                           .Fields("ImporteIVA5").Value = 0
                           .Fields("AplicarIVA5").Value = "NO"
                           .Fields("IdCuentaIvaCompras6").Value = Null
                           .Fields("IVAComprasPorcentaje6").Value = 0
                           .Fields("ImporteIVA6").Value = 0
                           .Fields("AplicarIVA6").Value = "NO"
                           .Fields("IdCuentaIvaCompras7").Value = Null
                           .Fields("IVAComprasPorcentaje7").Value = 0
                           .Fields("ImporteIVA7").Value = 0
                           .Fields("AplicarIVA7").Value = "NO"
                           .Fields("IdCuentaIvaCompras8").Value = Null
                           .Fields("IVAComprasPorcentaje8").Value = 0
                           .Fields("ImporteIVA8").Value = 0
                           .Fields("AplicarIVA8").Value = "NO"
                           .Fields("IdCuentaIvaCompras9").Value = Null
                           .Fields("IVAComprasPorcentaje9").Value = 0
                           .Fields("ImporteIVA9").Value = 0
                           .Fields("AplicarIVA9").Value = "NO"
                           .Fields("IdCuentaIvaCompras10").Value = Null
                           .Fields("IVAComprasPorcentaje10").Value = 0
                           .Fields("ImporteIVA10").Value = 0
                           .Fields("AplicarIVA10").Value = "NO"
                        End With
                        .Modificado = True
                     End With
                  End If
                  If mNoGravado <> 0 Then
                     With oCP.DetComprobantesProveedores.Item(-1)
                        With .Registro
                           .Fields("IdObra").Value = mIdObra
                           .Fields("IdCuentaGasto").Value = mIdCuentaGasto
                           .Fields("IdCuenta").Value = mIdCuenta1
                           .Fields("CodigoCuenta").Value = mCodigoCuenta1
                           .Fields("Importe").Value = mNoGravado
                           .Fields("IdCuentaIvaCompras1").Value = Null
                           .Fields("IVAComprasPorcentaje1").Value = 0
                           .Fields("ImporteIVA1").Value = 0
                           .Fields("AplicarIVA1").Value = "NO"
                           .Fields("IdCuentaIvaCompras2").Value = Null
                           .Fields("IVAComprasPorcentaje2").Value = 0
                           .Fields("ImporteIVA2").Value = 0
                           .Fields("AplicarIVA2").Value = "NO"
                           .Fields("IdCuentaIvaCompras3").Value = Null
                           .Fields("IVAComprasPorcentaje3").Value = 0
                           .Fields("ImporteIVA3").Value = 0
                           .Fields("AplicarIVA3").Value = "NO"
                           .Fields("IdCuentaIvaCompras4").Value = Null
                           .Fields("IVAComprasPorcentaje4").Value = 0
                           .Fields("ImporteIVA4").Value = 0
                           .Fields("AplicarIVA4").Value = "NO"
                           .Fields("IdCuentaIvaCompras5").Value = Null
                           .Fields("IVAComprasPorcentaje5").Value = 0
                           .Fields("ImporteIVA5").Value = 0
                           .Fields("AplicarIVA5").Value = "NO"
                           .Fields("IdCuentaIvaCompras6").Value = Null
                           .Fields("IVAComprasPorcentaje6").Value = 0
                           .Fields("ImporteIVA6").Value = 0
                           .Fields("AplicarIVA6").Value = "NO"
                           .Fields("IdCuentaIvaCompras7").Value = Null
                           .Fields("IVAComprasPorcentaje7").Value = 0
                           .Fields("ImporteIVA7").Value = 0
                           .Fields("AplicarIVA7").Value = "NO"
                           .Fields("IdCuentaIvaCompras8").Value = Null
                           .Fields("IVAComprasPorcentaje8").Value = 0
                           .Fields("ImporteIVA8").Value = 0
                           .Fields("AplicarIVA8").Value = "NO"
                           .Fields("IdCuentaIvaCompras9").Value = Null
                           .Fields("IVAComprasPorcentaje9").Value = 0
                           .Fields("ImporteIVA9").Value = 0
                           .Fields("AplicarIVA9").Value = "NO"
                           .Fields("IdCuentaIvaCompras10").Value = Null
                           .Fields("IVAComprasPorcentaje10").Value = 0
                           .Fields("ImporteIVA10").Value = 0
                           .Fields("AplicarIVA10").Value = "NO"
                        End With
                        .Modificado = True
                     End With
                  End If
                  fl = fl + 1
               Else
                  Exit Do
               End If
            Loop
            With oCP
               With .Registro
                  .Fields("TotalBruto").Value = mTotalBruto
                  .Fields("TotalIva1").Value = mTotalIva1
                  .Fields("TotalIva2").Value = 0
                  .Fields("TotalBonificacion").Value = 0
                  .Fields("TotalComprobante").Value = mTotalComprobante
                  .Fields("PorcentajeBonificacion").Value = 0
                  .Fields("TotalIVANoDiscriminado").Value = 0
                  .Fields("AjusteIVA").Value = 0
                  If Len(mObservaciones) > 2 Then .Fields("Observaciones").Value = mObservaciones
               End With
               .Guardar
            End With
            Set oCP = Nothing
         End With
         .Close False
      End With
      .Quit
   End With
   
Salida:

   Unload oF
   Set oF = Nothing

   Set oRsAux1 = Nothing
   Set oRsAux2 = Nothing
   Set oAp = Nothing
   Set oEx = Nothing
   Set oCP = Nothing
   Set oOP = Nothing

   Exit Sub

Mal:

   MsgBox "Se ha producido un error al registrar los datos" & vbCrLf & Err.Number & " -> " & Err.Description, vbCritical
   Resume Salida

End Sub

Public Sub ImportacionComprobantesFondoFijo2()

   Dim oAp As ComPronto.Aplicacion
   Dim oCP As ComPronto.ComprobanteProveedor
   Dim oPr As ComPronto.Proveedor
   Dim oPar As ComPronto.Parametro
   Dim oOP As ComPronto.OrdenPago
   Dim oRsAux1 As ADOR.Recordset
   Dim oRsAux2 As ADOR.Recordset
   Dim oF As Form
   Dim oEx As Excel.Application
   
   Dim mOk As Boolean, mConProblemas As Boolean
   Dim mArchivo As String, mComprobante As String, mCuit As String, mLetra As String, mBienesOServicios As String
   Dim mObservaciones As String, mRazonSocial As String, mIncrementarReferencia As String, mCondicionCompra As String
   Dim mCodProv As String, mNumeroCAI As String, mFecha1 As String, mError As String, mCodObra As String
   Dim mInformacionAuxiliar As String, mCuitDefault As String, mCodigoCuentaGasto As String, mTipo As String
   Dim mFechaFactura As Date, mFechaVencimientoCAI As Date, mFechaRecepcion As Date
   Dim mIdMonedaPesos As Integer, mIdTipoComprobanteFacturaCompra As Integer, mIdUnidadPorUnidad As Integer, fl As Integer
   Dim mContador As Integer, mIdCuentaIvaCompras1 As Integer, mIdCuentaGasto As Integer, i As Integer, mIdUO As Integer
   Dim mvarProvincia As Integer, mIdTipoComprobante As Integer, mIdCuentaFF As Integer, mIdCodigoIva As Integer
   Dim mvarIBCondicion As Integer, mvarIdIBCondicion As Integer, mvarIGCondicion As Integer, mvarIdTipoRetencionGanancia As Integer
   Dim mIdProveedor As Long, mNumeroComprobante1 As Long, mNumeroComprobante2 As Long, mCodigoCuenta As Long
   Dim mNumeroReferencia As Long, mCodigoCuentaFF As Long, mNumeroOP As Long, mIdOrdenPago As Long, mAux1 As Long, mAux2 As Long
   Dim mNumeroRendicion As Long, mIdCuenta As Long, mIdCuenta1 As Long, mIdObra As Long, mCodigoCuenta1 As Long
   Dim mvarCotizacionDolar As Single, mPorcentajeIVA As Single
   Dim mTotalItem As Double, mIva1 As Double, mGravado As Double, mNoGravado As Double, mTotalBruto As Double
   Dim mTotalIva1 As Double, mTotalComprobante As Double, mTotalPercepcion As Double, mTotalAjusteIVA As Double
   Dim mAjusteIVA As Double, mBruto As Double, mPercepcion As Double
   Dim mIdCuentaIvaCompras(10) As Long
   Dim mIVAComprasPorcentaje(10) As Single

   On Error GoTo Mal

   Set oF = New frmPathPresto
   With oF
      .Id = 14
      .Show vbModal
      mOk = .Ok
      If mOk Then
         mArchivo = .FileBrowser1(0).Text
         mFechaRecepcion = .DTFields(0).Value
         mNumeroReferencia = Val(.Text1.Text)
      End If
   End With
   Unload oF
   Set oF = Nothing

   If Not mOk Then Exit Sub

   Set oAp = Aplicacion

   mIncrementarReferencia = BuscarClaveINI("IncrementarReferenciaEnImportacionDeComprobantes")
   mCondicionCompra = BuscarClaveINI("Condicion de compra default para fondos fijos")
   mFecha1 = BuscarClaveINI("Fecha recepcion igual fecha comprobante en fondo fijo")
   mCuitDefault = BuscarClaveINI("Cuit por defecto en la importacion de fondos fijos")
   
   Set oRsAux1 = oAp.Parametros.TraerFiltrado("_PorId", 1)
   mIdMonedaPesos = oRsAux1.Fields("IdMoneda").Value
   mIdTipoComprobanteFacturaCompra = oRsAux1.Fields("IdTipoComprobanteFacturaCompra").Value
   mIdUnidadPorUnidad = IIf(IsNull(oRsAux1.Fields("IdUnidadPorUnidad").Value), 0, oRsAux1.Fields("IdUnidadPorUnidad").Value)
   gblFechaUltimoCierre = IIf(IsNull(oRsAux1.Fields("FechaUltimoCierre").Value), DateSerial(1980, 1, 1), oRsAux1.Fields("FechaUltimoCierre").Value)
   For i = 1 To 10
      If Not IsNull(oRsAux1.Fields("IdCuentaIvaCompras" & i).Value) Then
         mIdCuentaIvaCompras(i) = oRsAux1.Fields("IdCuentaIvaCompras" & i).Value
         mIVAComprasPorcentaje(i) = oRsAux1.Fields("IVAComprasPorcentaje" & i).Value
      Else
         mIdCuentaIvaCompras(i) = 0
         mIVAComprasPorcentaje(i) = 0
      End If
   Next
   oRsAux1.Close
   
   Set oF = New frmAviso
   With oF
      .Label1 = "Iniciando EXCEL ..."
      .Show
      .Refresh
      DoEvents
   End With

   oF.Label1 = oF.Label1 & vbCrLf & "Procesando fondo fijo ..."
   oF.Label2 = ""
   oF.Label3 = ""
   DoEvents

   fl = 7
   mContador = 0
   mNumeroRendicion = 0
   mIdCuentaFF = 0
   
   Set oEx = CreateObject("Excel.Application")
   With oEx
      .Visible = True
      .WindowState = xlMinimized
      Me.Refresh
      
      With .Workbooks.Open(mArchivo)
         .Sheets("FF").Select
         With .ActiveSheet
            Do While True
               If Len(Trim(.Cells(fl, 2))) > 0 Or Len(Trim(.Cells(fl, 3))) > 0 Or Len(Trim(.Cells(fl, 4))) > 0 Or _
                     Len(Trim(.Cells(fl, 5))) > 0 Or Len(Trim(.Cells(fl, 9))) > 0 Or Len(Trim(.Cells(fl, 10))) > 0 Then
                  mConProblemas = False
                  
                  If mNumeroRendicion = 0 And IsNumeric(.Cells(2, 16)) Then mNumeroRendicion = .Cells(2, 16)
                  mContador = mContador + 1
                  oF.Label2 = "Comprobante : " & .Cells(fl, 8)
                  oF.Label3 = "" & mContador
                  DoEvents
               
                  mTipo = .Cells(fl, 4)
                  If Len(.Cells(fl, 5)) > 0 Then
                     mIdTipoComprobante = .Cells(fl, 5)
                  Else
                     mIdTipoComprobante = mIdTipoComprobanteFacturaCompra
                  End If
                  mLetra = Trim(.Cells(fl, 6))
                  mNumeroComprobante1 = .Cells(fl, 7)
                  mNumeroComprobante2 = .Cells(fl, 8)
                  mRazonSocial = .Cells(fl, 9)
                  mCuit = .Cells(fl, 10)
                  mFechaFactura = CDate(.Cells(fl, 3))
                  mNumeroCAI = .Cells(fl, 18)
                  If IsDate(.Cells(fl, 19)) Then
                     mFechaVencimientoCAI = CDate(.Cells(fl, 19))
                  Else
                     mFechaVencimientoCAI = 0
                  End If
                  If mFecha1 = "SI" Then mFechaRecepcion = mFechaFactura
                  mCodObra = Trim(.Cells(fl, 2))
                  
                  If mIdCuentaFF = 0 Then
                     mCodigoCuentaFF = .Cells(2, 10)
                     Set oRsAux1 = oAp.Cuentas.TraerFiltrado("_PorCodigo", mCodigoCuentaFF)
                     If oRsAux1.RecordCount > 0 Then
                        mIdCuentaFF = oRsAux1.Fields(0).Value
                     Else
                        mError = mError & vbCrLf & mTipo & " " & mLetra & "-" & Format(mNumeroComprobante1, "0000") & _
                              "-" & Format(mNumeroComprobante2, "00000000") & ", cuenta de fondo fijo inexistente"
                        fl = fl + 1
                        GoTo FinLoop
                     End If
                     oRsAux1.Close
                  End If
                                    
                  mIdObra = 0
                  Set oRsAux1 = oAp.Obras.TraerFiltrado("_PorNumero", mCodObra)
                  If oRsAux1.RecordCount > 0 Then
                     mIdObra = oRsAux1.Fields("IdObra").Value
                  Else
                     mError = mError & vbCrLf & mTipo & " " & mLetra & "-" & Format(mNumeroComprobante1, "0000") & _
                              "-" & Format(mNumeroComprobante2, "00000000") & ", fila " & fl & "  - Obra " & mCodObra & " inexistente"
                     fl = fl + 1
                     GoTo FinLoop
                  End If
                  oRsAux1.Close
                  
                  If mFechaRecepcion > gblFechaUltimoCierre Then
                     If Len(mCuit) = 0 Then mCuit = mCuitDefault
                     If Len(mCuit) = 0 Then
                        mError = mError & vbCrLf & mTipo & " " & mLetra & "-" & Format(mNumeroComprobante1, "0000") & _
                              "-" & Format(mNumeroComprobante2, "00000000") & ", fila " & fl & "  - Cuit inexistente"
                        fl = fl + 1
                        GoTo FinLoop
                     Else
                        If Not VerificarCuit(mCuit) Then
                           mError = mError & vbCrLf & mTipo & " " & mLetra & "-" & Format(mNumeroComprobante1, "0000") & _
                              "-" & Format(mNumeroComprobante2, "00000000") & ", fila " & fl & "  - Cuit invalido : " & mCuit
                           fl = fl + 1
                           GoTo FinLoop
                        End If
                     End If
                     mIdProveedor = 0
                     Set oRsAux1 = oAp.Proveedores.TraerFiltrado("_PorCuit", mCuit)
                     If oRsAux1.RecordCount > 0 Then
                        mIdProveedor = oRsAux1.Fields(0).Value
                        mvarProvincia = IIf(IsNull(oRsAux1.Fields("IdProvincia").Value), 0, oRsAux1.Fields("IdProvincia").Value)
                        mvarIBCondicion = IIf(IsNull(oRsAux1.Fields("IBCondicion").Value), 0, oRsAux1.Fields("IBCondicion").Value)
                        mvarIdIBCondicion = IIf(IsNull(oRsAux1.Fields("IdIBCondicionPorDefecto").Value), 0, oRsAux1.Fields("IdIBCondicionPorDefecto").Value)
                        mvarIGCondicion = IIf(IsNull(oRsAux1.Fields("IGCondicion").Value), 0, oRsAux1.Fields("IGCondicion").Value)
                        mvarIdTipoRetencionGanancia = IIf(IsNull(oRsAux1.Fields("IdTipoRetencionGanancia").Value), 0, oRsAux1.Fields("IdTipoRetencionGanancia").Value)
                        mBienesOServicios = IIf(IsNull(oRsAux1.Fields("BienesOServicios").Value), "B", oRsAux1.Fields("BienesOServicios").Value)
                        mIdCodigoIva = IIf(IsNull(oRsAux1.Fields("IdCodigoIva").Value), 0, oRsAux1.Fields("IdCodigoIva").Value)
                     Else
                        If mLetra = "C" Then
                           mIdCodigoIva = 6
                        Else
                           mIdCodigoIva = 1
                        End If
                        Set oPr = oAp.Proveedores.Item(-1)
                        With oPr.Registro
                           .Fields("Confirmado").Value = "NO"
                           .Fields("RazonSocial").Value = mId(mRazonSocial, 1, 50)
                           .Fields("CUIT").Value = mCuit
                           .Fields("EnviarEmail").Value = 1
                           If mIdCodigoIva <> 0 Then .Fields("IdCodigoIva").Value = mIdCodigoIva
                           If IsNumeric(mCondicionCompra) Then .Fields("IdCondicionCompra").Value = CInt(mCondicionCompra)
                        End With
                        oPr.Guardar
                        mIdProveedor = oPr.Registro.Fields(0).Value
                        Set oPr = Nothing
                        mvarProvincia = 0
                        mvarIBCondicion = 0
                        mvarIdIBCondicion = 0
                        mvarIGCondicion = 0
                        mvarIdTipoRetencionGanancia = 0
                        mBienesOServicios = "B"
                     End If
                     oRsAux1.Close
                     
                     Set oRsAux1 = oAp.ComprobantesProveedores.TraerFiltrado("_PorNumeroComprobante", _
                                    Array(mIdProveedor, mLetra, mNumeroComprobante1, mNumeroComprobante2, -1, mIdTipoComprobante))
                     If oRsAux1.RecordCount = 0 Then
                        mvarCotizacionDolar = Cotizacion(mFechaFactura, glbIdMonedaDolar)
                        If mvarCotizacionDolar = 0 Then mConProblemas = True
                        Set oCP = oAp.ComprobantesProveedores.Item(-1)
                        With oCP
                           With .Registro
                              .Fields("IdTipoComprobante").Value = mIdTipoComprobante
                              .Fields("IdObra").Value = mIdObra
                              .Fields("FechaComprobante").Value = mFechaFactura
                              If mFechaFactura > mFechaRecepcion Then
                                 .Fields("FechaRecepcion").Value = mFechaFactura
                              Else
                                 .Fields("FechaRecepcion").Value = mFechaRecepcion
                              End If
                              .Fields("FechaVencimiento").Value = mFechaFactura
                              .Fields("FechaAsignacionPresupuesto").Value = mFechaFactura
                              .Fields("IdMoneda").Value = mIdMonedaPesos
                              .Fields("CotizacionMoneda").Value = 1
                              .Fields("CotizacionDolar").Value = mvarCotizacionDolar
                              .Fields("IdProveedorEventual").Value = mIdProveedor
                              .Fields("IdProveedor").Value = Null
                              .Fields("IdCuenta").Value = mIdCuentaFF
                              .Fields("IdOrdenPago").Value = Null
                              .Fields("Letra").Value = mLetra
                              .Fields("NumeroComprobante1").Value = mNumeroComprobante1
                              .Fields("NumeroComprobante2").Value = mNumeroComprobante2
                              .Fields("NumeroRendicionFF").Value = mNumeroRendicion
                              If (mvarIBCondicion = 2 Or mvarIBCondicion = 3) And mvarIdIBCondicion <> 0 Then
                                 .Fields("IdIBCondicion").Value = mvarIdIBCondicion
                              Else
                                 .Fields("IdIBCondicion").Value = Null
                              End If
                              If (mvarIGCondicion = 2 Or mvarIGCondicion = 3) And mvarIdTipoRetencionGanancia <> 0 Then
                                 .Fields("IdTipoRetencionGanancia").Value = mvarIdTipoRetencionGanancia
                              Else
                                 .Fields("IdTipoRetencionGanancia").Value = Null
                              End If
                              .Fields("IdProvinciaDestino").Value = mvarProvincia
                              .Fields("BienesOServicios").Value = Null
                              .Fields("NumeroCAI").Value = mNumeroCAI
                              If mFechaVencimientoCAI <> 0 Then
                                 .Fields("FechaVencimientoCAI").Value = mFechaVencimientoCAI
                              Else
                                 .Fields("FechaVencimientoCAI").Value = Null
                              End If
                              .Fields("DestinoPago").Value = "O"
                              .Fields("InformacionAuxiliar").Value = mInformacionAuxiliar
                              If mIdCodigoIva <> 0 Then .Fields("IdCodigoIva").Value = mIdCodigoIva
                              .Fields("CircuitoFirmasCompleto").Value = "SI"
                           End With
                        End With
                        
                        mTotalBruto = 0
                        mTotalIva1 = 0
                        mTotalPercepcion = 0
                        mTotalComprobante = 0
                        mTotalAjusteIVA = 0
                        mAjusteIVA = 0
                        
                        Do While Len(Trim(.Cells(fl, 2))) > 0 And mLetra = Trim(.Cells(fl, 6)) And _
                              mNumeroComprobante1 = .Cells(fl, 7) And mNumeroComprobante2 = .Cells(fl, 8) And _
                              (mCuit = .Cells(fl, 10) Or mCuit = mCuitDefault)
                           mCodigoCuentaGasto = .Cells(fl, 22)
                           mIdCuentaGasto = 0
                           mIdCuenta = 0
                           mCodigoCuenta = 0
                           Set oRsAux1 = oAp.CuentasGastos.TraerFiltrado("_PorCodigo2", mCodigoCuentaGasto)
                           If oRsAux1.RecordCount > 0 Then
                              mIdCuentaGasto = oRsAux1.Fields("IdCuentaGasto").Value
                              oRsAux1.Close
                              Set oRsAux1 = oAp.Cuentas.TraerFiltrado("_PorObraCuentaGasto", Array(mIdObra, mIdCuentaGasto))
                              If oRsAux1.RecordCount > 0 Then
                                 mIdCuenta = oRsAux1.Fields("IdCuenta").Value
                                 mCodigoCuenta = oRsAux1.Fields("Codigo").Value
                              Else
                                 mError = mError & vbCrLf & mTipo & " " & mLetra & "-" & Format(mNumeroComprobante1, "0000") & _
                                    "-" & Format(mNumeroComprobante2, "00000000") & ", fila " & fl & "  - Cuenta de gasto codigo :" & mCodigoCuentaGasto & " inexistente"
                                 fl = fl + 1
                                 GoTo FinLoop
                              End If
                           Else
                              oRsAux1.Close
                              Set oRsAux1 = oAp.Cuentas.TraerFiltrado("_PorCodigo", mCodigoCuentaGasto)
                              If oRsAux1.RecordCount > 0 Then
                                 mIdCuenta = oRsAux1.Fields("IdCuenta").Value
                                 mCodigoCuenta = oRsAux1.Fields("Codigo").Value
                              Else
                                 mError = mError & vbCrLf & mTipo & " " & mLetra & "-" & Format(mNumeroComprobante1, "0000") & _
                                    "-" & Format(mNumeroComprobante2, "00000000") & ", fila " & fl & "  - Cuenta contable inexistente"
                                 fl = fl + 1
                                 GoTo FinLoop
                              End If
                           End If
                           oRsAux1.Close
                           
                           mBruto = Abs(CDbl(.Cells(fl, 13)))
                           mIva1 = Round(Abs(CDbl(.Cells(fl, 14))), 4)
                           mPercepcion = Abs(CDbl(.Cells(fl, 15)))
                           mTotalItem = Round(Abs(CDbl(.Cells(fl, 16))), 2)
                           mObservaciones = "Rendicion : " & mNumeroRendicion & vbCrLf & .Cells(fl, 20) & vbCrLf
                           
                           mTotalBruto = mTotalBruto + mBruto
                           mTotalIva1 = mTotalIva1 + mIva1
                           mTotalPercepcion = mTotalPercepcion + mPercepcion
                           mTotalComprobante = mTotalComprobante + mTotalItem
                           mTotalAjusteIVA = mTotalAjusteIVA + mAjusteIVA
                           mPorcentajeIVA = 0
                           If mIva1 <> 0 And mBruto <> 0 Then mPorcentajeIVA = .Cells(fl, 11)
                           
                           mIdCuentaIvaCompras1 = 0
                           If mPorcentajeIVA <> 0 Then
                              For i = 1 To 10
                                 If mIVAComprasPorcentaje(i) = mPorcentajeIVA Then
                                    mIdCuentaIvaCompras1 = mIdCuentaIvaCompras(i)
                                    Exit For
                                 End If
                              Next
                           End If
                           If mIva1 <> 0 And mIdCuentaIvaCompras1 = 0 Then
                              mError = mError & vbCrLf & mTipo & " " & mLetra & "-" & Format(mNumeroComprobante1, "0000") & _
                              "-" & Format(mNumeroComprobante2, "00000000") & ", fila " & fl & "  - No se encontro el porcentaje de iva " & mPorcentajeIVA
                              fl = fl + 1
                              GoTo FinLoop
                           End If
                           
                           With oCP.DetComprobantesProveedores.Item(-1)
                              With .Registro
                                 .Fields("IdObra").Value = mIdObra
                                 .Fields("IdCuentaGasto").Value = mIdCuentaGasto
                                 .Fields("IdCuenta").Value = mIdCuenta
                                 .Fields("CodigoCuenta").Value = mCodigoCuenta
                                 .Fields("Importe").Value = mBruto
                                 If mIdCuentaIvaCompras1 <> 0 Then
                                    .Fields("IdCuentaIvaCompras1").Value = mIdCuentaIvaCompras1
                                    .Fields("IVAComprasPorcentaje1").Value = mPorcentajeIVA
                                    .Fields("ImporteIVA1").Value = Round(mIva1, 2)
                                    .Fields("AplicarIVA1").Value = "SI"
                                 Else
                                    .Fields("IdCuentaIvaCompras1").Value = Null
                                    .Fields("IVAComprasPorcentaje1").Value = 0
                                    .Fields("ImporteIVA1").Value = 0
                                    .Fields("AplicarIVA1").Value = "NO"
                                 End If
                                 .Fields("IdCuentaIvaCompras2").Value = Null
                                 .Fields("IVAComprasPorcentaje2").Value = 0
                                 .Fields("ImporteIVA2").Value = 0
                                 .Fields("AplicarIVA2").Value = "NO"
                                 .Fields("IdCuentaIvaCompras3").Value = Null
                                 .Fields("IVAComprasPorcentaje3").Value = 0
                                 .Fields("ImporteIVA3").Value = 0
                                 .Fields("AplicarIVA3").Value = "NO"
                                 .Fields("IdCuentaIvaCompras4").Value = Null
                                 .Fields("IVAComprasPorcentaje4").Value = 0
                                 .Fields("ImporteIVA4").Value = 0
                                 .Fields("AplicarIVA4").Value = "NO"
                                 .Fields("IdCuentaIvaCompras5").Value = Null
                                 .Fields("IVAComprasPorcentaje5").Value = 0
                                 .Fields("ImporteIVA5").Value = 0
                                 .Fields("AplicarIVA5").Value = "NO"
                                 .Fields("IdCuentaIvaCompras6").Value = Null
                                 .Fields("IVAComprasPorcentaje6").Value = 0
                                 .Fields("ImporteIVA6").Value = 0
                                 .Fields("AplicarIVA6").Value = "NO"
                                 .Fields("IdCuentaIvaCompras7").Value = Null
                                 .Fields("IVAComprasPorcentaje7").Value = 0
                                 .Fields("ImporteIVA7").Value = 0
                                 .Fields("AplicarIVA7").Value = "NO"
                                 .Fields("IdCuentaIvaCompras8").Value = Null
                                 .Fields("IVAComprasPorcentaje8").Value = 0
                                 .Fields("ImporteIVA8").Value = 0
                                 .Fields("AplicarIVA8").Value = "NO"
                                 .Fields("IdCuentaIvaCompras9").Value = Null
                                 .Fields("IVAComprasPorcentaje9").Value = 0
                                 .Fields("ImporteIVA9").Value = 0
                                 .Fields("AplicarIVA9").Value = "NO"
                                 .Fields("IdCuentaIvaCompras10").Value = Null
                                 .Fields("IVAComprasPorcentaje10").Value = 0
                                 .Fields("ImporteIVA10").Value = 0
                                 .Fields("AplicarIVA10").Value = "NO"
                                 'If mAux2 <> 0 Then .Fields("IdRubroContable").Value = mAux2
                              End With
                              .Modificado = True
                           End With
                        
                           fl = fl + 1
                        Loop
                        
                        With oCP
                           With .Registro
                              .Fields("NumeroReferencia").Value = mNumeroReferencia
                              .Fields("Confirmado").Value = "NO"
                              .Fields("TotalBruto").Value = mTotalBruto
                              .Fields("TotalIva1").Value = mTotalIva1
                              .Fields("TotalIva2").Value = 0
                              .Fields("TotalBonificacion").Value = 0
                              .Fields("TotalComprobante").Value = mTotalComprobante
                              .Fields("PorcentajeBonificacion").Value = 0
                              .Fields("TotalIVANoDiscriminado").Value = 0
                              .Fields("AjusteIVA").Value = mTotalAjusteIVA
                              .Fields("Observaciones").Value = mObservaciones
                              If mIncrementarReferencia <> "SI" Then .Fields("AutoincrementarNumeroReferencia").Value = "NO"
                           End With
                           .Guardar
                        End With
                        Set oCP = Nothing
                     
                        mNumeroReferencia = mNumeroReferencia + 1
                     Else
                        fl = fl + 1
                     End If
                  Else
                     mError = mError & vbCrLf & mTipo & " " & mLetra & "-" & Format(mNumeroComprobante1, "0000") & _
                              "-" & Format(mNumeroComprobante2, "00000000") & ", fila " & fl & "  - Fecha es anterior al ultimo cierre contable : " & mComprobante
                     fl = fl + 1
                  End If
               Else
                  Exit Do
               End If
FinLoop:
            Loop
         End With
         .Close False
      End With
      .Quit
   End With
   
   If Len(mError) > 0 Then
      MsgBox "Los siguientes comprobantes no se importaron :" & vbCrLf & mError, vbExclamation
   End If

Salida:

   Unload oF
   Set oF = Nothing

   Set oRsAux1 = Nothing
   Set oRsAux2 = Nothing
   Set oAp = Nothing
   Set oEx = Nothing
   Set oCP = Nothing
   Set oOP = Nothing

   Exit Sub

Mal:

   MsgBox "Se ha producido un error al registrar los datos" & vbCrLf & Err.Number & " -> " & Err.Description, vbCritical
   Resume Salida

End Sub

Public Sub ImportacionComprobantesProveedores1()

   Dim oAp As ComPronto.Aplicacion
   Dim oCP As ComPronto.ComprobanteProveedor
   Dim oPr As ComPronto.Proveedor
   Dim oPar As ComPronto.Parametro
   Dim oOP As ComPronto.OrdenPago
   Dim oRsAux1 As ADOR.Recordset
   Dim oRsAux2 As ADOR.Recordset
   Dim oF As Form
   Dim oEx As Excel.Application
   Dim mOk As Boolean, mConProblemas As Boolean
   Dim mArchivo As String, mComprobante As String, mCuit As String, mLetra As String
   Dim mBienesOServicios As String, mObservaciones As String, mRazonSocial As String
   Dim mIncrementarReferencia As String, mError As String, mPrestoDestino As String
   Dim mNumeroCAI As String
   Dim mFechaFactura As Date, mFechaVencimientoCAI As Date, mFechaRecepcion As Date
   Dim mIdMonedaPesos As Integer, mIdTipoComprobanteFacturaCompra As Integer
   Dim mIdUnidadPorUnidad As Integer, fl As Integer, mContador As Integer
   Dim mIdCuentaIvaCompras1 As Integer, mIdCuenta As Long, mIdObra As Integer
   Dim mIdCuentaGasto As Integer, i As Integer, mvarProvincia As Integer
   Dim mvarIBCondicion As Integer, mvarIdIBCondicion As Integer
   Dim mvarIGCondicion As Integer, mvarIdTipoRetencionGanancia As Integer
   Dim mIdTipoComprobante As Integer, mIdCuentaFF As Integer, mIdMoneda As Integer
   Dim mIdProveedor As Long, mNumeroComprobante1 As Long, mNumeroComprobante2 As Long
   Dim mCodigoCuenta As Long, mNumeroReferencia As Long, mCodigoCuentaFF As Long
   Dim mNumeroOP As Long, mIdOrdenPago As Long
   Dim mvarCotizacionDolar As Single, mPorcentajeIVA As Single
   Dim mBruto As Double, mIva1 As Double, mTotalItem As Double, mPercepcion As Double
   Dim mTotalBruto As Double, mTotalIva1 As Double, mTotalComprobante As Double
   Dim mTotalPercepcion As Double, mValores As Double
   Dim mIdCuentaIvaCompras(10) As Long
   Dim mIVAComprasPorcentaje(10) As Single

   On Error GoTo Mal

   Set oF = New frmPathPresto
   With oF
      .Id = 10
      .Show vbModal
      mOk = .Ok
      If mOk Then
         mArchivo = .FileBrowser1(0).Text
         mNumeroReferencia = Val(.Text1.Text)
      End If
   End With
   Unload oF
   Set oF = Nothing

   If Not mOk Then Exit Sub

   Set oAp = Aplicacion

   mIncrementarReferencia = BuscarClaveINI("IncrementarReferenciaEnImportacionDeComprobantes")
   
   Set oRsAux1 = oAp.Parametros.TraerFiltrado("_PorId", 1)
   mIdMonedaPesos = oRsAux1.Fields("IdMoneda").Value
   mIdTipoComprobanteFacturaCompra = oRsAux1.Fields("IdTipoComprobanteFacturaCompra").Value
   mIdUnidadPorUnidad = oRsAux1.Fields("IdUnidadPorUnidad").Value
   For i = 1 To 10
      If Not IsNull(oRsAux1.Fields("IdCuentaIvaCompras" & i).Value) Then
         mIdCuentaIvaCompras(i) = oRsAux1.Fields("IdCuentaIvaCompras" & i).Value
         mIVAComprasPorcentaje(i) = oRsAux1.Fields("IVAComprasPorcentaje" & i).Value
      Else
         mIdCuentaIvaCompras(i) = 0
         mIVAComprasPorcentaje(i) = 0
      End If
   Next
   oRsAux1.Close
   
   Set oF = New frmAviso
   With oF
      .Label1 = "Iniciando EXCEL ..."
      .Show
      .Refresh
      DoEvents
   End With

   oF.Label1 = oF.Label1 & vbCrLf & "Procesando comprobantes ..."
   oF.Label2 = ""
   oF.Label3 = ""
   DoEvents

   fl = 7
   mContador = 0
   mError = ""
   
   Set oEx = CreateObject("Excel.Application")
   With oEx
      .Visible = True
      .WindowState = xlMinimized
      Me.Refresh
      With .Workbooks.Open(mArchivo)
         .Sheets("PROVEEDORES").Select
         With .ActiveSheet
            Do While True
               If Len(Trim(.Cells(fl, 2))) > 0 Then
                  mConProblemas = False
                  mContador = mContador + 1
                  oF.Label2 = "Comprobante : " & .Cells(fl, 5)
                  oF.Label3 = "" & mContador
                  DoEvents
               
                  mIdObra = 0
                  Set oRsAux1 = oAp.Obras.TraerFiltrado("_PorNumero", LTrim(.Cells(fl, 4)))
                  If oRsAux1.RecordCount > 0 Then
                     mIdObra = oRsAux1.Fields(0).Value
                  End If
                  oRsAux1.Close
                  
                  If Len(.Cells(fl, 5)) > 0 Then
                     mIdTipoComprobante = .Cells(fl, 5)
                  Else
                     mIdTipoComprobante = mIdTipoComprobanteFacturaCompra
                  End If
                  mLetra = .Cells(fl, 6)
                  mComprobante = .Cells(fl, 7)
                  mNumeroComprobante1 = 0
                  mNumeroComprobante2 = 0
                  If InStr(1, mComprobante, "-") <> 0 Then
                     mNumeroComprobante1 = CLng(mId(mComprobante, 1, InStr(1, mComprobante, "-") - 1))
                     If mNumeroComprobante1 > 9999 Then
                        MsgBox "El punto de venta no puede tener mas de 4 digitos. (Fila " & fl & ")", vbExclamation
                        GoTo Salida
                     End If
                     mNumeroComprobante2 = CLng(mId(mComprobante, InStr(1, mComprobante, "-") + 1, 100))
                     If mNumeroComprobante2 > 99999999 Then
                        MsgBox "El numero de comprobante no puede tener mas de 8 digitos. (Fila " & fl & ")", vbExclamation
                        GoTo Salida
                     End If
                  End If
                  mRazonSocial = .Cells(fl, 8)
                  mCuit = .Cells(fl, 9)
                  mFechaFactura = CDate(.Cells(fl, 2))
                  mNumeroCAI = .Cells(fl, 17)
                  If IsDate(.Cells(fl, 19)) Then
                     mFechaVencimientoCAI = CDate(.Cells(fl, 19))
                  Else
                     mFechaVencimientoCAI = 0
                  End If
                  If IsDate(.Cells(fl, 28)) Then
                     mFechaRecepcion = CDate(.Cells(fl, 28))
                  Else
                     mFechaRecepcion = 0
                  End If
                  If Len(.Cells(fl, 27)) = 0 Or Not IsNumeric(.Cells(fl, 27)) Then
                     mIdMoneda = mIdMonedaPesos
                  Else
                     mIdMoneda = CInt(.Cells(fl, 27))
                  End If
                  mPrestoDestino = .Cells(fl, 25)
                  
                  mIdProveedor = 0
                  Set oRsAux1 = oAp.Proveedores.TraerFiltrado("_PorCuit", mCuit)
                  If oRsAux1.RecordCount > 0 Then
                     mIdProveedor = oRsAux1.Fields(0).Value
                     mvarProvincia = IIf(IsNull(oRsAux1.Fields("IdProvincia").Value), 0, oRsAux1.Fields("IdProvincia").Value)
                     mvarIBCondicion = IIf(IsNull(oRsAux1.Fields("IBCondicion").Value), 0, oRsAux1.Fields("IBCondicion").Value)
                     mvarIdIBCondicion = IIf(IsNull(oRsAux1.Fields("IdIBCondicionPorDefecto").Value), 0, oRsAux1.Fields("IdIBCondicionPorDefecto").Value)
                     mvarIGCondicion = IIf(IsNull(oRsAux1.Fields("IGCondicion").Value), 0, oRsAux1.Fields("IGCondicion").Value)
                     mvarIdTipoRetencionGanancia = IIf(IsNull(oRsAux1.Fields("IdTipoRetencionGanancia").Value), 0, oRsAux1.Fields("IdTipoRetencionGanancia").Value)
                     mBienesOServicios = IIf(IsNull(oRsAux1.Fields("BienesOServicios").Value), "B", oRsAux1.Fields("BienesOServicios").Value)
                  Else
                     mError = mError & vbCrLf & "El proveedor con cuit " & mCuit & ", comprobante " & mComprobante & " no existe."
                     fl = fl + 1
                     GoTo Seguir
                  End If
                  oRsAux1.Close
                  
                  Set oRsAux1 = oAp.ComprobantesProveedores.TraerFiltrado("_PorNumeroComprobante", _
                                 Array(mIdProveedor, mLetra, mNumeroComprobante1, mNumeroComprobante2, -1, -1))
                  If oRsAux1.RecordCount = 0 Then
                     mvarCotizacionDolar = Cotizacion(mFechaFactura, glbIdMonedaDolar)
                     If mvarCotizacionDolar = 0 Then mConProblemas = True
                     Set oCP = oAp.ComprobantesProveedores.Item(-1)
                     With oCP
                        With .Registro
                           .Fields("IdTipoComprobante").Value = mIdTipoComprobante
                           .Fields("IdObra").Value = mIdObra
                           .Fields("FechaComprobante").Value = mFechaFactura
                           .Fields("FechaRecepcion").Value = mFechaRecepcion
                           .Fields("FechaVencimiento").Value = mFechaFactura
                           .Fields("IdMoneda").Value = mIdMoneda
                           .Fields("CotizacionMoneda").Value = 1
                           .Fields("CotizacionDolar").Value = mvarCotizacionDolar
                           .Fields("IdProveedorEventual").Value = Null
                           .Fields("IdProveedor").Value = mIdProveedor
                           .Fields("IdCuenta").Value = Null
                           .Fields("IdOrdenPago").Value = Null ' -9
                           .Fields("Letra").Value = mLetra
                           .Fields("NumeroComprobante1").Value = mNumeroComprobante1
                           .Fields("NumeroComprobante2").Value = mNumeroComprobante2
                           If (mvarIBCondicion = 2 Or mvarIBCondicion = 3) And _
                                 mvarIdIBCondicion <> 0 Then
                              .Fields("IdIBCondicion").Value = mvarIdIBCondicion
                           Else
                              .Fields("IdIBCondicion").Value = Null
                           End If
                           If (mvarIGCondicion = 2 Or mvarIGCondicion = 3) And _
                                 mvarIdTipoRetencionGanancia <> 0 Then
                              .Fields("IdTipoRetencionGanancia").Value = mvarIdTipoRetencionGanancia
                           Else
                              .Fields("IdTipoRetencionGanancia").Value = Null
                           End If
                           .Fields("IdProvinciaDestino").Value = mvarProvincia
                           .Fields("BienesOServicios").Value = Null
                           .Fields("NumeroCAI").Value = mNumeroCAI
                           If mFechaVencimientoCAI <> 0 Then
                              .Fields("FechaVencimientoCAI").Value = mFechaVencimientoCAI
                           Else
                              .Fields("FechaVencimientoCAI").Value = Null
                           End If
                           .Fields("PrestoDestino").Value = mPrestoDestino
                        End With
                     End With
                     
                     mTotalBruto = 0
                     mTotalIva1 = 0
                     mTotalPercepcion = 0
                     mTotalComprobante = 0
                     mObservaciones = ""
                     Do While Len(Trim(.Cells(fl, 2))) > 0 And mComprobante = .Cells(fl, 7) And mCuit = .Cells(fl, 9)
                        mCodigoCuenta = CLng(.Cells(fl, 11))
                        mBruto = Abs(CDbl(.Cells(fl, 12)))
                        mIva1 = Abs(CDbl(.Cells(fl, 13)))
                        mPercepcion = Abs(CDbl(.Cells(fl, 14)))
                        mTotalItem = Abs(CDbl(.Cells(fl, 15)))
                        mObservaciones = mObservaciones & .Cells(fl, 26) & vbCrLf
                        
                        mTotalBruto = mTotalBruto + mBruto
                        mTotalIva1 = mTotalIva1 + mIva1
                        mTotalPercepcion = mTotalPercepcion + mPercepcion
                        mTotalComprobante = mTotalComprobante + mTotalItem
                        
                        mPorcentajeIVA = 0
                        If mIva1 <> 0 And mBruto <> 0 Then
                           mPorcentajeIVA = Round(mIva1 / mBruto * 100, 1)
                        End If
                        
                        mIdCuentaIvaCompras1 = 0
                        If mPorcentajeIVA <> 0 Then
                           For i = 1 To 10
                              If mIVAComprasPorcentaje(i) = mPorcentajeIVA Then
                                 mIdCuentaIvaCompras1 = mIdCuentaIvaCompras(i)
                                 Exit For
                              End If
                           Next
                        End If
                        If mTotalIva1 <> 0 And mIdCuentaIvaCompras1 = 0 Then
                           mConProblemas = True
                        End If
                        
                        mIdCuenta = 0
                        mIdCuentaGasto = 0
                        If mCodigoCuenta > 1000 Then
                           Set oRsAux2 = oAp.Cuentas.TraerFiltrado("_PorCodigo", mCodigoCuenta)
                           If oRsAux2.RecordCount > 0 Then
                              mIdCuenta = oRsAux2.Fields(0).Value
                           End If
                        Else
                           Set oRsAux2 = oAp.CuentasGastos.TraerFiltrado("_PorId", mCodigoCuenta)
                           If oRsAux2.RecordCount > 0 Then
                              mIdCuentaGasto = oRsAux2.Fields(0).Value
                           End If
                        End If
                        oRsAux2.Close
                        If mIdCuentaGasto = 0 And mIdCuenta = 0 Then
                           mConProblemas = True
                        End If
                        If mIdCuenta = 0 Then
                           Set oRsAux2 = oAp.Cuentas.TraerFiltrado("_PorObraCuentaGasto", Array(mIdObra, mIdCuentaGasto))
                           If oRsAux2.RecordCount > 0 Then
                              mIdCuenta = oRsAux2.Fields(0).Value
                              mCodigoCuenta = oRsAux2.Fields("Codigo").Value
                           End If
                           oRsAux2.Close
                           If mIdCuentaGasto = 0 Then
                              mConProblemas = True
                           End If
                        End If
                        
                        With oCP.DetComprobantesProveedores.Item(-1)
                           With .Registro
                              .Fields("IdObra").Value = mIdObra
                              .Fields("IdCuentaGasto").Value = mIdCuentaGasto
                              .Fields("IdCuenta").Value = mIdCuenta
                              .Fields("CodigoCuenta").Value = mCodigoCuenta
                              .Fields("Importe").Value = mBruto
                              If mIdCuentaIvaCompras1 <> 0 Then
                                 .Fields("IdCuentaIvaCompras1").Value = mIdCuentaIvaCompras1
                                 .Fields("IVAComprasPorcentaje1").Value = mPorcentajeIVA
                                 .Fields("ImporteIVA1").Value = mIva1
                                 .Fields("AplicarIVA1").Value = "SI"
                              Else
                                 .Fields("IdCuentaIvaCompras1").Value = Null
                                 .Fields("IVAComprasPorcentaje1").Value = 0
                                 .Fields("ImporteIVA1").Value = 0
                                 .Fields("AplicarIVA1").Value = "NO"
                              End If
                              .Fields("IdCuentaIvaCompras2").Value = Null
                              .Fields("IVAComprasPorcentaje2").Value = 0
                              .Fields("ImporteIVA2").Value = 0
                              .Fields("AplicarIVA2").Value = "NO"
                              .Fields("IdCuentaIvaCompras3").Value = Null
                              .Fields("IVAComprasPorcentaje3").Value = 0
                              .Fields("ImporteIVA3").Value = 0
                              .Fields("AplicarIVA3").Value = "NO"
                              .Fields("IdCuentaIvaCompras4").Value = Null
                              .Fields("IVAComprasPorcentaje4").Value = 0
                              .Fields("ImporteIVA4").Value = 0
                              .Fields("AplicarIVA4").Value = "NO"
                              .Fields("IdCuentaIvaCompras5").Value = Null
                              .Fields("IVAComprasPorcentaje5").Value = 0
                              .Fields("ImporteIVA5").Value = 0
                              .Fields("AplicarIVA5").Value = "NO"
                              .Fields("IdCuentaIvaCompras6").Value = Null
                              .Fields("IVAComprasPorcentaje6").Value = 0
                              .Fields("ImporteIVA6").Value = 0
                              .Fields("AplicarIVA6").Value = "NO"
                              .Fields("IdCuentaIvaCompras7").Value = Null
                              .Fields("IVAComprasPorcentaje7").Value = 0
                              .Fields("ImporteIVA7").Value = 0
                              .Fields("AplicarIVA7").Value = "NO"
                              .Fields("IdCuentaIvaCompras8").Value = Null
                              .Fields("IVAComprasPorcentaje8").Value = 0
                              .Fields("ImporteIVA8").Value = 0
                              .Fields("AplicarIVA8").Value = "NO"
                              .Fields("IdCuentaIvaCompras9").Value = Null
                              .Fields("IVAComprasPorcentaje9").Value = 0
                              .Fields("ImporteIVA9").Value = 0
                              .Fields("AplicarIVA9").Value = "NO"
                              .Fields("IdCuentaIvaCompras10").Value = Null
                              .Fields("IVAComprasPorcentaje10").Value = 0
                              .Fields("ImporteIVA10").Value = 0
                              .Fields("AplicarIVA10").Value = "NO"
                           End With
                           .Modificado = True
                        End With
                     
                        fl = fl + 1
                     Loop
                     
                     With oCP
                        With .Registro
                           .Fields("NumeroReferencia").Value = mNumeroReferencia
                           .Fields("Confirmado").Value = "NO"
                           .Fields("TotalBruto").Value = mTotalBruto
                           .Fields("TotalIva1").Value = mTotalIva1
                           .Fields("TotalIva2").Value = 0
                           .Fields("TotalBonificacion").Value = 0
                           .Fields("TotalComprobante").Value = mTotalComprobante
                           .Fields("PorcentajeBonificacion").Value = 0
                           .Fields("TotalIVANoDiscriminado").Value = 0
                           .Fields("AjusteIVA").Value = 0
                           If Len(mObservaciones) > 2 Then .Fields("Observaciones").Value = mObservaciones
                           If mIncrementarReferencia <> "SI" Then
                              .Fields("AutoincrementarNumeroReferencia").Value = "NO"
                           End If
                        End With
                        .Guardar
                     End With
                     Set oCP = Nothing
                  
                     mNumeroReferencia = mNumeroReferencia + 1
                  Else
                     fl = fl + 1
                  End If
                  oRsAux1.Close
               Else
                  Exit Do
               End If
Seguir:
            Loop
         
         End With
         .Close False
      End With
      .Quit
   End With
   
Salida:

   Unload oF
   Set oF = Nothing

   If Len(mError) > 0 Then
      MsgBox "La importacion de comprobantes reporta los siguientes errores :" & mError, vbExclamation
   End If
   
   Set oRsAux1 = Nothing
   Set oRsAux2 = Nothing
   Set oAp = Nothing
   Set oEx = Nothing
   Set oCP = Nothing
   Set oOP = Nothing

   Exit Sub

Mal:

   MsgBox "Se ha producido un error al registrar los datos" & vbCrLf & Err.Number & " -> " & Err.Description, vbCritical
   Resume Salida

End Sub

Public Sub ImportacionComprobantesProveedores2()

   Dim oAp As ComPronto.Aplicacion
   Dim oCP As ComPronto.ComprobanteProveedor
   Dim oPr As ComPronto.Proveedor
   Dim oPar As ComPronto.Parametro
   Dim oOP As ComPronto.OrdenPago
   Dim oRsAux1 As ADOR.Recordset
   Dim oRsAux2 As ADOR.Recordset
   Dim oRsErrores As ADOR.Recordset
   Dim oF As Form
   Dim oEx As Excel.Application
   Dim mOk As Boolean, mConProblemas As Boolean
   Dim mArchivo As String, mComprobante As String, mCuit As String, mLetra As String, mBienesOServicios As String
   Dim mObservaciones As String, mRazonSocial As String, mIncrementarReferencia As String, mError As String, mPrestoDestino As String
   Dim mNumeroCAI As String, mTipoComprobante As String
   Dim mFechaFactura As Date, mFechaVencimientoCAI As Date, mFechaRecepcion As Date
   Dim mIdMonedaPesos As Integer, mIdTipoComprobanteFacturaCompra As Integer, mIdUnidadPorUnidad As Integer, fl As Integer
   Dim mContador As Integer, mIdCuentaIvaCompras1 As Integer, mIdCuenta As Long, mIdObra As Integer, i As Integer
   Dim mIdCuentaGasto As Integer, mvarProvincia As Integer, mvarIBCondicion As Integer, mvarIdIBCondicion As Integer
   Dim mvarIGCondicion As Integer, mvarIdTipoRetencionGanancia As Integer, mIdCuentaFF As Integer, mIdMoneda As Integer
   Dim mIdTipoComprobante As Integer
   Dim mIdProveedor As Long, mNumeroComprobante1 As Long, mNumeroComprobante2 As Long, mCodigoCuenta As Long, mNumeroReferencia As Long
   Dim mCodigoCuentaFF As Long, mNumeroOP As Long, mIdOrdenPago As Long
   Dim mvarCotizacionDolar As Single, mPorcentajeIVA As Single
   Dim mBruto As Double, mIva1 As Double, mTotalItem As Double, mPercepcion As Double, mTotalBruto As Double, mTotalIva1 As Double
   Dim mTotalComprobante As Double, mTotalPercepcion As Double, mValores As Double
   Dim mIdCuentaIvaCompras(10) As Long
   Dim mIVAComprasPorcentaje(10) As Single

   On Error GoTo Mal

   Set oF = New frmPathPresto
   With oF
      .Id = 10
      .Show vbModal
      mOk = .Ok
      If mOk Then
         mArchivo = .FileBrowser1(0).Text
         mNumeroReferencia = Val(.Text1.Text)
      End If
   End With
   Unload oF
   Set oF = Nothing

   If Not mOk Then Exit Sub

   Set oAp = Aplicacion

   Set oRsErrores = CreateObject("ADOR.Recordset")
   With oRsErrores
      .Fields.Append "Id", adInteger
      .Fields.Append "Detalle", adVarChar, 200
   End With
   oRsErrores.Open
   
   'mIncrementarReferencia = BuscarClaveINI("IncrementarReferenciaEnImportacionDeComprobantes")
   
   Set oRsAux1 = oAp.Parametros.TraerFiltrado("_PorId", 1)
   mIdMonedaPesos = oRsAux1.Fields("IdMoneda").Value
   mIdTipoComprobanteFacturaCompra = oRsAux1.Fields("IdTipoComprobanteFacturaCompra").Value
   mIdUnidadPorUnidad = oRsAux1.Fields("IdUnidadPorUnidad").Value
   For i = 1 To 10
      If Not IsNull(oRsAux1.Fields("IdCuentaIvaCompras" & i).Value) Then
         mIdCuentaIvaCompras(i) = oRsAux1.Fields("IdCuentaIvaCompras" & i).Value
         mIVAComprasPorcentaje(i) = oRsAux1.Fields("IVAComprasPorcentaje" & i).Value
      Else
         mIdCuentaIvaCompras(i) = 0
         mIVAComprasPorcentaje(i) = 0
      End If
   Next
   oRsAux1.Close
   
   Set oF = New frmAviso
   With oF
      .Label1 = "Iniciando EXCEL ..."
      .Show
      .Refresh
      DoEvents
   End With

   oF.Label1 = oF.Label1 & vbCrLf & "Procesando comprobantes ..."
   oF.Label2 = ""
   oF.Label3 = ""
   DoEvents

   fl = 2
   mContador = 0
   mError = ""
   
   Set oEx = CreateObject("Excel.Application")
   With oEx
      .Visible = True
      .WindowState = xlMinimized
      Me.Refresh
      With .Workbooks.Open(mArchivo)
         '.Sheets("PROVEEDORES").Select
         With .ActiveSheet
            Do While True
               If Len(Trim(.Cells(fl, 1))) > 0 Then
                  mConProblemas = False
                  mContador = mContador + 1
                  
                  mNumeroCAI = ""
                  mFechaVencimientoCAI = 0
                  mIdMoneda = mIdMonedaPesos
                  mIdObra = 0
                  
                  mLetra = .Cells(fl, 6)
                  mNumeroComprobante1 = Val(.Cells(fl, 7))
                  mNumeroComprobante2 = Val(.Cells(fl, 8))
                  If mNumeroComprobante1 > 9999 Then
                     AgregarMensajeProcesoPresto oRsErrores, "El punto de venta del comprobante no puede tener mas de 4 digitos. (Fila " & fl & ")"
                     mConProblemas = True
                  End If
                  If mNumeroComprobante2 > 99999999 Then
                     AgregarMensajeProcesoPresto oRsErrores, "El numero de comprobante no puede tener mas de 8 digitos. (Fila " & fl & ")"
                     mConProblemas = True
                  End If
                  mComprobante = mLetra & "-" & Format(mNumeroComprobante1, "0000") & "-" & Format(mNumeroComprobante2, "00000000")
                  
                  mTipoComprobante = LTrim(.Cells(fl, 5))
                  Set oRsAux1 = oAp.TiposComprobante.TraerFiltrado("_PorAbreviatura", mTipoComprobante)
                  If oRsAux1.RecordCount > 0 Then
                     mIdTipoComprobante = oRsAux1.Fields(0).Value
                  Else
                     AgregarMensajeProcesoPresto oRsErrores, "El tipo de comprobante no existe" & ", comprobante " & mComprobante & " no existe. (Fila " & fl & ")"
                     mConProblemas = True
                  End If
                  oRsAux1.Close
                  
                  oF.Label2 = "Comprobante : " & mComprobante
                  oF.Label3 = "" & mContador
                  DoEvents
               
                  mRazonSocial = .Cells(fl, 3)
                  mCuit = .Cells(fl, 4)
                  mFechaFactura = CDate(.Cells(fl, 2))
                  mFechaRecepcion = CDate(.Cells(fl, 1))
                  mIdProveedor = 0
                  Set oRsAux1 = oAp.Proveedores.TraerFiltrado("_PorCuit", mCuit)
                  If oRsAux1.RecordCount > 0 Then
                     mIdProveedor = oRsAux1.Fields(0).Value
                     mvarProvincia = IIf(IsNull(oRsAux1.Fields("IdProvincia").Value), 0, oRsAux1.Fields("IdProvincia").Value)
                     mvarIBCondicion = IIf(IsNull(oRsAux1.Fields("IBCondicion").Value), 0, oRsAux1.Fields("IBCondicion").Value)
                     mvarIdIBCondicion = IIf(IsNull(oRsAux1.Fields("IdIBCondicionPorDefecto").Value), 0, oRsAux1.Fields("IdIBCondicionPorDefecto").Value)
                     mvarIGCondicion = IIf(IsNull(oRsAux1.Fields("IGCondicion").Value), 0, oRsAux1.Fields("IGCondicion").Value)
                     mvarIdTipoRetencionGanancia = IIf(IsNull(oRsAux1.Fields("IdTipoRetencionGanancia").Value), 0, oRsAux1.Fields("IdTipoRetencionGanancia").Value)
                     mBienesOServicios = IIf(IsNull(oRsAux1.Fields("BienesOServicios").Value), "B", oRsAux1.Fields("BienesOServicios").Value)
                  Else
'                     AgregarMensajeProcesoPresto oRsErrores, "El proveedor con cuit " & mCuit & ", comprobante " & mComprobante & " no existe. (Fila " & fl & ")"
'                     mConProblemas = True
                     Set oPr = oAp.Proveedores.Item(-1)
                     With oPr.Registro
                        .Fields("Confirmado").Value = "NO"
                        .Fields("RazonSocial").Value = mId(mRazonSocial, 1, 50)
                        .Fields("CUIT").Value = mCuit
                        .Fields("EnviarEmail").Value = 1
                     End With
                     oPr.Guardar
                     mIdProveedor = oPr.Registro.Fields(0).Value
                     Set oPr = Nothing
                     mvarProvincia = 0
                     mvarIBCondicion = 0
                     mvarIdIBCondicion = 0
                     mvarIGCondicion = 0
                     mvarIdTipoRetencionGanancia = 0
                     mBienesOServicios = "B"
                  End If
                  oRsAux1.Close
                  
                  mObservaciones = "Cuenta contable : " & .Cells(fl, 28) & vbCrLf & _
                                    "Centro de costos : " & .Cells(fl, 29) & vbCrLf & _
                                    "Numero movimiento : " & .Cells(fl, 24) & vbCrLf & _
                                    "Comentarios : " & .Cells(fl, 30) & vbCrLf & _
                                    "Total gravado : " & .Cells(fl, 9) & vbCrLf & _
                                    "Total no gravado : " & .Cells(fl, 10) & vbCrLf & _
                                    "Total iva : " & .Cells(fl, 14) & vbCrLf & _
                                    "Total comprobante : " & .Cells(fl, 23)
                  
                  If mConProblemas Then
                     fl = fl + 1
                     GoTo Seguir
                  End If
                  
                  Set oRsAux1 = oAp.ComprobantesProveedores.TraerFiltrado("_PorNumeroComprobante", _
                                 Array(mIdProveedor, mLetra, mNumeroComprobante1, mNumeroComprobante2, -1, -1))
                  If oRsAux1.RecordCount = 0 Then
                     mvarCotizacionDolar = Cotizacion(mFechaFactura, glbIdMonedaDolar)
                     If mvarCotizacionDolar = 0 Then
                        AgregarMensajeProcesoPresto oRsErrores, "No existe cotizacion dolar el dia " & mFechaFactura & ", comprobante " & mComprobante & ". (Fila " & fl & ")"
                        mConProblemas = True
                     End If
                     Set oCP = oAp.ComprobantesProveedores.Item(-1)
                     With oCP
                        With .Registro
                           .Fields("IdTipoComprobante").Value = mIdTipoComprobante
                           .Fields("IdObra").Value = Null
                           .Fields("FechaComprobante").Value = mFechaFactura
                           .Fields("FechaRecepcion").Value = mFechaRecepcion
                           .Fields("FechaVencimiento").Value = mFechaFactura
                           .Fields("IdMoneda").Value = mIdMoneda
                           .Fields("CotizacionMoneda").Value = 1
                           .Fields("CotizacionDolar").Value = mvarCotizacionDolar
                           .Fields("IdProveedorEventual").Value = Null
                           .Fields("IdProveedor").Value = mIdProveedor
                           .Fields("IdCuenta").Value = Null
                           .Fields("IdOrdenPago").Value = Null
                           .Fields("Letra").Value = mLetra
                           .Fields("NumeroComprobante1").Value = mNumeroComprobante1
                           .Fields("NumeroComprobante2").Value = mNumeroComprobante2
                           If (mvarIBCondicion = 2 Or mvarIBCondicion = 3) And mvarIdIBCondicion <> 0 Then
                              .Fields("IdIBCondicion").Value = mvarIdIBCondicion
                           Else
                              .Fields("IdIBCondicion").Value = Null
                           End If
                           If (mvarIGCondicion = 2 Or mvarIGCondicion = 3) And mvarIdTipoRetencionGanancia <> 0 Then
                              .Fields("IdTipoRetencionGanancia").Value = mvarIdTipoRetencionGanancia
                           Else
                              .Fields("IdTipoRetencionGanancia").Value = Null
                           End If
                           .Fields("IdProvinciaDestino").Value = mvarProvincia
                           .Fields("BienesOServicios").Value = Null
                           .Fields("NumeroCAI").Value = mNumeroCAI
                           If mFechaVencimientoCAI <> 0 Then
                              .Fields("FechaVencimientoCAI").Value = mFechaVencimientoCAI
                           Else
                              .Fields("FechaVencimientoCAI").Value = Null
                           End If
                           .Fields("Observaciones").Value = mObservaciones
                        End With
                     End With
                     
                     mTotalBruto = 0
                     mTotalIva1 = 0
                     mTotalPercepcion = 0
                     mTotalComprobante = 0
                     mObservaciones = ""
                     Do While Len(Trim(.Cells(fl, 1))) > 0 And mCuit = .Cells(fl, 4) And mLetra = .Cells(fl, 6) And _
                              mNumeroComprobante1 = Val(.Cells(fl, 7)) And mNumeroComprobante2 = Val(.Cells(fl, 8))
                        mCodigoCuenta = CLng(.Cells(fl, 28))
                        mBruto = Abs(CDbl(.Cells(fl, 31)))
                        mIva1 = 0
                        mPercepcion = 0
                        mTotalItem = mBruto
                        mObservaciones = mObservaciones & .Cells(fl, 30) & vbCrLf
                        
                        mTotalBruto = mTotalBruto + mBruto
                        mTotalIva1 = mTotalIva1 + mIva1
                        mTotalPercepcion = mTotalPercepcion + mPercepcion
                        mTotalComprobante = mTotalComprobante + mTotalItem
                        
                        mPorcentajeIVA = 0
                        If mIva1 <> 0 And mBruto <> 0 Then mPorcentajeIVA = Round(mIva1 / mBruto * 100, 1)
                        
                        mIdCuentaIvaCompras1 = 0
                        If mPorcentajeIVA <> 0 Then
                           For i = 1 To 10
                              If mIVAComprasPorcentaje(i) = mPorcentajeIVA Then
                                 mIdCuentaIvaCompras1 = mIdCuentaIvaCompras(i)
                                 Exit For
                              End If
                           Next
                        End If
                        If mTotalIva1 <> 0 And mIdCuentaIvaCompras1 = 0 Then
                           AgregarMensajeProcesoPresto oRsErrores, "No esta parametrizado el porcentaje de iva, comprobante " & mComprobante & ". (Fila " & fl & ")"
                           mConProblemas = True
                        End If
                        
                        mIdCuentaGasto = 0
                        mIdCuenta = 0
                        Set oRsAux2 = oAp.Cuentas.TraerFiltrado("_PorCodigo", mCodigoCuenta)
                        If oRsAux2.RecordCount > 0 Then mIdCuenta = oRsAux2.Fields(0).Value
                        oRsAux2.Close
                        If mIdCuenta = 0 Then
                           AgregarMensajeProcesoPresto oRsErrores, "No existe la cuenta contable " & mCodigoCuenta & ", comprobante " & mComprobante & ". (Fila " & fl & ")"
                           mConProblemas = True
                        End If
                        
                        With oCP.DetComprobantesProveedores.Item(-1)
                           With .Registro
                              .Fields("IdObra").Value = mIdObra
                              .Fields("IdCuentaGasto").Value = mIdCuentaGasto
                              .Fields("IdCuenta").Value = mIdCuenta
                              .Fields("CodigoCuenta").Value = mCodigoCuenta
                              .Fields("Importe").Value = mBruto
                              If mIdCuentaIvaCompras1 <> 0 Then
                                 .Fields("IdCuentaIvaCompras1").Value = mIdCuentaIvaCompras1
                                 .Fields("IVAComprasPorcentaje1").Value = mPorcentajeIVA
                                 .Fields("ImporteIVA1").Value = mIva1
                                 .Fields("AplicarIVA1").Value = "SI"
                              Else
                                 .Fields("IdCuentaIvaCompras1").Value = Null
                                 .Fields("IVAComprasPorcentaje1").Value = 0
                                 .Fields("ImporteIVA1").Value = 0
                                 .Fields("AplicarIVA1").Value = "NO"
                              End If
                              .Fields("IdCuentaIvaCompras2").Value = Null
                              .Fields("IVAComprasPorcentaje2").Value = 0
                              .Fields("ImporteIVA2").Value = 0
                              .Fields("AplicarIVA2").Value = "NO"
                              .Fields("IdCuentaIvaCompras3").Value = Null
                              .Fields("IVAComprasPorcentaje3").Value = 0
                              .Fields("ImporteIVA3").Value = 0
                              .Fields("AplicarIVA3").Value = "NO"
                              .Fields("IdCuentaIvaCompras4").Value = Null
                              .Fields("IVAComprasPorcentaje4").Value = 0
                              .Fields("ImporteIVA4").Value = 0
                              .Fields("AplicarIVA4").Value = "NO"
                              .Fields("IdCuentaIvaCompras5").Value = Null
                              .Fields("IVAComprasPorcentaje5").Value = 0
                              .Fields("ImporteIVA5").Value = 0
                              .Fields("AplicarIVA5").Value = "NO"
                              .Fields("IdCuentaIvaCompras6").Value = Null
                              .Fields("IVAComprasPorcentaje6").Value = 0
                              .Fields("ImporteIVA6").Value = 0
                              .Fields("AplicarIVA6").Value = "NO"
                              .Fields("IdCuentaIvaCompras7").Value = Null
                              .Fields("IVAComprasPorcentaje7").Value = 0
                              .Fields("ImporteIVA7").Value = 0
                              .Fields("AplicarIVA7").Value = "NO"
                              .Fields("IdCuentaIvaCompras8").Value = Null
                              .Fields("IVAComprasPorcentaje8").Value = 0
                              .Fields("ImporteIVA8").Value = 0
                              .Fields("AplicarIVA8").Value = "NO"
                              .Fields("IdCuentaIvaCompras9").Value = Null
                              .Fields("IVAComprasPorcentaje9").Value = 0
                              .Fields("ImporteIVA9").Value = 0
                              .Fields("AplicarIVA9").Value = "NO"
                              .Fields("IdCuentaIvaCompras10").Value = Null
                              .Fields("IVAComprasPorcentaje10").Value = 0
                              .Fields("ImporteIVA10").Value = 0
                              .Fields("AplicarIVA10").Value = "NO"
                           End With
                           .Modificado = True
                        End With
                     
                        fl = fl + 1
                     Loop
                     
                     If Not mConProblemas Then
                        With oCP
                           With .Registro
                              .Fields("NumeroReferencia").Value = mNumeroReferencia
                              .Fields("TotalBruto").Value = mTotalBruto
                              .Fields("TotalIva1").Value = mTotalIva1
                              .Fields("TotalIva2").Value = 0
                              .Fields("TotalBonificacion").Value = 0
                              .Fields("TotalComprobante").Value = mTotalComprobante
                              .Fields("PorcentajeBonificacion").Value = 0
                              .Fields("TotalIVANoDiscriminado").Value = 0
                              .Fields("AjusteIVA").Value = 0
                              .Fields("AutoincrementarNumeroReferencia").Value = "SI"
                           End With
                           .Guardar
                        End With
                     End If
                     Set oCP = Nothing
                  
                     mNumeroReferencia = mNumeroReferencia + 1
                  Else
                     fl = fl + 1
                  End If
                  oRsAux1.Close
               Else
                  Exit Do
               End If
Seguir:
            Loop
         
         End With
         .Close False
      End With
      .Quit
   End With
   
   Unload oF
   Set oF = Nothing
   
   If Not oRsErrores Is Nothing Then
      If oRsErrores.RecordCount > 0 Then
         Set oF = New frmConsulta1
         With oF
            Set .RecordsetFuente = oRsErrores
            .Id = 13
            .Show vbModal, Me
         End With
      Else
         MsgBox "Proceso completo", vbInformation
      End If
      Set oRsErrores = Nothing
   End If

Salida:
   On Error Resume Next
   
   Unload oF
   Set oF = Nothing

   Set oRsAux1 = Nothing
   Set oRsAux2 = Nothing
   Set oRsErrores = Nothing
   Set oAp = Nothing
   Set oEx = Nothing
   Set oCP = Nothing
   Set oOP = Nothing

   Exit Sub

Mal:
   MsgBox "Se ha producido un error al registrar los datos" & vbCrLf & Err.Number & " -> " & Err.Description, vbCritical
   Resume Salida

End Sub

Public Sub ImportacionOrdenesPago()

   Dim oAp As ComPronto.Aplicacion
   Dim oOP As ComPronto.OrdenPago
   Dim oRsAux1 As ADOR.Recordset
   Dim oRsAux2 As ADOR.Recordset
   Dim oF As Form
   Dim oEx As Excel.Application
   Dim mOk As Boolean, mConProblemas As Boolean
   Dim mIdMonedaPesos As Integer, fl As Integer, mContador As Integer
   Dim mIdProveedor As Integer, mIdObra As Integer, mIdMoneda As Integer
   Dim mIdTipoValor As Integer, mIdBanco As Integer, mIdCuentaBancaria As Integer
   Dim mIdCaja As Integer, mIdTipoComprobante As Integer
   Dim mNumeroOP As Long, mNumeroInterno As Long, mIdValor As Long, mIdCuenta As Long
   Dim mCodigoCuenta As Long, mNumeroComprobante1 As Long, mNumeroComprobante2 As Long
   Dim mIdImputacion As Long, mIdComprobanteProveedor As Long
   Dim mCotizacionDolar As Double, mNumeroCheque As Double, mImporte As Double
   Dim mImporteSinImpuestos As Double, mValores As Double, mAcreedores As Double
   Dim mDebe As Double, mHaber As Double, mCotizacionEuro As Double
   Dim mCodigoProveedor As String, mCuit As String, mTipoValor As String, mTipo As String
   Dim mCuentaBanco As String, mObservaciones As String, mArchivo As String
   Dim mComprobante As String, mLetra As String, mEsCajaBanco As String
   Dim mFecha As Date, mFechaVencimiento As Date
   Dim mVector

   On Error GoTo Mal

   Set oF = New frmPathPresto
   With oF
      .Id = 4
      .Show vbModal
      mOk = .Ok
      If mOk Then
         mArchivo = .FileBrowser1(0).Text
         mIdObra = .dcfields(0).BoundText
      End If
   End With
   Unload oF
   Set oF = Nothing

   If Not mOk Then Exit Sub

   Set oAp = Aplicacion

   Set oRsAux1 = oAp.Parametros.TraerFiltrado("_PorId", 1)
   mIdMonedaPesos = oRsAux1.Fields("IdMoneda").Value
   oRsAux1.Close
   
   Set oF = New frmAviso
   With oF
      .Label1 = "Iniciando EXCEL ..."
      .Show
      .Refresh
      DoEvents
   End With

   oF.Label1 = oF.Label1 & vbCrLf & "Procesando ordenes de pago ..."
   oF.Label2 = ""
   oF.Label3 = ""
   DoEvents

   fl = 8
   mContador = 0
   
   Set oEx = CreateObject("Excel.Application")
   With oEx
      
      .Visible = True
      .WindowState = xlMinimized
      Me.Refresh
      
      With .Workbooks.Open(mArchivo)
         .Sheets("OP").Select
         With .ActiveSheet
            Do While True
               
               If Len(Trim(.Cells(fl, 2))) = 0 And Len(Trim(.Cells(fl, 12))) = 0 And _
                     Len(Trim(.Cells(fl, 14))) = 0 And Len(Trim(.Cells(fl, 21))) = 0 Then
                  Exit Do
               End If
               
               mConProblemas = False
               
               mContador = mContador + 1
               oF.Label2 = "Comprobante : " & .Cells(fl, 2)
               oF.Label3 = "" & mContador
               DoEvents
            
               mCodigoProveedor = .Cells(fl, 5)
               mCuit = .Cells(fl, 6)
               mFecha = CDate(.Cells(fl, 1))
               mNumeroOP = CLng(.Cells(fl, 2))
               mIdMoneda = CInt(.Cells(fl, 9))
               mTipo = .Cells(fl, 3)
               If mTipo <> "CC" And mTipo <> "FF" And mTipo <> "OT" Then mTipo = "CC"
               mObservaciones = .Cells(fl, 25)
               
               mIdProveedor = 0
               If Len(mCodigoProveedor) > 0 Then
                  Set oRsAux1 = oAp.Proveedores.TraerFiltrado("_PorCodigoEmpresa", mCodigoProveedor)
                  If oRsAux1.RecordCount > 0 Then
                     mIdProveedor = oRsAux1.Fields(0).Value
                  End If
                  oRsAux1.Close
               End If
               If Len(mCuit) > 0 And mIdProveedor = 0 Then
                  Set oRsAux1 = oAp.Proveedores.TraerFiltrado("_PorCuit", mCuit)
                  If oRsAux1.RecordCount > 0 Then
                     mIdProveedor = oRsAux1.Fields(0).Value
                  End If
                  oRsAux1.Close
               End If
               If mIdProveedor = 0 Then
                  mConProblemas = True
               End If
               
               mCodigoCuenta = 0
               If Len(Trim(.Cells(fl, 8))) <> 0 Then
                  mCodigoCuenta = .Cells(fl, 8)
                  mIdCuenta = 0
                  Set oRsAux2 = oAp.Cuentas.TraerFiltrado("_PorCodigo", mCodigoCuenta)
                  If oRsAux2.RecordCount > 0 Then
                     mIdCuenta = oRsAux2.Fields(0).Value
                  End If
                  oRsAux2.Close
               End If
                        
               Set oRsAux1 = oAp.OrdenesPago.TraerFiltrado("_PorNumeroIdObraOrigen", _
                              Array(mNumeroOP, mIdObra))
               If oRsAux1.RecordCount = 0 Then
                  mCotizacionDolar = Cotizacion(mFecha, glbIdMonedaDolar)
                  If mCotizacionDolar = 0 Then
                     mConProblemas = True
                  End If
                  mCotizacionEuro = Cotizacion(mFecha, glbIdMonedaEuro)
                  If mCotizacionEuro = 0 Then
                     mConProblemas = True
                  End If
                  Set oOP = oAp.OrdenesPago.Item(-1)
                  With oOP
                     With .Registro
                        .Fields("NumeroOrdenPago").Value = mNumeroOP
                        .Fields("FechaOrdenPago").Value = mFecha
                        If mIdProveedor <> 0 Then
                           .Fields("IdProveedor").Value = mIdProveedor
                        End If
                        If mCodigoCuenta <> 0 Then
                           .Fields("IdCuenta").Value = mIdCuenta
                        End If
                        .Fields("IdMoneda").Value = mIdMoneda
                        .Fields("CotizacionMoneda").Value = 1
                        .Fields("CotizacionDolar").Value = mCotizacionDolar
                        .Fields("CotizacionEuro").Value = mCotizacionEuro
                        .Fields("IdObraOrigen").Value = mIdObra
                        .Fields("Tipo").Value = mTipo
                        .Fields("Dolarizada").Value = "NO"
                        .Fields("Exterior").Value = "NO"
                        .Fields("AsientoManual").Value = "NO"
                        .Fields("IdUsuarioIngreso").Value = glbIdUsuario
                        .Fields("FechaIngreso").Value = Now
                        .Fields("Observaciones").Value = mObservaciones
                        If mTipo = "OT" Then .Fields("TipoOperacionOtros").Value = 1
                     End With
                  End With
                     
                  mAcreedores = 0
                  mValores = 0
                  Do While Len(Trim(.Cells(fl, 2))) = 0 Or mNumeroOP = .Cells(fl, 2)
                     
                     If Len(Trim(.Cells(fl, 2))) = 0 And Len(Trim(.Cells(fl, 12))) = 0 And _
                           Len(Trim(.Cells(fl, 14))) = 0 And Len(Trim(.Cells(fl, 21))) = 0 Then
                        Exit Do
                     End If
                     
                     'RETENCIONES
                     If Len(Trim(.Cells(fl, 12))) <> 0 Then
                        If CInt(.Cells(fl, 12)) = 1 Then
                           oOP.Registro.Fields("RetencionIVA").Value = CDbl(.Cells(fl, 13))
                        ElseIf CInt(.Cells(fl, 12)) = 2 Then
                           oOP.Registro.Fields("RetencionGanancias").Value = CDbl(.Cells(fl, 13))
                        ElseIf CInt(.Cells(fl, 12)) = 3 Then
                           oOP.Registro.Fields("RetencionIBrutos").Value = CDbl(.Cells(fl, 13))
                        ElseIf CInt(.Cells(fl, 12)) = 4 Then
                           oOP.Registro.Fields("RetencionSUSS").Value = CDbl(.Cells(fl, 13))
                        End If
                     End If
                     
                     'IMPUTACIONES A CUENTAS CORRIENTES
                     If Len(Trim(.Cells(fl, 10))) <> 0 Then
                        mIdImputacion = -1
                        If Len(Trim(.Cells(fl, 26))) <> 0 Then
                           mComprobante = Trim(.Cells(fl, 26))
                           If InStr(1, mComprobante, "-") <> 0 Then
                              mVector = VBA.Split(mComprobante, "-")
                              mLetra = mVector(0)
                              mNumeroComprobante1 = CLng(mVector(1))
                              mNumeroComprobante2 = CLng(mVector(2))
                              Set oRsAux2 = oAp.ComprobantesProveedores.TraerFiltrado("_PorNumeroComprobante", _
                                             Array(mIdProveedor, mLetra, mNumeroComprobante1, mNumeroComprobante2, 0, 0))
                              If oRsAux2.RecordCount > 0 Then
                                 mIdTipoComprobante = oRsAux2.Fields("IdTipoComprobante").Value
                                 mIdComprobanteProveedor = oRsAux2.Fields("IdComprobanteProveedor").Value
                                 oRsAux2.Close
                                 Set oRsAux2 = oAp.CtasCtesA.TraerFiltrado("_BuscarComprobante", _
                                                Array(mIdComprobanteProveedor, mIdTipoComprobante))
                                 If oRsAux2.RecordCount > 0 Then
                                    mIdImputacion = oRsAux2.Fields(0).Value
                                 End If
                              End If
                              oRsAux2.Close
                           End If
                        End If
                        mImporte = CDbl(.Cells(fl, 10))
                        mImporteSinImpuestos = CDbl(.Cells(fl, 11))
                        mAcreedores = mAcreedores + mImporte
                        With oOP.DetOrdenesPago.Item(-1)
                           With .Registro
                              .Fields("IdImputacion").Value = mIdImputacion
                              .Fields("Importe").Value = mImporte
                              .Fields("ImportePagadoSinImpuestos").Value = mImporteSinImpuestos
                           End With
                           .Modificado = True
                        End With
                     End If
                     
                     'VALORES
                     If Len(Trim(.Cells(fl, 14))) <> 0 Then
                        mIdTipoValor = 6
                        mTipoValor = .Cells(fl, 14)
                        If mTipoValor = "CH" Or mTipoValor = "CHT" Then
                           mIdTipoValor = 6
                        ElseIf mTipoValor = "TR" Then
                           mIdTipoValor = 21
                        ElseIf mTipoValor = "EF" Then
                           mIdTipoValor = 33
                        End If
                        mNumeroInterno = CLng(.Cells(fl, 17))
                        mNumeroCheque = CDbl(.Cells(fl, 18))
                        mImporte = CDbl(.Cells(fl, 20))
                        mValores = mValores + mImporte
                        mCuentaBanco = CStr(.Cells(fl, 15))
                        If Len(Trim(.Cells(fl, 19))) <> 0 Then
                           mFechaVencimiento = CDate(.Cells(fl, 19))
                        Else
                           mFechaVencimiento = 0
                        End If
                        
                        mIdValor = 0
                        Set oRsAux2 = oAp.Valores.TraerFiltrado("_PorNumeroInterno", mNumeroInterno)
                        If oRsAux2.RecordCount > 0 Then
                           mIdValor = oRsAux2.Fields(0).Value
                        End If
                        oRsAux2.Close
                        
                        mIdBanco = 0
                        mIdCuentaBancaria = 0
                        Set oRsAux2 = oAp.CuentasBancarias.TraerFiltrado("_PorCuenta", mCuentaBanco)
                        If oRsAux2.RecordCount > 0 Then
                           mIdBanco = oRsAux2.Fields("IdBanco").Value
                           mIdCuentaBancaria = oRsAux2.Fields("IdCuentaBancaria").Value
                        End If
                        oRsAux2.Close
                        
                        mIdCaja = 0
                        If mTipoValor = "EF" Then
                           mIdBanco = 0
                           mIdCuentaBancaria = 0
                           Set oRsAux2 = oAp.Cajas.TraerFiltrado("_PorCuentaContable", mCuentaBanco)
                           If oRsAux2.RecordCount > 0 Then
                              mIdCaja = oRsAux2.Fields(0).Value
                           End If
                           oRsAux2.Close
                        End If
                        
                        With oOP.DetOrdenesPagoValores.Item(-1)
                           With .Registro
                              .Fields("IdTipoValor").Value = mIdTipoValor
                              .Fields("Importe").Value = mImporte
                              If mTipoValor = "EF" Then
                                 .Fields("IdCaja").Value = mIdCaja
                              Else
                                 .Fields("NumeroValor").Value = mNumeroCheque
                                 .Fields("NumeroInterno").Value = mNumeroInterno
                                 .Fields("IdBanco").Value = mIdBanco
                                 .Fields("IdCuentaBancaria").Value = mIdCuentaBancaria
                                 If mTipoValor = "CHT" Then
                                    .Fields("IdValor").Value = mIdValor
                                 End If
                                 If mFechaVencimiento <> 0 Then
                                    .Fields("FechaVencimiento").Value = mFechaVencimiento
                                 Else
                                    .Fields("FechaVencimiento").Value = Null
                                 End If
                              End If
                           End With
                           .Modificado = True
                        End With
                     End If
                     
                     'ASIENTO MANUAL
                     If Len(Trim(.Cells(fl, 22))) <> 0 Then
                        mCodigoCuenta = .Cells(fl, 22)
                        mDebe = 0
                        If Len(Trim(.Cells(fl, 23))) <> 0 Then
                           mDebe = CDbl(.Cells(fl, 23))
                        End If
                        mHaber = 0
                        If Len(Trim(.Cells(fl, 24))) <> 0 Then
                           mHaber = CDbl(.Cells(fl, 24))
                        End If
                        
                        mIdCuenta = 0
                        mEsCajaBanco = ""
                        mIdCaja = 0
                        Set oRsAux2 = oAp.Cuentas.TraerFiltrado("_PorCodigo", mCodigoCuenta)
                        If oRsAux2.RecordCount > 0 Then
                           mIdCuenta = oRsAux2.Fields(0).Value
                           oRsAux2.Close
                           Set oRsAux2 = oAp.Cuentas.TraerFiltrado("_CuentaCajaBanco", mIdCuenta)
                           If oRsAux2.RecordCount > 0 Then
                              If Not IsNull(oRsAux2.Fields("EsCajaBanco").Value) And _
                                    (oRsAux2.Fields("EsCajaBanco").Value = "BA" Or _
                                     oRsAux2.Fields("EsCajaBanco").Value = "CA") Then
                                 mEsCajaBanco = oRsAux2.Fields("EsCajaBanco").Value
                              End If
                              mIdCaja = IIf(IsNull(oRsAux2.Fields("IdCaja").Value), 0, oRsAux2.Fields("IdCaja").Value)
                           End If
                        End If
                        oRsAux2.Close
                        
                        mIdCuentaBancaria = 0
                        If mEsCajaBanco = "BA" Then
                           Set oRsAux2 = oAp.Bancos.TraerFiltrado("_PorCuentasBancariasIdCuenta", mIdCuenta)
                           If oRsAux2.RecordCount > 0 Then
                              mIdCuentaBancaria = oRsAux2.Fields("IdCuentaBancaria").Value
                           End If
                           oRsAux2.Close
                        End If
                        
                        oOP.Registro.Fields("AsientoManual").Value = "SI"
                        
                        With oOP.DetOrdenesPagoCuentas.Item(-1)
                           With .Registro
                              .Fields("IdCuenta").Value = mIdCuenta
                              .Fields("CodigoCuenta").Value = mCodigoCuenta
                              .Fields("IdMoneda").Value = mIdMoneda
                              If mDebe <> 0 Then .Fields("Debe").Value = mDebe
                              If mHaber <> 0 Then .Fields("Haber").Value = mHaber
                              If mIdCuentaBancaria <> 0 Then
                                 .Fields("IdCuentaBancaria").Value = mIdCuentaBancaria
                              ElseIf mIdCaja <> 0 Then
                                 .Fields("IdCaja").Value = mIdCaja
                              End If
                           End With
                           .Modificado = True
                        End With
                     End If
                     
                     fl = fl + 1
                  Loop
                     
                  With oOP
                     With .Registro
'                        If mConProblemas Then
                           .Fields("Confirmado").Value = "NO"
'                        Else
'                           .Fields("Confirmado").Value = "SI"
'                        End If
                        .Fields("Valores").Value = mValores
                        .Fields("Acreedores").Value = mAcreedores
                        .Fields("TipoGrabacion").Value = "I"
                     End With
                     .Guardar
                  End With
                  Set oOP = Nothing
                  
               Else
                  fl = fl + 1
               End If
               oRsAux1.Close
            Loop
         End With
         .Close False
      End With
      .Quit
   End With
   
Salida:

   Unload oF
   Set oF = Nothing

   Set oRsAux1 = Nothing
   Set oRsAux2 = Nothing
   Set oOP = Nothing
   Set oAp = Nothing
   Set oEx = Nothing

   Exit Sub

Mal:

   MsgBox "Se ha producido un error al registrar los datos" & vbCrLf & Err.Number & " -> " & Err.Description, vbCritical
   Resume Salida

End Sub

Public Sub ImportacionValores()

   Dim oAp As ComPronto.Aplicacion
   Dim oVal As ComPronto.Valor
   Dim oRsAux1 As ADOR.Recordset
   Dim oF As Form
   Dim i As Integer, mIdBanco As Integer, mIdMonedaPesos As Integer
   Dim mNumeroValor As Double, mImporte As Double
   Dim mArchivo As String, mError As String
   Dim mOk As Boolean, mConProblemas As Boolean
   Dim mFechaValor As Date
   Dim Filas, Columnas

   On Error GoTo Mal

   Set oF = New frmPathPresto
   With oF
      .Id = 5
      .Show vbModal
      mOk = .Ok
      If mOk Then
         mArchivo = .FileBrowser1(0).Text
      End If
   End With
   Unload oF
   Set oF = Nothing

   If Not mOk Then Exit Sub

   Set oAp = Aplicacion

   Set oRsAux1 = oAp.Parametros.TraerFiltrado("_PorId", 1)
   mIdMonedaPesos = oRsAux1.Fields("IdMoneda").Value
   oRsAux1.Close
   
   Set oF = New frmAviso
   With oF
      .Label1 = "Iniciando importacion ..."
      .Show
      .Refresh
      DoEvents
   End With

   oF.Label1 = oF.Label1 & vbCrLf & "Procesando valores ..."
   oF.Label2 = ""
   oF.Label3 = ""
   DoEvents

   mError = ""
   mConProblemas = False
   
   Filas = VBA.Split(LeerArchivoSecuencial(mArchivo), vbCrLf)
   If UBound(Filas) > 0 Then
      For i = 0 To UBound(Filas)
         Columnas = VBA.Split(Filas(i), ",")
         If UBound(Columnas) > 1 Then
            mNumeroValor = CDbl(Columnas(1))
            mIdBanco = CInt(Columnas(2))
            mFechaValor = CDate(Columnas(3))
            mImporte = CDbl(Columnas(4))
            
            Set oRsAux1 = oAp.Valores.TraerFiltrado("_PorNumeroValorIdBanco", _
                              Array(mNumeroValor, mIdBanco))
            If oRsAux1.RecordCount > 0 Then
               mError = mError & vbCrLf & "El cheque " & mNumeroValor & " " & _
                           "del banco " & Columnas(6) & " ya existe"
               mConProblemas = True
            End If
            oRsAux1.Close
            
            If Not mConProblemas Then
               Set oVal = oAp.Valores.Item(-1)
               With oVal
                  With .Registro
                     .Fields("IdTipoValor").Value = 6
                     .Fields("NumeroValor").Value = mNumeroValor
                     .Fields("FechaValor").Value = mFechaValor
                     .Fields("NumeroInterno").Value = 0
                     .Fields("IdBanco").Value = mIdBanco
                     .Fields("Importe").Value = mImporte
                     .Fields("IdCuentaBancaria").Value = 0
                     .Fields("IdMoneda").Value = mIdMonedaPesos
                     .Fields("CotizacionMoneda").Value = 1
                     .Fields("IdUsuarioIngreso").Value = glbIdUsuario
                     .Fields("FechaIngreso").Value = Now
                     .Fields("Detalle").Value = Columnas(8) & " - " & _
                                                Trim(Columnas(9)) & " del " & Columnas(10)
                  End With
                  .Guardar
               End With
            End If
         End If
      Next
   End If

   If Len(mError) > 0 Then
      MsgBox "El proceso reporta los siguientes problemas :" & mError
   End If

Salida:

   Unload oF
   Set oF = Nothing

   Set oRsAux1 = Nothing
   Set oVal = Nothing
   Set oAp = Nothing

   Exit Sub

Mal:

   MsgBox "Se ha producido un error al registrar los datos" & vbCrLf & Err.Number & " -> " & Err.Description, vbCritical
   Resume Salida

End Sub

Public Sub ImportacionEfectivo()

   Dim oAp As ComPronto.Aplicacion
   Dim oRec As ComPronto.Recibo
   Dim oRsAux1 As ADOR.Recordset
   Dim oF As Form
   Dim i As Integer, mIdMonedaPesos As Integer, mIdMonedaDolar As Integer
   Dim mIdPuntoVenta As Integer, mPuntoVenta As Integer
   Dim mImporte As Double, mDebe As Double, mHaber As Double
   Dim mNumeroRecibo As Long, mCodigo As Long, mIdCuenta As Long, mIdCaja As Long
   Dim mArchivo As String, mError As String
   Dim mFecha As Date, mFechaCorte As Date
   Dim mOk As Boolean, mConProblemas As Boolean
   Dim Filas, Columnas

   On Error GoTo Mal

   Set oF = New frmPathPresto
   With oF
      .Id = 6
      .Show vbModal
      mOk = .Ok
      If mOk Then
         mArchivo = .FileBrowser1(0).Text
      End If
   End With
   Unload oF
   Set oF = Nothing

   If Not mOk Then Exit Sub

   Set oAp = Aplicacion

   Set oRsAux1 = oAp.Parametros.TraerFiltrado("_PorId", 1)
   mIdMonedaPesos = oRsAux1.Fields("IdMoneda").Value
   mIdMonedaDolar = oRsAux1.Fields("IdMonedaDolar").Value
   oRsAux1.Close
   
   mIdCaja = 0
   Set oRsAux1 = oAp.Cajas.TraerTodos
   If oRsAux1.RecordCount > 0 Then
      mIdCaja = oRsAux1.Fields(0).Value
   End If
   oRsAux1.Close
   
   mIdPuntoVenta = 0
   mPuntoVenta = 0
   Set oRsAux1 = oAp.PuntosVenta.TraerFiltrado("_PorIdTipoComprobante", 2)
   If oRsAux1.RecordCount > 0 Then
      mIdPuntoVenta = oRsAux1.Fields(0).Value
      mPuntoVenta = oRsAux1.Fields("PuntoVenta").Value
   End If
   oRsAux1.Close
   
   Set oF = New frmAviso
   With oF
      .Label1 = "Iniciando importacion ..."
      .Show
      .Refresh
      DoEvents
   End With

   oF.Label1 = oF.Label1 & vbCrLf & "Procesando ingresos en efectivo ..."
   oF.Label2 = ""
   oF.Label3 = ""
   DoEvents

   mError = ""
   mFechaCorte = 0
   
   Filas = VBA.Split(LeerArchivoSecuencial(mArchivo), vbCrLf)
   If UBound(Filas) > 0 Then
      For i = 0 To UBound(Filas)
         Columnas = VBA.Split(Filas(i), ",")
         If UBound(Columnas) > 1 Then
            mFecha = CDate(Columnas(0))
            mImporte = CDbl(Columnas(1))
            mCodigo = CLng(Columnas(2))
            mDebe = CDbl(Columnas(3))
            mHaber = CDbl(Columnas(4))
            mNumeroRecibo = CLng(Format(Year(mFecha), "0000") & Format(Month(mFecha), "00") & Format(Day(mFecha), "00"))
            
            If mFecha <> mFechaCorte Then
               If Not oRec Is Nothing Then
                  Set oRsAux1 = oAp.Recibos.TraerFiltrado("_PorIdPuntoVenta_Numero", _
                                 Array(mIdPuntoVenta, mNumeroRecibo))
                  If oRsAux1.RecordCount = 0 Then
                     oRec.Guardar
                  End If
                  oRsAux1.Close
                  Set oRec = Nothing
               End If
               Set oRec = oAp.Recibos.Item(-1)
               With oRec
                  With .Registro
                     .Fields("NumeroRecibo").Value = mNumeroRecibo
                     .Fields("FechaRecibo").Value = mFecha
                     .Fields("IdPuntoVenta").Value = mIdPuntoVenta
                     .Fields("PuntoVenta").Value = mPuntoVenta
                     .Fields("Tipo").Value = "OT"
                     .Fields("Efectivo").Value = 0
                     .Fields("Valores").Value = mImporte
                     .Fields("Documentos").Value = 0
                     .Fields("Otros1").Value = 0
                     .Fields("Otros2").Value = 0
                     .Fields("Otros3").Value = 0
                     .Fields("Otros4").Value = 0
                     .Fields("Otros5").Value = 0
                     .Fields("Deudores").Value = 0
                     .Fields("RetencionIVA").Value = 0
                     .Fields("RetencionGanancias").Value = 0
                     .Fields("RetencionIBrutos").Value = 0
                     .Fields("GastosGenerales").Value = 0
                     .Fields("Cotizacion").Value = Cotizacion(mFecha, mIdMonedaDolar)
                     .Fields("IdMoneda").Value = mIdMonedaPesos
                     .Fields("Dolarizada").Value = "NO"
                     .Fields("AsientoManual").Value = "SI"
                     .Fields("CotizacionMoneda").Value = 1
                     .Fields("IdUsuarioIngreso").Value = glbIdUsuario
                     .Fields("FechaIngreso").Value = Now
                  End With
                  With .DetRecibosValores.Item(-1)
                     With .Registro
                        .Fields("IdTipoValor").Value = 32
                        .Fields("Importe").Value = mImporte
                        .Fields("IdCaja").Value = mIdCaja
                     End With
                     .Modificado = True
                  End With
               End With
               mFechaCorte = mFecha
            End If
            
            Set oRsAux1 = oAp.Cuentas.TraerFiltrado("_PorCodigo", mCodigo)
            If oRsAux1.RecordCount > 0 Then
               mIdCuenta = oRsAux1.Fields(0).Value
            Else
               mError = mError & vbCrLf & "El recibo " & mNumeroRecibo & " no tiene una de las cuentas"
               mIdCuenta = 0
            End If
            oRsAux1.Close
            
            If IsNull(oRec.Registro.Fields("IdCuenta").Value) And mHaber <> 0 Then
               oRec.Registro.Fields("IdCuenta").Value = mIdCuenta
            End If
            
            With oRec.DetRecibosCuentas.Item(-1)
               With .Registro
                  .Fields("IdCuenta").Value = mIdCuenta
                  .Fields("CodigoCuenta").Value = mCodigo
                  .Fields("Debe").Value = mDebe
                  .Fields("Haber").Value = mHaber
                  .Fields("IdMoneda").Value = mIdMonedaPesos
                  .Fields("CotizacionMonedaDestino").Value = 1
               End With
               .Modificado = True
            End With
            
         End If
      Next
   End If

   If Not oRec Is Nothing Then
      Set oRsAux1 = oAp.Recibos.TraerFiltrado("_PorIdPuntoVenta_Numero", _
                     Array(mIdPuntoVenta, mNumeroRecibo))
      If oRsAux1.RecordCount = 0 Then
         oRec.Guardar
      End If
      oRsAux1.Close
      Set oRec = Nothing
   End If
   
   If Len(mError) > 0 Then
      MsgBox "El proceso reporta los siguientes problemas :" & mError
   End If

Salida:

   Unload oF
   Set oF = Nothing

   Set oRsAux1 = Nothing
   Set oRec = Nothing
   Set oAp = Nothing

   Exit Sub

Mal:

   MsgBox "Se ha producido un error al registrar los datos" & vbCrLf & Err.Number & " -> " & Err.Description, vbCritical
   Resume Salida

End Sub

Public Sub ImportacionEfectivo1()

   Dim oAp As ComPronto.Aplicacion
   Dim oRec As ComPronto.Recibo
   Dim oPto As ComPronto.PuntoVenta
   Dim oRsAux1 As ADOR.Recordset
   Dim oF As Form
   Dim i As Integer, j As Integer, mIdMonedaPesos As Integer, mIdMonedaDolar As Integer
   Dim mIdPuntoVenta As Integer, mPuntoVenta As Integer
   Dim mImporte As Double, mTotal As Double
   Dim mNumeroRecibo As Long, mCodigo As Long, mCodigoRecibo As Long, mIdCuenta As Long
   Dim mIdCuentaRecibo As Long, mIdCaja As Long, mIdObra As Long
   Dim mArchivo As String, mError As String, s As String, s1 As String, mClave As String
   Dim mClave1 As String, mJerarquia As String, mTipo As String, mCodigoObra As String
   Dim mFecha As Date, mFechaCorte As Date
   Dim mOk As Boolean, mConProblemas As Boolean
   Dim Filas, Columnas, Subcolumnas

   On Error GoTo Mal

   Set oF = New frmPathPresto
   With oF
      .Id = 6
      .Show vbModal
      mOk = .Ok
      If mOk Then
         mArchivo = .FileBrowser1(0).Text
      End If
   End With
   Unload oF
   Set oF = Nothing

   If Not mOk Then Exit Sub

   Set oAp = Aplicacion

   Set oRsAux1 = oAp.Parametros.TraerFiltrado("_PorId", 1)
   mIdMonedaPesos = oRsAux1.Fields("IdMoneda").Value
   mIdMonedaDolar = oRsAux1.Fields("IdMonedaDolar").Value
   oRsAux1.Close
   
   mIdPuntoVenta = 0
   mPuntoVenta = 0
   mNumeroRecibo = 0
   Set oRsAux1 = oAp.PuntosVenta.TraerFiltrado("_PorIdTipoComprobante", 2)
   If oRsAux1.RecordCount > 0 Then
      mIdPuntoVenta = oRsAux1.Fields(0).Value
      mPuntoVenta = oRsAux1.Fields("PuntoVenta").Value
      mNumeroRecibo = oRsAux1.Fields("ProximoNumero").Value
   End If
   oRsAux1.Close
   
   Set oF = New frmAviso
   With oF
      .Label1 = "Iniciando importacion ..."
      .Show
      .Refresh
      DoEvents
   End With

   oF.Label1 = oF.Label1 & vbCrLf & "Procesando ingresos en efectivo ..."
   oF.Label2 = ""
   oF.Label3 = ""
   DoEvents

   mError = ""
   mFecha = Date
   mTotal = 0
   mIdObra = 0
   
   Set oRec = oAp.Recibos.Item(-1)
   With oRec
      With .Registro
         .Fields("FechaRecibo").Value = mFecha
         .Fields("IdPuntoVenta").Value = mIdPuntoVenta
         .Fields("PuntoVenta").Value = mPuntoVenta
         .Fields("Tipo").Value = "OT"
         .Fields("Efectivo").Value = 0
         .Fields("Documentos").Value = 0
         .Fields("Otros1").Value = 0
         .Fields("Otros2").Value = 0
         .Fields("Otros3").Value = 0
         .Fields("Otros4").Value = 0
         .Fields("Otros5").Value = 0
         .Fields("Deudores").Value = 0
         .Fields("RetencionIVA").Value = 0
         .Fields("RetencionGanancias").Value = 0
         .Fields("RetencionIBrutos").Value = 0
         .Fields("GastosGenerales").Value = 0
         .Fields("Cotizacion").Value = Cotizacion(mFecha, mIdMonedaDolar)
         .Fields("IdMoneda").Value = mIdMonedaPesos
         .Fields("Dolarizada").Value = "NO"
         .Fields("AsientoManual").Value = "SI"
         .Fields("CotizacionMoneda").Value = 1
         .Fields("IdUsuarioIngreso").Value = glbIdUsuario
         .Fields("FechaIngreso").Value = Now
      End With
   End With
   
   s = LeerArchivoSecuencial(mArchivo)
   s = Replace(s, ";", ",")
   Filas = VBA.Split(s, vbCrLf)
   If UBound(Filas) > 0 Then
      For i = 0 To UBound(Filas)
         If i = 0 Then
            s = QuitarPath(mArchivo)
            s1 = mId(s, 6, 2) + "/" + mId(s, 4, 2) + "/" + mId(s, 2, 2)
            If Not IsDate(s1) Then
               MsgBox "El archivo no tiene una fecha valida" & vbCrLf & _
                        "Importacion cancelada", vbExclamation
               GoTo Salida
            End If
            mFecha = CDate(s1)
            mClave = "Codigo de obra (" & mId(s, 1, 1) & ")"
            s = BuscarClaveINI(mClave)
            If Len(s) = 0 Then
               MsgBox "No existe la clave del Pronto.ini : " & mClave & vbCrLf & _
                        "Importacion cancelada", vbExclamation
               GoTo Salida
            End If
            Set oRsAux1 = oAp.Obras.TraerFiltrado("_PorNumero", s)
            If oRsAux1.RecordCount = 0 Then
               MsgBox "No existe la obra con numero " & s & vbCrLf & _
                        "Importacion cancelada", vbExclamation
               GoTo Salida
            End If
            mIdObra = oRsAux1.Fields(0).Value
            mClave = "" & s
            oRsAux1.Close
         
         ElseIf i = 1 Then
            Columnas = VBA.Split(Filas(i), ",")
            Subcolumnas = VBA.Split(Columnas(0), "=")
            mClave1 = mClave & "_" & Subcolumnas(1) & "_(1)"
            s = BuscarClaveINI(mClave1)
            Subcolumnas = VBA.Split(s, " ")
            mJerarquia = Subcolumnas(0)
            If Len(mJerarquia) = 0 Then
               MsgBox "No existe la clave del Pronto.ini : " & mClave & vbCrLf & _
                        "Importacion cancelada", vbExclamation
               GoTo Salida
            End If
         
            mIdCuentaRecibo = 0
            Set oRsAux1 = oAp.Cuentas.TraerFiltrado("_PorCodigoJerarquia", mJerarquia)
            If oRsAux1.RecordCount > 0 Then
               mIdCuentaRecibo = oRsAux1.Fields(0).Value
               mCodigoRecibo = oRsAux1.Fields("Codigo").Value
            End If
            oRsAux1.Close
            
            mIdCaja = 0
            Set oRsAux1 = oAp.Cajas.TraerFiltrado("_PorIdCuenta", mIdCuentaRecibo)
            If oRsAux1.RecordCount > 0 Then
               mIdCaja = oRsAux1.Fields(0).Value
            End If
            oRsAux1.Close

         Else
            Columnas = VBA.Split(Filas(i), ",")
            If UBound(Columnas) > 1 Then
               Subcolumnas = VBA.Split(Columnas(0), "=")
               For j = 0 To 2
                  If j = 0 Then
                     mImporte = Val(Subcolumnas(1))
                  Else
                     mImporte = Val(Columnas(j))
                  End If
                  If mImporte <> 0 Then
                     mClave1 = mClave & "_" & Subcolumnas(0) & "_(" & j + 1 & ")"
                     s = BuscarClaveINI(mClave1)
                     Subcolumnas = VBA.Split(s, " ")
                     mJerarquia = Subcolumnas(0)
                     mTipo = Subcolumnas(1)
                     If Len(Subcolumnas(0)) = 0 Then
                        MsgBox "No existe la clave del Pronto.ini : " & mClave & vbCrLf & _
                                 "Importacion cancelada", vbExclamation
                        GoTo Salida
                     End If
                     
                     mIdCuenta = 0
                     Set oRsAux1 = oAp.Cuentas.TraerFiltrado("_PorCodigoJerarquia", mJerarquia)
                     If oRsAux1.RecordCount > 0 Then
                        mIdCuenta = oRsAux1.Fields(0).Value
                        mCodigo = oRsAux1.Fields("Codigo").Value
                     End If
                     oRsAux1.Close
                     
                     With oRec.DetRecibosCuentas.Item(-1)
                        With .Registro
                           .Fields("IdCuenta").Value = mIdCuenta
                           .Fields("CodigoCuenta").Value = mCodigo
                           If mTipo = "DEBE" Then
                              .Fields("Debe").Value = mImporte
                              mTotal = mTotal - mImporte
                           Else
                              .Fields("Haber").Value = mImporte
                              mTotal = mTotal + mImporte
                           End If
                           .Fields("IdMoneda").Value = mIdMonedaPesos
                           .Fields("CotizacionMonedaDestino").Value = 1
                        End With
                        .Modificado = True
                     End With
                  End If
               Next
            End If
         End If
      Next
   End If
   
   Set oPto = Aplicacion.PuntosVenta.Item(mIdPuntoVenta)
   With oPto
      mNumeroRecibo = .Registro.Fields("ProximoNumero").Value
      .Registro.Fields("ProximoNumero").Value = mNumeroRecibo + 1
      .Guardar
   End With
   Set oPto = Nothing
   
   With oRec
      With .Registro
         .Fields("NumeroRecibo").Value = mNumeroRecibo
         .Fields("FechaRecibo").Value = mFecha
         .Fields("IdCuenta").Value = mIdCuentaRecibo
         .Fields("IdObra").Value = mIdObra
      End With
      With .DetRecibosValores.Item(-1)
         With .Registro
            .Fields("IdTipoValor").Value = 32
            .Fields("Importe").Value = mTotal
            .Fields("IdCaja").Value = mIdCaja
         End With
         .Modificado = True
      End With
      With .DetRecibosCuentas.Item(-1)
         With .Registro
            .Fields("IdCuenta").Value = mIdCuentaRecibo
            .Fields("CodigoCuenta").Value = mCodigoRecibo
            If mTotal > 0 Then
               .Fields("Debe").Value = mTotal
            Else
               .Fields("Haber").Value = Abs(mTotal)
            End If
            .Fields("IdMoneda").Value = mIdMonedaPesos
            .Fields("CotizacionMonedaDestino").Value = 1
         End With
         .Modificado = True
      End With
      .Guardar
   End With
   
Salida:

   Unload oF
   Set oF = Nothing

   Set oRsAux1 = Nothing
   Set oRec = Nothing
   Set oAp = Nothing

   Exit Sub

Mal:

   MsgBox "Se ha producido un error al registrar los datos" & vbCrLf & Err.Number & " -> " & Err.Description, vbCritical
   Resume Salida

End Sub

Public Sub ImportacionProveedores()

   Dim oAp As ComPronto.Aplicacion
   Dim oProv As ComPronto.Proveedor
   Dim oRsAux1 As ADOR.Recordset
   Dim oEx As Excel.Application
   Dim oF As Form
   Dim mOk As Boolean
   Dim mArchivo As String, mError As String, mCuit As String, mRazonSocial As String, mNombreFantasia As String
   Dim mDireccion As String, mCodigoPostal As String, mTelefono1 As String, mFax As String, mEmail As String
   Dim mPaginaWeb As String, mContacto As String, mIvaExencionRetencion As String, mCodigoSituacionRetencionIVA As String
   Dim mCodigoRetencionIVA As String, mRetenerSUSS As String, mIBNumeroInscripcion As String
   Dim mNumeroProveedor As Long, mIdProveedor As Long, mCodigo As Long, mIdCuenta As Long, mIdLocalidad As Long
   Dim mIdProvincia As Long, mIdPais As Long
   Dim fl As Integer, mIdMoneda As Integer, mIdCodigoIva As Integer, mIdActividad As Integer, mTipoProveedor As Integer
   Dim mIGCondicion As Integer, mIdTipoRetencionGanancia As Integer, mIdImpuestoDirectoSUSS As Integer, mIBCondicion As Integer
   Dim mIdIBCondicionPorDefecto As Integer
   Dim mFechaLimiteExentoGanancias As Date, mIvaFechaInicioExencion As Date, mIvaFechaCaducidadExencion As Date
   Dim mSUSSFechaCaducidadExencion As Date, mFechaLimiteExentoIIBB As Date
   Dim mIvaPorcentajeExencion As Single
   Dim mProcesar As Boolean
   Dim mAux1

'   On Error GoTo Mal

   Set oF = New frmPathPresto
   With oF
      .Id = 3
      .Show vbModal
      mOk = .Ok
      If mOk Then
         mArchivo = .FileBrowser1(0).Text
      End If
   End With
   Unload oF
   Set oF = Nothing

   If Not mOk Then Exit Sub

   Set oAp = Aplicacion

   mAux1 = TraerValorParametro2("ProximoNumeroProveedor")
   mNumeroProveedor = IIf(IsNull(mAux1), 1, mAux1)
   
   Set oF = New frmAviso
   With oF
      .Label1 = "Iniciando EXCEL ..."
      .Show
      .Refresh
      DoEvents
   End With

   oF.Label1 = oF.Label1 & vbCrLf & "Procesando conjuntos ..."
   oF.Label2 = ""
   oF.Label3 = ""
   DoEvents

   mError = ""
   fl = 7
   
   Set oEx = CreateObject("Excel.Application")
   With oEx
      .Visible = True
      .WindowState = xlMinimized
      Me.Refresh
      
      With .Workbooks.Open(mArchivo)
         With .ActiveSheet
            Do While True
               If Len(Trim(.Cells(fl, 3))) > 0 Then
                  mProcesar = True
                  oF.Label2 = "Proveedor : " & .Cells(fl, 2)
                  DoEvents
                  
                  mCuit = .Cells(fl, 3)
                  Set oRsAux1 = oAp.Proveedores.TraerFiltrado("_PorCuit", mCuit)
                  mIdProveedor = -1
                  If oRsAux1.RecordCount > 0 Then mIdProveedor = oRsAux1.Fields(0).Value
                  oRsAux1.Close
                  
                  mCodigo = .Cells(fl, 14)
                  Set oRsAux1 = oAp.Cuentas.TraerFiltrado("_PorCodigo", mCodigo)
                  mIdCuenta = 0
                  If oRsAux1.RecordCount > 0 Then
                     mIdCuenta = oRsAux1.Fields(0).Value
                  Else
                     mError = mError & vbCrLf & "La cuenta contable " & mCodigo & " no existe"
                     mProcesar = False
                  End If
                  oRsAux1.Close
                  
                  mRazonSocial = .Cells(fl, 2)
                  mNombreFantasia = .Cells(fl, 4)
                  mDireccion = .Cells(fl, 5)
                  mIdLocalidad = .Cells(fl, 7)
                  mCodigoPostal = .Cells(fl, 8)
                  mIdProvincia = .Cells(fl, 10)
                  mIdPais = .Cells(fl, 12)
                  mTelefono1 = .Cells(fl, 15)
                  mFax = .Cells(fl, 16)
                  mEmail = .Cells(fl, 17)
                  mPaginaWeb = .Cells(fl, 18)
                  mIdCodigoIva = .Cells(fl, 20)
                  mIdMoneda = .Cells(fl, 22)
                  mIdActividad = .Cells(fl, 24)
                  mContacto = .Cells(fl, 26)
                  
                  mTipoProveedor = 1
                  If UCase(.Cells(fl, 25)) = "SERVICIOS" Then mTipoProveedor = 2
                  
                  mIGCondicion = 2
                  If UCase(.Cells(fl, 27)) = "EXENTO" Then mIGCondicion = 1
                  mIdTipoRetencionGanancia = .Cells(fl, 29)
                  mFechaLimiteExentoGanancias = 0
                  If IsDate(.Cells(fl, 30)) Then mFechaLimiteExentoGanancias = CDate(.Cells(fl, 30))
                  
                  mIvaExencionRetencion = "NO"
                  If UCase(.Cells(fl, 31)) = "SI" Then mIvaExencionRetencion = "SI"
                  mIvaPorcentajeExencion = .Cells(fl, 32)
                  mIvaFechaInicioExencion = 0
                  If IsDate(.Cells(fl, 33)) Then mIvaFechaInicioExencion = CDate(.Cells(fl, 33))
                  mIvaFechaCaducidadExencion = 0
                  If IsDate(.Cells(fl, 34)) Then mIvaFechaCaducidadExencion = CDate(.Cells(fl, 34))
                  mCodigoSituacionRetencionIVA = .Cells(fl, 35)
                  mCodigoRetencionIVA = .Cells(fl, 36)
                  
                  mRetenerSUSS = "EX"
                  If UCase(.Cells(fl, 37)) = "ALCANZADO" Then
                     mRetenerSUSS = "SI"
                  ElseIf UCase(.Cells(fl, 37)) = "NO ALCANZADO" Then
                     mRetenerSUSS = "NO"
                  End If
                  mIdImpuestoDirectoSUSS = .Cells(fl, 39)
                  mSUSSFechaCaducidadExencion = 0
                  If IsDate(.Cells(fl, 40)) Then mSUSSFechaCaducidadExencion = CDate(.Cells(fl, 40))
                  
                  mIBCondicion = 1
                  If UCase(.Cells(fl, 41)) = "INSCRIPTO CONVENIO MULTILATERAL" Then
                     mIBCondicion = 2
                  ElseIf UCase(.Cells(fl, 41)) = "INSCRIPTO JURISDICCION LOCAL" Then
                     mIBCondicion = 3
                  ElseIf UCase(.Cells(fl, 41)) = "NO ALCANZADO" Then
                     mIBCondicion = 4
                  End If
                  mFechaLimiteExentoIIBB = 0
                  If IsDate(.Cells(fl, 42)) Then mFechaLimiteExentoIIBB = CDate(.Cells(fl, 42))
                  mIdIBCondicionPorDefecto = .Cells(fl, 44)
                  mIBNumeroInscripcion = .Cells(fl, 45)
                  
                  Set oProv = oAp.Proveedores.Item(mIdProveedor)
                  With oProv.Registro
                     .Fields("RazonSocial").Value = mRazonSocial
                     .Fields("Cuit").Value = mCuit
                     .Fields("IdCuenta").Value = mIdCuenta
                     .Fields("NombreFantasia").Value = mNombreFantasia
                     .Fields("Direccion").Value = mDireccion
                     .Fields("IdLocalidad").Value = mIdLocalidad
                     .Fields("CodigoPostal").Value = mCodigoPostal
                     .Fields("IdProvincia").Value = mIdProvincia
                     .Fields("IdPais").Value = mIdPais
                     .Fields("Telefono1").Value = mTelefono1
                     .Fields("Fax").Value = mFax
                     .Fields("Email").Value = mEmail
                     .Fields("PaginaWeb").Value = mPaginaWeb
                     .Fields("IdCodigoIva").Value = mIdCodigoIva
                     .Fields("IdMoneda").Value = mIdMoneda
                     .Fields("IdActividad").Value = mIdActividad
                     .Fields("Contacto").Value = mContacto
                     .Fields("TipoProveedor").Value = mTipoProveedor
                     .Fields("IGCondicion").Value = mIGCondicion
                     .Fields("IdTipoRetencionGanancia").Value = mIdTipoRetencionGanancia
                     If mFechaLimiteExentoGanancias > 0 Then .Fields("FechaLimiteExentoGanancias").Value = mFechaLimiteExentoGanancias
                     .Fields("IvaExencionRetencion").Value = mIvaExencionRetencion
                     .Fields("IvaPorcentajeExencion").Value = mIvaPorcentajeExencion
                     If mIvaFechaInicioExencion > 0 Then .Fields("IvaFechaInicioExencion").Value = mIvaFechaInicioExencion
                     If mIvaFechaCaducidadExencion > 0 Then .Fields("IvaFechaCaducidadExencion").Value = mIvaFechaCaducidadExencion
                     .Fields("CodigoSituacionRetencionIVA").Value = mCodigoSituacionRetencionIVA
                     .Fields("CodigoRetencionIVA").Value = mCodigoRetencionIVA
                     .Fields("RetenerSUSS").Value = mRetenerSUSS
                     .Fields("IdImpuestoDirectoSUSS").Value = mIdImpuestoDirectoSUSS
                     If mSUSSFechaCaducidadExencion > 0 Then .Fields("SUSSFechaCaducidadExencion").Value = mSUSSFechaCaducidadExencion
                     .Fields("IBCondicion").Value = mIBCondicion
                     If mFechaLimiteExentoIIBB > 0 Then .Fields("FechaLimiteExentoIIBB").Value = mFechaLimiteExentoIIBB
                     .Fields("IdIBCondicionPorDefecto").Value = mIdIBCondicionPorDefecto
                     .Fields("IBNumeroInscripcion").Value = mIBNumeroInscripcion
                     .Fields("CodigoProveedor").Value = mNumeroProveedor
                     .Fields("CodigoEmpresa").Value = "PC" & Format(mNumeroProveedor, "0000")
                     If mIdProveedor < 0 Then
                        .Fields("FechaAlta").Value = Now
                        .Fields("IdUsuarioIngreso").Value = glbIdUsuario
                        .Fields("FechaIngreso").Value = Now
                     End If
                     If mProcesar Then
                        oProv.Guardar
                        GuardarValorParametro2 "ProximoNumeroProveedor", "" & mNumeroProveedor + 1
                     End If
                  End With
               Else
                  Exit Do
               End If
               fl = fl + 1
            Loop
         End With
         .Close False
      End With
      .Quit
   End With
   
Salida:

   Unload oF
   Set oF = Nothing

   If Len(mError) > 0 Then
      mError = "El proceso ha concluido con los siguientes errores :" & vbCrLf & mError
      Set oF = New frmConsulta1
      With oF
         .Id = 12
         oF.rchTexto.Text = mError
         .Show vbModal, Me
      End With
      Unload oF
      Set oF = Nothing
   End If

   Set oRsAux1 = Nothing
   Set oAp = Nothing
   Set oProv = Nothing
   Set oEx = Nothing

   Exit Sub

Mal:

   MsgBox "Se ha producido un error al registrar los datos" & vbCrLf & Err.Number & " -> " & Err.Description, vbCritical
   Resume Salida

End Sub

Public Sub RenumerarAsientos()

   Dim oF As Form
   Dim mOk As Boolean
         
   Dim mNumeroInicial As Long
   Dim mFechaInicial As Date, mFechaFinal As Date
   
   mNumeroInicial = 0
   
   Set oF = New frm_Aux
   With oF
      .Caption = "Renumeracion de asientos"
      With .Label2(0)
         .Caption = "Fecha inicial :"
         .Top = 50
         .Left = oF.cmd(0).Left
         .Visible = True
      End With
      With .DTFields(0)
         .Top = oF.Label2(0).Top
         .Left = oF.Label2(0).Left + oF.Label2(0).Width + 10
         .Value = DateSerial(Year(Date), Month(Date), 1)
         .Visible = True
      End With
      With .Label2(1)
         .Caption = "Fecha final :"
         .Top = oF.Label2(0).Top + oF.Label2(0).Height * 2
         .Left = oF.Label2(0).Left
         .Visible = True
      End With
      With .DTFields(1)
         .Top = oF.Label2(1).Top
         .Left = oF.Label2(1).Left + oF.Label2(1).Width + 10
         .Value = Date
         .Visible = True
      End With
      With .Label1
         .Caption = "Numero inicial :"
         .Top = oF.Label2(1).Top + oF.Label2(1).Height * 2
         .Left = oF.Label2(1).Left
      End With
      With .Text1
         .Top = oF.Label1.Top
         .Left = oF.Label1.Left + oF.Label1.Width + 10
      End With
      .Show vbModal, Me
      If IsNumeric(.Text1.Text) Then mNumeroInicial = (.Text1.Text)
      mFechaInicial = .DTFields(0).Value
      mFechaFinal = .DTFields(1).Value
      mOk = .Ok
   End With
   Unload oF
   Set oF = Nothing
   
   If mOk Then
      If mNumeroInicial = 0 Then
         MsgBox "No ingreso el numero inicial", vbExclamation
         Exit Sub
      End If
   
      Dim oRs As ADOR.Recordset
      Set oRs = Aplicacion.Asientos.TraerFiltrado("_EntreFechas", Array(mFechaInicial, mFechaFinal))
      If oRs.RecordCount > 0 Then
         oRs.MoveFirst
         Do While Not oRs.EOF
            Aplicacion.Tarea "Asientos_CambiarNumero", Array(oRs.Fields(0).Value, mNumeroInicial)
            mNumeroInicial = mNumeroInicial + 1
            oRs.MoveNext
         Loop
      End If
      oRs.Close
      Set oRs = Nothing
   End If

End Sub

Public Sub CopiarAsiento()

   Dim oAp As ComPronto.Aplicacion
   Dim oAsi As ComPronto.Asiento
   Dim oPar As ComPronto.Parametro
   Dim oRs As ADOR.Recordset
   Dim oRsDet As ADOR.Recordset
   Dim iFilas As Integer, i As Integer, mNum As Long
   Dim Filas
   Dim Columnas
   
   Set oAp = Aplicacion
   
   Filas = VBA.Split(Lista.GetString, vbCrLf)
   
   For iFilas = LBound(Filas) + 1 To UBound(Filas)
      
      Columnas = VBA.Split(Filas(iFilas), vbTab)
      
      Set oPar = Aplicacion.Parametros.Item(1)
      mNum = oPar.Registro.Fields("ProximoAsiento").Value
      
      Set oRs = oAp.Asientos.Item(Columnas(2)).Registro
      Set oRsDet = oAp.Asientos.TraerFiltrado("_DetallesPorIdAsiento", Columnas(2))
      
      Set oAsi = oAp.Asientos.Item(-1)
      With oAsi
         With .Registro
            .Fields("NumeroAsiento").Value = mNum
            .Fields("FechaAsiento").Value = Date
            .Fields("IdIngreso").Value = glbIdUsuario
            .Fields("FechaIngreso").Value = Date
            .Fields("Concepto").Value = oRs.Fields("Concepto").Value
         End With
         If oRsDet.RecordCount > 0 Then
            oRsDet.MoveFirst
            Do While Not oRsDet.EOF
               With .DetAsientos.Item(-1)
                  With .Registro
                     For i = 2 To oRsDet.Fields.Count - 1
                        .Fields(oRsDet.Fields(i).Name).Value = oRsDet.Fields(i).Value
                     Next
                  End With
                  .Modificado = True
               End With
               oRsDet.MoveNext
            Loop
         End If
         .Guardar
      End With
      Set oAsi = Nothing
      
      oRs.Close
      Set oRs = Nothing
      
      oRsDet.Close
      Set oRsDet = Nothing
      
      oPar.Registro.Fields("ProximoAsiento").Value = mNum + 1
      oPar.Guardar
      Set oPar = Nothing
   
   Next

   Set oAp = Nothing

End Sub

Public Sub RevertirAsiento()

   Dim oAp As ComPronto.Aplicacion
   Dim oAsi As ComPronto.Asiento
   Dim oPar As ComPronto.Parametro
   Dim oRs As ADOR.Recordset
   Dim oRsDet As ADOR.Recordset
   Dim iFilas As Integer, i As Integer, mNum As Long
   Dim Filas
   Dim Columnas
   
   Set oAp = Aplicacion
   
   Filas = VBA.Split(Lista.GetString, vbCrLf)
   
   For iFilas = LBound(Filas) + 1 To UBound(Filas)
      
      Columnas = VBA.Split(Filas(iFilas), vbTab)
      
      Set oPar = Aplicacion.Parametros.Item(1)
      mNum = oPar.Registro.Fields("ProximoAsiento").Value
      
      Set oRs = oAp.Asientos.Item(Columnas(2)).Registro
      Set oRsDet = oAp.Asientos.TraerFiltrado("_DetallesPorIdAsiento", Columnas(2))
      
      Set oAsi = oAp.Asientos.Item(-1)
      With oAsi
         With .Registro
            .Fields("NumeroAsiento").Value = mNum
            .Fields("FechaAsiento").Value = Date
            .Fields("IdIngreso").Value = glbIdUsuario
            .Fields("FechaIngreso").Value = Date
            .Fields("Concepto").Value = oRs.Fields("Concepto").Value
         End With
         If oRsDet.RecordCount > 0 Then
            oRsDet.MoveFirst
            Do While Not oRsDet.EOF
               With .DetAsientos.Item(-1)
                  With .Registro
                     For i = 2 To oRsDet.Fields.Count - 1
                        .Fields(oRsDet.Fields(i).Name).Value = oRsDet.Fields(i).Value
                     Next
                     .Fields("Debe").Value = oRsDet.Fields("Haber").Value
                     .Fields("Haber").Value = oRsDet.Fields("Debe").Value
                  End With
                  .Modificado = True
               End With
               oRsDet.MoveNext
            Loop
         End If
         .Guardar
      End With
      Set oAsi = Nothing
      
      oRs.Close
      Set oRs = Nothing
      
      oRsDet.Close
      Set oRsDet = Nothing
      
      oPar.Registro.Fields("ProximoAsiento").Value = mNum + 1
      oPar.Guardar
      Set oPar = Nothing
   
   Next

   Set oAp = Nothing

End Sub

Public Sub EmitirOrdenesDePago(ByVal Destino As Integer)

   Dim mvarConCotizacion As Boolean, mvarOK As Boolean
   mvarConCotizacion = False
   Dim of1 As frm_Aux
   Set of1 = New frm_Aux
   With of1
      .Caption = "Emision de Orden de Pago"
      .Label1.Visible = False
      .Text1.Visible = False
      With .Frame1
         .Caption = "Emite cotizacion dolar ? : "
         .Top = of1.Label1.Top
         .Visible = True
      End With
      .Option1.Caption = "SI"
      .Option1.Value = True
      .Option2.Caption = "NO"
      .Show vbModal, Me
      mvarOK = .Ok
      mvarConCotizacion = .Option1.Value
   End With
   Unload of1
   Set of1 = Nothing
   Me.Refresh
   If Not mvarOK Then Exit Sub
   
   Dim mCopias As Integer
   Dim mPrinter As String, mPrinterAnt As String
   
   mPrinterAnt = Printer.DeviceName & " on " & Printer.Port
   
   If Destino = 0 Then
      Dim oF As frmCopiasImpresion
      Set oF = New frmCopiasImpresion
      With oF
         .txtCopias.Text = 2
         .Frame1.Visible = False
         .Show vbModal, Me
      End With
      mvarOK = oF.Ok
      mCopias = Val(oF.txtCopias.Text)
      mPrinter = oF.Combo1.Text
      Unload oF
      Set oF = Nothing
      If Not mvarOK Then Exit Sub
   Else
      mCopias = 1
   End If

   Dim mAuxS1 As String, mAuxS2 As String, mDestino As String
   Dim iFilas As Integer, mvarId As Long
   Dim oRs As ADOR.Recordset
   Dim Filas, Columnas
   Dim oW As Word.Application
   
   mAuxS2 = BuscarClaveINI("No mostrar imputaciones en OP fondo fijo")
   If Destino = 0 Then
      mDestino = "Printer"
   Else
      mDestino = "Word"
   End If
   mAuxS1 = "||" & Destino & "|||" & mCopias & "|||" & IIf(mvarConCotizacion, "SI", "NO") & "|" & _
                     mPrinterAnt & "|" & mPrinter & "|" & mAuxS2
   
   Filas = VBA.Split(Lista.GetString, vbCrLf)
   For iFilas = LBound(Filas) + 1 To UBound(Filas)
      Columnas = VBA.Split(Filas(iFilas), vbTab)
      mvarId = Columnas(2)
      
      Set oRs = Aplicacion.OrdenesPago.TraerFiltrado("_PorId", mvarId)
      If oRs.RecordCount > 0 Then
         Set oW = CreateObject("Word.Application")
         oW.Visible = True
         With oW.Documents.Add(glbPathPlantillas & "\OrdenPago_" & glbEmpresaSegunString & ".dot")
            oW.Application.Run MacroName:="Emision", varg1:=glbStringConexion, _
                                                      varg2:=mvarId, varg3:=mAuxS1
            oW.Application.Run MacroName:="DatosDelPie"
            oW.Application.Run MacroName:="AgregarLogo", varg1:=glbEmpresaSegunString, varg2:=glbPathPlantillas & "\.."
            If Destino = 0 Then
               If Len(mPrinter) > 0 Then oW.ActivePrinter = mPrinter
               oW.Documents(1).PrintOut False, , , , , , , mCopias
               If Len(mPrinterAnt) > 0 Then oW.ActivePrinter = mPrinterAnt
               oW.Documents(1).Close False
               oW.Quit
            End If
         End With
         
         If Not IsNull(oRs.Fields("RetencionGanancias").Value) And _
               oRs.Fields("RetencionGanancias").Value <> 0 Then
            EmisionCertificadoRetencionGanancias mvarId, mDestino, mPrinter
         End If
         
         If Not IsNull(oRs.Fields("RetencionIVA").Value) And _
               oRs.Fields("RetencionIVA").Value <> 0 Then
            EmisionCertificadoRetencionIVA mvarId, mDestino, mPrinter
         End If
         
         If Not IsNull(oRs.Fields("RetencionIBrutos").Value) And _
               oRs.Fields("RetencionIBrutos").Value <> 0 Then
            EmisionCertificadoRetencionIIBB mvarId, mDestino, mPrinter
         End If
         
         If Not IsNull(oRs.Fields("RetencionSUSS").Value) And _
               oRs.Fields("RetencionSUSS").Value <> 0 Then
            EmisionCertificadoRetencionSUSS mvarId, mDestino, mPrinter
         End If
      End If
      oRs.Close
      Set oRs = Nothing
   Next
   Set oW = Nothing
   
'   If Len(mIds) > 0 Then
'      mIds = mId(mIds, 1, Len(mIds) - 1)
'      EmisionOrdenPago "OrdenesPago", mIds, "||" & Destino & "|||" & mCopias & "|||" & _
'                        IIf(mvarConCotizacion, "SI", "NO") & "|" & _
'                        mPrinterAnt & "|" & mPrinter
'   End If

End Sub

Public Sub EliminarOrdenesDePago()

   Dim Filas
   Dim Columnas
   Dim iFilas As Integer
   
   Me.MousePointer = vbHourglass
   DoEvents

   Filas = VBA.Split(Lista.GetString, vbCrLf)
   
   For iFilas = LBound(Filas) + 1 To UBound(Filas)
      Columnas = VBA.Split(Filas(iFilas), vbTab)
      Aplicacion.Tarea "OrdenesPago_EliminarOrdenesDePagoAConfirmar", Columnas(2)
   Next
   Set Lista.DataSource = Aplicacion.OrdenesPago.TraerFiltrado("_AConfirmar")
   
   Me.MousePointer = vbDefault

End Sub

Public Sub EmitirDatosObra(ByVal Destino As Integer)

   Dim mvarOK As Boolean
   Dim mCopias As Integer
   Dim mPrinter As String, mPrinterAnt As String
   
   mPrinterAnt = Printer.DeviceName & " on " & Printer.Port
   
   If Destino = 0 Then
      Dim oF As frmCopiasImpresion
      Set oF = New frmCopiasImpresion
      With oF
         .txtCopias.Text = 2
         .Frame1.Visible = False
         .Show vbModal, Me
      End With
      mvarOK = oF.Ok
      mCopias = Val(oF.txtCopias.Text)
      mPrinter = oF.Combo1.Text
      Unload oF
      Set oF = Nothing
      If Not mvarOK Then
         Exit Sub
      End If
   Else
      mCopias = 1
   End If

   Dim iFilas As Integer, mIds As String
   Dim Filas
   Dim Columnas
   
   Filas = VBA.Split(Lista.GetString, vbCrLf)
   mIds = ""
   For iFilas = LBound(Filas) + 1 To UBound(Filas)
      Columnas = VBA.Split(Filas(iFilas), vbTab)
      mIds = mIds & Columnas(2) & "|"
   Next
   
   If Len(mIds) > 0 Then
      mIds = mId(mIds, 1, Len(mIds) - 1)
      ListadoObras "Obras", mIds, "||" & Destino & "|||" & mCopias & "|||" & _
                        mPrinterAnt & "|" & mPrinter
   End If

End Sub

Public Sub ImportacionRequerimientos()

   Dim oAp As ComPronto.Aplicacion
   Dim oEx As Excel.Application
   Dim oReq As ComPronto.Requerimiento
   Dim oRs As ADOR.Recordset
   Dim oRsAux As ADOR.Recordset
   Dim oRsErrores As ADOR.Recordset
   Dim oF As Form
   Dim mArchivo As String, mObra As String, mSectorSolicitante As String
   Dim mLugarEntrega As String, mDetalle As String, mCodigoMaterial As String
   Dim mMaterial As String, mUnidad As String, mAdjunto1 As String, mAdjunto2 As String
   Dim mObservaciones As String, mProveedor As String, mPathObra As String, mObs As String
   Dim fl As Integer, mContador As Integer, mItem As Integer, mIdSolicito As Integer
   Dim mIdObra As Integer, mIdSector As Integer, mIdUnidadPorUnidad As Integer
   Dim mIdMonedaPesos As Integer, mIdUnidad As Integer
   Dim mNumeroRM As Long, mLegajoSolicito As Long, mNumeroFactura As Long
   Dim mIdArticulo As Long
   Dim mCantidad As Double, mImporte As Double
   Dim mFecha As Date, mFechaFactura As Date, mFechaNecesidad As Date
   Dim mOk As Boolean, mConProblemas As Boolean
   
   On Error GoTo Mal

   Set oF = New frmPathPresto
   With oF
      .Id = 7
      .Show vbModal
      mOk = .Ok
      If mOk Then
         mArchivo = .FileBrowser1(0).Text
      End If
   End With
   Unload oF
   Set oF = Nothing

   If Not mOk Then Exit Sub

    mObs = BuscarClaveINI("Inicializar origen de descripcion en item de RM")
   
   Set oAp = Aplicacion

   Set oRsErrores = CreateObject("ADOR.Recordset")
   With oRsErrores
      .Fields.Append "Id", adInteger
      .Fields.Append "Detalle", adVarChar, 200
   End With
   oRsErrores.Open
   
   Set oRs = oAp.Parametros.Item(1).Registro
   mIdMonedaPesos = oRs.Fields("IdMoneda").Value
   mIdUnidadPorUnidad = oRs.Fields("IdUnidadPorUnidad").Value
   oRs.Close
   
   Set oF = New frmAviso
   With oF
      .Label1 = "Abriendo planilla Excel ..."
      .Show
      .Refresh
      DoEvents
   End With

   oF.Label1 = oF.Label1 & vbCrLf & "Procesando requerimientos ..."
   oF.Label2 = ""
   oF.Label3 = ""
   DoEvents

   fl = 6
   
   Set oEx = CreateObject("Excel.Application")
   With oEx
      .Visible = True
      .WindowState = xlMinimized
      Me.Refresh
      With .Workbooks.Open(mArchivo)
         .Sheets("RM").Select
         With .ActiveSheet
            Do While True
               If Len(Trim(.Cells(fl, 2))) = 0 Then Exit Do
               
               mConProblemas = False
               
               mContador = mContador + 1
               oF.Label2 = "Comprobante : " & .Cells(fl, 2)
               oF.Label3 = "" & mContador
               DoEvents
            
               mNumeroRM = CLng(.Cells(fl, 2))
               If IsDate(.Cells(fl, 3)) Then
                  mFecha = CDate(.Cells(fl, 3))
               Else
                  mFecha = Date
               End If
               mObra = .Cells(fl, 4)
               mLegajoSolicito = CLng(.Cells(fl, 5))
               mSectorSolicitante = .Cells(fl, 6)
               mLugarEntrega = .Cells(fl, 7)
               mDetalle = .Cells(fl, 8)
               
               Set oRsAux = oAp.Requerimientos.TraerFiltrado("_PorNumero", mNumeroRM)
               If oRsAux.RecordCount > 0 Then
                  AgregarMensajeProcesoPresto oRsErrores, "El requerimiento " & mNumeroRM & " ya existe, toda la RM fue rechazada."
                  mConProblemas = True
               End If
               oRsAux.Close
   
               mIdObra = 0
               Set oRsAux = oAp.Obras.TraerFiltrado("_PorNumero", mObra)
               If oRsAux.RecordCount > 0 Then mIdObra = oRsAux.Fields(0).Value
               oRsAux.Close
               
               mIdSolicito = 0
               Set oRsAux = oAp.Empleados.TraerFiltrado("_PorLegajo", mLegajoSolicito)
               If oRsAux.RecordCount > 0 Then mIdSolicito = oRsAux.Fields(0).Value
               oRsAux.Close
               
               mIdSector = 0
               Set oRsAux = oAp.Sectores.TraerFiltrado("_PorDescripcion", mSectorSolicitante)
               If oRsAux.RecordCount > 0 Then mIdSector = oRsAux.Fields(0).Value
               oRsAux.Close
               
               If Not mConProblemas Then
                  Set oReq = oAp.Requerimientos.Item(-1)
                  With oReq
                     With .Registro
                        .Fields("Confirmado").Value = "NO"
                        .Fields("NumeroRequerimiento").Value = mNumeroRM
                        .Fields("FechaRequerimiento").Value = mFecha
                        If mIdObra <> 0 Then .Fields("IdObra").Value = mIdObra
                        .Fields("LugarEntrega").Value = mLugarEntrega
                        If mIdSolicito <> 0 Then .Fields("IdSolicito").Value = mIdSolicito
                        If mIdSector <> 0 Then .Fields("IdSector").Value = mIdSector
                        .Fields("IdMoneda").Value = mIdMonedaPesos
                        .Fields("Detalle").Value = mDetalle
                     End With
                  End With
                  
                  Do While Len(Trim(.Cells(fl, 2))) <> 0 And mNumeroRM = CLng(.Cells(fl, 2))
                     mItem = CInt(.Cells(fl, 9))
                     mCodigoMaterial = .Cells(fl, 10)
                     mMaterial = .Cells(fl, 11)
                     mCantidad = CDbl(.Cells(fl, 12))
                     mUnidad = .Cells(fl, 13)
                     If IsDate(.Cells(fl, 14)) Then
                        mFechaNecesidad = CDate(.Cells(fl, 14))
                     Else
                        mFechaNecesidad = mFecha
                     End If
                     mAdjunto1 = .Cells(fl, 15)
                     mAdjunto2 = .Cells(fl, 16)
                     mObservaciones = .Cells(fl, 17)
                     mNumeroFactura = CLng(.Cells(fl, 18))
                     mFechaFactura = CDate(.Cells(fl, 19))
                     mProveedor = .Cells(fl, 20)
                     mImporte = CDbl(.Cells(fl, 21))
                     
                     mIdArticulo = 0
                     Set oRsAux = oAp.Articulos.TraerFiltrado("_PorCodigo", mCodigoMaterial)
                     If oRsAux.RecordCount > 0 Then mIdArticulo = oRsAux.Fields(0).Value
                     oRsAux.Close
                     
                     mIdUnidad = 0
                     Set oRsAux = oAp.Unidades.TraerFiltrado("_PorAbreviatura", mUnidad)
                     If oRsAux.RecordCount > 0 Then mIdUnidad = oRsAux.Fields(0).Value
                     oRsAux.Close
                     
                     With oReq.DetRequerimientos.Item(-1)
                        With .Registro
                           .Fields("NumeroItem").Value = mItem
                           If mIdArticulo <> 0 Then
                              .Fields("IdArticulo").Value = mIdArticulo
                           Else
                              .Fields("Descripcionmanual").Value = mMaterial
                           End If
                           .Fields("Cantidad").Value = mCantidad
                           If mIdUnidad <> 0 Then .Fields("IdUnidad").Value = mIdUnidad
                           .Fields("FechaEntrega").Value = mFechaNecesidad
                           If Len(Trim(mAdjunto1)) > 0 Or Len(Trim(mAdjunto2)) > 0 Then
                              .Fields("Adjunto").Value = "SI"
                           Else
                              .Fields("Adjunto").Value = "NO"
                           End If
                           If Len(Trim(mAdjunto1)) > 0 Then .Fields("ArchivoAdjunto1").Value = mAdjunto1
                           If Len(Trim(mAdjunto2)) > 0 Then .Fields("ArchivoAdjunto2").Value = mAdjunto2
                           .Fields("EsBienDeUso").Value = "NO"
                           .Fields("Observaciones").Value = mObservaciones
                           .Fields("NumeroFacturaCompra1").Value = 0
                           .Fields("NumeroFacturaCompra2").Value = mNumeroFactura
                           .Fields("FechaFacturaCompra").Value = mFechaFactura
                           .Fields("ImporteFacturaCompra").Value = mImporte
                           .Fields("OrigenDescripcion").Value = 1
                           Select Case mObs
                              Case "01"
                                 .Fields("OrigenDescripcion").Value = 1
                              Case "02"
                                 .Fields("OrigenDescripcion").Value = 2
                              Case "03"
                                 .Fields("OrigenDescripcion").Value = 3
                           End Select
                        End With
                        .Modificado = True
                     End With
                     fl = fl + 1
                  Loop
                  oReq.Guardar
                  Set oReq = Nothing
               Else
                  fl = fl + 1
               End If
            Loop
         End With
         .Close False
      End With
      .Quit
   End With
   
   Unload oF
   Set oF = Nothing

   If Not oRsErrores Is Nothing Then
      If oRsErrores.RecordCount > 0 Then
         Set oF = New frmConsulta1
         With oF
            Set .RecordsetFuente = oRsErrores
            .Id = 13
            .Show vbModal, Me
         End With
      Else
         MsgBox "Proceso completo", vbInformation
      End If
      Set oRsErrores = Nothing
   End If

Salida:
   On Error Resume Next
   
   Unload oF
   Set oF = Nothing

   Set oRs = Nothing
   Set oRsErrores = Nothing
   Set oRsAux = Nothing
   Set oReq = Nothing
   Set oEx = Nothing
   Set oAp = Nothing

   Exit Sub

Mal:
   MsgBox "Se ha producido un error al registrar los datos" & vbCrLf & Err.Number & " -> " & Err.Description, vbCritical
   Resume Salida
   
End Sub

Public Sub ImportacionSalidaMateriales()

   Dim oAp As ComPronto.Aplicacion
   Dim oEx As Excel.Application
   Dim oSal As ComPronto.SalidaMateriales
   Dim oRs As ADOR.Recordset
   Dim oRsAux As ADOR.Recordset
   Dim oRsErrores As ADOR.Recordset
   Dim oRsMatriz As ADOR.Recordset
   Dim oF As Form
   Dim mArchivo As String, mNumeroObra As String, mCodigoEquipo As String, mCodigoInsumo As String, mUnidad As String
   Dim mObservaciones As String
   Dim fl As Integer, mContador As Integer, mItem As Integer, mIdUnidad As Integer, mIdMonedaPesos As Integer, mIdUbicacion As Integer
   Dim mIdEquipo As Long, mIdArticulo As Long, mIdObra As Long, mIdCorte As Long
   Dim mCantidad As Double, mCosto As Double, mCotizacionDolar As Double
   Dim mOk As Boolean, mCorte As Boolean
   
   On Error GoTo Mal

   mArchivo = ""
   mCotizacionDolar = Cotizacion(Date, glbIdMonedaDolar)
   
   If mCotizacionDolar = 0 Then
      MsgBox "Debe ingresar la cotizacion dolar antes de importar los datos", vbExclamation
      Exit Sub
   End If
   
   Set oF = New frmPathPresto
   With oF
      .Id = 7
      .Show vbModal
      mOk = .Ok
      If mOk Then mArchivo = .FileBrowser1(0).Text
   End With
   Unload oF
   Set oF = Nothing
   If Not mOk Then Exit Sub

   Set oAp = Aplicacion

   Set oRsMatriz = CreateObject("ADOR.Recordset")
   With oRsMatriz
      .Fields.Append "Fila", adInteger
      .Fields.Append "IdEquipo", adInteger
      .Fields.Append "IdInsumo", adInteger
      .Fields.Append "IdUnidad", adInteger
      .Fields.Append "NumeroObra_Mantenimiento", adVarChar, 13
      .Fields.Append "IdObra", adInteger
      .Fields.Append "Cantidad", adDouble
      .Fields.Item("Cantidad").Precision = 18
      .Fields.Item("Cantidad").NumericScale = 2
      .Fields.Append "CostoUnitario", adDouble
      .Fields.Item("CostoUnitario").Precision = 18
      .Fields.Item("CostoUnitario").NumericScale = 2
      .Fields.Append "IdUbicacion", adInteger
      .Fields.Append "Observaciones", adVarChar, 1000
      .Open
   End With
   
   Set oRsErrores = CreateObject("ADOR.Recordset")
   With oRsErrores
      .Fields.Append "Id", adInteger
      .Fields.Append "Detalle", adVarChar, 200
      .Open
   End With
   
   Set oRs = oAp.Parametros.Item(1).Registro
   mIdMonedaPesos = oRs.Fields("IdMoneda").Value
   oRs.Close
   
   Set oF = New frmAviso
   With oF
      .Label1 = "Abriendo planilla Excel ..."
      .Show
      .Refresh
      DoEvents
   End With

   oF.Label1 = oF.Label1 & vbCrLf & "Procesando salidas de materiales ..."
   oF.Label2 = ""
   oF.Label3 = ""
   DoEvents

   fl = 3
   
   Set oEx = CreateObject("Excel.Application")
   With oEx
      .Visible = True
      .WindowState = xlMinimized
      Me.Refresh
      With .Workbooks.Open(mArchivo)
         '.Sheets("Salidas").Select
         With .ActiveSheet
            Do While True
               If Len(Trim(.Cells(fl, 2))) = 0 Then Exit Do
               
               mContador = mContador + 1
               oF.Label2 = "Comprobante : " & .Cells(fl, 2)
               oF.Label3 = "" & mContador
               DoEvents
            
               mCodigoEquipo = .Cells(fl, 2)
               mCodigoInsumo = .Cells(fl, 3)
               mCantidad = .Cells(fl, 4)
               mUnidad = .Cells(fl, 5)
               mIdUbicacion = .Cells(fl, 6)
               mObservaciones = .Cells(fl, 7)
               
               mIdEquipo = 0
               mNumeroObra = ""
               Set oRsAux = oAp.Articulos.TraerFiltrado("_BD_ProntoMantenimientoPorNumeroInventario", mCodigoEquipo)
               If oRsAux.RecordCount > 0 Then
                  mIdEquipo = IIf(IsNull(oRsAux.Fields("IdArticulo").Value), 0, oRsAux.Fields("IdArticulo").Value)
                  mNumeroObra = IIf(IsNull(oRsAux.Fields("NumeroObra").Value), "", oRsAux.Fields("NumeroObra").Value)
               End If
               oRsAux.Close
               
               mIdArticulo = 0
               mCosto = 0
               Set oRsAux = oAp.Articulos.TraerFiltrado("_PorCodigo", mCodigoInsumo)
               If oRsAux.RecordCount > 0 Then
                  mIdArticulo = oRsAux.Fields(0).Value
                  mCosto = IIf(IsNull(oRsAux.Fields("CostoReposicion").Value), 0, oRsAux.Fields("CostoReposicion").Value)
               End If
               oRsAux.Close
               
               mIdUnidad = 0
               Set oRsAux = oAp.Unidades.TraerFiltrado("_PorAbreviatura", mUnidad)
               If oRsAux.RecordCount > 0 Then mIdUnidad = oRsAux.Fields(0).Value
               oRsAux.Close
               
               mIdObra = 0
               Set oRsAux = oAp.Obras.TraerFiltrado("_PorNumero", mNumeroObra)
               If oRsAux.RecordCount > 0 Then mIdObra = oRsAux.Fields(0).Value
               oRsAux.Close
               
               Set oRsAux = oAp.Ubicaciones.TraerFiltrado("_PorId", mIdUbicacion)
               If oRsAux.RecordCount = 0 Then mIdUbicacion = 0
               oRsAux.Close
               
               With oRsMatriz
                  .AddNew
                  .Fields("Fila").Value = fl
                  .Fields("IdEquipo").Value = mIdEquipo
                  .Fields("IdInsumo").Value = mIdArticulo
                  .Fields("IdUnidad").Value = mIdUnidad
                  .Fields("NumeroObra_Mantenimiento").Value = mNumeroObra
                  .Fields("IdObra").Value = mIdObra
                  .Fields("IdUbicacion").Value = mIdUbicacion
                  .Fields("CostoUnitario").Value = mCosto
                  .Fields("Cantidad").Value = mCantidad
                  .Fields("Observaciones").Value = mObservaciones
                  .Update
               End With
               
               fl = fl + 1
            Loop
            
            With oRsMatriz
               .Sort = "Fila"
               .MoveFirst
               Do While Not .EOF
                  If .Fields("IdEquipo").Value = 0 Then
                     oRsErrores.AddNew
                     oRsErrores.Fields("Detalle").Value = "Fila " & .Fields("Fila").Value & ", no se encontro el equipo"
                     oRsErrores.Update
                  End If
                  If .Fields("IdInsumo").Value = 0 Then
                     oRsErrores.AddNew
                     oRsErrores.Fields("Detalle").Value = "Fila " & .Fields("Fila").Value & ", no se encontro el insumo"
                     oRsErrores.Update
                  End If
                  If .Fields("IdUnidad").Value = 0 Then
                     oRsErrores.AddNew
                     oRsErrores.Fields("Detalle").Value = "Fila " & .Fields("Fila").Value & ", no se encontro la unidad"
                     oRsErrores.Update
                  End If
                  If .Fields("NumeroObra_Mantenimiento").Value = "" Then
                     oRsErrores.AddNew
                     oRsErrores.Fields("Detalle").Value = "Fila " & .Fields("Fila").Value & ", no se encontro la obra en PRONTO MANTENIMIENTO"
                     oRsErrores.Update
                  End If
                  If .Fields("IdObra").Value = 0 Then
                     oRsErrores.AddNew
                     oRsErrores.Fields("Detalle").Value = "Fila " & .Fields("Fila").Value & ", no se encontro la obra en PRONTO con el codigo " & .Fields("NumeroObra_Mantenimiento").Value
                     oRsErrores.Update
                  End If
                  If .Fields("IdUbicacion").Value = 0 Then
                     oRsErrores.AddNew
                     oRsErrores.Fields("Detalle").Value = "Fila " & .Fields("Fila").Value & ", no se encontro la ubicacion"
                     oRsErrores.Update
                  End If
                  .MoveNext
               Loop
            End With
            
            If oRsErrores.RecordCount = 0 Then
               With oRsMatriz
                  .Sort = "IdObra,Fila"
                  .MoveFirst
                  mIdCorte = .Fields("IdObra").Value
                  Set oSal = oAp.SalidasMateriales.Item(-1)
                  Do While True
                     mCorte = False
                     If .EOF Then
                        mCorte = True
                     ElseIf mIdCorte <> .Fields("IdObra").Value Then
                        mCorte = True
                     End If
                     If mCorte Then
                        With oSal
                           With .Registro
                              .Fields("IdObra").Value = mIdCorte
                              .Fields("TipoSalida").Value = 1
                              .Fields("NumeroSalidaMateriales").Value = 0
                              .Fields("NumeroSalidaMateriales2").Value = 1
                              .Fields("FechaSalidaMateriales").Value = Date
                              .Fields("IdUsuarioIngreso").Value = glbIdUsuario
                              .Fields("Emitio").Value = glbIdUsuario
                              .Fields("FechaIngreso").Value = Now
                           End With
                           .Guardar
                        End With
                        Set oSal = Nothing
                        If Not .EOF Then
                           mIdCorte = .Fields("IdObra").Value
                           Set oSal = oAp.SalidasMateriales.Item(-1)
                        Else
                           Exit Do
                        End If
                     End If
                     With oSal.DetSalidasMateriales.Item(-1)
                        With .Registro
                           .Fields("IdArticulo").Value = oRsMatriz.Fields("IdInsumo").Value
                           .Fields("IdUnidad").Value = oRsMatriz.Fields("IdUnidad").Value
                           .Fields("Partida").Value = ""
                           .Fields("IdObra").Value = oRsMatriz.Fields("IdObra").Value
                           .Fields("Cantidad").Value = oRsMatriz.Fields("Cantidad").Value
                           .Fields("Adjunto").Value = "NO"
                           .Fields("IdUbicacion").Value = oRsMatriz.Fields("IdUbicacion").Value
                           .Fields("CotizacionDolar").Value = mCotizacionDolar
                           .Fields("CotizacionMoneda").Value = 1
                           .Fields("IdMoneda").Value = glbIdMonedaPesos
                           .Fields("Observaciones").Value = oRsMatriz.Fields("Observaciones").Value
                           .Fields("CostoUnitario").Value = oRsMatriz.Fields("CostoUnitario").Value
                           .Fields("IdEquipoDestino").Value = oRsMatriz.Fields("IdEquipo").Value
                        End With
                        .Modificado = True
                     End With
                     .MoveNext
                  Loop
                  .Close
               End With
            End If
         End With
         .Close False
      End With
      .Quit
   End With
   
   Unload oF
   Set oF = Nothing

   If Not oRsErrores Is Nothing Then
      If oRsErrores.RecordCount > 0 Then
         Set oF = New frmConsulta1
         With oF
            Set .RecordsetFuente = oRsErrores
            .Id = 13
            .Show vbModal, Me
         End With
      Else
         MsgBox "Proceso completo", vbInformation
      End If
      Set oRsErrores = Nothing
   End If

Salida:
   On Error Resume Next
   
   Unload oF
   Set oF = Nothing

   Set oRs = Nothing
   Set oRsMatriz = Nothing
   Set oRsErrores = Nothing
   Set oRsAux = Nothing
   Set oSal = Nothing
   Set oEx = Nothing
   Set oAp = Nothing

   Exit Sub

Mal:
   MsgBox "Se ha producido un error al registrar los datos" & vbCrLf & Err.Number & " -> " & Err.Description, vbCritical
   Resume Salida
   
End Sub

Public Sub ImportacionCobranzas()

   Dim oAp As ComPronto.Aplicacion
   Dim oRec As ComPronto.Recibo
   Dim oRsAux1 As ADOR.Recordset
   Dim oF As Form
   Dim i As Integer, mIdMonedaPesos As Integer, mIdMonedaDolar As Integer
   Dim mIdPuntoVenta As Integer, mPuntoVenta As Integer, mIdMoneda As Integer
   Dim mCodigoDebeHaber As Integer
   Dim mImporte As Double, mDebe As Double, mHaber As Double, mTotalValores As Double
   Dim mNumeroValor As Double, mCotizacionMoneda As Double
   Dim mNumeroRecibo As Long, mCodigo As Long, mCodigoCuenta As Long, mIdCuenta As Long
   Dim mIdCaja As Long, mNumeroInterno As Long, mCodigoBanco As Long, mIdBanco As Long
   Dim mIdCuentaBancaria As Long, mIdCuentaValores As Long, mAuxL1 As Long
   Dim mArchivo As String, mError As String, mCuentaBanco As String
   Dim mFecha As Date, mFechaVencimiento As Date
   Dim mOk As Boolean, mConProblemas As Boolean
   Dim Filas, Columnas, mVector

   On Error GoTo Mal

   Set oF = New frmPathPresto
   With oF
      .Id = 6
      .Show vbModal
      mOk = .Ok
      If mOk Then
         mArchivo = .FileBrowser1(0).Text
      End If
   End With
   Unload oF
   Set oF = Nothing

   If Not mOk Then Exit Sub

   Set oAp = Aplicacion

   Set oRsAux1 = oAp.Parametros.TraerFiltrado("_PorId", 1)
   mIdMonedaPesos = oRsAux1.Fields("IdMoneda").Value
   mIdMonedaDolar = oRsAux1.Fields("IdMonedaDolar").Value
   mIdCuentaValores = IIf(IsNull(oRsAux1.Fields("IdCuentaValores").Value), 0, oRsAux1.Fields("IdCuentaValores").Value)
   oRsAux1.Close
   
   mIdCaja = 0
   Set oRsAux1 = oAp.Cajas.TraerTodos
   If oRsAux1.RecordCount > 0 Then
      mIdCaja = oRsAux1.Fields(0).Value
   End If
   oRsAux1.Close
   
   Set oF = New frmAviso
   With oF
      .Label1 = "Iniciando importacion ..."
      .Show
      .Refresh
      DoEvents
   End With

   oF.Label1 = oF.Label1 & vbCrLf & "Procesando ingresos en efectivo ..."
   oF.Label2 = ""
   oF.Label3 = ""
   DoEvents

   mConProblemas = False
   mError = ""
   mTotalValores = 0
   
   Filas = VBA.Split(LeerArchivoSecuencial(mArchivo), vbCrLf)
   If UBound(Filas) > 0 Then
      
      For i = 0 To UBound(Filas)
         
         Columnas = VBA.Split(Filas(i), ",")
         If UBound(Columnas) > 1 Then
            
            Select Case Columnas(0)
               
               Case "C"
                  If Not oRec Is Nothing Then
                     mError = mError & vbCrLf & "El recibo " & mNumeroRecibo & " no tiene el terminador y no fue tomado"
                     Set oRec = Nothing
                  End If
                  
                  mConProblemas = False
                  mTotalValores = 0
                  
                  mVector = VBA.Split(Columnas(1), "-")
                  mPuntoVenta = CInt(mVector(0))
                  mNumeroRecibo = CLng(mVector(1))
                  mFecha = CDate(Columnas(2))
                  mIdMoneda = CInt(Columnas(3))
                  mCodigoCuenta = CLng(Columnas(4))
                  
                  mIdPuntoVenta = 0
                  Set oRsAux1 = oAp.PuntosVenta.TraerFiltrado("_PorIdTipoComprobantePuntoVenta", Array(2, mPuntoVenta))
                  If oRsAux1.RecordCount > 0 Then
                     mIdPuntoVenta = oRsAux1.Fields(0).Value
                  Else
                     mError = mError & vbCrLf & "El recibo " & mNumeroRecibo & " no tiene punto de venta valido y no fue tomado"
                     mConProblemas = True
                  End If
                  oRsAux1.Close
                  
                  mIdCuenta = 0
                  Set oRsAux1 = oAp.Cuentas.TraerFiltrado("_PorCodigo", mCodigoCuenta)
                  If oRsAux1.RecordCount > 0 Then
                     mIdCuenta = oRsAux1.Fields(0).Value
                  Else
                     mError = mError & vbCrLf & "El recibo " & mNumeroRecibo & " no tiene una cuenta contable valida y no fue tomado"
                     mConProblemas = True
                  End If
                  oRsAux1.Close
                  
                  Set oRsAux1 = oAp.Recibos.TraerFiltrado("_PorIdPuntoVenta_Numero", _
                                 Array(mIdPuntoVenta, mNumeroRecibo))
                  If oRsAux1.RecordCount > 0 Then
                     mError = mError & vbCrLf & "El recibo " & mNumeroRecibo & " ya existe y no fue tomado"
                     mConProblemas = True
                  End If
                  oRsAux1.Close
                  
                  If mIdMonedaPesos = mIdMoneda Then
                     mCotizacionMoneda = 1
                  Else
                     mCotizacionMoneda = Cotizacion(mFecha, mIdMoneda)
                     If mCotizacionMoneda = 0 Then
                        mError = mError & vbCrLf & "El recibo " & mNumeroRecibo & " no tiene cotizacion para la moneda y no fue tomado"
                        mConProblemas = True
                     End If
                  End If
                  
                  Set oRec = oAp.Recibos.Item(-1)
                  With oRec
                     With .Registro
                        .Fields("NumeroRecibo").Value = mNumeroRecibo
                        .Fields("FechaRecibo").Value = mFecha
                        .Fields("IdPuntoVenta").Value = mIdPuntoVenta
                        .Fields("PuntoVenta").Value = mPuntoVenta
                        .Fields("Tipo").Value = "OT"
                        .Fields("IdCuenta").Value = mIdCuenta
                        .Fields("Efectivo").Value = 0
                        .Fields("Documentos").Value = 0
                        .Fields("Otros1").Value = 0
                        .Fields("Otros2").Value = 0
                        .Fields("Otros3").Value = 0
                        .Fields("Otros4").Value = 0
                        .Fields("Otros5").Value = 0
                        .Fields("Deudores").Value = 0
                        .Fields("RetencionIVA").Value = 0
                        .Fields("RetencionGanancias").Value = 0
                        .Fields("RetencionIBrutos").Value = 0
                        .Fields("GastosGenerales").Value = 0
                        .Fields("Cotizacion").Value = Cotizacion(mFecha, mIdMonedaDolar)
                        .Fields("IdMoneda").Value = mIdMoneda
                        .Fields("Dolarizada").Value = "NO"
                        .Fields("AsientoManual").Value = "SI"
                        .Fields("CotizacionMoneda").Value = mCotizacionMoneda
                        .Fields("IdUsuarioIngreso").Value = glbIdUsuario
                     End With
                  End With
                  
               Case "V"
                  If Not oRec Is Nothing Then
                     
                     If Columnas(1) = "EF" Then
                        mImporte = CDbl(Columnas(2))
                        
                        mIdCuenta = 0
                        mCodigoCuenta = 0
                        
                        mAuxL1 = mIdCaja
                        If UBound(Columnas) > 2 Then
                           Set oRsAux1 = oAp.Cajas.TraerFiltrado("_PorCuentaContable", Columnas(3))
                           If oRsAux1.RecordCount > 0 Then
                              mAuxL1 = oRsAux1.Fields("IdCuenta").Value
                              mIdCuenta = oRsAux1.Fields("IdCuenta").Value
                              mCodigoCuenta = Columnas(3)
                           End If
                           oRsAux1.Close
                        End If
                        With oRec.DetRecibosValores.Item(-1)
                           With .Registro
                              .Fields("IdTipoValor").Value = 32
                              .Fields("IdCaja").Value = mAuxL1
                              .Fields("Importe").Value = mImporte
                           End With
                           .Modificado = True
                        End With
                        mTotalValores = mTotalValores + mImporte
                     
                        If mIdCuenta = 0 Then
                           Set oRsAux1 = oAp.Cajas.TraerFiltrado("_TodosSF")
                           If oRsAux1.RecordCount > 0 Then
                              mIdCuenta = oRsAux1.Fields("IdCuenta").Value
                              oRsAux1.Close
                              Set oRsAux1 = oAp.Cuentas.TraerFiltrado("_PorId", mIdCuenta)
                              If oRsAux1.RecordCount > 0 Then
                                 mCodigoCuenta = oRsAux1.Fields("Codigo").Value
                              End If
                           Else
                              mError = mError & vbCrLf & "En el recibo " & mNumeroRecibo & " vino un movimiento en efectivo y no hay cajas definidas"
                              mConProblemas = True
                           End If
                           oRsAux1.Close
                        End If
                        With oRec.DetRecibosCuentas.Item(-1)
                           With .Registro
                              .Fields("IdCuenta").Value = mIdCuenta
                              .Fields("CodigoCuenta").Value = mCodigoCuenta
                              .Fields("Debe").Value = mImporte
                              .Fields("IdMoneda").Value = mIdMoneda
                              .Fields("CotizacionMonedaDestino").Value = mCotizacionMoneda
                           End With
                           .Modificado = True
                        End With
                     
                     ElseIf Columnas(1) = "CH" Then
                        mNumeroInterno = CLng(Columnas(2))
                        mCodigoBanco = CLng(Columnas(3))
                        mNumeroValor = CDbl(Columnas(4))
                        mFechaVencimiento = CDate(Columnas(5))
                        mImporte = CDbl(Columnas(6))
                        
                        mIdBanco = 0
                        Set oRsAux1 = oAp.Bancos.TraerFiltrado("_PorCodigoUnico", mCodigoBanco)
                        If oRsAux1.RecordCount > 0 Then
                           mIdBanco = oRsAux1.Fields(0).Value
                        Else
                           mError = mError & vbCrLf & "El recibo " & mNumeroRecibo & " tiene un valor de terceros de un banco invalido y no fue tomado (CH)"
                           mConProblemas = True
                        End If
                        oRsAux1.Close
                        
                        With oRec.DetRecibosValores.Item(-1)
                           With .Registro
                              .Fields("IdTipoValor").Value = 6
                              .Fields("NumeroValor").Value = mNumeroValor
                              .Fields("NumeroInterno").Value = mNumeroInterno
                              .Fields("FechaVencimiento").Value = mFechaVencimiento
                              .Fields("IdBanco").Value = mIdBanco
                              .Fields("Importe").Value = mImporte
                           End With
                           .Modificado = True
                        End With
                        mTotalValores = mTotalValores + mImporte
                        
                        mCodigoCuenta = 0
                        Set oRsAux1 = oAp.Cuentas.TraerFiltrado("_PorId", mIdCuentaValores)
                        If oRsAux1.RecordCount > 0 Then
                           mCodigoCuenta = oRsAux1.Fields("Codigo").Value
                        Else
                           mError = mError & vbCrLf & "El recibo " & mNumeroRecibo & " tiene cheques de terceros y no esta definida la cuenta valores a depositar"
                           mConProblemas = True
                        End If
                        oRsAux1.Close
                        With oRec.DetRecibosCuentas.Item(-1)
                           With .Registro
                              .Fields("IdCuenta").Value = mIdCuentaValores
                              .Fields("CodigoCuenta").Value = mCodigoCuenta
                              .Fields("Debe").Value = mImporte
                              .Fields("IdMoneda").Value = mIdMoneda
                              .Fields("CotizacionMonedaDestino").Value = mCotizacionMoneda
                           End With
                           .Modificado = True
                        End With
                     
                     ElseIf Columnas(1) = "TB" Then
                        mNumeroInterno = CLng(Columnas(2))
                        mCuentaBanco = CStr(Columnas(3))
                        mImporte = CDbl(Columnas(4))
                        
                        mIdBanco = 0
                        mIdCuentaBancaria = 0
                        Set oRsAux1 = oAp.CuentasBancarias.TraerFiltrado("_PorCuenta", mCuentaBanco)
                        If oRsAux1.RecordCount > 0 Then
                           mIdBanco = oRsAux1.Fields("IdBanco").Value
                           mIdCuentaBancaria = oRsAux1.Fields("IdCuentaBancaria").Value
                        Else
                           mError = mError & vbCrLf & "El recibo " & mNumeroRecibo & " tiene una TB con una cuenta bancaria invalida y no fue tomado (TB)"
                           mConProblemas = True
                        End If
                        oRsAux1.Close
                        
                        mIdCuenta = 0
                        Set oRsAux1 = oAp.Bancos.TraerFiltrado("_PorId", mIdBanco)
                        If oRsAux1.RecordCount > 0 Then
                           mIdCuenta = IIf(IsNull(oRsAux1.Fields("IdCuenta").Value), 0, oRsAux1.Fields("IdCuenta").Value)
                        Else
                           mError = mError & vbCrLf & "El recibo " & mNumeroRecibo & " tiene un banco invalido y no fue tomado (TB)"
                           mConProblemas = True
                        End If
                        oRsAux1.Close
                        
                        With oRec.DetRecibosValores.Item(-1)
                           With .Registro
                              .Fields("IdTipoValor").Value = 21
                              .Fields("NumeroTransferencia").Value = mNumeroInterno
                              .Fields("IdCuentaBancariaTransferencia").Value = mIdCuentaBancaria
                              .Fields("Importe").Value = mImporte
                           End With
                           .Modificado = True
                        End With
                        mTotalValores = mTotalValores + mImporte
                        
                        mCodigoCuenta = 0
                        Set oRsAux1 = oAp.Cuentas.TraerFiltrado("_PorId", mIdCuenta)
                        If oRsAux1.RecordCount > 0 Then
                           mCodigoCuenta = oRsAux1.Fields("Codigo").Value
                        Else
                           mError = mError & vbCrLf & "El recibo " & mNumeroRecibo & " tiene una TB desde un banco sin cuenta contable (TB)"
                           mConProblemas = True
                        End If
                        oRsAux1.Close
                        With oRec.DetRecibosCuentas.Item(-1)
                           With .Registro
                              .Fields("IdCuenta").Value = mIdCuenta
                              .Fields("CodigoCuenta").Value = mCodigoCuenta
                              .Fields("Debe").Value = mImporte
                              .Fields("IdMoneda").Value = mIdMoneda
                              .Fields("CotizacionMonedaDestino").Value = mCotizacionMoneda
                           End With
                           .Modificado = True
                        End With
                     
                     ElseIf Columnas(1) = "DB" Then
                        mCodigoCuenta = CLng(Columnas(2))
                        mImporte = CDbl(Columnas(3))
            
                        mIdCuenta = 0
                        Set oRsAux1 = oAp.Cuentas.TraerFiltrado("_PorCodigo", mCodigoCuenta)
                        If oRsAux1.RecordCount > 0 Then
                           mIdCuenta = oRsAux1.Fields(0).Value
                        Else
                           mError = mError & vbCrLf & "El recibo " & mNumeroRecibo & " tiene un DB con una cuenta contable invalida y no fue tomado (DB)"
                           mConProblemas = True
                        End If
                        oRsAux1.Close
                        
                        With oRec.DetRecibosValores.Item(-1)
                           With .Registro
                              .Fields("IdTipoValor").Value = 22
                              .Fields("IdCuenta").Value = mIdCuenta
                              .Fields("Importe").Value = mImporte
                           End With
                           .Modificado = True
                        End With
                        mTotalValores = mTotalValores + mImporte
                        
                        With oRec.DetRecibosCuentas.Item(-1)
                           With .Registro
                              .Fields("IdCuenta").Value = mIdCuenta
                              .Fields("CodigoCuenta").Value = mCodigoCuenta
                              .Fields("Debe").Value = mImporte
                              .Fields("IdMoneda").Value = mIdMoneda
                              .Fields("CotizacionMonedaDestino").Value = mCotizacionMoneda
                           End With
                           .Modificado = True
                        End With
                     End If
                  End If
               
               Case "A"
                  If Not oRec Is Nothing Then
                     mCodigoCuenta = CLng(Columnas(1))
                     mImporte = CDbl(Columnas(2))
         
                     mIdCuenta = 0
                     Set oRsAux1 = oAp.Cuentas.TraerFiltrado("_PorCodigo", mCodigoCuenta)
                     If oRsAux1.RecordCount > 0 Then
                        mIdCuenta = oRsAux1.Fields(0).Value
                     Else
                        mError = mError & vbCrLf & "El recibo " & mNumeroRecibo & " tiene una cuenta contable invalida en el asiento y no fue tomado"
                        mConProblemas = True
                     End If
                     oRsAux1.Close
                     
                     With oRec.DetRecibosCuentas.Item(-1)
                        With .Registro
                           .Fields("IdCuenta").Value = mIdCuenta
                           .Fields("CodigoCuenta").Value = mCodigoCuenta
                           .Fields("Haber").Value = mImporte
                           .Fields("IdMoneda").Value = mIdMoneda
                           .Fields("CotizacionMonedaDestino").Value = mCotizacionMoneda
                        End With
                        .Modificado = True
                     End With
                  End If
            
               Case "T"
                  If Not oRec Is Nothing Then
                     If Not mConProblemas Then
                        With oRec
                           With .Registro
                              .Fields("Valores").Value = mTotalValores
                              .Fields("FechaIngreso").Value = Now
                           End With
                           .Guardar
                        End With
                     End If
                     Set oRec = Nothing
                  End If
            
            End Select
            
         End If
         
      Next
      
   End If
            
   If Len(mError) > 0 Then
      MsgBox "El proceso reporta los siguientes problemas :" & mError
   End If

Salida:

   Unload oF
   Set oF = Nothing

   Set oRsAux1 = Nothing
   Set oRec = Nothing
   Set oAp = Nothing

   Exit Sub

Mal:

   MsgBox "Se ha producido un error al registrar los datos" & vbCrLf & Err.Number & " -> " & Err.Description, vbCritical
   Resume Salida

End Sub

Public Sub EnviarNovedades_PRONTO_SAT()

   Dim oAp As ComPronto.Aplicacion
   Dim oPar As ComPronto.Parametro
   Dim oRs As ADOR.Recordset
   Dim oRsArch As ADOR.Recordset
   Dim oRsDest As ADOR.Recordset
   Dim oRsLote As ADOR.Recordset
   Dim goMailOL As CEmailOL
   Dim oTransmision As ComPronto.ArchivoATransmitirLoteo
   Dim oF As Form
   Dim sXML As String, mLista As String, mSubject As String, mBody As String, mAttachment As String, mPathSaliente As String
   Dim mLote As String, mSetear As String
   Dim mArchivo As String
   Dim lStatus As Long, mNumeroLote As Long
   Dim mOk As Boolean, mOutlook As Boolean, mProcesado As Boolean
   Dim mIdObra As Integer
   Dim oXML As MSXML.DOMDocument
   
   On Error GoTo Mal
   
   Set oF = New frm_Aux
   With oF
      .Text1.Visible = False
      .Label1.Visible = False
      With .Check1
         .Top = oF.Label1.Top
         .Left = oF.Label1.Left
         .Width = oF.Label1.Width * 2
         .Caption = "Enviar por Outlook :"
         .Visible = True
      End With
      .Caption = "Novedades a PRONTO SAT"
      .Show vbModal, Me
      mOk = .Ok
      If .Check1.Value = 1 Then
         mOutlook = True
      Else
         mOutlook = False
      End If
   End With
   Unload oF
   If Not mOk Then Exit Sub
   
   Set oF = New frmInformacion
   With oF
      .Label1.Caption = "PROCESAMIENTO DE INFORMACION PARA TRANSMISION DE DATOS A PRONTO SAT"
      .Show , Me
   End With
   
   Set oAp = Aplicacion
   
   Set oPar = oAp.Parametros.Item(1)
   If Not IsNull(oPar.Registro.Fields("PathEnvioEmails").Value) Then
      mPathSaliente = oPar.Registro.Fields("PathEnvioEmails").Value
   Else
      mPathSaliente = "C:\"
   End If
   Set oPar = Nothing
   
   Set oRs = oAp.TablasGenerales.TraerFiltrado("ArchivosATransmitir", "_PorSistema", "SAT")
   
   If oRs.RecordCount > 0 Then
      If mOutlook Then Set goMailOL = New CEmailOL
      Do While Not oRs.EOF
         mArchivo = oRs.Fields("Tabla").Value
         oF.Label2.Caption = "Procesando archivo : " & mArchivo
         DoEvents
         
         sXML = ""
         mProcesado = True
         Select Case mArchivo
            Case "Articulos"
               Set oRsArch = oAp.Articulos.TraerFiltrado("_ParaTransmitir")
            Case "Rubros"
               Set oRsArch = oAp.Rubros.TraerFiltrado("_ParaTransmitir")
            Case "Subrubros"
               Set oRsArch = oAp.Subrubros.TraerFiltrado("_ParaTransmitir")
            Case "Familias"
               Set oRsArch = oAp.Familias.TraerFiltrado("_ParaTransmitir")
            Case "Obras"
               Set oRsArch = oAp.Obras.TraerFiltrado("_ParaTransmitir")
            Case "Equipos"
               Set oRsArch = oAp.Equipos.TraerFiltrado("_ParaTransmitir")
            Case "DetEquipos"
               Set oRsArch = oAp.TablasGenerales.TraerFiltrado("DetEquipos", "_ParaTransmitir")
            Case "Planos"
               Set oRsArch = oAp.Planos.TraerFiltrado("_ParaTransmitir")
            Case "ArchivosATransmitirDestinos"
               Set oRsArch = oAp.ArchivosATransmitirDestinos.TraerFiltrado("_Todos")
            Case "Ubicaciones"
               mProcesado = False
            Case "Depositos"
               mProcesado = False
            Case "Proveedores"
               Set oRsArch = oAp.Proveedores.TraerFiltrado("_ParaTransmitir")
            Case "Transportistas"
               Set oRsArch = oAp.Transportistas.TraerFiltrado("_ParaTransmitir")
            Case "Pedidos"
               mProcesado = False
            Case "DetPedidos"
               mProcesado = False
            Case "Localidades"
               Set oRsArch = oAp.Localidades.TraerFiltrado("_ParaTransmitir")
            Case "Provincias"
               Set oRsArch = oAp.Provincias.TraerFiltrado("_ParaTransmitir")
            Case "Paises"
               Set oRsArch = oAp.Paises.TraerFiltrado("_ParaTransmitir")
            Case "Monedas"
               Set oRsArch = oAp.Monedas.TraerFiltrado("_ParaTransmitir")
            Case "Sectores"
               Set oRsArch = oAp.Sectores.TraerFiltrado("_ParaTransmitir")
            Case "Cuentas"
               Set oRsArch = oAp.Cuentas.TraerFiltrado("_ParaTransmitir")
            Case "UnidadesOperativas"
               Set oRsArch = oAp.UnidadesOperativas.TraerFiltrado("_ParaTransmitir")
            Case "Unidades"
               Set oRsArch = oAp.Unidades.TraerFiltrado("_ParaTransmitir_Todos")
            Case "Empleados"
               Set oRsArch = oAp.Empleados.TraerFiltrado("_ParaTransmitir_Todos")
            Case "DescripcionIva"
               Set oRsArch = oAp.TablasGenerales.TraerTodos("DescripcionIva")
            Case "Cotizaciones"
               Set oRsArch = oAp.Cotizaciones.TraerFiltrado("_ParaTransmitir")
            Case "Conjuntos"
               Set oRsArch = oAp.Conjuntos.TraerFiltrado("_Todos")
            Case "DetConjuntos"
               Set oRsArch = oAp.TablasGenerales.TraerFiltrado("DetConjuntos", "_Todos")

            Case Else
               mProcesado = False
         End Select
      
         If mProcesado Then
            If oRsArch.RecordCount > 0 Then sXML = ArmarXML(oRsArch)
         End If
         
         Set oRsDest = oAp.ArchivosATransmitirDestinos.TraerFiltrado("_ActivosPorSistema", "SAT")
         
         If Not oRsDest.RecordCount > 0 Then
            oRsDest.Close
            MsgBox "No hay destinos definidos para transmitir!", vbExclamation
            GoTo Salida
         End If
         
         oRsDest.MoveFirst
         Do While Not oRsDest.EOF
            mIdObra = 0
            If Not IsNull(oRsDest.Fields("IdObra").Value) Then
               mIdObra = oRsDest.Fields("IdObra").Value
            End If
                  
            Select Case mArchivo
               Case "Ubicaciones"
                  Set oRsArch = oAp.Ubicaciones.TraerFiltrado("_ParaTransmitir", mIdObra)
                  sXML = ""
                  If oRsArch.RecordCount > 0 Then sXML = ArmarXML(oRsArch)
               Case "Depositos"
                  Set oRsArch = oAp.Depositos.TraerFiltrado("_ParaTransmitir", mIdObra)
                  sXML = ""
                  If oRsArch.RecordCount > 0 Then sXML = ArmarXML(oRsArch)
               Case "Pedidos"
                  Set oRsArch = oAp.Pedidos.TraerFiltrado("_ParaTransmitir", mIdObra)
                  sXML = ""
                  If oRsArch.RecordCount > 0 Then sXML = ArmarXML(oRsArch)
               Case "DetPedidos"
                  Set oRsArch = oAp.TablasGenerales.TraerFiltrado("DetPedidos", "_ParaTransmitir", mIdObra)
                  sXML = ""
                  If oRsArch.RecordCount > 0 Then sXML = ArmarXML(oRsArch)
               Case "SalidasMateriales"
                  Set oRsArch = oAp.SalidasMateriales.TraerFiltrado("_ParaTransmitir", mIdObra)
                  sXML = ""
                  If oRsArch.RecordCount > 0 Then sXML = ArmarXML(oRsArch)
               Case "DetRequerimientos"
                  Set oRsArch = oAp.TablasGenerales.TraerFiltrado("DetRequerimientos", "_ParaTransmitir", mIdObra)
                  sXML = ""
                  If oRsArch.RecordCount > 0 Then sXML = ArmarXML(oRsArch)
            End Select
            Set oRsArch = Nothing
            
            If Len(sXML) > 0 Then
               Set oRsLote = oAp.ArchivosATransmitirLoteo.TraerFiltrado("_UltimoLote", _
                     Array(oRsDest.Fields("IdArchivoATransmitirDestino").Value, oRs.Fields("IdArchivoATransmitir").Value))
               mNumeroLote = 1
               If oRsLote.RecordCount > 0 Then
                  If Not IsNull(oRsLote.Fields("Lote").Value) Then
                     mNumeroLote = oRsLote.Fields("Lote").Value + 1
                  End If
               End If
               oRsLote.Close
               
               mLote = Format(mNumeroLote, "00000")
               mLista = IIf(IsNull(oRsDest.Fields("Email").Value), "", oRsDest.Fields("Email").Value)
               mSubject = glbEmpresaSegunString & "_" & _
                        IIf(IsNull(oRsDest.Fields("Email").Value), "", oRsDest.Fields("Email").Value) & "_" & mArchivo & "_L" & mLote
               mBody = "" & vbCrLf & mArchivo & "."
               mAttachment = mPathSaliente & mSubject & ".XML"
               
               Set oXML = CreateObject("MSXML.DOMDocument")
               oXML.loadXML sXML
               oXML.Save mAttachment
               Set oXML = Nothing
            
               If mOutlook Then
                  lStatus = goMailOL.Send(mLista, True, mSubject, mBody, mAttachment)
               End If
               
               Set oTransmision = oAp.ArchivosATransmitirLoteo.Item(-1)
               With oTransmision.Registro
                  .Fields("IdArchivoATransmitir").Value = oRs.Fields("IdArchivoATransmitir").Value
                  .Fields("FechaTransmision").Value = Now
                  .Fields("IdArchivoATransmitirDestino").Value = oRsDest.Fields("IdArchivoATransmitirDestino").Value
                  .Fields("NumeroLote").Value = mNumeroLote
                  .Fields("Confirmado").Value = "NO"
               End With
               oTransmision.Guardar
               Set oTransmision = Nothing
            End If
            
            oRsDest.MoveNext
         Loop
         oRsDest.Close
         Set oRsDest = Nothing
         
         oRs.MoveNext
      Loop
   
      oRs.MoveFirst
      Do While Not oRs.EOF
         mArchivo = oRs.Fields("Tabla").Value
         
         Select Case mArchivo
            Case "Articulos"
               mSetear = "Articulos_TX_SetearComoTransmitido"
            Case "Rubros"
               mSetear = "Rubros_TX_SetearComoTransmitido"
            Case "Subrubros"
               mSetear = "Subrubros_TX_SetearComoTransmitido"
            Case "Familias"
               mSetear = "Familias_TX_SetearComoTransmitido"
            Case "Obras"
               mSetear = "Obras_TX_SetearComoTransmitido"
            Case "Equipos"
               mSetear = "Equipos_TX_SetearComoTransmitido"
            Case "DetEquipos"
               mSetear = "DetEquipos_TX_SetearComoTransmitido"
            Case "Planos"
               mSetear = "Planos_TX_SetearComoTransmitido"
            Case "ArchivosATransmitirDestinos"
            Case "Ubicaciones"
            Case "Depositos"
            Case "Proveedores"
               mSetear = "Proveedores_TX_SetearComoTransmitido"
            Case "Transportistas"
               mSetear = "Transportistas_TX_SetearComoTransmitido"
            Case "Pedidos"
               mSetear = "Pedidos_TX_SetearComoTransmitido"
            Case "DetPedidos"
               oAp.Tarea "DetPedidos_TX_SetearComoTransmitido", mIdObra
            Case "Localidades"
               mSetear = "Localidades_TX_SetearComoTransmitido"
            Case "Provincias"
               mSetear = "Provincias_TX_SetearComoTransmitido"
            Case "Paises"
               mSetear = "Paises_TX_SetearComoTransmitido"
            Case "Monedas"
               mSetear = "Monedas_TX_SetearComoTransmitido"
            Case "Sectores"
               mSetear = "Sectores_TX_SetearComoTransmitido"
            Case "Cuentas"
               mSetear = "Cuentas_TX_SetearComoTransmitido"
            Case "UnidadesOperativas"
               mSetear = "UnidadesOperativas_TX_SetearComoTransmitido"
            Case "Unidades"
            Case "SalidasMateriales"
               oAp.Tarea "SalidasMateriales_TX_SetearComoTransmitido", mIdObra
            Case "DetRequerimientos"
               oAp.Tarea "DetRequerimientos_TX_SetearComoTransmitido", mIdObra
         End Select
         
         If Len(mSetear) > 0 Then oAp.Tarea mSetear
         
         oRs.MoveNext
      Loop
   
   Else
      MsgBox "No hay archivos definidos para transmitir", vbExclamation
   End If

   oRs.Close
   
Salida:
   Unload oF
   Set oF = Nothing
   Set oRs = Nothing
   Set oRsArch = Nothing
   Set oRsDest = Nothing
   Set oRsLote = Nothing
   Set oAp = Nothing
   Set goMailOL = Nothing
   
   Exit Sub

Mal:

   MsgBox "Se ha producido un error al registrar los datos" & vbCrLf & Err.Number & " -> " & Err.Description, vbCritical
   Resume Salida

End Sub

Public Sub ImportarNovedades_PRONTO_SAT()

   Dim oAp As ComPronto.Aplicacion
   Dim oPar As ComPronto.Parametro
   Dim oRs As ADOR.Recordset
   Dim goMailOL As CEmailOL
   Dim oTransmision As ComPronto.ArchivoATransmitirLoteo
   Dim oF As Form
   Dim sXML As String, mLista As String, mSubject As String, mBody As String
   Dim mAttachment As String, mPathEntrante As String, mArchivos As String
   Dim mAuxS1 As String
   Dim mDatos1() As String
   Dim mDatos2() As String
   Dim mDatos3() As String
   Dim lStatus As Long, mLote As Long, mIdDestino As Long
   Dim i As Integer, j As Integer
   Dim mOk As Boolean, mOutlook As Boolean
   Dim est As EnumAcciones
   Dim oXML As MSXML.DOMDocument
   
   On Error GoTo Mal
   
   Set oF = New frm_Aux
   With oF
      .Text1.Visible = False
      .Label1.Visible = False
      With .Check1
         .Top = oF.Label1.Top
         .Left = oF.Label1.Left
         .Width = oF.Label1.Width * 2
         .Caption = "Leer desde Outlook :"
         .Visible = True
      End With
      .Caption = "Novedades desde PRONTO SAT"
      .Show vbModal, Me
      mOk = .Ok
      If .Check1.Value = 1 Then
         mOutlook = True
      Else
         mOutlook = False
      End If
   End With
   Unload oF
   If Not mOk Then Exit Sub
   
   Set oAp = Aplicacion
   
   Set oPar = oAp.Parametros.Item(1)
   mPathEntrante = oPar.Registro.Fields("PathRecepcionEmails").Value
   Set oPar = Nothing
   
   Set oF = New frmInformacion
   oF.Label1.Caption = "INCORPORACION DE INFORMACION ENVIADA DESDE PRONTO SAT"
   oF.Show , Me
   
   If mOutlook Then
      Set goMailOL = New CEmailOL
      lStatus = goMailOL.Leer(mPathEntrante, oF)
   End If
   
   mArchivos = Dir(mPathEntrante & "*.XML", vbArchive)
   
   If Not mArchivos = "" Then
      Do While mArchivos <> ""
         mDatos3 = VBA.Split(mId$(mArchivos, 1, InStrRev(mArchivos, ".") - 1), "_")
         mAuxS1 = mDatos3(2)
         If UBound(mDatos3) > 3 Then
            mAuxS1 = mAuxS1 & "|" & mDatos3(4) & "|" & glbIdUsuario
         Else
            mAuxS1 = mAuxS1 & "|" & Year(Date) & Format(Month(Date), "00") & Format(Day(Date), "00") & "|" & glbIdUsuario
         End If
         
         oF.Label2.Caption = "Procesando archivo : " & mDatos3(2)
         DoEvents
         
         Set oXML = CreateObject("MSXML.DOMDocument")
         Set oRs = CreateObject("ADOR.Recordset")
         oXML.Load mPathEntrante & mArchivos
         oRs.Open oXML
         Set oXML = Nothing
         
         mIdDestino = 0
         If oRs.RecordCount > 0 Then
            oRs.MoveFirst
            mIdDestino = oRs.Fields("IdOrigenTransmision").Value
            Select Case mDatos3(2)
               Case "Requerimientos"
                  Do While Not oRs.EOF
                     oRs.Fields("Aprobo").Value = Null
                     oRs.MoveNext
                  Loop
                  oRs.MoveFirst
               Case "LMateriales"
                  Do While Not oRs.EOF
                     oRs.Fields("Aprobo").Value = Null
                     oRs.MoveNext
                  Loop
                  oRs.MoveFirst
            End Select
         End If
         est = oAp.TablasGenerales.ActualizacionEnLotes(mAuxS1, oRs, mIdDestino)
         oRs.Close
         Set oRs = Nothing
         
         Kill mPathEntrante & mArchivos
         
         If mIdDestino <> 0 And mOutlook Then
            mLista = oAp.ArchivosATransmitirDestinos.Item(mIdDestino).Registro.Fields("Email").Value
            mSubject = mId$(mArchivos, 1, InStrRev(mArchivos, ".") - 1) & "_Ok"
            mBody = "Ok." & vbCrLf
            mAttachment = ""
            lStatus = goMailOL.Send(mLista, True, mSubject, mBody, mAttachment)
         End If
         
         mArchivos = Dir
      Loop
   End If
   
   'Registro de confirmacion de recepciones
   If mOutlook Then
      If Len(goMailOL.RespuestasOK) Then
         mDatos1 = VBA.Split(goMailOL.RespuestasOK, "|")
         For i = 0 To UBound(mDatos1)
            mDatos2 = VBA.Split(mDatos1(i), "_")
            Set oRs = oAp.ArchivosATransmitirLoteo.TraerFiltrado("_PorArchivoLote", Array(mDatos2(2), mDatos2(1), Val(mId(mDatos2(3), 2, 5))))
            If oRs.RecordCount > 0 Then
               Set oTransmision = oAp.ArchivosATransmitirLoteo.Item(oRs.Fields(0).Value)
               With oTransmision.Registro
                  .Fields("Confirmado").Value = "SI"
                  .Fields("FechaRecepcionOK").Value = Now
               End With
               oTransmision.Guardar
               Set oTransmision = Nothing
            End If
            oRs.Close
         Next
      End If
   End If
   
Salida:
   Unload oF
   Set oF = Nothing
   Set oRs = Nothing
   Set oAp = Nothing
   Set goMailOL = Nothing
   
   Exit Sub

Mal:

   MsgBox "Se ha producido un error al registrar los datos" & vbCrLf & Err.Number & " -> " & Err.Description, vbCritical
   Resume Salida

End Sub

Public Sub EnviarNovedades_PRONTO_MANTENIMIENTO()

   Dim oAp As ComPronto.Aplicacion
   Dim oPar As ComPronto.Parametro
   Dim oRs As ADOR.Recordset
   Dim oRsArch As ADOR.Recordset
   Dim oRsDest As ADOR.Recordset
   Dim oRsLote As ADOR.Recordset
   Dim goMailOL As CEmailOL
   Dim oTransmision As ComPronto.ArchivoATransmitirLoteo
   Dim oF As Form
   Dim sXML As String, mLista As String, mSubject As String, mBody As String
   Dim mAttachment As String, mPathSaliente As String, mArchivo As String
   Dim lStatus As Long
   Dim mOk As Boolean, mOutlook As Boolean
   Dim oXML As MSXML.DOMDocument
   
   On Error GoTo Mal
   
   Set oF = New frm_Aux
   With oF
      .Text1.Visible = False
      .Label1.Visible = False
      With .Check1
         .Top = oF.Label1.Top
         .Left = oF.Label1.Left
         .Width = oF.Label1.Width * 2
         .Caption = "Enviar por Outlook :"
         .Visible = True
      End With
      .Caption = "Novedades a PRONTO MANTENIMIENTO"
      .Width = .Width * 1.3
      .Show vbModal, Me
      mOk = .Ok
      If .Check1.Value = 1 Then
         mOutlook = True
      Else
         mOutlook = False
      End If
   End With
   Unload oF
   If Not mOk Then Exit Sub
   
   Set oF = New frmInformacion
   With oF
      .Label1.Caption = "PROCESAMIENTO DE INFORMACION PARA TRANSMISION DE DATOS A PRONTO MANTENIMIENTO"
      .Show , Me
   End With
   
   Set oAp = Aplicacion
   
   Set oPar = oAp.Parametros.Item(1)
   If Not IsNull(oPar.Registro.Fields("PathEnvioEmailsMANTENIMIENTO").Value) Then
      mPathSaliente = oPar.Registro.Fields("PathEnvioEmailsMANTENIMIENTO").Value
   Else
      mPathSaliente = "C:\"
   End If
   Set oPar = Nothing
   
   Set oRs = oAp.TablasGenerales.TraerFiltrado("ArchivosATransmitir", "_PorSistema", "MANTENIMIENTO")
   
   If oRs.RecordCount > 0 Then
      
      Set goMailOL = New CEmailOL
         
      Do While Not oRs.EOF
      
         mArchivo = oRs.Fields("Tabla").Value
         oF.Label2.Caption = "Procesando archivo : " & mArchivo
         DoEvents
         
         Select Case mArchivo
            Case "Articulos"
               Set oRsArch = oAp.Articulos.TraerFiltrado("_ParaTransmitirPRONTO_MANTENIMIENTO")
            Case "Obras"
               Set oRsArch = oAp.Obras.TraerFiltrado("_ParaTransmitir_Todos")
            Case "DetObrasDestinos"
               Set oRsArch = oAp.TablasGenerales.TraerFiltrado("DetObrasDestinos", "_ParaTransmitir_Todos")

'            Case Else
'               MsgBox "Archivo : " & mArchivo & ", no definido!", vbExclamation
'               GoTo Salida
         End Select
      
         If Not oRsArch Is Nothing Then
         
            If oRsArch.RecordCount > 0 Then
            
               Set oRsDest = oAp.ArchivosATransmitirDestinos.TraerFiltrado("_ActivosPorSistema", "MANTENIMIENTO")
               
               If Not oRsDest.RecordCount > 0 Then
                  oRsDest.Close
                  MsgBox "No hay destinos definidos para transmitir!", vbExclamation
                  GoTo Salida
               End If
               
               sXML = ArmarXML(oRsArch)
               
               Do While Not oRsDest.EOF
               
                  mLista = IIf(IsNull(oRsDest.Fields("Email").Value), "SinMail", oRsDest.Fields("Email").Value)
                  mSubject = "PRONTO_" & glbEmpresaSegunString & "_" & _
                              mLista & "_" & mArchivo & "_" & _
                              Replace(CStr(Date), "/", "-")
                  mBody = "" & vbCrLf & mArchivo & "."
                  mAttachment = mPathSaliente & mSubject & ".XML"
                  
                  Set oXML = CreateObject("MSXML.DOMDocument")
                  oXML.loadXML sXML
                  oXML.Save mAttachment
                  Set oXML = Nothing
               
                  If mOutlook Then
                     lStatus = goMailOL.Send(mLista, True, mSubject, mBody, mAttachment)
                  End If
                  
                  oRsDest.MoveNext
                  
               Loop
               oRsDest.Close
            
            Else
            
               oRsArch.Close
            
            End If
         
         End If
         
         Set oRsArch = Nothing
         oRs.MoveNext
      
      Loop
   
   Else
   
      MsgBox "No hay archivos definidos para transmitir", vbExclamation
   
   End If

   oRs.Close
   
Salida:
   Unload oF
   Set oF = Nothing
   Set oRs = Nothing
   Set oRsArch = Nothing
   Set oRsDest = Nothing
   Set oRsLote = Nothing
   Set oAp = Nothing
   Set goMailOL = Nothing
   
   Exit Sub

Mal:

   MsgBox "Se ha producido un error al registrar los datos" & vbCrLf & Err.Number & " -> " & Err.Description, vbCritical
   Resume Salida

End Sub

Public Sub EnviarNovedades_PRONTO()

   Dim oAp As ComPronto.Aplicacion
   Dim oPar As ComPronto.Parametro
   Dim oRs As ADOR.Recordset
   Dim oRsArch As ADOR.Recordset
   Dim oRsDest As ADOR.Recordset
   Dim oRsLote As ADOR.Recordset
   Dim goMailOL As CEmailOL
   Dim oTransmision As ComPronto.ArchivoATransmitirLoteo
   Dim oF As Form
   Dim sXML As String, mLista As String, mSubject As String, mBody As String
   Dim mAttachment As String, mPathSaliente As String, mLote As String
   Dim mSetear As String, mArchivo As String, mPuntoVenta As String
   Dim mEmail As String, mTipoPRONTO As String, mRubrosArticulos As String
   Dim lStatus As Long, mNumeroLote As Long
   Dim mOk As Boolean, mOutlook As Boolean, mProcesado As Boolean
   Dim mEsPuntoVenta As Boolean
   Dim mIdObra As Integer
   Dim oXML As MSXML.DOMDocument
   
'   On Error GoTo Mal
   
   mPuntoVenta = BuscarClaveINI("Punto de venta")
   If Len(mPuntoVenta) > 0 Then
      mTipoPRONTO = "PUNTO DE VENTAS"
      mEsPuntoVenta = True
   Else
      mTipoPRONTO = "PRONTO CENTRAL"
      mEsPuntoVenta = False
   End If
   
   Set oF = New frm_Aux
   With oF
      .Text1.Visible = False
      .Label1.Visible = False
      With .Check1
         .Top = oF.Label1.Top
         .Left = oF.Label1.Left
         .Width = oF.Label1.Width * 2
         .Caption = "Enviar por Outlook :"
         .Visible = True
      End With
      .Caption = "Novedades a " & mTipoPRONTO
      .Show vbModal, Me
      mOk = .Ok
      If .Check1.Value = 1 Then
         mOutlook = True
      Else
         mOutlook = False
      End If
   End With
   Unload oF
   If Not mOk Then Exit Sub
   
   If mOutlook Then
      If mEsPuntoVenta Then
         mEmail = BuscarClaveINI("Email del punto de venta")
      Else
         mEmail = BuscarClaveINI("Email del PRONTO")
      End If
      If Len(mEmail) = 0 Then
         MsgBox "No existe definicion del email del " & mTipoPRONTO & " (Pronto.ini)", vbExclamation
         Exit Sub
      End If
   End If
   
   Set oF = New frmInformacion
   With oF
      .Label1.Caption = "PROCESAMIENTO DE INFORMACION PARA TRANSMISION DE DATOS A PRONTO CENTRAL"
      .Show , Me
   End With
   
   Set oAp = Aplicacion
   
   Set oPar = oAp.Parametros.Item(1)
   If Not IsNull(oPar.Registro.Fields("PathEnvioEmails").Value) Then
      mPathSaliente = oPar.Registro.Fields("PathEnvioEmails").Value
   Else
      mPathSaliente = "C:\"
   End If
   Set oPar = Nothing
   
   Set oRs = oAp.TablasGenerales.TraerFiltrado("ArchivosATransmitir", "_PorSistema", "PRONTO")
   
   If oRs.RecordCount > 0 Then
      
      If mOutlook Then Set goMailOL = New CEmailOL
         
      Do While Not oRs.EOF
         mArchivo = oRs.Fields("Tabla").Value
         oF.Label2.Caption = "Procesando archivo : " & mArchivo
         DoEvents
         
         Select Case mArchivo
            Case "Articulos"
               mRubrosArticulos = BuscarClaveINI("Rubros de articulos para transmision")
               If Len(mRubrosArticulos) = 0 Then
                  Set oRsArch = oAp.Articulos.TraerFiltrado("_ParaTransmitir")
               Else
                  Set oRsArch = oAp.Articulos.TraerFiltrado("_ParaTransmitirPorIdRubros", mRubrosArticulos)
               End If
            Case "Clientes"
               Set oRsArch = oAp.Clientes.TraerFiltrado("_ParaTransmitir")
            Case "Facturas"
               Set oRsArch = oAp.Facturas.TraerFiltrado("_ParaTransmitir")
            Case "DetFacturas"
               Set oRsArch = oAp.TablasGenerales.TraerFiltrado("DetFacturas", "_ParaTransmitir")
            Case "Recibos"
               Set oRsArch = oAp.Recibos.TraerFiltrado("_ParaTransmitir")
            Case "DetRecibos"
               Set oRsArch = oAp.TablasGenerales.TraerFiltrado("DetRecibos", "_ParaTransmitir")
            Case "DetRecibosCuentas"
               Set oRsArch = oAp.TablasGenerales.TraerFiltrado("DetRecibosCuentas", "_ParaTransmitir")
            Case "DetRecibosRubrosContables"
               Set oRsArch = oAp.TablasGenerales.TraerFiltrado("DetRecibosRubrosContables", "_ParaTransmitir")
            Case "DetRecibosValores"
               Set oRsArch = oAp.TablasGenerales.TraerFiltrado("DetRecibosValores", "_ParaTransmitir")
            Case "Subdiarios"
               Set oRsArch = oAp.Subdiarios.TraerFiltrado("_ParaTransmitir")
            Case "Valores"
               Set oRsArch = oAp.Valores.TraerFiltrado("_ParaTransmitir")
            Case "CtasCtesD"
               Set oRsArch = oAp.CtasCtesD.TraerFiltrado("_ParaTransmitir")
         End Select
      
         sXML = ""
         If Not oRsArch Is Nothing Then
            If oRsArch.RecordCount > 0 Then sXML = ArmarXML(oRsArch)
         End If
         Set oRsArch = Nothing
         
         If Len(sXML) > 0 Then
            mLista = mEmail
            mSubject = glbEmpresaSegunString & "_" & mEmail & "_" & mArchivo & "_" & mPuntoVenta
            mBody = "" & vbCrLf & mArchivo & "."
            mAttachment = mPathSaliente & mSubject & ".XML"
            
            Set oXML = CreateObject("MSXML.DOMDocument")
            oXML.loadXML sXML
            oXML.Save mAttachment
            Set oXML = Nothing
         
            If mOutlook Then
               lStatus = goMailOL.Send(mLista, True, mSubject, mBody, mAttachment)
            End If
         End If
         
         oRs.MoveNext
      Loop
   
      oRs.MoveFirst
      Do While Not oRs.EOF
         mArchivo = oRs.Fields("Tabla").Value
         mSetear = ""
         Select Case mArchivo
            Case "Articulos"
               mSetear = "Articulos_TX_SetearComoTransmitido"
            Case "Clientes"
               mSetear = "Clientes_TX_SetearComoTransmitido"
            Case "Facturas"
               mSetear = "Facturas_TX_SetearComoTransmitido"
            Case "DetFacturas"
               mSetear = "DetFacturas_TX_SetearComoTransmitido"
            Case "Recibos"
               mSetear = "Recibos_TX_SetearComoTransmitido"
            Case "DetRecibos"
               mSetear = "DetRecibos_TX_SetearComoTransmitido"
            Case "DetRecibosCuentas"
               mSetear = "DetRecibosCuentas_TX_SetearComoTransmitido"
            Case "DetRecibosRubrosContables"
               mSetear = "DetRecibosRubrosContables_TX_SetearComoTransmitido"
            Case "DetRecibosValores"
               mSetear = "DetRecibosValores_TX_SetearComoTransmitido"
            Case "Subdiarios"
               mSetear = "Subdiarios_TX_SetearComoTransmitido"
            Case "Valores"
               mSetear = "Valores_TX_SetearComoTransmitido"
            Case "CtasCtesD"
               mSetear = "CtasCtesD_TX_SetearComoTransmitido"
         End Select
         If Len(mSetear) > 0 Then
            oAp.Tarea mSetear
         End If
         oRs.MoveNext
      Loop
   
   Else
   
      MsgBox "No hay archivos definidos para transmitir", vbExclamation
   
   End If

   oRs.Close
   
Salida:
   Unload oF
   Set oF = Nothing
   Set oRs = Nothing
   Set oRsArch = Nothing
   Set oRsDest = Nothing
   Set oRsLote = Nothing
   Set oTransmision = Nothing
   Set oAp = Nothing
   Set goMailOL = Nothing
   
   Exit Sub

Mal:

   MsgBox "Se ha producido un error al registrar los datos" & vbCrLf & Err.Number & " -> " & Err.Description, vbCritical
   Resume Salida

End Sub

Public Sub ImportarNovedades_PRONTO()

   Dim oAp As ComPronto.Aplicacion
   Dim oPar As ComPronto.Parametro
   Dim oRs As ADOR.Recordset
   Dim oRs1 As ADOR.Recordset
   Dim goMailOL As CEmailOL
   Dim oTransmision As ComPronto.ArchivoATransmitirLoteo
   Dim oF As Form
   Dim sXML As String, mLista As String, mSubject As String, mBody As String
   Dim mAttachment As String, mPathEntrante As String, mArchivos As String
   Dim mTipoPRONTO As String, mPuntoVenta As String, mArchivosAProcesar As String
   Dim mDatos1() As String
   Dim mDatos2() As String
   Dim mDatos3() As String
   Dim lStatus As Long, mLote As Long, mIdDestino As Long
   Dim i As Integer, j As Integer
   Dim mOk As Boolean, mOutlook As Boolean, mEsPuntoVenta As Boolean
   Dim est As EnumAcciones
   Dim oXML As MSXML.DOMDocument
   
'   On Error GoTo Mal
   
   mPuntoVenta = BuscarClaveINI("Punto de venta")
   If Len(mPuntoVenta) > 0 Then
      mTipoPRONTO = "PUNTO DE VENTAS"
      mEsPuntoVenta = True
      mArchivosAProcesar = "(Articulos)"
   Else
      mTipoPRONTO = "PRONTO CENTRAL"
      mEsPuntoVenta = False
      mArchivosAProcesar = "(Clientes)(Facturas)(DetFacturas)(Recibos)(DetRecibos)" & _
                           "(DetRecibosCuentas)(DetRecibosRubrosContables)" & _
                           "(DetRecibosValores)(Subdiarios)(CtasCtesD)(Valores)"
   End If
   
   Set oF = New frm_Aux
   With oF
      .Text1.Visible = False
      .Label1.Visible = False
      With .Check1
         .Top = oF.Label1.Top
         .Left = oF.Label1.Left
         .Width = oF.Label1.Width * 2
         .Caption = "Leer desde Outlook :"
         .Visible = True
      End With
      .Caption = "Novedades desde " & mTipoPRONTO
      .Show vbModal, Me
      mOk = .Ok
      If .Check1.Value = 1 Then
         mOutlook = True
      Else
         mOutlook = False
      End If
   End With
   Unload oF
   If Not mOk Then Exit Sub
   
   Set oAp = Aplicacion
   
   Set oPar = oAp.Parametros.Item(1)
   mPathEntrante = oPar.Registro.Fields("PathRecepcionEmails").Value
   Set oPar = Nothing
   
   Set oF = New frmInformacion
   oF.Label1.Caption = "INCORPORACION DE INFORMACION ENVIADA DESDE " & mTipoPRONTO
   oF.Show , Me
   
   If mOutlook Then
      Set goMailOL = New CEmailOL
      lStatus = goMailOL.Leer(mPathEntrante, oF)
   End If
   
   mArchivos = Dir(mPathEntrante & "*.XML", vbArchive)
   
   If Not mArchivos = "" Then
      Do While mArchivos <> ""
         mDatos3 = VBA.Split(mId$(mArchivos, 1, InStrRev(mArchivos, ".") - 1), "_")
         If InStr(1, mArchivosAProcesar, "(" & mDatos3(2) & ")") <> 0 Then
            oF.Label2.Caption = "Procesando archivo : " & mDatos3(2)
            DoEvents
            
            Set oXML = CreateObject("MSXML.DOMDocument")
            Set oRs = CreateObject("ADOR.Recordset")
            oXML.Load mPathEntrante & mArchivos
            oRs.Open oXML
            Set oXML = Nothing
            
            mIdDestino = 0
            If Len(mDatos3(3)) > 0 And IsNumeric(mDatos3(3)) Then
               mIdDestino = CLng(mDatos3(3))
            End If
            
            Set oRs1 = CopiarTodosLosRegistros(oRs)
            est = oAp.TablasGenerales.ActualizacionEnLotes(mDatos3(2), oRs1, mIdDestino)
            oRs.Close
            Set oRs = Nothing
            Set oRs1 = Nothing
            
            Kill mPathEntrante & mArchivos
            
'            If mOutlook Then
'               mLista = oAp.ArchivosATransmitirDestinos.Item(mIdDestino).Registro.Fields("Email").Value
'               mSubject = mId$(mArchivos, 1, InStrRev(mArchivos, ".") - 1) & "_Ok"
'               mBody = "Ok." & vbCrLf
'               mAttachment = ""
'               lStatus = goMailOL.Send(mLista, True, mSubject, mBody, mAttachment)
'            End If
         End If
         mArchivos = Dir
      Loop
   End If
   
   'Registro de confirmacion de recepciones
'   If mOutlook Then
'      If Len(goMailOL.RespuestasOK) Then
'         mDatos1 = VBA.Split(goMailOL.RespuestasOK, "|")
'         For i = 0 To UBound(mDatos1)
'            mDatos2 = VBA.Split(mDatos1(i), "_")
'            Set oRs = oAp.ArchivosATransmitirLoteo.TraerFiltrado("_PorArchivoLote", Array(mDatos2(2), mDatos2(1), Val(mId(mDatos2(3), 2, 5))))
'            If oRs.RecordCount > 0 Then
'               Set oTransmision = oAp.ArchivosATransmitirLoteo.Item(oRs.Fields(0).Value)
'               With oTransmision.Registro
'                  .Fields("Confirmado").Value = "SI"
'                  .Fields("FechaRecepcionOK").Value = Now
'               End With
'               oTransmision.Guardar
'               Set oTransmision = Nothing
'            End If
'            oRs.Close
'         Next
'      End If
'   End If
   
Salida:
   Unload oF
   Set oF = Nothing
   Set oRs = Nothing
   Set oRs1 = Nothing
   Set oAp = Nothing
   Set goMailOL = Nothing
   
   Exit Sub

Mal:

   MsgBox "Se ha producido un error al registrar los datos" & vbCrLf & Err.Number & " -> " & Err.Description, vbCritical
   Resume Salida

End Sub

Public Sub EnviarNovedades_PRONTO_BALANZA()

   Dim oAp As ComPronto.Aplicacion
   Dim oPar As ComPronto.Parametro
   Dim oRs As ADOR.Recordset
   Dim oRsArch As ADOR.Recordset
   Dim oRsDest As ADOR.Recordset
   Dim oRsLote As ADOR.Recordset
   Dim goMailOL As CEmailOL
   Dim oTransmision As ComPronto.ArchivoATransmitirLoteo
   Dim oF As Form
   Dim sXML As String, mLista As String, mSubject As String, mBody As String, mAttachment As String, mPathSaliente As String
   Dim mLote As String, mSetear As String
   Dim mArchivo As String
   Dim lStatus As Long, mNumeroLote As Long
   Dim mOk As Boolean, mOutlook As Boolean, mProcesado As Boolean
   Dim mIdObra As Integer
   Dim oXML As MSXML.DOMDocument
   
   On Error GoTo Mal
   
   Set oF = New frm_Aux
   With oF
      .Text1.Visible = False
      .Label1.Visible = False
      With .Check1
         .Top = oF.Label1.Top
         .Left = oF.Label1.Left
         .Width = oF.Label1.Width * 2
         .Caption = "Enviar por Outlook :"
         .Visible = True
      End With
      .Caption = "Novedades a PRONTO BALANZA"
      .Show vbModal, Me
      mOk = .Ok
      If .Check1.Value = 1 Then
         mOutlook = True
      Else
         mOutlook = False
      End If
   End With
   Unload oF
   If Not mOk Then Exit Sub
   
   Set oF = New frmInformacion
   With oF
      .Label1.Caption = "PROCESAMIENTO DE INFORMACION PARA TRANSMISION DE DATOS A PRONTO BALANZA"
      .Show , Me
   End With
   
   Set oAp = Aplicacion
   
   Set oPar = oAp.Parametros.Item(1)
   If Not IsNull(oPar.Registro.Fields("PathEnvioEmails").Value) Then
      mPathSaliente = oPar.Registro.Fields("PathEnvioEmails").Value
   Else
      mPathSaliente = "C:\"
   End If
   Set oPar = Nothing
   
   Set oRs = oAp.TablasGenerales.TraerFiltrado("ArchivosATransmitir", "_PorSistema", "BALANZA")
   
   If oRs.RecordCount > 0 Then
      If mOutlook Then Set goMailOL = New CEmailOL
      Do While Not oRs.EOF
         mArchivo = oRs.Fields("Tabla").Value
         oF.Label2.Caption = "Procesando archivo : " & mArchivo
         DoEvents
         
         sXML = ""
         mProcesado = True
         Select Case mArchivo
            Case "Articulos"
               Set oRsArch = oAp.Articulos.TraerFiltrado("_ParaTransmitir_Todos")
            Case "DetArticulosUnidades"
               Set oRsArch = oAp.TablasGenerales.TraerFiltrado("DetArticulosUnidades", "_ParaTransmitir")
            Case "Rubros"
               Set oRsArch = oAp.Rubros.TraerFiltrado("_ParaTransmitir_Todos")
            Case "Subrubros"
               Set oRsArch = oAp.Subrubros.TraerFiltrado("_ParaTransmitir_Todos")
            Case "Familias"
               Set oRsArch = oAp.Familias.TraerFiltrado("_ParaTransmitir_Todos")
            Case "Obras"
               Set oRsArch = oAp.Obras.TraerFiltrado("_ParaTransmitir_Todos")
            Case "ArchivosATransmitirDestinos"
               Set oRsArch = oAp.ArchivosATransmitirDestinos.TraerFiltrado("_Todos")
            Case "Ubicaciones"
               Set oRsArch = oAp.Ubicaciones.TraerFiltrado("_ParaTransmitir", -1)
            Case "Depositos"
               Set oRsArch = oAp.Depositos.TraerFiltrado("_ParaTransmitir", -1)
            Case "Proveedores"
               Set oRsArch = oAp.Proveedores.TraerFiltrado("_ParaTransmitir_Todos")
            Case "Transportistas"
               Set oRsArch = oAp.Transportistas.TraerFiltrado("_ParaTransmitir_Todos")
            Case "Pedidos"
               Set oRsArch = oAp.Pedidos.TraerFiltrado("_ParaTransmitir_Todos", Array(-1, "BALANZA"))
            Case "DetPedidos"
               Set oRsArch = oAp.TablasGenerales.TraerFiltrado("DetPedidos", "_ParaTransmitir_Todos", Array(-1, "BALANZA"))
            Case "Localidades"
               Set oRsArch = oAp.Localidades.TraerFiltrado("_ParaTransmitir_Todos")
            Case "Provincias"
               Set oRsArch = oAp.Provincias.TraerFiltrado("_ParaTransmitir_Todos")
            Case "Paises"
               Set oRsArch = oAp.Paises.TraerFiltrado("_ParaTransmitir_Todos")
            Case "Monedas"
               Set oRsArch = oAp.Monedas.TraerFiltrado("_ParaTransmitir_Todos")
            Case "Sectores"
               Set oRsArch = oAp.Sectores.TraerFiltrado("_ParaTransmitir_Todos")
            Case "Cuentas"
               Set oRsArch = oAp.Cuentas.TraerFiltrado("_ParaTransmitir_Todos")
            Case "UnidadesOperativas"
               Set oRsArch = oAp.UnidadesOperativas.TraerFiltrado("_ParaTransmitir_Todos")
            Case "Unidades"
               Set oRsArch = oAp.Unidades.TraerFiltrado("_ParaTransmitir_Todos")
            Case "Empleados"
               Set oRsArch = oAp.Empleados.TraerFiltrado("_ParaTransmitir_Todos")
            Case "DescripcionIva"
               Set oRsArch = oAp.TablasGenerales.TraerTodos("DescripcionIva")
            Case "Cotizaciones"
               Set oRsArch = oAp.Cotizaciones.TraerFiltrado("_ParaTransmitir")
            Case "Conjuntos"
               Set oRsArch = oAp.Conjuntos.TraerFiltrado("_Todos")
            Case "DetConjuntos"
               Set oRsArch = oAp.TablasGenerales.TraerFiltrado("DetConjuntos", "_Todos")
            Case "Choferes"
               Set oRsArch = oAp.Choferes.TraerFiltrado("_ParaTransmitir_Todos")
            Case "Fletes"
               Set oRsArch = oAp.Fletes.TraerFiltrado("_ParaTransmitir_Todos")
            Case "TarifasFletes"
               Set oRsArch = oAp.TarifasFletes.TraerFiltrado("_ParaTransmitir_Todos")
            Case Else
               mProcesado = False
         End Select
      
         If mProcesado Then If oRsArch.RecordCount > 0 Then sXML = ArmarXML(oRsArch)
         
         Set oRsDest = oAp.ArchivosATransmitirDestinos.TraerFiltrado("_ActivosPorSistema", "BALANZA")
         
         If Not oRsDest.RecordCount > 0 Then
            oRsDest.Close
            MsgBox "No hay destinos definidos para transmitir!", vbExclamation
            GoTo Salida
         End If
         
         oRsDest.MoveFirst
         Do While Not oRsDest.EOF
            mIdObra = 0
            If Not IsNull(oRsDest.Fields("IdObra").Value) Then
               mIdObra = oRsDest.Fields("IdObra").Value
            End If
                  
            Select Case mArchivo
               Case "SalidasMateriales"
                  Set oRsArch = oAp.SalidasMateriales.TraerFiltrado("_ParaTransmitir", mIdObra)
                  sXML = ""
                  If oRsArch.RecordCount > 0 Then sXML = ArmarXML(oRsArch)
               Case "DetRequerimientos"
                  Set oRsArch = oAp.TablasGenerales.TraerFiltrado("DetRequerimientos", "_ParaTransmitir", mIdObra)
                  sXML = ""
                  If oRsArch.RecordCount > 0 Then sXML = ArmarXML(oRsArch)
            End Select
            Set oRsArch = Nothing
            
            If Len(sXML) > 0 Then
               Set oRsLote = oAp.ArchivosATransmitirLoteo.TraerFiltrado("_UltimoLote", _
                     Array(oRsDest.Fields("IdArchivoATransmitirDestino").Value, oRs.Fields("IdArchivoATransmitir").Value))
               mNumeroLote = 1
               If oRsLote.RecordCount > 0 Then
                  If Not IsNull(oRsLote.Fields("Lote").Value) Then
                     mNumeroLote = oRsLote.Fields("Lote").Value + 1
                  End If
               End If
               oRsLote.Close
               
               mLote = Format(mNumeroLote, "00000")
               mLista = IIf(IsNull(oRsDest.Fields("Email").Value), "", oRsDest.Fields("Email").Value)
               mSubject = glbEmpresaSegunString & "_" & _
                        IIf(IsNull(oRsDest.Fields("Email").Value), "", oRsDest.Fields("Email").Value) & "_" & mArchivo & "_L" & mLote
               mBody = "" & vbCrLf & mArchivo & "."
               mAttachment = mPathSaliente & mSubject & ".XML"
               
               Set oXML = CreateObject("MSXML.DOMDocument")
               oXML.loadXML sXML
               oXML.Save mAttachment
               Set oXML = Nothing
            
               If mOutlook Then
                  lStatus = goMailOL.Send(mLista, True, mSubject, mBody, mAttachment)
               End If
               
               Set oTransmision = oAp.ArchivosATransmitirLoteo.Item(-1)
               With oTransmision.Registro
                  .Fields("IdArchivoATransmitir").Value = oRs.Fields("IdArchivoATransmitir").Value
                  .Fields("FechaTransmision").Value = Now
                  .Fields("IdArchivoATransmitirDestino").Value = oRsDest.Fields("IdArchivoATransmitirDestino").Value
                  .Fields("NumeroLote").Value = mNumeroLote
                  .Fields("Confirmado").Value = "NO"
               End With
               oTransmision.Guardar
               Set oTransmision = Nothing
            End If
            
            oRsDest.MoveNext
         Loop
         oRsDest.Close
         Set oRsDest = Nothing
         
         oRs.MoveNext
      Loop
   
      oRs.MoveFirst
      Do While Not oRs.EOF
         mArchivo = oRs.Fields("Tabla").Value
         
         Select Case mArchivo
            Case "Articulos"
               mSetear = "Articulos_TX_SetearComoTransmitido"
            Case "Rubros"
               mSetear = "Rubros_TX_SetearComoTransmitido"
            Case "Subrubros"
               mSetear = "Subrubros_TX_SetearComoTransmitido"
            Case "Familias"
               mSetear = "Familias_TX_SetearComoTransmitido"
            Case "Obras"
               mSetear = "Obras_TX_SetearComoTransmitido"
            Case "Equipos"
               mSetear = "Equipos_TX_SetearComoTransmitido"
            Case "DetEquipos"
               mSetear = "DetEquipos_TX_SetearComoTransmitido"
            Case "Planos"
               mSetear = "Planos_TX_SetearComoTransmitido"
            Case "ArchivosATransmitirDestinos"
            Case "Ubicaciones"
            Case "Depositos"
            Case "Proveedores"
               mSetear = "Proveedores_TX_SetearComoTransmitido"
            Case "Transportistas"
               mSetear = "Transportistas_TX_SetearComoTransmitido"
            Case "Pedidos"
               mSetear = "Pedidos_TX_SetearComoTransmitido"
            Case "DetPedidos"
               oAp.Tarea "DetPedidos_TX_SetearComoTransmitido", mIdObra
            Case "Localidades"
               mSetear = "Localidades_TX_SetearComoTransmitido"
            Case "Provincias"
               mSetear = "Provincias_TX_SetearComoTransmitido"
            Case "Paises"
               mSetear = "Paises_TX_SetearComoTransmitido"
            Case "Monedas"
               mSetear = "Monedas_TX_SetearComoTransmitido"
            Case "Sectores"
               mSetear = "Sectores_TX_SetearComoTransmitido"
            Case "Cuentas"
               mSetear = "Cuentas_TX_SetearComoTransmitido"
            Case "UnidadesOperativas"
               mSetear = "UnidadesOperativas_TX_SetearComoTransmitido"
            Case "Unidades"
            Case "SalidasMateriales"
               oAp.Tarea "SalidasMateriales_TX_SetearComoTransmitido", mIdObra
            Case "DetRequerimientos"
               oAp.Tarea "DetRequerimientos_TX_SetearComoTransmitido", mIdObra
         End Select
         
         If Len(mSetear) > 0 Then oAp.Tarea mSetear
         
         oRs.MoveNext
      Loop
   
   Else
      MsgBox "No hay archivos definidos para transmitir", vbExclamation
   End If

   oRs.Close
   
Salida:
   Unload oF
   Set oF = Nothing
   Set oRs = Nothing
   Set oRsArch = Nothing
   Set oRsDest = Nothing
   Set oRsLote = Nothing
   Set oAp = Nothing
   Set goMailOL = Nothing
   
   Exit Sub

Mal:
   MsgBox "Se ha producido un error al registrar los datos" & vbCrLf & Err.Number & " -> " & Err.Description, vbCritical
   Resume Salida

End Sub

Public Sub ImportarNovedades_PRONTO_BALANZA()

   Dim oAp As ComPronto.Aplicacion
   Dim oPar As ComPronto.Parametro
   Dim oRs As ADOR.Recordset
   Dim oRs1 As ADOR.Recordset
   Dim goMailOL As CEmailOL
   Dim oTransmision As ComPronto.ArchivoATransmitirLoteo
   Dim oF As Form
   Dim sXML As String, mLista As String, mSubject As String, mBody As String, mAttachment As String, mPathEntrante As String
   Dim mArchivos As String, mTipoPRONTO As String, mPuntoVenta As String, mArchivosAProcesar As String, mAuxS1 As String
   Dim mDatos1() As String
   Dim mDatos2() As String
   Dim mDatos3() As String
   Dim lStatus As Long, mLote As Long, mIdDestino As Long
   Dim i As Integer, j As Integer
   Dim mOk As Boolean, mOutlook As Boolean, mEsPuntoVenta As Boolean
   Dim est As EnumAcciones
   Dim oXML As MSXML.DOMDocument
   
'   On Error GoTo Mal
   
   mArchivosAProcesar = "(Recepciones)(DetalleRecepciones)(SalidasMateriales)(DetalleSalidasMateriales)"
   
   Set oF = New frm_Aux
   With oF
      .Text1.Visible = False
      .Label1.Visible = False
      With .Check1
         .Top = oF.Label1.Top
         .Left = oF.Label1.Left
         .Width = oF.Label1.Width * 2
         .Caption = "Leer desde Outlook :"
         .Visible = True
      End With
      .Caption = "Novedades desde " & mTipoPRONTO
      .Show vbModal, Me
      mOk = .Ok
      If .Check1.Value = 1 Then
         mOutlook = True
      Else
         mOutlook = False
      End If
   End With
   Unload oF
   If Not mOk Then Exit Sub
   
   Set oAp = Aplicacion
   
   Set oPar = oAp.Parametros.Item(1)
   mPathEntrante = oPar.Registro.Fields("PathRecepcionEmails").Value
   Set oPar = Nothing
   
   Set oF = New frmInformacion
   oF.Label1.Caption = "INCORPORACION DE INFORMACION ENVIADA DESDE BALANZA"
   oF.Show , Me
   
   If mOutlook Then
      Set goMailOL = New CEmailOL
      lStatus = goMailOL.Leer(mPathEntrante, oF)
   End If
   
   mArchivos = Dir(mPathEntrante & "*.XML", vbArchive)
   
   If Not mArchivos = "" Then
      Do While mArchivos <> ""
         mDatos3 = VBA.Split(mId$(mArchivos, 1, InStrRev(mArchivos, ".") - 1), "_")
         mAuxS1 = mDatos3(2)
         If UBound(mDatos3) > 3 Then
            mAuxS1 = mAuxS1 & "|" & mDatos3(4) & "|" & glbIdUsuario
         Else
            mAuxS1 = mAuxS1 & "|" & Year(Date) & Format(Month(Date), "00") & Format(Day(Date), "00") & "|" & glbIdUsuario
         End If
         
         oF.Label2.Caption = "Procesando archivo : " & mDatos3(2)
         DoEvents
         
         Set oXML = CreateObject("MSXML.DOMDocument")
         Set oRs = CreateObject("ADOR.Recordset")
         oXML.Load mPathEntrante & mArchivos
         oRs.Open oXML
         Set oXML = Nothing
         
         mIdDestino = 0
         If oRs.RecordCount > 0 Then
            oRs.MoveFirst
            mIdDestino = oRs.Fields("IdOrigenTransmision").Value
         End If
         est = oAp.TablasGenerales.ActualizacionEnLotes(mAuxS1, oRs, mIdDestino)
         oRs.Close
         Set oRs = Nothing
         
         Kill mPathEntrante & mArchivos
         
         If mIdDestino <> 0 And mOutlook Then
            mLista = oAp.ArchivosATransmitirDestinos.Item(mIdDestino).Registro.Fields("Email").Value
            mSubject = mId$(mArchivos, 1, InStrRev(mArchivos, ".") - 1) & "_Ok"
            mBody = "Ok." & vbCrLf
            mAttachment = ""
            lStatus = goMailOL.Send(mLista, True, mSubject, mBody, mAttachment)
         End If
         
         mArchivos = Dir
      Loop
   End If
   
Salida:
   Unload oF
   Set oF = Nothing
   Set oRs = Nothing
   Set oRs1 = Nothing
   Set oAp = Nothing
   Set goMailOL = Nothing
   
   Exit Sub

Mal:
   MsgBox "Se ha producido un error al registrar los datos" & vbCrLf & Err.Number & " -> " & Err.Description, vbCritical
   Resume Salida

End Sub

Public Sub PasarProveedorEventualADefinitivo()

   Dim Filas, Columnas
   Dim oF As frmProveedores
   
   
   Filas = VBA.Split(Lista.GetString, vbCrLf)
   Columnas = VBA.Split(Filas(1), vbTab)
   If IsNumeric(Columnas(2)) Then
      Set oF = New frmProveedores
      With oF
         .NivelAcceso = ControlAccesoNivel(Arbol.SelectedItem.Key)
         .OpcionesAcceso = ControlAccesoOpciones(Arbol.SelectedItem.Key)
         .DTPicker1(0).Value = Now
         .DTPicker1(1).Enabled = False
         .DTPicker1(2).Value = CDate("1/1/1980")
         .Option1.Value = True
         .Option8.Value = True
         .Option6.Value = True
         .Option13.Value = True
         .Option14.Value = True
         .Eventual = True
         .Id = Columnas(2)
         .Check1.Value = 1
         .Show vbModal, Me
      End With
      Unload oF
      Set oF = Nothing
   End If

End Sub

Public Function Ultimo_NodoTitulo() As String

   If Not Arbol.SelectedItem Is Nothing Then
      If Len(Arbol.SelectedItem.Tag) = 0 Then
         Ultimo_NodoTitulo = Arbol.SelectedItem.Text
      Else
         Ultimo_NodoTitulo = Arbol.SelectedItem.Tag
      End If
   End If

End Function

Public Sub MarcarOrdenesCompraComoCumplidas(ByVal Marca As String)

   Dim iFilas As Integer
   Dim Filas, Columnas
   
   Filas = VBA.Split(Lista.GetString, vbCrLf)
   For iFilas = LBound(Filas) + 1 To UBound(Filas)
      Columnas = VBA.Split(Filas(iFilas), vbTab)
      If IsNumeric(Columnas(2)) Then
         Aplicacion.Tarea "OrdenesCompra_MarcarComoCumplidas", Array(Columnas(2), Marca)
      End If
   Next
   Arbol_NodeClick Arbol.SelectedItem

End Sub

Public Sub EmisionEtiquetasArticulos(ByVal mGetString As String)

   Dim iFilas As Integer, mCopias As Integer
   Dim s As String
   Dim mImprimir As Boolean
   Dim Filas, Columnas
   
   Filas = VBA.Split(mGetString, vbCrLf)
   s = ""
   For iFilas = LBound(Filas) + 1 To UBound(Filas)
      Columnas = VBA.Split(Filas(iFilas), vbTab)
      If IsNumeric(Columnas(3)) Then
         s = s & Columnas(3) & ","
      End If
   Next
   If Len(s) > 0 Then s = mId(s, 1, Len(s) - 1)
   
   Dim mvarOK As Boolean
   Dim oF As frm_Aux
   
   Set oF = New frm_Aux
   With oF
      .Caption = "Emision de etiquetas"
      .Label1.Caption = "Copias x articulo:"
      With .Check1
         .Left = oF.Label2(1).Left
         .Top = oF.Label2(1).Top
         .Width = oF.Label2(1).Width * 2
         .Caption = "Enviar a impresora :"
         .Value = 1
         .Visible = True
      End With
      .Show vbModal, Me
      mvarOK = .Ok
      If .Check1.Value = 0 Then
         mImprimir = False
      Else
         mImprimir = True
      End If
      mCopias = Val(.Text1.Text)
      If mCopias = 0 Then mCopias = 1
   End With
   Unload oF
   Set oF = Nothing
   
   Me.Refresh
   If Not mvarOK Then
      Exit Sub
   End If
   
   On Error GoTo Mal
   
   Dim oW As Word.Application
   
   Set oW = CreateObject("Word.Application")
   
   With oW
      .Visible = True
      With .Documents.Add(glbPathPlantillas & "\EtiquetasArticulos_" & glbEmpresaSegunString)
         oW.Application.Run MacroName:="Emision", varg1:=glbStringConexion, varg2:=s, varg3:=mCopias
         If mImprimir Then
            oW.ActiveDocument.PrintOut False, , , , , , , mCopias
            .Close False
         End If
      End With
      If mImprimir Then .Quit
   End With

Salida:

   Me.MousePointer = vbDefault
   Set oW = Nothing
   Exit Sub

Mal:

   If mImprimir Then oW.Quit
   Me.MousePointer = vbDefault
   MsgBox "Se ha producido un error al imprimir ..." & vbCrLf & Err.Number & " " & Err.Description, vbCritical
   Resume Salida

End Sub

Public Sub EmisionEtiquetasArticulosZebra(ByVal mGetString As String)

   Dim iFilas As Integer, mCopias As Integer, i As Integer
   Dim mValRet As Long
   Dim s As String, mZebra As String, mImpresoraZebra As String, mLinea(1) As String
   Dim Filas, Columnas
   
   Dim mvarOK As Boolean
   Dim oF As frm_Aux
   
   Set oF = New frm_Aux
   With oF
      .Caption = "Emision de etiquetas"
      .Label1.Caption = "Copias x articulo:"
      With .Label2(1)
         .Caption = "Impresora :"
         .Visible = True
      End With
      With .Text2
         .Top = oF.DTFields(1).Top
         .Left = oF.DTFields(1).Left
         .Text = BuscarClaveINI("Direccion impresora Zebra")
         .Visible = True
      End With
      .Show vbModal, Me
      mvarOK = .Ok
      mCopias = Val(.Text1.Text)
      mImpresoraZebra = .Text2.Text
      If mCopias = 0 Then mCopias = 1
   End With
   Unload oF
   Set oF = Nothing
   
   Me.Refresh
   If Not mvarOK Then Exit Sub
   If Len(mImpresoraZebra) = 0 Then mImpresoraZebra = "lpt1"
   
'   On Error GoTo Mal
   
   Dim fso As New FileSystemObject
   
   Set fso = CreateObject("Scripting.FileSystemObject")

   mLinea(0) = BuscarClaveINI("Etiquetas Zebra Linea 1")
   mLinea(1) = BuscarClaveINI("Etiquetas Zebra Linea 2")
   
   Filas = VBA.Split(mGetString, vbCrLf)
   mZebra = "" & vbCrLf & "N" & vbCrLf
   For iFilas = LBound(Filas) + 1 To UBound(Filas)
      Columnas = VBA.Split(Filas(iFilas), vbTab)
'      If iFilas Mod 2 = 0 Then i = 1 Else i = 0
'      mZebra = mZebra & mLinea(i) & Chr(34) & Columnas(1) & Chr(34) & vbCrLf
'      If iFilas Mod 2 = 0 Then
'         mZebra = mZebra & "P" & mCopias & vbCrLf
'         GuardarArchivoSecuencial "c:\Zebra.txt", mZebra
'         fso.CopyFile "c:\Zebra.txt", mImpresoraZebra
'         mZebra = "" & vbCrLf & "N" & vbCrLf
'      End If
      If Len(mLinea(1)) = 0 Then
         mZebra = mZebra & mLinea(0) & Chr(34) & Columnas(1) & Chr(34) & vbCrLf & _
                  "P" & mCopias & vbCrLf
      Else
         mZebra = mZebra & mLinea(0) & Chr(34) & Columnas(1) & Chr(34) & vbCrLf & _
                  mLinea(1) & Chr(34) & Columnas(1) & Chr(34) & vbCrLf & _
                  "P" & mCopias & vbCrLf
      End If
      GuardarArchivoSecuencial "c:\Zebra.txt", mZebra

'GuardarArchivoSecuencial "c:\Zebra" & iFilas & ".txt", mZebra
'i = ShellExecute(0, "print", "c:\Zebra.txt", "", "", 0)
'i = Shell("c:\Imprime.bat", vbHide)

   EsperarShell ("c:\Imprime.bat")

'      fso.CopyFile "c:\Zebra.txt", mImpresoraZebra
      mZebra = "" & vbCrLf & "N" & vbCrLf
   Next
'   If iFilas Mod 2 = 0 Then
'      mZebra = mZebra & "P" & mCopias & vbCrLf
'      GuardarArchivoSecuencial "c:\Zebra.txt", mZebra
'      fso.CopyFile "c:\Zebra.txt", mImpresoraZebra
'   End If
   
Salida:

   Set fso = Nothing
   Me.MousePointer = vbDefault
   Exit Sub

Mal:

   Me.MousePointer = vbDefault
   MsgBox "Se ha producido un error al imprimir ..." & vbCrLf & Err.Number & " " & Err.Description, vbCritical
   Resume Salida

End Sub

Public Sub GeneracionDeFacturasDesdeOrdenesCompraAutomaticas()

   Dim oF As frmExcel1
   Set oF = New frmExcel1
   With oF
      .Codigo = "GenFac"
      .Titulo = "Generacion de facturas (desde ordenes de compra automaticas)"
      .Show vbModal, Me
   End With
   Unload oF
   Set oF = Nothing

End Sub

Public Sub ModificarVencimientosVentaEnCuotas()

   Dim oF As frm_Aux
   Dim oL As ListItem
   Dim oRs As ADOR.Recordset
   Dim Filas, Columnas
   Dim mvarOK As Boolean
   Dim mFecha1 As Date, mFecha2 As Date, mFecha3 As Date
   Dim mFechaVto1 As Date, mFechaVto2 As Date, mFechaVto3 As Date
   Dim mIdArticulo As Long
   
   Filas = VBA.Split(Lista.GetString, vbCrLf)
   Columnas = VBA.Split(Filas(1), vbTab)
            
   Set oF = New frm_Aux
   With oF
      .Caption = "Cambiar fechas de vto."
      .Text1.Visible = False
      .Label1.Visible = False
      With .Label2(2)
         .Top = oF.Label2(1).Top
         .Left = oF.Label2(1).Left
      End With
      With .DTFields(2)
         .Top = oF.DTFields(1).Top
         .Left = oF.DTFields(1).Left
      End With
      With .Label2(1)
         .Top = oF.Label1.Top
         .Left = oF.Label1.Left
      End With
      With .DTFields(1)
         .Top = oF.Text1.Top
         .Left = oF.Text1.Left
      End With
      With .Label2(0)
         .Caption = "1er. vto. :"
         .Visible = True
      End With
      With .Label2(1)
         .Caption = "2do. vto. :"
         .Visible = True
      End With
      With .Label2(2)
         .Caption = "3er. vto. :"
         .Visible = True
      End With
      With .DTFields(0)
         If IsDate(Columnas(6)) Then .Value = CDate(Columnas(6))
         .Visible = True
      End With
      With .DTFields(1)
         If IsDate(Columnas(7)) Then .Value = CDate(Columnas(7))
         .Visible = True
      End With
      With .DTFields(2)
         If IsDate(Columnas(8)) Then .Value = CDate(Columnas(8))
         .Visible = True
      End With
      .Show vbModal, Me
      mvarOK = .Ok
      mFecha1 = oF.DTFields(0).Value
      mFecha2 = oF.DTFields(1).Value
      mFecha3 = oF.DTFields(2).Value
   End With
   Unload oF
   Set oF = Nothing
   If Not mvarOK Then
      Exit Sub
   End If

   If IsNumeric(Columnas(4)) Then
      Set oRs = Aplicacion.VentasEnCuotas.TraerFiltrado("_CuotasGeneradasParaModificarVencimientos", Columnas(4))
      With oRs
         If .RecordCount > 0 Then
            .MoveFirst
            mIdArticulo = .Fields("IdArticulo").Value
            mFechaVto1 = mFecha1
            mFechaVto2 = mFecha2
            mFechaVto3 = mFecha3
            Do While Not .EOF
               If .Fields("IdArticulo").Value <> mIdArticulo Then
                  mFechaVto1 = mFecha1
                  mFechaVto2 = mFecha2
                  mFechaVto3 = mFecha3
                  mIdArticulo = .Fields("IdArticulo").Value
               End If
               Aplicacion.Tarea "VentasEnCuotas_ModificarVencimientos", _
                        Array(.Fields(0).Value, mFechaVto1, mFechaVto2, mFechaVto3)
               mFechaVto1 = DateAdd("m", 1, mFechaVto1)
               mFechaVto2 = DateAdd("m", 1, mFechaVto2)
               mFechaVto3 = DateAdd("m", 1, mFechaVto3)
               .MoveNext
            Loop
         End If
         .Close
      End With
      Set oRs = Nothing
      Lista.SelectedItem.ListSubItems(5) = "" & mFecha1
      Lista.SelectedItem.ListSubItems(6) = "" & mFecha2
      Lista.SelectedItem.ListSubItems(7) = "" & mFecha3
   End If
         
End Sub

Public Sub EliminarVentaEnCuotas()

   Dim oRs As ADOR.Recordset
   Dim mErrores As String
   Dim Filas, Columnas
   
   Filas = VBA.Split(Lista.GetString, vbCrLf)
   Columnas = VBA.Split(Filas(1), vbTab)

   mErrores = ""
   Set oRs = Aplicacion.VentasEnCuotas.TraerFiltrado("_NotasDebitoGeneradasPorIdVentaEnCuotas", Columnas(2))
   With oRs
      If .RecordCount > 0 Then
         .MoveFirst
         Do While Not .EOF
            mErrores = mErrores & vbCrLf & Format(.Fields("NumeroNotaDebito").Value, "00000000") & " " & _
                           "del " & .Fields("FechaNotaDebito").Value
            .MoveNext
         Loop
      End If
      .Close
   End With
   Set oRs = Nothing
   
   If Len(mErrores) > 0 Then
      MsgBox "No se puede eliminar el registro hasta anular " & vbCrLf & _
               "las siguientes notas de debito :" & mErrores
      Exit Sub
   End If
   
   Aplicacion.Tarea "VentasEnCuotas_Eliminar", Columnas(2)
   
   Set Lista.DataSource = Aplicacion.VentasEnCuotas.TraerTodos
   
   MsgBox "Venta en cuotas anulada"

End Sub

Public Sub EmitirFacturas(ByVal Destino As Integer)

   Dim mPlantilla As String, mCampo As String, mAgrupar As String
   Dim mvarConfirmarClausulaDolar As String, mArgL1 As String
   Dim oRs As ADOR.Recordset
   
   Set oRs = Aplicacion.Parametros.TraerFiltrado("_PorId", 1)
   If oRs.RecordCount > 0 Then
      mvarConfirmarClausulaDolar = IIf(IsNull(oRs.Fields("ConfirmarClausulaDolar").Value), "NO", oRs.Fields("ConfirmarClausulaDolar").Value)
   End If
   oRs.Close
   
   Dim mvarClausula As Boolean, mOk As Boolean
   mvarClausula = False
   mAgrupar = BuscarClaveINI("Agrupar items en factura")
   If mvarConfirmarClausulaDolar = "SI" Or Len(mAgrupar) <> 0 Then
      Dim of1 As frm_Aux
      Set of1 = New frm_Aux
      With of1
         .Caption = "Emision de factura"
         .Label1.Visible = False
         .Text1.Visible = False
         With .Frame1
            .Caption = "Emite clausula dolar ? : "
            .Top = of1.Label1.Top
            .Visible = True
         End With
         .Option1.Caption = "SI"
         .Option1.Value = True
         .Option2.Caption = "NO"
         If Len(mAgrupar) <> 0 Then
            With .Check1
               .Top = of1.Frame1.Top + of1.Frame1.Height + 100
               .Left = of1.Frame1.Left
               .Width = of1.Frame1.Width / 2
               .Caption = "Agrupar items"
               If mAgrupar = "SI" Then
                  .Value = 1
               Else
                  .Value = 0
               End If
               .Visible = True
            End With
         End If
         .Show vbModal, Me
         mOk = .Ok
         mvarClausula = .Option1.Value
         If Len(mAgrupar) <> 0 Then
            If .Check1.Value = 1 Then
               mAgrupar = "SI"
            Else
               mAgrupar = "NO"
            End If
         End If
      End With
      Unload of1
      Set of1 = Nothing
      Me.Refresh
      If Not mOk Then Exit Sub
   End If
   
   Dim mCopias As Integer
   Dim mPrinter As String, mPrinterAnt As String
   
   mPrinterAnt = Printer.DeviceName & " on " & Printer.Port
   
   If Destino = 0 Then
      Dim oF As frmImpresion
      Set oF = New frmImpresion
      With oF
         .txtCopias.Text = 1
         .Show vbModal, Me
      End With
      mOk = oF.Ok
      mCopias = Val(oF.txtCopias.Text)
      mPrinter = oF.Combo1.Text
      Unload oF
      Set oF = Nothing
      If Not mOk Then Exit Sub
      Me.Refresh
   Else
      mCopias = 1
   End If
   
   mArgL1 = BuscarClaveINI("Conceptos para detallar dominios en factura")
   
   Dim oW As Word.Application
   Dim iFilas As Integer, mIds As String, mPID As String
   Dim Filas
   Dim Columnas
   
   On Error GoTo Mal
   
   Me.MousePointer = vbHourglass
   DoEvents
   
   If Destino = 0 Then CargaProcesosEnEjecucion
   Set oW = CreateObject("Word.Application")
   If Destino = 0 Then mPID = ObtenerPIDProcesosLanzados
   
   Filas = VBA.Split(Lista.GetString, vbCrLf)
   For iFilas = LBound(Filas) + 1 To UBound(Filas)
      Columnas = VBA.Split(Filas(iFilas), vbTab)
      
      mPlantilla = "N/A"
      Set oRs = Aplicacion.Parametros.TraerFiltrado("_PorId", 1)
      If oRs.RecordCount > 0 Then
         mCampo = "Plantilla_Factura_" & Columnas(1)
         If Not IsNull(oRs.Fields(mCampo).Value) And Len(oRs.Fields(mCampo).Value) > 0 Then mPlantilla = oRs.Fields(mCampo).Value
      End If
      oRs.Close
      
      Set oRs = Aplicacion.Facturas.TraerFiltrado("_PorId", Columnas(2))
      If Not IsNull(oRs.Fields("CAE").Value) Then
         mPlantilla = mId(mPlantilla, 1, Len(mPlantilla) - 4) & "_FA" & mId(mPlantilla, Len(mPlantilla) - 3, 4)
      End If
      oRs.Close
      
      If Not Len(Trim(Dir(glbPathPlantillas & "\" & mPlantilla))) <> 0 Then
         MsgBox "No existe la plantilla de impresion, definala en la tabla de parametros.", vbExclamation
         Exit Sub
      End If
   
      With oW
         .Visible = True
         .Documents.Add (glbPathPlantillas & "\" & mPlantilla)
         If Len(mAgrupar) <> 0 Then
            .Application.Run MacroName:="Emision", varg1:=glbStringConexion, varg2:=Columnas(2), _
                  varg3:=mvarClausula, varg4:=mPrinter, varg5:=mCopias, varg6:=mAgrupar & "|" & mArgL1
         Else
            .Application.Run MacroName:="Emision", varg1:=glbStringConexion, varg2:=Columnas(2), _
                  varg3:=mvarClausula, varg4:=mPrinter, varg5:=mCopias
         End If
         If Destino = 0 Then
            oW.Documents(1).Close False
            'oW.Quit
         End If
      End With
   Next
   
   If Destino = 0 Then
      If glbTerminarProcesosOffice Then
         TerminarProceso mPID
      Else
         oW.Quit
      End If
   End If
   
   GoTo Salida
   
Mal:
   Me.MousePointer = vbDefault
   MsgBox "Se ha producido un error al imprimir ..." & vbCrLf & Err.Number & " " & Err.Description, vbCritical

Salida:
   Set oW = Nothing
   Set oRs = Nothing
   Me.MousePointer = vbDefault

End Sub

Public Sub EliminarFacturasAnuladas()

   Dim oL As ListItem
   Dim Filas, Columnas, mVector
   Dim iFilas As Integer
   Dim mCadena As String
   Dim mBorro As Boolean
   
   Me.MousePointer = vbHourglass
   DoEvents

   mBorro = False
   
   Filas = VBA.Split(Lista.GetString, vbCrLf)
   
   For iFilas = LBound(Filas) + 1 To UBound(Filas)
      Columnas = VBA.Split(Filas(iFilas), vbTab)
      If Columnas(5) = "SI" Then
         Aplicacion.Tarea "Facturas_EliminarFacturaAnulada", Columnas(2)
         mBorro = True
      End If
   Next
   
   If mBorro Then
      MsgBox "Proceso concluido, vuelva a seleccionar facturas para actualizar la lista"
   End If
   
   Me.MousePointer = vbDefault

End Sub

Public Sub EmitirNotasCredito(ByVal Destino As Integer)

   Dim mPlantilla As String, mCampo As String, mvarConfirmarClausulaDolar As String
   Dim mPrinter As String, mPrinterAnt As String
   Dim mOk As Boolean, mvarClausula As Boolean
   Dim mCopias As Integer
   Dim oRs As ADOR.Recordset
   
   mvarConfirmarClausulaDolar = ""
   Set oRs = Aplicacion.Parametros.TraerFiltrado("_PorId", 1)
   If oRs.RecordCount > 0 Then
      mvarConfirmarClausulaDolar = IIf(IsNull(oRs.Fields("ConfirmarClausulaDolar").Value), "NO", oRs.Fields("ConfirmarClausulaDolar").Value)
   End If
   oRs.Close
   
   If mvarConfirmarClausulaDolar = "SI" Then
      Dim of1 As frm_Aux
      Set of1 = New frm_Aux
      With of1
         .Caption = "Emision de nota de credito"
         .Label1.Visible = False
         .Text1.Visible = False
         With .Frame1
            .Caption = "Emite clausula dolar ? : "
            .Top = of1.Label1.Top
            .Visible = True
         End With
         .Option1.Caption = "SI"
         .Option1.Value = True
         .Option2.Caption = "NO"
         .Show vbModal, Me
         mOk = .Ok
         mvarClausula = .Option1.Value
      End With
      Unload of1
      Set of1 = Nothing
      Me.Refresh
      If Not mOk Then Exit Sub
   End If
   
   mPrinterAnt = Printer.DeviceName & " on " & Printer.Port
   
   If Destino = 0 Then
      Dim oF As frmImpresion
      Set oF = New frmImpresion
      With oF
         .txtCopias.Text = 1
         .Show vbModal, Me
      End With
      mOk = oF.Ok
      mCopias = Val(oF.txtCopias.Text)
      mPrinter = oF.Combo1.Text
      Unload oF
      Set oF = Nothing
      If Not mOk Then Exit Sub
      Me.Refresh
   Else
      mCopias = 1
   End If
   
   Dim oW As Word.Application
   Dim iFilas As Integer, mIds As String, mPID As String
   Dim Filas
   Dim Columnas
   
   On Error GoTo Mal
   
   Me.MousePointer = vbHourglass
   DoEvents
   
   If Destino = 0 Then CargaProcesosEnEjecucion
   Set oW = CreateObject("Word.Application")
   If Destino = 0 Then mPID = ObtenerPIDProcesosLanzados
   
   Filas = VBA.Split(Lista.GetString, vbCrLf)
   For iFilas = LBound(Filas) + 1 To UBound(Filas)
      Columnas = VBA.Split(Filas(iFilas), vbTab)
      
      mPlantilla = "N/A"
      Set oRs = Aplicacion.Parametros.TraerFiltrado("_PorId", 1)
      If oRs.RecordCount > 0 Then
         mCampo = "Plantilla_NotasCredito_" & Columnas(3)
         If Not IsNull(oRs.Fields(mCampo).Value) And Len(oRs.Fields(mCampo).Value) > 0 Then
            mPlantilla = oRs.Fields(mCampo).Value
         End If
      End If
      oRs.Close
      
      Set oRs = Aplicacion.NotasCredito.TraerFiltrado("_PorId", Columnas(2))
      If Not IsNull(oRs.Fields("CAE").Value) Then
         mPlantilla = mId(mPlantilla, 1, Len(mPlantilla) - 4) & "_FA" & mId(mPlantilla, Len(mPlantilla) - 3, 4)
      End If
      oRs.Close
      
      If Not Len(Trim(Dir(glbPathPlantillas & "\" & mPlantilla))) <> 0 Then
         MsgBox "No existe la plantilla de impresion, definala en la tabla de parametros.", vbExclamation
         Exit Sub
      End If
   
      With oW
         .Visible = True
         .Documents.Add (glbPathPlantillas & "\" & mPlantilla)
         .Application.Run MacroName:="Emision", varg1:=glbStringConexion, varg2:=Columnas(2), _
               varg3:=mvarClausula, varg4:=mPrinter, varg5:=mCopias
         If Destino = 0 Then
            oW.Documents(1).Close False
            'oW.Quit
         End If
      End With
   Next
   
   If Destino = 0 Then
      If glbTerminarProcesosOffice Then
         TerminarProceso mPID
      Else
         oW.Quit
      End If
   End If
   
   GoTo Salida
   
Mal:
   Me.MousePointer = vbDefault
   MsgBox "Se ha producido un error al imprimir ..." & vbCrLf & Err.Number & " " & Err.Description, vbCritical

Salida:
   Set oW = Nothing
   Set oRs = Nothing
   Me.MousePointer = vbDefault

End Sub

Public Sub EmitirNotasDebito(ByVal Destino As Integer)

   Dim mPlantilla As String, mCampo As String, mvarConfirmarClausulaDolar As String
   Dim mPrinter As String, mPrinterAnt As String
   Dim mOk As Boolean, mvarClausula As Boolean
   Dim mCopias As Integer
   Dim oRs As ADOR.Recordset
   
   mvarConfirmarClausulaDolar = ""
   Set oRs = Aplicacion.Parametros.TraerFiltrado("_PorId", 1)
   If oRs.RecordCount > 0 Then
      mvarConfirmarClausulaDolar = IIf(IsNull(oRs.Fields("ConfirmarClausulaDolar").Value), "NO", oRs.Fields("ConfirmarClausulaDolar").Value)
   End If
   oRs.Close
   
   If mvarConfirmarClausulaDolar = "SI" Then
      Dim of1 As frm_Aux
      Set of1 = New frm_Aux
      With of1
         .Caption = "Emision de nota de debito"
         .Label1.Visible = False
         .Text1.Visible = False
         With .Frame1
            .Caption = "Emite clausula dolar ? : "
            .Top = of1.Label1.Top
            .Visible = True
         End With
         .Option1.Caption = "SI"
         .Option1.Value = True
         .Option2.Caption = "NO"
         .Show vbModal, Me
         mOk = .Ok
         mvarClausula = .Option1.Value
      End With
      Unload of1
      Set of1 = Nothing
      Me.Refresh
      If Not mOk Then Exit Sub
   End If
   
   mPrinterAnt = Printer.DeviceName & " on " & Printer.Port
   
   If Destino = 0 Then
      Dim oF As frmImpresion
      Set oF = New frmImpresion
      With oF
         .txtCopias.Text = 1
         .Show vbModal, Me
      End With
      mOk = oF.Ok
      mCopias = Val(oF.txtCopias.Text)
      mPrinter = oF.Combo1.Text
      Unload oF
      Set oF = Nothing
      If Not mOk Then Exit Sub
      Me.Refresh
   Else
      mCopias = 1
   End If
   
   Dim oW As Word.Application
   Dim iFilas As Integer, mIds As String, mPID As String
   Dim Filas
   Dim Columnas
   
   On Error GoTo Mal
   
   Me.MousePointer = vbHourglass
   DoEvents
   
   If Destino = 0 Then CargaProcesosEnEjecucion
   Set oW = CreateObject("Word.Application")
   If Destino = 0 Then mPID = ObtenerPIDProcesosLanzados
   
   Filas = VBA.Split(Lista.GetString, vbCrLf)
   For iFilas = LBound(Filas) + 1 To UBound(Filas)
      Columnas = VBA.Split(Filas(iFilas), vbTab)
      
      mPlantilla = "N/A"
      Set oRs = Aplicacion.Parametros.TraerFiltrado("_PorId", 1)
      If oRs.RecordCount > 0 Then
         mCampo = "Plantilla_NotasDebito_" & Columnas(3)
         If Not IsNull(oRs.Fields(mCampo).Value) And Len(oRs.Fields(mCampo).Value) > 0 Then
            mPlantilla = oRs.Fields(mCampo).Value
         End If
      End If
      oRs.Close
      
      Set oRs = Aplicacion.NotasDebito.TraerFiltrado("_PorId", Columnas(2))
      If Not IsNull(oRs.Fields("CAE").Value) Then
         mPlantilla = mId(mPlantilla, 1, Len(mPlantilla) - 4) & "_FA" & mId(mPlantilla, Len(mPlantilla) - 3, 4)
      End If
      oRs.Close
      
      If Not Len(Trim(Dir(glbPathPlantillas & "\" & mPlantilla))) <> 0 Then
         MsgBox "No existe la plantilla de impresion, definala en la tabla de parametros.", vbExclamation
         Exit Sub
      End If
   
      With oW
         .Visible = True
         .Documents.Add (glbPathPlantillas & "\" & mPlantilla)
         .Application.Run MacroName:="Emision", varg1:=glbStringConexion, varg2:=Columnas(2), _
               varg3:=mvarClausula, varg4:=mPrinter, varg5:=mCopias
         If Destino = 0 Then
            oW.Documents(1).Close False
            'oW.Quit
         End If
      End With
   Next
   
   If Destino = 0 Then
      If glbTerminarProcesosOffice Then
         TerminarProceso mPID
      Else
         oW.Quit
      End If
   End If
   
   GoTo Salida
   
Mal:
   Me.MousePointer = vbDefault
   MsgBox "Se ha producido un error al imprimir ..." & vbCrLf & Err.Number & " " & Err.Description, vbCritical

Salida:
   Set oW = Nothing
   Set oRs = Nothing
   Me.MousePointer = vbDefault

End Sub

Public Sub ImportacionCobranzasPagoFacil()

   Dim oAp As ComPronto.Aplicacion
   Dim oRec As ComPronto.Recibo
   Dim oPto As ComPronto.PuntoVenta
   Dim oRsAux1 As ADOR.Recordset
   Dim oF As Form
   Dim i As Integer, mIdMonedaPesos As Integer, mIdMonedaDolar As Integer
   Dim mIdPuntoVenta As Integer, mPuntoVenta As Integer, mIdMoneda As Integer
   Dim mCodigoDebeHaber As Integer, mIdTipoComprobante As Integer
   Dim mImporte As Double, mDebe As Double, mHaber As Double, mTotalValores As Double
   Dim mNumeroValor As Double, mCotizacionMoneda As Double, mCotizacion As Double
   Dim mNumeroRecibo As Long, mCodigo As Long, mCodigoCuenta As Long, mIdCuenta As Long
   Dim mIdCaja As Long, mNumeroInterno As Long, mCodigoBanco As Long, mIdBanco As Long
   Dim mIdCuentaBancaria As Long, mIdCuentaValores As Long, mLote As Long, mSublote As Long
   Dim mIdImputacion As Long, mIdCliente As Long, mIdComprobante As Long
   Dim mIdVendedor As Long, mIdCobrador As Long, mIdRubroContable As Long
   Dim mArchivo As String, mError As String, mCuentaBanco As String, mAuxStr1 As String
   Dim mFecha As Date, mFechaVencimiento As Date, mFechaLote As Date
   Dim mOk As Boolean, mConProblemas As Boolean
   Dim Filas, Columnas, mVector

   On Error GoTo Mal

   Set oF = New frmPathPresto
   With oF
      .Id = 8
      .Show vbModal
      mOk = .Ok
      If mOk Then
         mArchivo = .FileBrowser1(0).Text
      End If
   End With
   Unload oF
   Set oF = Nothing

   If Not mOk Then Exit Sub

   If Len(mArchivo) = 0 Then
      MsgBox "No indico el archivo a procesar", vbExclamation
      Exit Sub
   End If
   
   Set oAp = Aplicacion

   Set oRsAux1 = oAp.Parametros.TraerFiltrado("_PorId", 1)
   mIdMonedaPesos = oRsAux1.Fields("IdMoneda").Value
   mIdMonedaDolar = oRsAux1.Fields("IdMonedaDolar").Value
   mIdCuentaValores = IIf(IsNull(oRsAux1.Fields("IdCuentaValores").Value), 0, oRsAux1.Fields("IdCuentaValores").Value)
   oRsAux1.Close
   
   mAuxStr1 = BuscarClaveINI("Punto de venta cobranza pago facil")
   mPuntoVenta = 0
   If IsNumeric(mAuxStr1) Then mPuntoVenta = CLng(mAuxStr1)
   
   mIdPuntoVenta = 0
   If mPuntoVenta = 0 Then
      Set oRsAux1 = oAp.PuntosVenta.TraerFiltrado("_PorIdTipoComprobante", 2)
   Else
      Set oRsAux1 = oAp.PuntosVenta.TraerFiltrado("_PorIdTipoComprobantePuntoVenta", Array(2, mPuntoVenta))
   End If
   If oRsAux1.RecordCount > 0 Then
      mIdPuntoVenta = oRsAux1.Fields(0).Value
      mPuntoVenta = oRsAux1.Fields("PuntoVenta").Value
   End If
   oRsAux1.Close
   If mIdPuntoVenta = 0 Then
      MsgBox "No tiene definido un punto de venta para los recibos", vbExclamation
      GoTo Salida
   End If
   
   mIdCaja = 0
   Set oRsAux1 = oAp.Parametros.TraerFiltrado("_PorId", 1)
   If oRsAux1.RecordCount > 0 Then
      If Not IsNull(oRsAux1.Fields("IdCajaEnPesosDefault").Value) Then
         mIdCaja = oRsAux1.Fields("IdCajaEnPesosDefault").Value
      Else
         MsgBox "No tiene definido la caja default en los parametros", vbExclamation
         GoTo Salida
      End If
   End If
   oRsAux1.Close
   
   mAuxStr1 = BuscarClaveINI("IdRubroContable Importacion cobranzas")
   mIdRubroContable = 0
   If IsNumeric(mAuxStr1) Then mIdRubroContable = CLng(mAuxStr1)
   
   Set oF = New frmAviso
   With oF
      .Label1 = "Iniciando importacion ..."
      .Show
      .Refresh
      DoEvents
   End With

   oF.Label1 = oF.Label1 & vbCrLf & "Procesando ingresos en efectivo ..."
   oF.Label2 = ""
   oF.Label3 = ""
   DoEvents

   mConProblemas = False
   mError = ""
   mTotalValores = 0
   
   Filas = VBA.Split(LeerArchivoSecuencial(mArchivo), vbCrLf)
   If UBound(Filas) > 0 Then
      
      For i = 0 To UBound(Filas)
         
         If VBA.mId(Filas(i), 1, 1) = "5" Or VBA.mId(Filas(i), 1, 1) = "8" Or _
               VBA.mId(Filas(i), 1, 1) = "9" Then
            If Not oRec Is Nothing Then
               If Not mConProblemas Then
                  Set oPto = oAp.PuntosVenta.Item(mIdPuntoVenta)
                  With oPto
                     mNumeroRecibo = .Registro.Fields("ProximoNumero").Value
                     .Registro.Fields("ProximoNumero").Value = mNumeroRecibo + 1
                     .Guardar
                  End With
                  Set oPto = Nothing
                  
                  With oRec
                     With .Registro
                        .Fields("NumeroRecibo").Value = mNumeroRecibo
                        .Fields("Valores").Value = mTotalValores
                        .Fields("Deudores").Value = mTotalValores
                        .Fields("FechaIngreso").Value = Now
                     End With
                     With .DetRecibosRubrosContables.Item(-1)
                        With .Registro
                           .Fields("IdRubroContable").Value = mIdRubroContable
                           .Fields("Importe").Value = mTotalValores
                        End With
                        .Modificado = True
                     End With
                     .Guardar
                  End With
               End If
               Set oRec = Nothing
            End If
         End If
         
         Select Case VBA.mId(Filas(i), 1, 1)
            
            Case "3"
            
               mFechaLote = CDate(mId(Filas(i), 8, 2) & "/" & mId(Filas(i), 6, 2) & "/" & mId(Filas(i), 2, 4))
               mLote = CLng(mId(Filas(i), 10, 6))
            
            Case "5"
               
               mConProblemas = False
               mTotalValores = 0
               
               mFecha = CDate(mId(Filas(i), 15, 2) & "/" & mId(Filas(i), 13, 2) & "/" & mId(Filas(i), 9, 4))
               mSublote = CLng(mId(Filas(i), 2, 5))
               mIdMoneda = mIdMonedaPesos
               
               mIdComprobante = CLng(mId(Filas(i), 27, 12))
               mIdTipoComprobante = CInt(mId(Filas(i), 25, 2))
               mIdCliente = 0
               Select Case mIdTipoComprobante
                  Case 1
                     Set oRsAux1 = oAp.Facturas.TraerFiltrado("_PorId", mIdComprobante)
                     If oRsAux1.RecordCount > 0 Then mIdCliente = oRsAux1.Fields("IdCliente").Value
                     oRsAux1.Close
                  Case 3, 4
                     Set oRsAux1 = oAp.NotasDebito.TraerFiltrado("_PorId", mIdComprobante)
                     If oRsAux1.RecordCount > 0 Then mIdCliente = oRsAux1.Fields("IdCliente").Value
                     oRsAux1.Close
'                  Case 4
'                     Set oRsAux1 = oAp.NotasCredito.TraerFiltrado("_PorId", mIdComprobante)
'                     If oRsAux1.RecordCount > 0 Then mIdCliente = oRsAux1.Fields("IdCliente").Value
'                     oRsAux1.Close
               End Select
               If mIdCliente = 0 Then
                  mError = mError & vbCrLf & "No se encontro el cliente/comprobante y no fue tomado"
                  mConProblemas = True
               End If
               
               mIdVendedor = 0
               mIdCobrador = 0
               If mIdCliente <> 0 Then
                  Set oRsAux1 = oAp.Clientes.TraerFiltrado("_PorId", mIdCliente)
                  If oRsAux1.RecordCount > 0 Then
                     mIdVendedor = IIf(IsNull(oRsAux1.Fields("Vendedor1").Value), 0, oRsAux1.Fields("Vendedor1").Value)
                     mIdCobrador = IIf(IsNull(oRsAux1.Fields("Cobrador").Value), 0, oRsAux1.Fields("Cobrador").Value)
                  End If
                  oRsAux1.Close
               End If
               
               Set oRsAux1 = oAp.Recibos.TraerFiltrado("_LoteSublote", Array(mLote, mSublote, mFechaLote))
               If oRsAux1.RecordCount > 0 Then
                  mError = mError & vbCrLf & "Un recibo ya existe y no fue tomado"
                  mConProblemas = True
               End If
               oRsAux1.Close
               
               mCotizacion = Cotizacion(mFecha, mIdMonedaDolar)
               If mCotizacion = 0 Then
                  mError = mError & vbCrLf & "No hay cotizacion ingresada el " & mFecha & " y los recibos de esa fecha no fueron tomados"
                  mConProblemas = True
               End If
               
               If mIdMonedaPesos = mIdMoneda Then
                  mCotizacionMoneda = 1
               Else
                  mCotizacionMoneda = Cotizacion(mFecha, mIdMoneda)
                  If mCotizacionMoneda = 0 Then
                     mError = mError & vbCrLf & "El recibo " & mNumeroRecibo & " no tiene cotizacion para la moneda y no fue tomado"
                     mConProblemas = True
                  End If
               End If
               
               Set oRec = oAp.Recibos.Item(-1)
               With oRec
                  With .Registro
                     .Fields("FechaRecibo").Value = mFecha
                     .Fields("IdPuntoVenta").Value = mIdPuntoVenta
                     .Fields("PuntoVenta").Value = mPuntoVenta
                     .Fields("IdCliente").Value = mIdCliente
                     .Fields("Tipo").Value = "CC"
                     .Fields("Documentos").Value = 0
                     .Fields("Otros1").Value = 0
                     .Fields("Otros2").Value = 0
                     .Fields("Otros3").Value = 0
                     .Fields("Otros4").Value = 0
                     .Fields("Otros5").Value = 0
                     .Fields("RetencionIVA").Value = 0
                     .Fields("RetencionGanancias").Value = 0
                     .Fields("RetencionIBrutos").Value = 0
                     .Fields("GastosGenerales").Value = 0
                     .Fields("Cotizacion").Value = mCotizacion
                     .Fields("IdMoneda").Value = mIdMoneda
                     .Fields("Dolarizada").Value = "NO"
                     .Fields("AsientoManual").Value = "NO"
                     .Fields("CotizacionMoneda").Value = mCotizacionMoneda
                     .Fields("IdUsuarioIngreso").Value = glbIdUsuario
                     .Fields("Lote").Value = mLote
                     .Fields("Sublote").Value = mSublote
                     .Fields("IdVendedor").Value = mIdVendedor
                     .Fields("IdCobrador").Value = mIdCobrador
                     .Fields("FechaLote").Value = mFechaLote
                  End With
               End With
               
            Case "6"
               
               If Not oRec Is Nothing Then
                  mIdTipoComprobante = CInt(mId(Filas(i), 19, 2))
                  If mIdTipoComprobante = 4 Then mIdTipoComprobante = 3
                  mIdComprobante = CLng(mId(Filas(i), 21, 12))
                  mIdImputacion = 0
                  Set oRsAux1 = oAp.CtasCtesD.TraerFiltrado("_BuscarComprobante", Array(mIdComprobante, mIdTipoComprobante))
                  If oRsAux1.RecordCount > 0 Then
                     mIdImputacion = oRsAux1.Fields(0).Value
                  End If
                  mImporte = CDbl(mId(Filas(i), 6, 8)) / 100
                  With oRec.DetRecibos.Item(-1)
                     With .Registro
                        .Fields("IdImputacion").Value = mIdImputacion
                        .Fields("Importe").Value = mImporte
                     End With
                     .Modificado = True
                  End With
               End If
            
            Case "7"
               
               If Not oRec Is Nothing Then
                  If mId(Filas(i), 5, 1) = "E" Then
                     mImporte = CDbl(mId(Filas(i), 86, 15)) / 100
                     oRec.Registro.Fields("Efectivo").Value = 0
                     With oRec.DetRecibosValores.Item(-1)
                        With .Registro
                           .Fields("IdTipoValor").Value = 32
                           .Fields("IdCaja").Value = mIdCaja
                           .Fields("Importe").Value = mImporte
                        End With
                        .Modificado = True
                     End With
                     mTotalValores = mTotalValores + mImporte
                  
                  ElseIf mId(Filas(i), 5, 1) = "C" Then
                     mNumeroInterno = 0
                     mCodigoBanco = CLng(mId(Filas(i), 6, 3))
                     mNumeroValor = CDbl(mId(Filas(i), 16, 8))
                     mFechaVencimiento = mFecha
                     mImporte = CDbl(mId(Filas(i), 86, 15)) / 100
                     
                     mIdBanco = 0
                     Set oRsAux1 = oAp.Bancos.TraerFiltrado("_PorCodigoUnico", mCodigoBanco)
                     If oRsAux1.RecordCount > 0 Then
                        mIdBanco = oRsAux1.Fields(0).Value
                     Else
                        mError = mError & vbCrLf & "El recibo " & mNumeroRecibo & " tiene un valor de terceros de un banco invalido y no fue tomado (CH)"
                        mConProblemas = True
                     End If
                     oRsAux1.Close
                     
                     With oRec.DetRecibosValores.Item(-1)
                        With .Registro
                           .Fields("IdTipoValor").Value = 6
                           .Fields("NumeroValor").Value = mNumeroValor
                           .Fields("NumeroInterno").Value = mNumeroInterno
                           .Fields("FechaVencimiento").Value = mFechaVencimiento
                           .Fields("IdBanco").Value = mIdBanco
                           .Fields("Importe").Value = mImporte
                        End With
                        .Modificado = True
                     End With
                     mTotalValores = mTotalValores + mImporte
                  End If
               End If
                     
         End Select
            
      Next
      
   End If
            
   If Len(mError) > 0 Then
      MsgBox "El proceso reporta los siguientes problemas :" & mError
   End If

Salida:

   On Error Resume Next
   Unload oF
   Set oF = Nothing

   Set oRsAux1 = Nothing
   Set oRec = Nothing
   Set oPto = Nothing
   Set oAp = Nothing

   Exit Sub

Mal:

   MsgBox "Se ha producido un error al registrar los datos" & vbCrLf & Err.Number & " -> " & Err.Description, vbCritical
   Resume Salida

End Sub

Public Sub ImportacionCobranzasSantanderRio()

   Dim oAp As ComPronto.Aplicacion
   Dim oRec As ComPronto.Recibo
   Dim oPto As ComPronto.PuntoVenta
   Dim oRsAux1 As ADOR.Recordset
   Dim oF As Form
   Dim i As Integer, mIdMonedaPesos As Integer, mIdMonedaDolar As Integer
   Dim mIdPuntoVenta As Integer, mPuntoVenta As Integer, mIdMoneda As Integer
   Dim mCodigoDebeHaber As Integer, mIdTipoComprobante As Integer
   Dim mImporte As Double, mDebe As Double, mHaber As Double, mTotalValores As Double
   Dim mNumeroValor As Double, mCotizacionMoneda As Double, mCotizacion As Double
   Dim mNumeroRecibo As Long, mCodigo As Long, mCodigoCuenta As Long, mIdCuenta As Long
   Dim mIdCaja As Long, mNumeroInterno As Long, mCodigoBanco As Long, mIdBanco As Long
   Dim mIdCuentaBancaria As Long, mIdCuentaValores As Long, mLote As Long, mSublote As Long
   Dim mIdImputacion As Long, mIdCliente As Long, mIdComprobante As Long, mIdRubroContable As Long
   Dim mIdCuentaBancariaTransferencia As Long, mIdBancoTransferencia As Long, mIdCuentaBanco As Long
   Dim mIdVendedor As Long, mIdCobrador As Long
   Dim mArchivo As String, mError As String, mCuentaBanco As String, mAuxStr1 As String
   Dim mIdentificador As String, mCliente As String
   Dim mFecha As Date, mFechaVencimiento As Date, mFechaLote As Date
   Dim mOk As Boolean, mConProblemas As Boolean
   Dim Filas, Columnas, mVector

   On Error GoTo Mal

   Set oF = New frmPathPresto
   With oF
      .Id = 15
      .Show vbModal
      mOk = .Ok
      If mOk Then
         mArchivo = .FileBrowser1(0).Text
      End If
   End With
   Unload oF
   Set oF = Nothing

   If Not mOk Then Exit Sub

   If Len(mArchivo) = 0 Then
      MsgBox "No indico el archivo a procesar", vbExclamation
      Exit Sub
   End If
   
   Set oAp = Aplicacion

   Set oRsAux1 = oAp.Parametros.TraerFiltrado("_PorId", 1)
   mIdMonedaPesos = oRsAux1.Fields("IdMoneda").Value
   mIdMonedaDolar = oRsAux1.Fields("IdMonedaDolar").Value
   mIdCuentaValores = IIf(IsNull(oRsAux1.Fields("IdCuentaValores").Value), 0, oRsAux1.Fields("IdCuentaValores").Value)
   oRsAux1.Close
   
   mAuxStr1 = BuscarClaveINI("Punto de venta cobranza Santander Rio")
   mPuntoVenta = 0
   If IsNumeric(mAuxStr1) Then mPuntoVenta = CLng(mAuxStr1)
   
   mIdPuntoVenta = 0
   If mPuntoVenta = 0 Then
      Set oRsAux1 = oAp.PuntosVenta.TraerFiltrado("_PorIdTipoComprobante", 2)
   Else
      Set oRsAux1 = oAp.PuntosVenta.TraerFiltrado("_PorIdTipoComprobantePuntoVenta", Array(2, mPuntoVenta))
   End If
   If oRsAux1.RecordCount > 0 Then
      mIdPuntoVenta = oRsAux1.Fields(0).Value
      mPuntoVenta = oRsAux1.Fields("PuntoVenta").Value
   End If
   oRsAux1.Close
   If mIdPuntoVenta = 0 Then
      MsgBox "No tiene definido un punto de venta para los recibos", vbExclamation
      GoTo Salida
   End If
   
   mAuxStr1 = BuscarClaveINI("IdRubroContable Importacion cobranzas")
   mIdRubroContable = 0
   If IsNumeric(mAuxStr1) Then mIdRubroContable = CLng(mAuxStr1)
   
   mAuxStr1 = BuscarClaveINI("IdCuentaBancaria importacion cobranzas para servicio de cobro 1")
   mIdCuentaBancaria = 0
   If IsNumeric(mAuxStr1) Then
      mIdCuentaBancaria = CLng(mAuxStr1)
      Set oRsAux1 = oAp.CuentasBancarias.TraerFiltrado("_PorIdConCuenta", mIdCuentaBancaria)
      If oRsAux1.RecordCount > 0 Then
         mIdCuentaBancariaTransferencia = oRsAux1.Fields("IdCuentaBancaria").Value
         mIdBancoTransferencia = oRsAux1.Fields("IdBanco").Value
         mIdCuentaBanco = oRsAux1.Fields("IdCuenta").Value
      Else
         MsgBox "No existe la cuenta bancaria para cobro de servicios por Santander Rio", vbExclamation
         GoTo Salida
      End If
      oRsAux1.Close
   Else
      MsgBox "No tiene definido la cuenta bancaria para cobro de servicios por Santander Rio", vbExclamation
      GoTo Salida
   End If
   
   Set oF = New frmAviso
   With oF
      .Label1 = "Iniciando importacion ..."
      .Show
      .Refresh
      DoEvents
   End With

   oF.Label1 = oF.Label1 & vbCrLf & "Procesando ingresos en efectivo ..."
   oF.Label2 = ""
   oF.Label3 = ""
   DoEvents

   mConProblemas = False
   mError = ""
   
   Filas = VBA.Split(LeerArchivoSecuencial(mArchivo), vbCrLf)
   If UBound(Filas) > 0 Then
      mLote = CLng(mId(QuitarPath(mArchivo), 5, 4))
      
      For i = 0 To UBound(Filas)
         Select Case VBA.mId(Filas(i), 1, 2)
            Case "20"
               mFecha = CDate(mId(Filas(i), 9, 2) & "/" & mId(Filas(i), 7, 2) & "/" & mId(Filas(i), 3, 4))
            
            Case "21"
               mConProblemas = False
               mIdCliente = 0
               
               mIdentificador = mId(Filas(i), 81, 15)
               mFechaLote = mFecha
               mIdTipoComprobante = CInt(mId(Filas(i), 99, 2))
               If mIdTipoComprobante = 4 Then mIdTipoComprobante = 3
               mIdComprobante = CLng(mId(Filas(i), 101, 12))
               mImporte = CDbl(mId(Filas(i), 65, 16)) / 100
               
               mIdMoneda = mIdMonedaPesos
                  
               Set oRsAux1 = oAp.Recibos.TraerFiltrado("_PorServicioCobro", Array("RIO", mIdentificador))
               If oRsAux1.RecordCount > 0 Then
                  mError = mError & vbCrLf & "El cobro identificado como " & mIdentificador & ", ya existe (recibo " & oRsAux1.Fields("NumeroRecibo").Value & ")"
                  mConProblemas = True
               End If
               oRsAux1.Close
               
               mCotizacion = Cotizacion(mFecha, mIdMonedaDolar)
               If mCotizacion = 0 Then
                  mError = mError & vbCrLf & "No hay cotizacion ingresada el " & mFecha & " y los recibos de esta fecha no fueron tomados"
                  mConProblemas = True
               End If
               
               If mIdMonedaPesos = mIdMoneda Then
                  mCotizacionMoneda = 1
               Else
                  mCotizacionMoneda = Cotizacion(mFecha, mIdMoneda)
                  If mCotizacionMoneda = 0 Then
                     mError = mError & vbCrLf & "No hay cotizacion para el dia " & mFecha & ", el cobro identificado como " & mIdentificador & ", no fue ingresado"
                     mConProblemas = True
                  End If
               End If
               
               Set oRec = oAp.Recibos.Item(-1)
               With oRec
                  With .Registro
                     .Fields("FechaRecibo").Value = mFecha
                     .Fields("IdPuntoVenta").Value = mIdPuntoVenta
                     .Fields("PuntoVenta").Value = mPuntoVenta
                     .Fields("Tipo").Value = "CC"
                     .Fields("Documentos").Value = 0
                     .Fields("Otros1").Value = 0
                     .Fields("Otros2").Value = 0
                     .Fields("Otros3").Value = 0
                     .Fields("Otros4").Value = 0
                     .Fields("Otros5").Value = 0
                     .Fields("RetencionIVA").Value = 0
                     .Fields("RetencionGanancias").Value = 0
                     .Fields("RetencionIBrutos").Value = 0
                     .Fields("GastosGenerales").Value = 0
                     .Fields("Cotizacion").Value = mCotizacion
                     .Fields("IdMoneda").Value = mIdMoneda
                     .Fields("Dolarizada").Value = "NO"
                     .Fields("AsientoManual").Value = "NO"
                     .Fields("CotizacionMoneda").Value = mCotizacionMoneda
                     .Fields("IdUsuarioIngreso").Value = glbIdUsuario
                     .Fields("ServicioCobro").Value = "RIO"
                     .Fields("LoteServicioCobro").Value = mIdentificador
                     .Fields("FechaLote").Value = mFechaLote
                     .Fields("Valores").Value = mImporte
                     .Fields("Deudores").Value = mImporte
                     .Fields("FechaIngreso").Value = Now
                  
                     With oRec.DetRecibosRubrosContables.Item(-1)
                        With .Registro
                           .Fields("IdRubroContable").Value = mIdRubroContable
                           .Fields("Importe").Value = mImporte
                        End With
                        .Modificado = True
                     End With
                     
                     mIdImputacion = 0
                     Set oRsAux1 = oAp.CtasCtesD.TraerFiltrado("_BuscarComprobante", Array(mIdComprobante, mIdTipoComprobante))
                     If oRsAux1.RecordCount > 0 Then
                        mIdImputacion = oRsAux1.Fields(0).Value
                        mIdCliente = oRsAux1.Fields("IdCliente").Value
                     End If
                     oRsAux1.Close
                     With oRec.DetRecibos.Item(-1)
                        With .Registro
                           .Fields("IdImputacion").Value = mIdImputacion
                           .Fields("Importe").Value = mImporte
                        End With
                        .Modificado = True
                     End With
                     
                     mIdVendedor = 0
                     mIdCobrador = 0
                     mCliente = ""
                     If mIdCliente <> 0 Then
                        Set oRsAux1 = oAp.Clientes.TraerFiltrado("_PorId", mIdCliente)
                        If oRsAux1.RecordCount > 0 Then
                           mIdVendedor = IIf(IsNull(oRsAux1.Fields("Vendedor1").Value), 0, oRsAux1.Fields("Vendedor1").Value)
                           mIdCobrador = IIf(IsNull(oRsAux1.Fields("Cobrador").Value), 0, oRsAux1.Fields("Cobrador").Value)
                           mCliente = IIf(IsNull(oRsAux1.Fields("RazonSocial").Value), "", oRsAux1.Fields("RazonSocial").Value)
                        End If
                        oRsAux1.Close
                     Else
                        mError = mError & vbCrLf & "No existe cliente en el cobro identificado como " & mIdentificador & ", no fue ingresado"
                        mConProblemas = True
                     End If
                     
                     If mId(Filas(i), 96, 3) <> "000" Then
                        mError = mError & vbCrLf & "El registro correspondiente a " & mCliente & " comprobante " & mId(Filas(i), 113, 15) & " vino con codigo de rechazo " & mId(Filas(i), 96, 3) & " y no fue tomado."
                        mConProblemas = True
                     End If
               
                     With oRec.DetRecibosValores.Item(-1)
                        With .Registro
                           .Fields("IdTipoValor").Value = 21
                           .Fields("IdCuentaBancariaTransferencia").Value = mIdCuentaBancariaTransferencia
                           .Fields("IdBancoTransferencia").Value = mIdBancoTransferencia
                           .Fields("IdCuenta").Value = mIdCuentaBanco
                           .Fields("NumeroTransferencia").Value = 0
                           .Fields("Importe").Value = mImporte
                           .Fields("FechaVencimiento").Value = mFecha
                        End With
                        .Modificado = True
                     End With
                     
                     If Not mConProblemas Then
                        Set oPto = oAp.PuntosVenta.Item(mIdPuntoVenta)
                        With oPto
                           mNumeroRecibo = .Registro.Fields("ProximoNumero").Value
                           .Registro.Fields("ProximoNumero").Value = mNumeroRecibo + 1
                           .Guardar
                        End With
                        Set oPto = Nothing
                        
                        .Fields("NumeroRecibo").Value = mNumeroRecibo
                        .Fields("IdCliente").Value = mIdCliente
                        .Fields("IdVendedor").Value = mIdVendedor
                        .Fields("IdCobrador").Value = mIdCobrador
                        oRec.Guardar
                     End If
                  End With
               End With
         End Select
      Next
   End If
            
   If Len(mError) > 0 Then MsgBox "El proceso reporta los siguientes problemas :" & mError

Salida:

   On Error Resume Next
   Unload oF
   Set oF = Nothing

   Set oRsAux1 = Nothing
   Set oRec = Nothing
   Set oPto = Nothing
   Set oAp = Nothing

   Exit Sub

Mal:

   MsgBox "Se ha producido un error al registrar los datos" & vbCrLf & Err.Number & " -> " & Err.Description, vbCritical
   Resume Salida

End Sub

Public Sub ImportacionArticulos()

   Dim oAp As ComPronto.Aplicacion
   Dim oEx As Excel.Application
   Dim oArt As ComPronto.Articulo
   Dim oRs As ADOR.Recordset
   Dim oRsErrores As ADOR.Recordset
   Dim oRsAux As ADOR.Recordset
   Dim oF As Form
   Dim mArchivo As String, mAuxStr1 As String, mCodigo As String, mComentario As String
   Dim mDescripcion As String, mNumeroInventario As String, mUbicacion As String
   Dim mObservaciones As String
   Dim fl As Integer, mContador As Integer
   Dim mIdGrado As Long, mIdRubro As Long, mIdSubrubro As Long, mIdTipo As Long
   Dim mIdEstado As Long
   Dim mOk As Boolean, mConProblemas As Boolean
   Dim mLinea As Double
   
   On Error GoTo Mal

   Set oF = New frmPathPresto
   With oF
      .Id = 9
      .Show vbModal
      mOk = .Ok
      If mOk Then
         mArchivo = .FileBrowser1(0).Text
      End If
   End With
   Unload oF
   Set oF = Nothing

   If Not mOk Then Exit Sub

   Set oAp = Aplicacion

   Set oRsErrores = CreateObject("ADOR.Recordset")
   With oRsErrores
      .Fields.Append "Id", adInteger
      .Fields.Append "Detalle", adVarChar, 200
   End With
   oRsErrores.Open
   
   Set oF = New frmAviso
   With oF
      .Label1 = "Abriendo planilla Excel ..."
      .Show
      .Refresh
      DoEvents
   End With

   oF.Label1 = oF.Label1 & vbCrLf & "Procesando articulos ..."
   oF.Label2 = ""
   oF.Label3 = ""
   DoEvents

   mAuxStr1 = BuscarClaveINI("IdRubro de equipos")
   mIdRubro = 0
   If IsNumeric(mAuxStr1) Then mIdRubro = CLng(mAuxStr1)
   
   mAuxStr1 = BuscarClaveINI("IdSubrubro de equipos")
   mIdSubrubro = 0
   If IsNumeric(mAuxStr1) Then mIdSubrubro = CLng(mAuxStr1)
   
   mAuxStr1 = BuscarClaveINI("IdTipo para filtrar equipos instalados")
   mIdTipo = 0
   If IsNumeric(mAuxStr1) Then mIdTipo = CLng(mAuxStr1)
   
   fl = 2
   
   Set oEx = CreateObject("Excel.Application")
   With oEx
      
      .Visible = True
      .WindowState = xlMinimized
      Me.Refresh
      
      With .Workbooks.Open(mArchivo)
         .Sheets("Hoja1").Select
         With .ActiveSheet
            Do While True
               
               If Len(Trim(.Cells(fl, 2))) = 0 Then
                  Exit Do
               End If
               
               mConProblemas = False
               
               mContador = mContador + 1
               oF.Label2 = "Articulo : " & .Cells(fl, 2)
               oF.Label3 = "" & mContador
               DoEvents
               
               mCodigo = .Cells(fl, 2)
               mDescripcion = .Cells(fl, 3)
               mNumeroInventario = .Cells(fl, 4)
               mLinea = 0
               If IsNumeric(.Cells(fl, 5)) Then mLinea = CDbl(.Cells(fl, 5))
               mIdEstado = 0
               If IsNumeric(.Cells(fl, 7)) Then mIdEstado = .Cells(fl, 7)
               mUbicacion = .Cells(fl, 8)
               mComentario = .Cells(fl, 9)
               mObservaciones = .Cells(fl, 10)
               
               Set oRsAux = oAp.Articulos.TraerFiltrado("_PorCodigo", mCodigo)
               If oRsAux.RecordCount > 0 Then
                  AgregarMensajeProcesoPresto oRsErrores, "El articulo " & mCodigo & _
                        " ya existe."
                  mConProblemas = True
               End If
               oRsAux.Close
   
               If Not mConProblemas Then
                  
                  mIdGrado = 0
                  Set oRsAux = oAp.Grados.TraerFiltrado("_PorDescripcion", .Cells(fl, 6))
                  If oRsAux.RecordCount > 0 Then
                     mIdGrado = oRsAux.Fields(0).Value
                  End If
                  oRsAux.Close
                  
                  Set oArt = oAp.Articulos.Item(-1)
                  With oArt
                     With .Registro
                        .Fields("Codigo").Value = mCodigo
                        .Fields("Descripcion").Value = mDescripcion
                        .Fields("NumeroInventario").Value = mNumeroInventario
                        .Fields("Datos1").Value = mLinea
                        .Fields("IdGrado").Value = mIdGrado
                        .Fields("IdRubro").Value = mIdRubro
                        .Fields("IdSubrubro").Value = mIdSubrubro
                        .Fields("IdTipo").Value = mIdTipo
                        .Fields("IdCuantificacion").Value = 1
                        .Fields("Autorizacion").Value = "C"
                        .Fields("ModeloEspecifico").Value = "HAWK"
                        .Fields("FechaAlta").Value = Now
                        .Fields("IdAcabado").Value = mIdEstado
                        .Fields("TipoCoberturaSeguro").Value = mUbicacion
                        .Fields("Caracteristicas").Value = mComentario
                        .Fields("Observaciones").Value = mObservaciones
                     End With
                  End With
                  oArt.Guardar
                  Set oArt = Nothing
               
               Else
               
                  fl = fl + 1
                  
               End If
   
            Loop
         End With
         .Close False
      End With
      .Quit
   
   End With
   
   Unload oF
   Set oF = Nothing

   If Not oRsErrores Is Nothing Then
      If oRsErrores.RecordCount > 0 Then
         Set oF = New frmConsulta1
         With oF
            Set .RecordsetFuente = oRsErrores
            .Id = 13
            .Show vbModal, Me
         End With
      Else
         MsgBox "Proceso completo", vbInformation
      End If
      Set oRsErrores = Nothing
   End If

Salida:

   On Error Resume Next
   
   Unload oF
   Set oF = Nothing

   Set oRs = Nothing
   Set oRsErrores = Nothing
   Set oRsAux = Nothing
   Set oArt = Nothing
   Set oEx = Nothing
   Set oAp = Nothing

   Exit Sub

Mal:

   MsgBox "Se ha producido un error al registrar los datos" & vbCrLf & Err.Number & " -> " & Err.Description, vbCritical
   Resume Salida
   
End Sub

Public Sub QuitarMarcaAprobacionConciliacion()

   Dim oL As ListItem
   Dim Filas, Columnas, mVector
   Dim iFilas As Integer, mAcceder As Integer
   Dim mCadena As String
   
   If Not glbAdministrador Then
      mAcceder = MsgBox("Para ingresar a este modulo debe tener permiso de ADMINISTRADOR" & vbCrLf & "Desea login de supervisores ?", vbYesNo, "Acceso a supervisores")
      If mAcceder = vbNo Then
         Exit Sub
      End If
      If Not DefinirAdministrador Then
         MsgBox "Para ingresar a este modulo debe tener permiso de ADMINISTRADOR", vbCritical
         Exit Sub
      End If
   End If
   
   Me.MousePointer = vbHourglass
   DoEvents

   Filas = VBA.Split(Lista.GetString, vbCrLf)
   
   For iFilas = LBound(Filas) + 1 To UBound(Filas)
      Columnas = VBA.Split(Filas(iFilas), vbTab)
      Aplicacion.Tarea "Conciliaciones_QuitarMarcaAprobacion", Columnas(2)
   Next
   Set Lista.DataSource = Aplicacion.Conciliaciones.TraerTodos

   Me.MousePointer = vbDefault

End Sub

Public Sub ActivarPopupMateriales()

   On Error Resume Next
   
'   Me.MousePointer = vbHourglass
'   DoEvents

   Dim oRs As ADOR.Recordset
   Dim mIdRubro As Long, mIdSubrubro As Long
   Dim mCantidadRubros As Integer, mCantidadSubrubros As Integer
   Dim mCantidadArticulos As Integer
   Dim Key1 As Long, Key2 As Long, Key3 As Long
   Dim mRubro As String, mSubrubro As String, mArticulo As String

   Set cPMenu = New cPopupMenu
   With cPMenu
      .ImageList = Img16
      .hWndOwner = Me.hwnd
      .HeaderStyle = ecnmHeaderSeparator
      .MenuBackgroundColor = &HC0C0FF
      .InActiveMenuForeColor = &H333333
      .ActiveMenuBackgroundColor = &H336666
      .ActiveMenuForeColor = &HFFFFFF
      .ImageProcessHighlights = True
      .BackgroundPicture = picBackground.Picture
      .Clear
   End With
   
   POP_menuheight = GetSystemMetrics(SM_CYMENU)
   POP_breakpoint = ((GetSystemMetrics(SM_CYFULLSCREEN) - POP_menuheight) \ POP_menuheight) - 3
   
   Key1 = cPMenu.AddItem("Materiales", , 0, , , , , "Root")

   Set oRs = Aplicacion.Articulos.TraerFiltrado("_ParaMenu1")
   If oRs Is Nothing Then
      Set cPMenu = Nothing
      glbMenuPopUpCargado1 = False
      Exit Sub
   End If
   With oRs
      If .RecordCount > 0 Then
         .MoveFirst
         mIdRubro = -1
         mIdSubrubro = -1
         mCantidadRubros = 0
         mCantidadSubrubros = 0
         mCantidadArticulos = 0
         Do While Not .EOF
            If Len(Trim(.Fields("Rubro").Value)) <> 0 Then
               mRubro = .Fields("Rubro").Value
            Else
               mRubro = "S/D"
            End If
            If Len(Trim(.Fields("Subrubro").Value)) <> 0 Then
               mSubrubro = .Fields("Subrubro").Value
            Else
               mSubrubro = "S/D"
            End If
            If Len(Trim(.Fields("Descripcion").Value)) <> 0 Then
               mArticulo = .Fields("Descripcion").Value
            Else
               mArticulo = "S/D"
            End If
            
            If mIdRubro <> .Fields("IdRubro").Value Then
               If mIdRubro = -1 Then cPMenu.AddItem "-Rubros", , , Key1
               mCantidadRubros = mCantidadRubros + 1
               If mCantidadRubros Mod POP_breakpoint = 0 Then
                  Key1 = cPMenu.AddItem("Mas rubros", , , Key1, , , , "R0")
               End If
               Key2 = cPMenu.AddItem(mRubro, , , Key1, Img16.ListImages("Rubros").Index - 1, , , "R" & .Fields("IdRubro").Value)
            End If
            If mIdRubro <> .Fields("IdRubro").Value Or _
                  mIdSubrubro <> .Fields("IdSubrubro").Value Then
               If mIdRubro <> .Fields("IdRubro").Value Then
                  cPMenu.AddItem "-Subrubros", , , Key2
               End If
               mCantidadSubrubros = mCantidadSubrubros + 1
               If mCantidadSubrubros Mod POP_breakpoint = 0 Then
                  Key2 = cPMenu.AddItem("Mas subrubros", , , Key2, , , , "R0")
                  mCantidadSubrubros = 0
               End If
               Key3 = cPMenu.AddItem(mSubrubro, , , Key2, Img16.ListImages("Subrubros").Index - 1, , , "S" & .Fields("IdSubrubro").Value)
               mIdRubro = .Fields("IdRubro").Value
               mIdSubrubro = .Fields("IdSubrubro").Value
               mCantidadArticulos = 0
            End If
            
            mCantidadArticulos = mCantidadArticulos + 1
            If mCantidadArticulos Mod POP_breakpoint = 0 Then
               Key3 = cPMenu.AddItem("Mas materiales", , , Key3, , , , "R0")
            End If
            cPMenu.AddItem mArticulo, , , Key3, Img16.ListImages("Articulos").Index - 1, , , .Fields("IdArticulo").Value
            
            .MoveNext
         Loop
      End If
      .Close
   End With

   cPMenu.Store "Materiales"
   'cPMenu.StoreToFile , App.Path & "\PopUp.Dat"
   
   Set oRs = Nothing

'   Me.MousePointer = vbDefault
'   DoEvents

End Sub

Public Sub ExportarComprobantesXML()

   Dim oF As frm_Aux
   
   Set oF = New frm_Aux
   With oF
      .Caption = "Exportar comprobantes (XML)"
      With .Label1
         .Top = 100
         .Caption = "Comprobante :"
      End With
      With .Combo1(0)
         .Top = 100
         .Left = oF.Label1.Left + oF.Label1.Width + 100
         .Width = .Width * 1.5
         .AddItem "Pedidos", 0
         .AddItem "Ordenes de compra", 1
         .Visible = True
      End With
      .Text1.Visible = False
      .Width = .Width * 3.5
      .Height = .Height * 3.1
      With .Lista
         .Left = oF.Label1.Left
         .Top = 500
         .Width = 12000
         .Height = 5400
         .CheckBoxes = True
         .Visible = True
      End With
      With .cmd(0)
         .Top = 6000
         .Left = oF.Lista.Left
         .Caption = "Generar"
         .Enabled = False
      End With
      .cmd(1).Top = .cmd(0).Top
      .Id = 2
      .Show vbModal, Me
   End With
   Unload oF
   Set oF = Nothing

End Sub

Public Sub DefinirAccesosItemUsuarios()

   Dim oF As frm_Aux
   Dim mOk As Boolean
   
   Set oF = New frm_Aux
   With oF
      .Id = 3
      .ArbolItem = Arbol.SelectedItem.Key
      .MnuDet.Visible = True
      .Caption = "Definir accesos por item - usuario"
      .Label1.Visible = False
      .Text1.Visible = False
      .Width = .Width * 2
      .Height = .Height * 3.2
      With .Lista
         .Left = oF.Label1.Left
         .Top = 500
         .Width = 6500
         .Height = 5400
         .CheckBoxes = True
         .MultiSelect = True
         .Visible = True
         Set .SmallIcons = oF.Img16
         Set .DataSource = Aplicacion.Empleados.TraerFiltrado("_AccesosPorItemArbol", Arbol.SelectedItem.Key)
      End With
      With .cmd(0)
         .Top = 6000
         .Left = oF.Lista.Left
         .Caption = "Guardar"
      End With
      With .cmd(1)
         .Left = oF.cmd(0).Left + oF.cmd(0).Width + 50
         .Top = oF.cmd(0).Top
      End With
      .Show vbModal, Me
      mOk = .Ok
   End With
   Unload oF
   Set oF = Nothing
   If mOk Then
      CargarPermisos
      CargarArbol
      CargarPopUpMenu
   End If

End Sub

Public Sub DistribuirTeoricosPorMatrices()

   On Error GoTo Mal
   
   Dim oF As frm_Aux
   Dim mIdDistribucionObra As Long
   Dim mOk As Boolean
   
   Set oF = New frm_Aux
   mIdDistribucionObra = 0
   With oF
      .Caption = "Matriz"
      .Text1.Visible = False
      .Label1.Caption = "Elegir matriz:"
      With .dcfields(0)
         .Top = oF.Text1.Top
         .Left = oF.Text1.Left
         .Width = .Width * 2
         .BoundColumn = "IdDistribucionObra"
         Set .RowSource = Aplicacion.DistribucionesObras.TraerLista
         .Visible = True
      End With
      .Width = .Width * 1.3
      .Show vbModal, Me
      mOk = .Ok
      If IsNumeric(.dcfields(0).BoundText) Then
         mIdDistribucionObra = .dcfields(0).BoundText
      End If
   End With
   Unload oF
   Set oF = Nothing
   
   If Not mOk Then Exit Sub
   If mIdDistribucionObra = 0 Then
      MsgBox "No eligio una matriz para aplicar la distribucion", vbExclamation
      Exit Sub
   End If
   
   Dim Filas, Columnas, mVector
   Dim s As String
   Dim i As Integer
   
   mVector = VBA.Split(Arbol.SelectedItem.Key, " ")
   
   s = Lista.GetString
   
   Filas = VBA.Split(s, vbCrLf)

   For i = 1 To UBound(Filas)
      Columnas = VBA.Split(Filas(i), vbTab)
      Aplicacion.Tarea "Cuentas_DistribuirPresupuestoEconomicoPorMatriz", Array(Columnas(2), mIdDistribucionObra, mVector(2))
   Next
   
   Arbol_NodeClick Arbol.SelectedItem
   
Salida:

   Exit Sub

Mal:
   
   Dim mvarResp As Integer
   Select Case Err.Number
      Case Else
         MsgBox "Se ha producido un error al registrar los datos" & vbCrLf & Err.Number & " -> " & Err.Description, vbCritical
   End Select
   Resume Salida

End Sub

Public Sub RegrabarComprobantesProveedores()

   Dim iFilas As Integer, mAcceder As Integer
   
   If Not glbAdministrador Then
      mAcceder = MsgBox("Para ingresar a este modulo debe tener permiso de ADMINISTRADOR" & vbCrLf & "Desea login de supervisores ?", vbYesNo, "Acceso a supervisores")
      If mAcceder = vbNo Then
         Exit Sub
      End If
      If Not DefinirAdministrador Then
         MsgBox "Para ingresar a este modulo debe tener permiso de ADMINISTRADOR", vbCritical
         Exit Sub
      End If
   End If
   
   Me.MousePointer = vbHourglass
   DoEvents

   On Error GoTo Mal
   
   Dim oF As Form
   Dim oAp As ComPronto.Aplicacion
   Dim oCP As ComPronto.ComprobanteProveedor
   Dim oDet As ComPronto.DetComprobanteProveedor
   Dim oRs As ADOR.Recordset
   Dim Filas, Columnas
   
   Set oAp = Aplicacion
   
   Set oF = New frmAviso
   With oF
      .Label1 = "Cargando comprobantes de proveedores ..." & vbCrLf & _
               "Procesando comprobante :"
      .Show
      .Refresh
      DoEvents
   End With

   Filas = VBA.Split(Lista.GetString, vbCrLf)
   
   For iFilas = LBound(Filas) + 1 To UBound(Filas)
      Columnas = VBA.Split(Filas(iFilas), vbTab)
      Set oCP = oAp.ComprobantesProveedores.Item(Columnas(2))
      oF.Label1 = "Cargando comprobantes de proveedores ..." & vbCrLf & _
                  "Procesando comprobante :" & vbCrLf & _
                  "" & oCP.Registro.Fields("Letra").Value & "-" & _
                  Format(oCP.Registro.Fields("NumeroComprobante1").Value, "0000") & "-" & _
                  Format(oCP.Registro.Fields("NumeroComprobante2").Value, "0000000000") & vbCrLf & _
                  iFilas & " de " & UBound(Filas)
      DoEvents
      Set oRs = oCP.DetComprobantesProveedores.TraerTodos
      If oRs.RecordCount <> 0 Then
         While Not oRs.EOF
            Set oDet = oCP.DetComprobantesProveedores.Item(oRs.Fields(0).Value)
            oDet.Modificado = True
            Set oDet = Nothing
            oRs.MoveNext
         Wend
      End If
      oCP.Guardar
      Set oRs = Nothing
      Set oCP = Nothing
   Next
   Unload oF

Salida:

   Set oF = Nothing
   Set oRs = Nothing
   Set oDet = Nothing
   Set oCP = Nothing
   Set oAp = Nothing
   
   Me.MousePointer = vbDefault
   Exit Sub

Mal:
   
   Me.MousePointer = vbDefault
   Dim mvarResp As Integer
   Select Case Err.Number
      Case Else
         MsgBox "Se ha producido un error al registrar los datos" & vbCrLf & Err.Number & " -> " & Err.Description, vbCritical
   End Select
   Resume Salida

End Sub

Public Sub RecalcularGrabarComprobantesProveedores()

   Dim iFilas As Integer, mAcceder As Integer
   
   If Not glbAdministrador Then
      mAcceder = MsgBox("Para ingresar a este modulo debe tener permiso de ADMINISTRADOR" & vbCrLf & "Desea login de supervisores ?", vbYesNo, "Acceso a supervisores")
      If mAcceder = vbNo Then
         Exit Sub
      End If
      If Not DefinirAdministrador Then
         MsgBox "Para ingresar a este modulo debe tener permiso de ADMINISTRADOR", vbCritical
         Exit Sub
      End If
   End If
   
   On Error GoTo Mal
   
   Dim oF As frmComprobantesPrv
   Dim Filas, Columnas
   
   Filas = VBA.Split(Lista.GetString, vbCrLf)
   For iFilas = LBound(Filas) + 1 To UBound(Filas)
      Columnas = VBA.Split(Filas(iFilas), vbTab)
      Set oF = New frmComprobantesPrv
      With oF
         .NivelAcceso = ControlAccesoNivel("ComprobantesPrvTodos")
         .OpcionesAcceso = ControlAccesoOpciones("ComprobantesPrvTodos")
         .GrabacionAutomatica = True
         .Id = Columnas(2)
         .Show vbModal, Me
      End With
      Unload oF
      Me.Refresh
      DoEvents
   Next
   
Salida:

   Set oF = Nothing
   Exit Sub

Mal:
   
   Me.MousePointer = vbDefault
   Dim mvarResp As Integer
   Select Case Err.Number
      Case Else
         MsgBox "Se ha producido un error al registrar los datos" & vbCrLf & Err.Number & " -> " & Err.Description, vbCritical
   End Select
   Resume Salida

End Sub

Public Sub DefinirDestinoPagoComprobantesProveedores()

   Dim iFilas As Integer, mAcceder As Integer
   
   If Not glbAdministrador Then
      mAcceder = MsgBox("Para ingresar a este modulo debe tener permiso de ADMINISTRADOR" & vbCrLf & "Desea login de supervisores ?", vbYesNo, "Acceso a supervisores")
      If mAcceder = vbNo Then
         Exit Sub
      End If
      If Not DefinirAdministrador Then
         MsgBox "Para ingresar a este modulo debe tener permiso de ADMINISTRADOR", vbCritical
         Exit Sub
      End If
   End If
   
   On Error GoTo Mal
   
   Dim oF As Form
   Dim mDestinoPago As String
   Dim mOk As Boolean
   Dim Filas, Columnas
   
   Set oF = New frm_Aux
   With oF
      .Caption = "Destino de pago"
      .Text1.Visible = False
      .Label1.Caption = "Destino de pago :"
      .Frame1.Visible = True
      .Frame1.Top = .Label1.Top + .Label1.Height + 100
      .Option1.Value = True
      .Option1.Caption = "Administracion"
      .Option2.Caption = "Obra"
      .Show vbModal, Me
      mOk = .Ok
      If .Option1.Value Then
         mDestinoPago = "A"
      Else
         mDestinoPago = "O"
      End If
   End With
   Unload oF
   Set oF = Nothing
   If Not mOk Then Exit Sub
   
   Set oF = New frmAviso
   With oF
      .Label1 = "Cargando comprobantes de proveedores ..." & vbCrLf & _
               "Procesando comprobante :"
      .Show
      .Refresh
      DoEvents
   End With

   Filas = VBA.Split(Lista.GetString, vbCrLf)
   
   For iFilas = LBound(Filas) + 1 To UBound(Filas)
      Columnas = VBA.Split(Filas(iFilas), vbTab)
      Aplicacion.Tarea "ComprobantesProveedores_GrabarDestinoPago", _
                        Array(Columnas(2), mDestinoPago)
      oF.Label1 = "Cargando comprobantes de proveedores ..." & vbCrLf & _
                  "Procesando comprobante :" & vbCrLf & _
                  "" & Columnas(5) & vbCrLf & Columnas(4) & vbCrLf & _
                  iFilas & " de " & UBound(Filas)
      DoEvents
   Next
   Arbol_NodeClick Arbol.SelectedItem
   Unload oF

Salida:
   Set oF = Nothing
   Exit Sub

Mal:
   Dim mvarResp As Integer
   Select Case Err.Number
      Case Else
         MsgBox "Se ha producido un error al registrar los datos" & vbCrLf & Err.Number & " -> " & Err.Description, vbCritical
   End Select
   Resume Salida

End Sub

Public Sub DefinirOPFondoReparoComprobantesProveedores()

   Dim iFilas As Integer, mAcceder As Integer
   
   If Not glbAdministrador Then
      mAcceder = MsgBox("Para ingresar a este modulo debe tener permiso de ADMINISTRADOR" & vbCrLf & "Desea login de supervisores ?", vbYesNo, "Acceso a supervisores")
      If mAcceder = vbNo Then
         Exit Sub
      End If
      If Not DefinirAdministrador Then
         MsgBox "Para ingresar a este modulo debe tener permiso de ADMINISTRADOR", vbCritical
         Exit Sub
      End If
   End If
   
   On Error GoTo Mal
   
   Dim oF As Form
   Dim mNumeroOP As Long
   Dim mOk As Boolean
   Dim Filas, Columnas
   
   Set oF = New frm_Aux
   With oF
      .Caption = "OP Fondo Reparo"
      .Label1.Caption = "Numero de OP :"
      .Show vbModal, Me
      mOk = .Ok
      mNumeroOP = Val(.Text1.Text)
   End With
   Unload oF
   Set oF = Nothing
   If Not mOk Then Exit Sub
   
   Set oF = New frmAviso
   With oF
      .Label1 = "Cargando comprobantes de proveedores ..." & vbCrLf & _
               "Procesando comprobante :"
      .Show
      .Refresh
      DoEvents
   End With

   Filas = VBA.Split(Lista.GetString, vbCrLf)
   
   For iFilas = LBound(Filas) + 1 To UBound(Filas)
      Columnas = VBA.Split(Filas(iFilas), vbTab)
      Aplicacion.Tarea "ComprobantesProveedores_GrabarDestinoPago", _
                        Array(Columnas(2), "", mNumeroOP)
      oF.Label1 = "Cargando comprobantes de proveedores ..." & vbCrLf & _
                  "Procesando comprobante :" & vbCrLf & _
                  "" & Columnas(5) & vbCrLf & Columnas(4) & vbCrLf & _
                  iFilas & " de " & UBound(Filas)
      DoEvents
   Next
   Arbol_NodeClick Arbol.SelectedItem
   Unload oF

Salida:
   Set oF = Nothing
   Exit Sub

Mal:
   Dim mvarResp As Integer
   Select Case Err.Number
      Case Else
         MsgBox "Se ha producido un error al registrar los datos" & vbCrLf & Err.Number & " -> " & Err.Description, vbCritical
   End Select
   Resume Salida

End Sub

Public Sub ImportacionInformacionImpositiva()

   Dim oAp As ComPronto.Aplicacion
   Dim oProv As ComPronto.Proveedor
   Dim oCli As ComPronto.Cliente
   Dim oRs As ADOR.Recordset
   Dim oRsAux1 As ADOR.Recordset
   Dim oRsAux2 As ADOR.Recordset
   Dim oF As frm_Aux
   Dim of1 As frmAviso
   Dim mArchivo As String, s As String, mCuit As String, mArchivoSalida As String, mvarPathArchivosExportados As String
   Dim mPathImportacionDatos As String, mAux1 As String, mAuxS1 As String, mAuxS2 As String, mAuxS3 As String, mAuxS4 As String
   Dim mCodigo As Integer, mvarSeguro As Integer
   Dim i As Long, j As Long, X As Long, mAuxL1 As Long, mAuxL2 As Long, mAuxL3 As Long
   Dim mFechaLog As Date, mAuxD1 As Date
   Dim mOk As Boolean, mConProblemas As Boolean, mPrimero As Boolean
   Dim mAux2 As Double
   Dim Filas, Columnas
   
   On Error GoTo Mal

   mPrimero = True
   
   mPathImportacionDatos = "C:\"
   Set oRsAux1 = Aplicacion.Parametros.TraerFiltrado("_PorId", 1)
   If oRsAux1.RecordCount > 0 Then
      mPathImportacionDatos = IIf(IsNull(oRsAux1.Fields("PathImportacionDatos").Value), "C:\", oRsAux1.Fields("PathImportacionDatos").Value)
   End If
   oRsAux1.Close
   
   Set oF = New frm_Aux
   With oF
      .Caption = "Importacion de informacion impositiva"
      .Id = 10
      .Text1.Visible = False
      With .Label1
         .Caption = "Archivo a procesar:"
         .Width = .Width * 1.3
         .Top = oF.Label2(0).Top
      End With
      With .FileBrowser1(0)
         .Left = oF.Label2(1).Left
         .Top = oF.Label1.Top + oF.Label1.Height + 100
         .InitDir = mPathImportacionDatos
         .Visible = True
      End With
      .Frame1.Top = .FileBrowser1(0).Top + .FileBrowser1(0).Height + 100
      With .cmd(1)
         .Top = oF.cmd(0).Top + oF.cmd(0).Height + 100
         .Left = oF.cmd(0).Left
      End With
      With .Frame2
         .Top = oF.cmd(0).Top
         .Left = oF.cmd(0).Left + oF.cmd(0).Width + 400
         .Visible = True
      End With
      .Option3.Value = True
      .Width = .Width * 1.2
      .Height = .Height * 1.5
      .Show vbModal
      mOk = .Ok
      If .Option3.Value Then mCodigo = 1
      If .Option4.Value Then mCodigo = 2
      If .Option5.Value Then
         If .Option1.Value Then
            mCodigo = 3
         Else
            mCodigo = 4
         End If
      End If
      If .Option6.Value Then mCodigo = 5
      If .Option7.Value Then mCodigo = 6
      If .Option8.Value Then mCodigo = 7
      If .Option9.Value Then mCodigo = 8
      If .Option10.Value Then mCodigo = 9
      mArchivo = .FileBrowser1(0).Text
   End With
   Unload oF
   Set oF = Nothing
   If Not mOk Or Len(mArchivo) = 0 And mCodigo <> 3 Then Exit Sub
   If mCodigo = 1 Then
      If UCase(mId(mArchivo, 1, Len(mPathImportacionDatos))) <> UCase(mPathImportacionDatos) Then
         MsgBox "El archivos deben estar en el servidor de datos para poder ser importado", vbExclamation
         Exit Sub
      End If
   End If

   If mCodigo <> 6 Then
      mvarSeguro = MsgBox("Este proceso genera un archivo de log que registra el estado" & vbCrLf & _
                           "inicial y final de los datos a modificar del proveedor, estos" & vbCrLf & _
                           "cambios pueden consultarse en la opcion Seguridad-Log importacion" & vbCrLf & _
                           "archivos de retencion. Esta de acuerdo en continuar ?", vbYesNo, "Procesar informacion impositiva")
      If mvarSeguro = vbNo Then Exit Sub
   End If
   
   Set of1 = New frmAviso
   With of1
      .Caption = "Importacion de informacion impositiva"
      .Label1 = "Abriendo archivo ..."
      .Show
      .Refresh
      DoEvents
   End With

   Set oAp = Aplicacion

   If mCodigo = 3 Then
      Set oRs = oAp.Parametros.TraerTodos
      mvarPathArchivosExportados = IIf(IsNull(oRs.Fields("PathArchivosExportados").Value), "C:\", oRs.Fields("PathArchivosExportados").Value)
      oRs.Close
      Set oRs = oAp.Proveedores.TraerFiltrado("_ParaTransmitir_Todos")
      If oRs.RecordCount > 0 Then
         s = "" & mId(glbCuit, 1, 2) & mId(glbCuit, 4, 8) & mId(glbCuit, 13, 1) & vbCrLf
         oRs.MoveFirst
         Do While Not oRs.EOF
            If Not IsNull(oRs.Fields("IdCodigoIva").Value) And oRs.Fields("IdCodigoIva").Value = 1 And Len(oRs.Fields("Cuit").Value) > 0 Then
               s = s & "" & mId(oRs.Fields("Cuit").Value, 1, 2) & _
                  mId(oRs.Fields("Cuit").Value, 4, 8) & mId(oRs.Fields("Cuit").Value, 13, 1) & " " & mId(CStr(Date), 4, 7) & vbCrLf
            End If
            oRs.MoveNext
         Loop
      End If
      oRs.Close
      If Len(s) > 0 Then
         s = mId(s, 1, Len(s) - 2)
         mArchivoSalida = mvarPathArchivosExportados & "ReproWeb.txt"
         GuardarArchivoSecuencial mArchivoSalida, s
      End If
      MsgBox "Se ha generado el archivo : " & mArchivoSalida
      GoTo Salida
   End If
   
   If mCodigo = 6 Then
      oAp.Tarea "Proveedores_BorrarEmbargos"
   End If
   
   If mCodigo = 7 Or mCodigo = 9 Then
      Set oRsAux1 = oAp.Proveedores.TraerFiltrado("_SoloCuit")
      Set oRsAux2 = oAp.Clientes.TraerFiltrado("_SoloCuit")
   End If
   
   If mCodigo <> 7 Then
      s = LeerArchivoSecuencial1(mArchivo)
      If Len(s) = 0 Then GoTo Salida
   End If
   of1.Label1 = ""
   
   Filas = VBA.Split(s, Chr(10))
   
   'RG830
   If mCodigo = 1 Then
      of1.Label1 = vbCrLf & vbCrLf & "RG-830" & vbCrLf & vbCrLf & "Procesando informacion..." & vbCrLf & "Importando padron, un momento por favor..."
      DoEvents
      
      mFechaLog = Now
      oAp.Tarea "Proveedores_EstadoInicialImpositivo", Array(mFechaLog, "RG830")
      
      oAp.Tarea "Proveedores_ImportarInformacionImpositiva", Array("RG830", QuitarPath(mArchivo), mFechaLog)
      GoTo Salida
   End If
   
   'IIBB 70/07
   If mCodigo = 7 Then
      of1.Label1 = vbCrLf & vbCrLf & "IIBB 70/07" & vbCrLf & vbCrLf & "Procesando informacion..." & vbCrLf & "Importando padron, un momento por favor..."
      DoEvents
      
      mFechaLog = Now
      oAp.Tarea "Proveedores_EstadoInicialImpositivo", Array(mFechaLog, "IIBB")
      
      mAuxL1 = 1
      If mPrimero Then
         oAp.Tarea "Proveedores_ImportarInformacionImpositiva2", Array("IIBB-7007", QuitarPath(mArchivo), mFechaLog, 1)
         Set oRsAux1 = oAp.Proveedores.TraerFiltrado("_ContarRegistrosImpositivos")
         If oRsAux1.RecordCount > 0 Then mAuxL1 = oRsAux1.Fields(0).Value
         oRsAux1.Close
         of1.Label2 = "Total registros : " & mAuxL1
         mAuxL1 = Int(mAuxL1 / 100) + 1
         DoEvents
         mPrimero = False
      End If
      For i = 2 To mAuxL1
         oAp.Tarea "Proveedores_ImportarInformacionImpositiva2", Array("IIBB-7007", QuitarPath(mArchivo), mFechaLog, i)
         of1.Label1 = vbCrLf & vbCrLf & "IIBB 70/07" & vbCrLf & vbCrLf & "Procesando informacion..." & vbCrLf & "Registros procesados " & i * 100
         DoEvents
      Next
      GoTo Salida
   End If
   
   For i = 0 To UBound(Filas) - 1
      of1.Label1 = vbCrLf & vbCrLf & vbCrLf & vbCrLf & "Procesando registros ..."
      of1.Label2 = "Registro : " & i & " de " & UBound(Filas)
      DoEvents
      
'      If mCodigo = 1 Then
'         Columnas = VBA.Split(Filas(i), ";")
'         If UBound(Columnas) < 9 Then
'            If mPrimero Then
'               MsgBox "Archivo invalido", vbExclamation
'               GoTo Salida
'            End If
'         End If
'         If mPrimero Then
'            mPrimero = False
'            mFechaLog = Now
'            oAp.Tarea "Proveedores_EstadoInicialImpositivo", Array(mFechaLog, "RG830")
'         End If
'
''         If i >= 1 And UBound(Columnas) >= 9 Then
''            mCuit = mId(Columnas(1), 1, 2) & "-" & mId(Columnas(1), 3, 8) & "-" & mId(Columnas(1), 11, 1)
''            Set oRs = oAp.Proveedores.TraerFiltrado("_PorCuit", mCuit)
''            If oRs.RecordCount > 0 Then
''               If IsNull(oRs.Fields("Eventual").Value) Or oRs.Fields("Eventual").Value <> "SI" Then
''                  Set oProv = oAp.Proveedores.Item(oRs.Fields(0).Value)
''                  If CInt(Columnas(3)) = 100 Then
''                     oProv.Registro.Fields("IGCondicion").Value = 1
''                     oProv.Registro.Fields("FechaLimiteExentoGanancias").Value = CDate(Columnas(9))
''                  Else
''                     oProv.Registro.Fields("IGCondicion").Value = 2
''                     oProv.Registro.Fields("FechaLimiteExentoGanancias").Value = Null
''                  End If
''                  oAp.Tarea "LogImpuestos_A", Array(mFechaLog, "RG830", oRs.Fields(0).Value, _
''                                                   oProv.Registro.Fields("IGCondicion").Value, _
''                                                   oProv.Registro.Fields("FechaLimiteExentoGanancias").Value)
''                  oProv.Guardar
''               End If
''            End If
''            oRs.Close
''         End If
''         If i >= 2 Then
'            'mCuit = mId(Filas(i), 21, 2) & "-" & mId(Filas(i), 23, 8) & "-" & mId(Filas(i), 31, 1)
'            mCuit = mId(Columnas(1), 1, 2) & "-" & mId(Columnas(1), 3, 8) & "-" & mId(Columnas(1), 11, 1)
'            Set oRs = oAp.Proveedores.TraerFiltrado("_PorCuit", mCuit)
'            If oRs.RecordCount > 0 Then
'               If IsNull(oRs.Fields("Eventual").Value) Or oRs.Fields("Eventual").Value <> "SI" Then
'                  Set oProv = oAp.Proveedores.Item(oRs.Fields(0).Value)
'                  'If CInt(mId(Filas(i), 46, 5)) = 100 Then
'                  If CInt(Columnas(3)) = 100 Then
'                     oProv.Registro.Fields("IGCondicion").Value = 1
'                     oProv.Registro.Fields("FechaLimiteExentoGanancias").Value = CDate(Trim(Columnas(9))) 'CDate(mId(Filas(i), 131, 10))
'                  Else
'                     oProv.Registro.Fields("IGCondicion").Value = 2
'                     oProv.Registro.Fields("FechaLimiteExentoGanancias").Value = Null
'                  End If
'                  oAp.Tarea "LogImpuestos_A", Array(mFechaLog, "RG830", oRs.Fields(0).Value, _
'                                                   oProv.Registro.Fields("IGCondicion").Value, _
'                                                   oProv.Registro.Fields("FechaLimiteExentoGanancias").Value)
'                  oProv.Guardar
'               End If
'            End If
'            oRs.Close
''         End If
      
      If mCodigo = 2 Then
         If Len(Filas(i)) >= 130 Then
            If mId(Filas(i), 110, 4) = "RG17" Or mId(Filas(i), 110, 6) = "RG2226" Then
               If mPrimero Then
                  mPrimero = False
                  mFechaLog = Now
                  oAp.Tarea "Proveedores_EstadoInicialImpositivo", Array(mFechaLog, mId(Filas(i), 112, 6))
               End If
               Columnas = VBA.Split(Filas(i), vbTab)
               mCuit = mId(Filas(i), 2, 2) & "-" & mId(Filas(i), 4, 8) & "-" & mId(Filas(i), 12, 1)
               Set oRs = oAp.Proveedores.TraerFiltrado("_PorCuit", mCuit)
               If oRs.RecordCount > 0 Then
                  If IsNull(oRs.Fields("Eventual").Value) Or oRs.Fields("Eventual").Value <> "SI" Then
                     Set oProv = oAp.Proveedores.Item(oRs.Fields(0).Value)
'                     If CSng(mId(Filas(i), 104, 5)) = 100 Then
'                        oProv.Registro.Fields("IvaExencionRetencion").Value = "SI"
'                        oProv.Registro.Fields("IvaPorcentajeExencion").Value = Null
'                        oProv.Registro.Fields("IvaFechaCaducidadExencion").Value = CDate(mId(Filas(i), 86, 10))
'                     Else
                        oProv.Registro.Fields("IvaExencionRetencion").Value = "NO"
                        oProv.Registro.Fields("IvaPorcentajeExencion").Value = CSng(mId(Filas(i), 104, 5))
                        oProv.Registro.Fields("IvaFechaInicioExencion").Value = CDate(mId(Filas(i), 75, 10))
                        oProv.Registro.Fields("IvaFechaCaducidadExencion").Value = CDate(mId(Filas(i), 86, 10))
'                     End If
                     oAp.Tarea "LogImpuestos_A", Array(mFechaLog, mId(Filas(i), 112, 6), oRs.Fields(0).Value, _
                                                      -1, Null, _
                                                      oProv.Registro.Fields("IvaExencionRetencion").Value, _
                                                      oProv.Registro.Fields("IvaPorcentajeExencion").Value, _
                                                      oProv.Registro.Fields("IvaFechaCaducidadExencion").Value)
                     oProv.Guardar
                  End If
               End If
               oRs.Close
            End If
         End If
      
      ElseIf mCodigo = 4 Then
         Columnas = VBA.Split(Filas(i), ",")
         If UBound(Columnas) < 6 Then
            MsgBox "Archivo invalido", vbExclamation
            GoTo Salida
         End If
         'If IsNumeric(mId(Filas(i), 95, 1)) Then
         If IsNumeric(Columnas(4)) Then
            If mPrimero Then
               mPrimero = False
               mFechaLog = Now
               oAp.Tarea "Proveedores_EstadoInicialImpositivo", Array(mFechaLog, "ReproWeb")
            End If
            mCuit = mId(Trim(Columnas(1)), 1, 2) & "-" & mId(Trim(Columnas(1)), 3, 8) & "-" & mId(Trim(Columnas(1)), 11, 1)
            Set oRs = oAp.Proveedores.TraerFiltrado("_PorCuit", mCuit)
            If oRs.RecordCount > 0 Then
               Set oProv = oAp.Proveedores.Item(oRs.Fields(0).Value)
               'oProv.Registro.Fields("CodigoSituacionRetencionIVA").Value = CLng(mId(Filas(i), 95, 1))
               oProv.Registro.Fields("CodigoSituacionRetencionIVA").Value = CLng(Columnas(4))
               oAp.Tarea "LogImpuestos_A", Array(mFechaLog, "ReproWeb", oRs.Fields(0).Value, _
                                                -1, Null, Null, -1, Null, _
                                                oProv.Registro.Fields("CodigoSituacionRetencionIVA").Value)
               oProv.Guardar
            End If
            oRs.Close
         End If
   
      ElseIf mCodigo = 5 Then
'         Columnas = VBA.Split(Filas(i), vbTab)
''         If UBound(Columnas) < 7 Then
''            MsgBox "Archivo invalido", vbExclamation
''            GoTo Salida
''         End If
'         If i >= 1 And Len(Columnas(0)) >= 11 Then
'            mCuit = mId(Columnas(0), 1, 2) & "-" & mId(Columnas(0), 3, 8) & "-" & mId(Columnas(0), 11, 1)
'            Set oRs = oAp.Proveedores.TraerFiltrado("_PorCuit", mCuit)
'            If oRs.RecordCount > 0 Then
'               Set oProv = oAp.Proveedores.Item(oRs.Fields(0).Value)
'               Columnas = VBA.Split(Filas(i + 2), vbTab)
'               If Len(Columnas(0)) > 50 Then
'                  If CInt(mId(Columnas(0), 31, 4)) = 100 And IsDate(mId(Columnas(0), 63, 9)) Then
'                     With oProv.Registro
'                        .Fields("RetenerSUSS").Value = "EX"
'                        .Fields("SUSSFechaCaducidadExencion").Value = CDate(mId(Columnas(0), 63, 9))
'                        .Fields("IdImpuestoDirectoSUSS").Value = Null
'                     End With
'                  End If
'                  oProv.Guardar
'               End If
'               i = i + 3
'            End If
'            oRs.Close
         If IsNumeric(mId(Filas(i), 1, 11)) Then
            mCuit = mId(Filas(i), 1, 2) & "-" & mId(Filas(i), 3, 8) & "-" & mId(Filas(i), 11, 1)
            Set oRs = oAp.Proveedores.TraerFiltrado("_PorCuit", mCuit)
            If oRs.RecordCount > 0 Then
'               mOk = False
'               For j = i To i + 10
'                  If IsDate(mId(Filas(j), 63, 9)) Then
'                     mOk = True
'                     i = j
'                     Exit For
'                  End If
'               Next
'               If mOk Then
                  Set oProv = oAp.Proveedores.Item(oRs.Fields(0).Value)
                  Columnas = VBA.Split(Filas(i), ";")
                  If UBound(Columnas) <> 7 Then
                     If mPrimero Then
                        MsgBox "Archivo invalido", vbExclamation
                        GoTo Salida
                     End If
                  End If
                  If mPrimero Then
                     mPrimero = False
                     mFechaLog = Now
                     oAp.Tarea "Proveedores_EstadoInicialImpositivo", Array(mFechaLog, "SUSS")
                  End If
                  mAuxS1 = Columnas(7)
                  mAuxS1 = Replace(mAuxS1, "JAN", "01")
                  mAuxS1 = Replace(mAuxS1, "FEB", "02")
                  mAuxS1 = Replace(mAuxS1, "MAR", "03")
                  mAuxS1 = Replace(mAuxS1, "APR", "04")
                  mAuxS1 = Replace(mAuxS1, "MAY", "05")
                  mAuxS1 = Replace(mAuxS1, "JUN", "06")
                  mAuxS1 = Replace(mAuxS1, "JUL", "07")
                  mAuxS1 = Replace(mAuxS1, "AUG", "08")
                  mAuxS1 = Replace(mAuxS1, "SEP", "09")
                  mAuxS1 = Replace(mAuxS1, "OCT", "10")
                  mAuxS1 = Replace(mAuxS1, "NOV", "11")
                  mAuxS1 = Replace(mAuxS1, "DEC", "12")
                  If Val(Columnas(3)) = 100 And IsDate(mAuxS1) Then
                     With oProv.Registro
                        .Fields("RetenerSUSS").Value = "EX"
                        .Fields("SUSSFechaCaducidadExencion").Value = CDate(mAuxS1)
                        .Fields("IdImpuestoDirectoSUSS").Value = Null
                     End With
                     oAp.Tarea "LogImpuestos_A", Array(mFechaLog, "SUSS", oRs.Fields(0).Value, _
                                                      -1, Null, Null, -1, Null, -1, _
                                                      oProv.Registro.Fields("SUSSFechaCaducidadExencion").Value)
                  oProv.Guardar
                  End If
'               End If
            End If
            oRs.Close
         End If
      
      ElseIf mCodigo = 6 Then
         If Len(Filas(i)) < 30 Then
            MsgBox "Archivo invalido", vbExclamation
            GoTo Salida
         End If
         mAux1 = mId(Trim(Filas(i)), 7, 2) & "/" & mId(Trim(Filas(i)), 5, 2) & "/" & mId(Trim(Filas(i)), 1, 4) & " Rentas Bs.As."
         mAux2 = Val(mId(Trim(Filas(i)), 20, 13)) / 100
         mCuit = mId(Trim(Filas(i)), 9, 2) & "-" & mId(Trim(Filas(i)), 11, 8) & "-" & mId(Trim(Filas(i)), 19, 1)
         Set oRs = oAp.Proveedores.TraerFiltrado("_PorCuit", mCuit)
         If oRs.RecordCount > 0 Then
            Set oProv = oAp.Proveedores.Item(oRs.Fields(0).Value)
            With oProv.Registro
               .Fields("SujetoEmbargado").Value = "SI"
               .Fields("SaldoEmbargo").Value = mAux2
               .Fields("DetalleEmbargo").Value = mAux1
            End With
            oProv.Guardar
         End If
         oRs.Close
   
'      ElseIf mCodigo = 7 Then
'         Columnas = VBA.Split(Filas(i), ";")
'         If UBound(Columnas) < 6 Then
'            MsgBox "Archivo invalido", vbExclamation
'            GoTo Salida
'         End If
'
'         mAuxS1 = mId(Trim(Columnas(1)), 1, 2) & "/" & mId(Trim(Columnas(1)), 3, 2) & "/" & mId(Trim(Columnas(1)), 5, 4)
'         mAuxS2 = mId(Trim(Columnas(2)), 1, 2) & "/" & mId(Trim(Columnas(2)), 3, 2) & "/" & mId(Trim(Columnas(2)), 5, 4)
'         mAuxS3 = Replace(Columnas(8), ",", ".")
'         mAuxS4 = Replace(Columnas(7), ",", ".")
'
'         If IsDate(mAuxS1) And IsDate(mAuxS2) And IsNumeric(mAuxS3) Then
'            If mPrimero Then
'               mPrimero = False
'               mFechaLog = Now
'               oAp.Tarea "Proveedores_EstadoInicialImpositivo", Array(mFechaLog, "IIBB")
'            End If
'            mCuit = mId(Trim(Columnas(3)), 1, 2) & "-" & mId(Trim(Columnas(3)), 3, 8) & "-" & mId(Trim(Columnas(3)), 11, 1)
'            If oRsAux1.RecordCount > 0 Then
'               oRsAux1.MoveFirst
'               oRsAux1.Find "Cuit = " & mCuit
'               If Not oRsAux1.EOF Then
'                  oAp.Tarea "Proveedores_ActualizarDatosIIBB", _
'                        Array(oRsAux1.Fields(0).Value, Val(mAuxS3), CDate(mAuxS1), CDate(mAuxS2), CInt(Columnas(10)))
'                  oAp.Tarea "LogImpuestos_A", Array(mFechaLog, "IIBB", oRsAux1.Fields(0).Value, _
'                                                   -1, Null, Null, -1, Null, -1, Null, _
'                                                   Val(mAuxS3), CDate(mAuxS1), CDate(mAuxS2), CInt(Columnas(10)))
'               End If
'            End If
'
'            If oRsAux2.RecordCount > 0 Then
'               oRsAux2.MoveFirst
'               oRsAux2.Find "Cuit = " & mCuit
'               If Not oRsAux2.EOF Then
'                  oAp.Tarea "Clientes_ActualizarDatosIIBB", _
'                        Array(oRsAux2.Fields(0).Value, Val(mAuxS4), CDate(mAuxS1), CDate(mAuxS2), CInt(Columnas(9)))
'                  oAp.Tarea "LogImpuestos_A", Array(mFechaLog, "IIBB", -1, _
'                                                   -1, Null, Null, -1, Null, -1, Null, _
'                                                   Val(mAuxS4), CDate(mAuxS1), CDate(mAuxS2), CInt(Columnas(9)), _
'                                                   oRsAux2.Fields(0).Value)
'               End If
'            End If
'         End If
      
      ElseIf mCodigo = 8 Then
         If Len(Filas(i)) < 30 Then
            MsgBox "Archivo invalido", vbExclamation
            GoTo Salida
         End If
         If mId(Trim(Filas(i)), 1, 1) = "2" Then
            mAuxS1 = mId(Trim(Filas(i)), 10, 2)
            Select Case mAuxS1
               Case "01"
                  mAuxS2 = "A"
               Case "06"
                  mAuxS2 = "B"
               Case "11"
                  mAuxS2 = "C"
               Case "19"
                  mAuxS2 = "E"
               Case Else
                  mAuxS2 = "A"
            End Select
            mAuxL1 = CLng(mId(Trim(Filas(i)), 12, 4))
            mAuxL2 = CLng(mId(Trim(Filas(i)), 16, 8))
            mAuxL3 = CLng(mId(Trim(Filas(i)), 24, 8))
            For X = mAuxL2 To mAuxL3
               Set oRs = oAp.Facturas.TraerFiltrado("_PorNumeroComprobante", Array(mAuxS2, mAuxL1, X))
               If oRs.RecordCount > 0 Then
                  If mId(Trim(Filas(i)), 1, 1) = "2" Then
                     mAuxS3 = mId(Trim(Filas(i)), 136, 14)
                     mAuxD1 = CDate(mId(Trim(Filas(i)), 156, 2) & "/" & mId(Trim(Filas(i)), 154, 2) & "/" & mId(Trim(Filas(i)), 150, 4))
                     oAp.Tarea "Facturas_ActualizarDatosCAE", Array(oRs.Fields(0).Value, mAuxS3, Null, mAuxD1)
                  ElseIf mId(Trim(Filas(i)), 1, 1) = "4" Then
                     mAuxS3 = mId(Trim(Filas(i)), 144, 11)
                     mAuxD1 = CDate(mId(Trim(Filas(i)), 142, 2) & "/" & mId(Trim(Filas(i)), 140, 2) & "/" & mId(Trim(Filas(i)), 136, 4))
                     oAp.Tarea "Facturas_ActualizarDatosCAE", Array(oRs.Fields(0).Value, Null, mAuxS3, mAuxD1)
                  End If
               End If
               oRs.Close
            Next
         End If
      
      ElseIf mCodigo = 9 Then
         Columnas = VBA.Split(Filas(i), ";")
         If UBound(Columnas) < 6 Then
            MsgBox "Archivo invalido", vbExclamation
            GoTo Salida
         End If
         
         mAuxS1 = mId(Trim(Columnas(1)), 1, 2) & "/" & mId(Trim(Columnas(1)), 3, 2) & "/" & mId(Trim(Columnas(1)), 5, 4)
         mAuxS2 = mId(Trim(Columnas(2)), 1, 2) & "/" & mId(Trim(Columnas(2)), 3, 2) & "/" & mId(Trim(Columnas(2)), 5, 4)
         mAuxS3 = Replace(Columnas(8), ",", ".")
         mAuxS4 = Replace(Columnas(7), ",", ".")
         
         If IsDate(mAuxS1) And IsDate(mAuxS2) And IsNumeric(mAuxS3) Then
            If mPrimero Then
               mPrimero = False
               mFechaLog = Now
               oAp.Tarea "Proveedores_EstadoInicialImpositivo", Array(mFechaLog, "IIBB Cap", 1)
            End If
            mCuit = mId(Trim(Columnas(3)), 1, 2) & "-" & mId(Trim(Columnas(3)), 3, 8) & "-" & mId(Trim(Columnas(3)), 11, 1)
            If oRsAux1.RecordCount > 0 Then
               oRsAux1.MoveFirst
               oRsAux1.Find "Cuit = " & mCuit
               If Not oRsAux1.EOF Then
                  oAp.Tarea "Proveedores_ActualizarDatosIIBB", _
                        Array(oRsAux1.Fields(0).Value, Val(mAuxS3), CDate(mAuxS1), CDate(mAuxS2), CInt(Columnas(10)), 1)
                  oAp.Tarea "LogImpuestos_A", Array(mFechaLog, "IIBB Cap", oRsAux1.Fields(0).Value, -1, Null, Null, -1, Null, -1, _
                                                    Null, Val(mAuxS3), CDate(mAuxS1), CDate(mAuxS2), CInt(Columnas(10)))
               End If
            End If
            
            If oRsAux2.RecordCount > 0 Then
               oRsAux2.MoveFirst
               oRsAux2.Find "Cuit = " & mCuit
               If Not oRsAux2.EOF Then
                  oAp.Tarea "Clientes_ActualizarDatosIIBB", _
                        Array(oRsAux2.Fields(0).Value, Val(mAuxS4), CDate(mAuxS1), CDate(mAuxS2), CInt(Columnas(9)), 1)
                  oAp.Tarea "LogImpuestos_A", Array(mFechaLog, "IIBB Cap", -1, -1, Null, Null, -1, Null, -1, Null, Val(mAuxS4), _
                                                   CDate(mAuxS1), CDate(mAuxS2), CInt(Columnas(9)), oRsAux2.Fields(0).Value)
               End If
            End If
         End If
      End If
   Next

Salida:
   On Error Resume Next
   
   Unload oF
   Set oF = Nothing
   Unload of1
   Set of1 = Nothing

   If mCodigo = 7 Then
      oRsAux1.Close
      oRsAux2.Close
   End If
   
   Set oRs = Nothing
   Set oRsAux1 = Nothing
   Set oRsAux2 = Nothing
   Set oProv = Nothing
   Set oCli = Nothing
   Set oAp = Nothing

   If mPrimero And mCodigo <> 1 Then MsgBox "Se ha completado el proceso sin ningun registro procesado.", vbInformation
   
   Exit Sub

Mal:
   MsgBox "Se ha producido un error al registrar los datos" & vbCrLf & Err.Number & " -> " & Err.Description, vbCritical
   Resume Salida

End Sub

Public Sub MarcaImpresion(ByVal Marca As String, ByVal Tipo As String)

   Dim oF As frmAutorizacion
   Dim iFilas As Integer
   Dim mMarca As String, mFiltro As String
   Dim mOk As Boolean
   Dim Filas, Columnas
   
   Set oF = New frmAutorizacion
   With oF
      .Empleado = 0
      .Administradores = True
      .Show vbModal, Me
      mOk = .Ok
   End With
   Unload oF
   Set oF = Nothing
   If Not mOk Then Exit Sub
   
   Me.Refresh
   
   If Marca = "Marcar" Then mMarca = "SI" Else mMarca = "NO"
   
   Filas = VBA.Split(Lista.GetString, vbCrLf)
   For iFilas = LBound(Filas) + 1 To UBound(Filas)
      Columnas = VBA.Split(Filas(iFilas), vbTab)
      Select Case Tipo
         Case "RM"
            Aplicacion.Tarea "Requerimientos_RegistrarImpresion", Array(Columnas(2), mMarca)
         Case "PE"
            Aplicacion.Tarea "Pedidos_RegistrarImpresion", Array(Columnas(17), mMarca)
      End Select
   Next
   mFiltro = Lista.Filtrado
   Arbol_NodeClick Arbol.SelectedItem
   If Len(mFiltro) > 0 Then Lista.Filtrado = mFiltro

End Sub

Public Sub GrabarDetalleRM()

   Dim mDetalle As String
   Dim mOk As Boolean
   Dim oF As frm_Aux
   
   Set oF = New frm_Aux
   With oF
      .Caption = "Imputacion de RM"
      .Label1.Caption = "Imputacion :"
      '.Label1.Visible = False
      .Text1.Width = .Text1.Width * 3
      .Width = .Width * 1.6
      .Show vbModal, Me
      mOk = .Ok
      mDetalle = .Text1.Text
   End With
   Unload oF
   Set oF = Nothing
   Me.Refresh
   
   If Not mOk Then Exit Sub
   
   Dim iFilas As Integer
   Dim Filas, Columnas
   
   Filas = VBA.Split(Lista.GetString, vbCrLf)
   For iFilas = LBound(Filas) + 1 To UBound(Filas)
      Columnas = VBA.Split(Filas(iFilas), vbTab)
      Aplicacion.Tarea "Requerimientos_RegistrarImpresion", Array(Columnas(2), "", mId(mDetalle, 1, 50))
   Next
   Arbol_NodeClick Arbol.SelectedItem

End Sub

Public Sub MarcarCuentasGastoComoActivas(ByVal Marca As String)

   Dim oL As ListItem
   Dim iFilas As Integer, i As Integer
   Dim Filas, Columnas
   
   i = 0
   For Each oL In Lista.ListItems
      If oL.SubItems(3) = "SI" Then i = i + 1
   Next
   
   Filas = VBA.Split(Lista.GetString, vbCrLf)
   For iFilas = LBound(Filas) + 1 To UBound(Filas)
      Columnas = VBA.Split(Filas(iFilas), vbTab)
      If IsNumeric(Columnas(2)) Then
         If i = 1000 And Marca = "SI" Then
            MsgBox "No puede marcar mas de 1000 cuentas de gastos como activas", vbExclamation
            GoTo Salida
         End If
         Aplicacion.Tarea "CuentasGastos_MarcarComoActiva", Array(Columnas(2), Marca)
         If Marca = "SI" And Columnas(3) <> "SI" Then i = i + 1
      End If
   Next
Salida:
   Arbol_NodeClick Arbol.SelectedItem

End Sub

Public Sub MarcarValoresComoConfirmados()

   On Error GoTo Mal
   
   Dim oF As frm_Aux
   Dim mOk As Boolean
   Dim mFecha As Date
   
   Set oF = New frm_Aux
   With oF
      .Caption = "Confirmacion"
      .Text1.Visible = False
      .Label1.Caption = "Fecha conf.:"
      With .DTFields(0)
         .Top = oF.Text1.Top
         .Left = oF.Text1.Left
         .Value = Date
         .Visible = True
      End With
      .Show vbModal, Me
      mOk = .Ok
      mFecha = .DTFields(0).Value
   End With
   Unload oF
   Set oF = Nothing
   
   If Not mOk Then Exit Sub
   
   Dim Filas, Columnas, mVector
   Dim iFilas As Integer
   
   Filas = VBA.Split(Lista.GetString, vbCrLf)
   For iFilas = LBound(Filas) + 1 To UBound(Filas)
      Columnas = VBA.Split(Filas(iFilas), vbTab)
      If IsNumeric(Columnas(2)) Then
         Aplicacion.Tarea "Valores_MarcarComoConfirmado", Array(Columnas(2), glbIdUsuario, mFecha)
      End If
   Next
         
Salida:

   Exit Sub

Mal:
   
   Dim mvarResp As Integer
   Select Case Err.Number
      Case Else
         MsgBox "Se ha producido un error al registrar los datos" & vbCrLf & Err.Number & " -> " & Err.Description, vbCritical
   End Select
   Resume Salida

End Sub

Public Sub TransferirAnticiposAlPersonalSyJ()

   'On Error GoTo Mal
   
   Dim oF As frm_Aux
   Dim mIdParametroLiquidacion As Integer
   Dim mOk As Boolean
   
   Set oF = New frm_Aux
   With oF
      .Caption = "Transferencia de anticipos al SyJ"
      .Text1.Visible = False
      .Label1.Caption = "Liquidacion :"
      With .dcfields(0)
         .Top = oF.Text1.Top
         .Left = oF.Text1.Left
         .Width = .Width * 2
         .BoundColumn = "IdParametroLiquidacion"
         Set .RowSource = Aplicacion.AnticiposAlPersonalSyJ.TraerFiltrado("_ParametrosLiquidaciones")
         .Visible = True
      End With
      .Width = .Width * 1.3
      .Show vbModal, Me
      mOk = .Ok
      If IsNumeric(.dcfields(0).BoundText) Then
         mIdParametroLiquidacion = .dcfields(0).BoundText
      End If
   End With
   Unload oF
   Set oF = Nothing
   
   If Not mOk Then Exit Sub
   If mIdParametroLiquidacion = 0 Then
      MsgBox "No eligio una liquidacion para la transferencia", vbExclamation
      Exit Sub
   End If
   
   Aplicacion.Tarea "AnticiposAlPersonalSyJ_TransferirAnticiposAlSyJ", mIdParametroLiquidacion
   Arbol_NodeClick Arbol.SelectedItem
   MsgBox "Proceso Concluido"
   
Salida:

   Exit Sub

Mal:
   
   Dim mvarResp As Integer
   Select Case Err.Number
      Case Else
         MsgBox "Se ha producido un error al registrar los datos" & vbCrLf & Err.Number & " -> " & Err.Description, vbCritical
   End Select
   Resume Salida

End Sub

Public Sub MarcarOrdenesCompraParaFacturacionAutomatica(ByVal Marca As String)

   Dim iFilas As Integer
   Dim Filas, Columnas
   
   Filas = VBA.Split(Lista.GetString, vbCrLf)
   For iFilas = LBound(Filas) + 1 To UBound(Filas)
      Columnas = VBA.Split(Filas(iFilas), vbTab)
      If IsNumeric(Columnas(2)) Then
         Aplicacion.Tarea "OrdenesCompra_MarcarParaFacturacionAutomatica", Array(Columnas(2), Marca)
      End If
   Next
   Arbol_NodeClick Arbol.SelectedItem

End Sub

Public Sub ImportacionAsientos()

   Dim oAp As ComPronto.Aplicacion
   Dim oAsi As ComPronto.Asiento
   Dim oPar As ComPronto.Parametro
   Dim oRsAux1 As ADOR.Recordset
   Dim oF As Form
   Dim oEx As Excel.Application
   Dim mOk As Boolean, mConProblemas As Boolean, mProceso As Boolean
   Dim mArchivos As String, mArchivo As String, mArchivo1 As String, mDoc As String
   Dim mPathEntrante As String, mPathBackup As String, s As String, s1 As String
   Dim mDetalle As String, mModelo1 As String, mCodigoSecundario As String
   Dim s2 As String, mAuxS1 As String
   Dim fl As Integer, i As Integer, j As Integer, mModelo As Integer
   Dim mIdAsiento As Long, mIdCuenta As Long, mIdCuentaBancaria As Long
   Dim mIdCaja As Long, mNumeroAsiento As Long
   Dim mDebe As Double, mHaber As Double
   Dim mAuxD1 As Date
   Dim mVector, mVectorAux, Filas, Columnas

   On Error GoTo Mal

   Set oAp = Aplicacion

   Set oF = New frmAviso
   With oF
      .Label1 = "Iniciando ..."
      .Show
      .Refresh
      DoEvents
   End With

   oF.Label1 = oF.Label1 & vbCrLf & "Procesando asientos ..."
   oF.Label2 = ""
   oF.Label3 = ""
   DoEvents

   mModelo1 = BuscarClaveINI("Modelo de importacion de asientos")
   If Len(mModelo1) = 0 Then
      mModelo = 1
   Else
      mModelo = Val(mModelo1)
   End If
   
   If mModelo = 1 Then
      fl = 2
   ElseIf mModelo = 2 Then
      fl = 7
   End If
   
   mPathEntrante = "C:\"
   Set oRsAux1 = oAp.Parametros.TraerFiltrado("_PorId", 1)
   If oRsAux1.RecordCount > 0 Then
      mPathEntrante = IIf(IsNull(oRsAux1.Fields("PathImportacionDatos").Value), "C:\", oRsAux1.Fields("PathImportacionDatos").Value)
   End If
   oRsAux1.Close
   mPathBackup = mPathEntrante & "Backup\"
   
   Set oEx = CreateObject("Excel.Application")
   
   mArchivos = ""
   mArchivo = Dir(mPathEntrante & "*.*", vbArchive)
   Do While mArchivo <> ""
      mArchivos = mArchivos & mArchivo & ", "
      mArchivo = Dir
   Loop
   
   s2 = ""
   If Len(mArchivos) > 0 Then
      mVector = VBA.Split(mArchivos, ",")
      For i = 0 To UBound(mVector)
         mArchivo = Trim(UCase(mVector(i)))
         If Len(Trim(mArchivo)) > 0 Then
            
            mConProblemas = False
            s = "Proceso archivo : " & mArchivo
            
            Set oRsAux1 = oAp.Asientos.TraerFiltrado("_PorArchivoImportacion", mId(mArchivo, 1, 50))
            mIdAsiento = -1
            If oRsAux1.RecordCount > 0 Then
               mIdAsiento = oRsAux1.Fields(0).Value
               mNumeroAsiento = oRsAux1.Fields("NumeroAsiento").Value
               s = s & " - Modificacion" & vbCrLf
            Else
               s = s & vbCrLf
            End If
            oRsAux1.Close
            
            Set oAsi = oAp.Asientos.Item(mIdAsiento)
            
            oF.Label1 = oF.Label1 & vbCrLf & mArchivo
            DoEvents
            
            s1 = ""
            mProceso = False
            If Right(mArchivo, 3) = "XLS" Or InStr(1, mArchivo, ".") = 0 Then
               mProceso = True
               With oEx
                  .Visible = True
                  .WindowState = xlMinimized
                  Me.Refresh
                  With .Workbooks.Open(mPathEntrante & mArchivo)
                     '.Sheets("Asiento diario").Select
                     With .ActiveSheet
                        If mModelo = 2 Then
                           For j = 1 To 100
                              If UCase(.Cells(j, 1)) = "CUENTA" Then
                                 fl = j + 2
                                 Exit For
                              End If
                           Next
                        End If
                        Do While True
                           If Len(Trim(.Cells(fl, 1))) > 0 Then
                              mIdCuentaBancaria = 0
                              mIdCaja = 0
                              mDetalle = ""
                              mDebe = 0
                              mHaber = 0
                              
                              If mModelo = 1 Then
                                 mCodigoSecundario = .Cells(fl, 1)
                                 
                                 If Len(Trim(.Cells(fl, 4))) > 0 Then
                                    Set oRsAux1 = oAp.CuentasBancarias.TraerFiltrado("_PorCuenta", .Cells(fl, 4))
                                    If oRsAux1.RecordCount > 0 Then
                                       mIdCuentaBancaria = oRsAux1.Fields(0).Value
                                    Else
                                       s1 = s1 & "Cuenta bancaria " & .Cells(fl, 4) & ", inexistente" & vbCrLf
                                    End If
                                    oRsAux1.Close
                                 End If
                                 
                                 If Len(Trim(.Cells(fl, 5))) > 0 Then
                                    Set oRsAux1 = oAp.Cajas.TraerFiltrado("_PorDescripcion", .Cells(fl, 5))
                                    If oRsAux1.RecordCount > 0 Then
                                       mIdCaja = oRsAux1.Fields(0).Value
                                    Else
                                       s1 = s1 & "Caja " & .Cells(fl, 5) & ", inexistente" & vbCrLf
                                    End If
                                    oRsAux1.Close
                                 End If
                                 
                                 mDetalle = mId(.Cells(fl, 3), 1, 50)
                                 If Len(Trim(.Cells(fl, 6))) > 0 Then mDebe = Val(.Cells(fl, 6))
                                 If Len(Trim(.Cells(fl, 7))) > 0 Then mHaber = Val(.Cells(fl, 7))
                              ElseIf mModelo = 2 Then
                                 If InStr(1, .Cells(fl, 1), "-") <> 0 Then
                                    mVectorAux = VBA.Split(.Cells(fl, 1), "-")
                                    mCodigoSecundario = Trim(mVectorAux(0))
                                    If Len(Trim(.Cells(fl, 4))) > 0 Then mDebe = Val(.Cells(fl, 4))
                                    If Len(Trim(.Cells(fl, 5))) > 0 Then mHaber = Val(.Cells(fl, 5))
                                 Else
                                    GoTo Vuelta
                                 End If
                              End If
                              
                              Set oRsAux1 = oAp.Cuentas.TraerFiltrado("_PorCodigoSecundario", mCodigoSecundario)
                              mIdCuenta = 0
                              If oRsAux1.RecordCount > 0 Then
                                 mIdCuenta = oRsAux1.Fields(0).Value
                              Else
                                 mConProblemas = True
                                 s1 = s1 & "Cuenta " & mCodigoSecundario & ", inexistente" & vbCrLf
                                 GoTo Vuelta
                              End If
                              oRsAux1.Close
                              
                              If mDebe = 0 And mHaber = 0 Then GoTo Vuelta
                              
                              With oAsi.DetAsientos.Item(-1)
                                 With .Registro
                                    .Fields("IdCuenta").Value = mIdCuenta
                                    .Fields("Detalle").Value = mDetalle
                                    .Fields("IdMoneda").Value = 1
                                    .Fields("CotizacionMoneda").Value = 1
                                    .Fields("IdCuentaBancaria").Value = mIdCuentaBancaria
                                    .Fields("IdCaja").Value = mIdCaja
                                    .Fields("Debe").Value = mDebe
                                    .Fields("Haber").Value = mHaber
                                 End With
                                 .Modificado = True
                              End With
            
                              oF.Label2 = "Linea : " & fl
                              DoEvents
Vuelta:
                              fl = fl + 1
               
                           Else
                              Exit Do
                           End If
                        Loop
                        
                        If oAsi.DetAsientos.TotalDebe <> oAsi.DetAsientos.TotalHaber Then
                           mConProblemas = True
                           s1 = s1 & "El asiento del archivo " & mArchivo & ", no balancea y fue descartado." & vbCrLf
                        End If
                        
                        mAuxS1 = mId(mArchivo, 14, 2) & "/" & mId(mArchivo, 12, 2) & "/" & mId(mArchivo, 8, 4)
                        If IsDate(mAuxS1) Then
                           mAuxD1 = CDate(mAuxS1)
                        Else
                           mAuxD1 = Date
                        End If
                        If mAuxD1 <= gblFechaUltimoCierre Then
                           mConProblemas = True
                           s1 = s1 & "La fecha del asiento " & mArchivo & ", no puede ser anterior al ultimo cierre : " & gblFechaUltimoCierre & vbCrLf
                        End If
                        
                        If Len(s1) > 0 Then
                           s = s & s1 & vbCrLf
                        Else
                           s = s & "Procesado correctamente" & vbCrLf & vbCrLf
                        End If
                        If Not mConProblemas Then
                           If mIdAsiento = -1 Then
                              Set oPar = oAp.Parametros.Item(1)
                              mNumeroAsiento = IIf(IsNull(oPar.Registro.Fields("ProximoAsiento").Value), 1, oPar.Registro.Fields("ProximoAsiento").Value)
                              oPar.Registro.Fields("ProximoAsiento").Value = mNumeroAsiento + 1
                              oPar.Guardar
                              Set oPar = Nothing
                              With oAsi.Registro
                                 .Fields("NumeroAsiento").Value = mNumeroAsiento
                                 .Fields("FechaAsiento").Value = mAuxD1
                                 .Fields("IdIngreso").Value = glbIdUsuario
                                 .Fields("FechaIngreso").Value = Now
                              End With
                           Else
                              With oAsi.Registro
                                 .Fields("IdModifico").Value = glbIdUsuario
                                 .Fields("FechaUltimaModificacion").Value = Now
                              End With
                              oAp.Tarea "Asientos_EliminarDetalles", mIdAsiento
                           End If
                           oAsi.Registro.Fields("ArchivoImportacion").Value = mId(mArchivo, 1, 50)
                           oAsi.Registro.Fields("Concepto").Value = mId(mArchivo, 1, 50)
                           oAsi.Guardar
                           Set oAsi = Nothing
                        End If
                     End With
                     .Close False
                  End With
                  .Quit
               End With
            
            ElseIf Right(mArchivo, 3) = "CSV" Then
               mProceso = True
               mDoc = LeerArchivoSecuencial1(mPathEntrante & mArchivo)
               Filas = VBA.Split(mDoc, Chr(10))
               For j = LBound(Filas) + 1 To UBound(Filas)
                  If InStr(1, Filas(j), ";") <> 0 Then
                     Columnas = VBA.Split(Filas(j), ";")
                  
                     mIdCuentaBancaria = 0
                     mIdCaja = 0
                     mDetalle = ""
                     mDebe = 0
                     mHaber = 0
                        
                     mCodigoSecundario = Columnas(0)
                     If Len(Trim(mCodigoSecundario)) > 0 Then
                        If Len(Trim(Columnas(3))) > 0 Then
                           Set oRsAux1 = oAp.CuentasBancarias.TraerFiltrado("_PorCuenta", Columnas(3))
                           If oRsAux1.RecordCount > 0 Then
                              mIdCuentaBancaria = oRsAux1.Fields(0).Value
                           Else
                              s1 = s1 & "Cuenta bancaria " & Columnas(3) & ", inexistente" & vbCrLf
                           End If
                           oRsAux1.Close
                        End If
                        
                        mDetalle = mId(Columnas(2), 1, 50)
                        If Len(Trim(Columnas(4))) > 0 Then mDebe = Val(Replace(Columnas(4), ",", "."))
                        If Len(Trim(Columnas(5))) > 0 Then mHaber = Val(Replace(Columnas(5), ",", "."))
                        
                        Set oRsAux1 = oAp.Cuentas.TraerFiltrado("_PorCodigoSecundario", mCodigoSecundario)
                        mIdCuenta = 0
                        If oRsAux1.RecordCount > 0 Then
                           mIdCuenta = oRsAux1.Fields(0).Value
                        Else
                           mConProblemas = True
                           s1 = s1 & "Cuenta " & mCodigoSecundario & ", inexistente" & vbCrLf
                           GoTo Vuelta1
                        End If
                        oRsAux1.Close
                        
                        If Not (mDebe = 0 And mHaber = 0) Then
                           With oAsi.DetAsientos.Item(-1)
                              With .Registro
                                 .Fields("IdCuenta").Value = mIdCuenta
                                 .Fields("Detalle").Value = mDetalle
                                 .Fields("IdMoneda").Value = 1
                                 .Fields("CotizacionMoneda").Value = 1
                                 .Fields("IdCuentaBancaria").Value = mIdCuentaBancaria
                                 .Fields("IdCaja").Value = mIdCaja
                                 .Fields("Debe").Value = mDebe
                                 .Fields("Haber").Value = mHaber
                              End With
                              .Modificado = True
                           End With
      
                           oF.Label2 = "Linea : " & j
                           DoEvents
                        End If
                     End If
                  End If
Vuelta1:
               Next
               
               If oAsi.DetAsientos.TotalDebe <> oAsi.DetAsientos.TotalHaber Then
                  mConProblemas = True
                  s1 = s1 & "El asiento del archivo " & mArchivo & ", no balancea y fue descartado." & vbCrLf
               End If
                        
               If Len(s1) > 0 Then
                  s = s & s1 & vbCrLf
               Else
                  s = s & "Procesado correctamente" & vbCrLf & vbCrLf
               End If
               
               If Not mConProblemas Then
                  If mIdAsiento = -1 Then
                     Set oPar = oAp.Parametros.Item(1)
                     mNumeroAsiento = IIf(IsNull(oPar.Registro.Fields("ProximoAsiento").Value), 1, oPar.Registro.Fields("ProximoAsiento").Value)
                     oPar.Registro.Fields("ProximoAsiento").Value = mNumeroAsiento + 1
                     oPar.Guardar
                     Set oPar = Nothing
                     mAuxS1 = mId(mArchivo, 14, 2) & "/" & mId(mArchivo, 12, 2) & "/" & mId(mArchivo, 8, 4)
                     If IsDate(mAuxS1) Then
                        mAuxD1 = CDate(mAuxS1)
                     Else
                        mAuxD1 = Date
                     End If
                     With oAsi.Registro
                        .Fields("NumeroAsiento").Value = mNumeroAsiento
                        .Fields("FechaAsiento").Value = mAuxD1
                        .Fields("IdIngreso").Value = glbIdUsuario
                        .Fields("FechaIngreso").Value = Now
                     End With
                  Else
                     With oAsi.Registro
                        .Fields("IdModifico").Value = glbIdUsuario
                        .Fields("FechaUltimaModificacion").Value = Now
                     End With
                     oAp.Tarea "Asientos_EliminarDetalles", mIdAsiento
                  End If
                  oAsi.Registro.Fields("ArchivoImportacion").Value = mId(mArchivo, 1, 50)
                  oAsi.Registro.Fields("Concepto").Value = mId(mArchivo, 1, 50)
                  oAsi.Guardar
                  Set oAsi = Nothing
               End If
            
            End If
            s2 = s2 & s
            
            If Not mConProblemas And mProceso Then
               mArchivo1 = Dir(mPathBackup & mArchivo, vbArchive)
               If mArchivo1 <> "" Then Kill mPathBackup & mArchivo1
               s1 = "Copy " & mPathEntrante & mArchivo & " " & mPathBackup & mArchivo & " /Y"
               GuardarArchivoSecuencial mPathEntrante & "Copiar.bat", s1
               j = Shell(mPathEntrante & "Copiar.bat", vbHide)
               Sleep 1000
               Kill mPathEntrante & mArchivo
            End If
         End If
      Next
      
      Unload oF
      Set oF = New frm_Aux
      With oF
         .Caption = "Reporte de importacion de asientos contables"
         .Width = .Width * 2
         .Height = .Height * 2
         .cmd(0).Caption = "Salir"
         .cmd(0).Top = oF.Height - 900
         With .RichTextBox1
            .Top = 0
            .Left = 0
            .Width = oF.Width
            .Height = oF.Height - 1000
            .Text = s2
            .Visible = True
         End With
         .Show vbModal, Me
      End With
      
   End If
   
Salida:

   Unload oF
   Set oF = Nothing

   Set oRsAux1 = Nothing
   Set oAp = Nothing
   Set oAsi = Nothing
   Set oPar = Nothing
   Set oEx = Nothing

   Exit Sub

Mal:

   MsgBox "Se ha producido un error al registrar los datos" & vbCrLf & Err.Number & " -> " & Err.Description, vbCritical
   Resume Salida

End Sub

Public Sub ImportacionAsientos1()

   Dim oAp As ComPronto.Aplicacion
   Dim oAsi As ComPronto.Asiento
   Dim oPar As ComPronto.Parametro
   Dim oRsAux1 As ADOR.Recordset
   Dim oF As Form
   Dim oEx As Excel.Application
   Dim mOk As Boolean, mConProblemas As Boolean, mProceso As Boolean
   Dim mCodigo As String, mArchivo As String, mArchivo1 As String, s As String, s1 As String, s2 As String, mAuxS1 As String
   Dim mDetalle As String
   Dim fl As Integer, i As Integer, j As Integer, mModelo As Integer
   Dim mIdAsiento As Long, mIdCuenta As Long, mNumeroAsiento As Long
   Dim mDebe As Double, mHaber As Double
   Dim mFecha As Date

   On Error GoTo Mal

   Set oF = New frmPathPresto
   With oF
      .Id = 11
      .Show vbModal
      mOk = .Ok
      If mOk Then
         mArchivo = .FileBrowser1(0).Text
         mFecha = .DTFields(0).Value
      End If
   End With
   Unload oF
   Set oF = Nothing

   If Not mOk Then Exit Sub

   If mFecha <= gblFechaUltimoCierre Then
      MsgBox "La fecha del asiento no puede ser anterior al ultimo cierre : " & gblFechaUltimoCierre, vbExclamation
      Exit Sub
   End If
   
   Set oAp = Aplicacion

   Set oF = New frmAviso
   With oF
      .Label1 = "Iniciando ..."
      .Show
      .Refresh
      DoEvents
   End With

   oF.Label1 = oF.Label1 & vbCrLf & "Procesando asientos ..."
   oF.Label2 = ""
   oF.Label3 = ""
   DoEvents

   Set oEx = CreateObject("Excel.Application")
   
   If Len(Trim(mArchivo)) > 0 Then
      mConProblemas = False
      s = "Proceso archivo : " & mArchivo
      
      Set oRsAux1 = oAp.Asientos.TraerFiltrado("_PorArchivoImportacion", mId(mArchivo, 1, 200))
      mIdAsiento = -1
      If oRsAux1.RecordCount > 0 Then
         mIdAsiento = oRsAux1.Fields(0).Value
         mNumeroAsiento = oRsAux1.Fields("NumeroAsiento").Value
         s = s & " - Modificacion" & vbCrLf
      Else
         s = s & vbCrLf
      End If
      oRsAux1.Close
      
      mDetalle = ""
      fl = 2
      
      Set oAsi = oAp.Asientos.Item(mIdAsiento)
      
      oF.Label1 = oF.Label1 & vbCrLf & mArchivo
      DoEvents
            
      With oEx
         .Visible = True
         .WindowState = xlMinimized
         Me.Refresh
         With .Workbooks.Open(mArchivo)
            With .ActiveSheet
               Do While True
                  If Len(Trim(.Cells(fl, 2))) > 0 Then
                     mDebe = 0
                     mHaber = 0
                     mCodigo = LTrim(.Cells(fl, 2))
                     If InStr(1, mCodigo, " ") <> 0 Then
                        mCodigo = mId(mCodigo, 1, InStr(1, mCodigo, " ") - 1)
                     End If
                     If Trim(.Cells(fl, 4)) = "D" Then
                        If Len(Trim(.Cells(fl, 3))) > 0 Then mDebe = Val(.Cells(fl, 3))
                     Else
                        If Len(Trim(.Cells(fl, 3))) > 0 Then mHaber = Val(.Cells(fl, 3))
                     End If
                     mDetalle = mId(Trim(.Cells(fl, 5)), 1, 50)
                     
                     Set oRsAux1 = oAp.Cuentas.TraerFiltrado("_PorCodigo", IIf(IsNumeric(mCodigo), mCodigo, 0))
                     mIdCuenta = 0
                     If oRsAux1.RecordCount > 0 Then
                        mIdCuenta = oRsAux1.Fields(0).Value
                     Else
                        mConProblemas = True
                        s1 = s1 & "Cuenta " & mCodigo & ", inexistente" & vbCrLf
                        GoTo Vuelta
                     End If
                     oRsAux1.Close
                              
                     If mDebe = 0 And mHaber = 0 Then GoTo Vuelta
                              
                     With oAsi.DetAsientos.Item(-1)
                        With .Registro
                           .Fields("IdCuenta").Value = mIdCuenta
                           .Fields("Detalle").Value = mDetalle
                           .Fields("IdMoneda").Value = 1
                           .Fields("CotizacionMoneda").Value = 1
                           '.Fields("IdCuentaBancaria").Value = mIdCuentaBancaria
                           '.Fields("IdCaja").Value = mIdCaja
                           .Fields("Debe").Value = mDebe
                           .Fields("Haber").Value = mHaber
                        End With
                        .Modificado = True
                     End With
            
                     oF.Label2 = "Linea : " & fl
                     DoEvents
Vuelta:
                     fl = fl + 1
      
                  Else
                     Exit Do
                  End If
               Loop
                        
               If oAsi.DetAsientos.TotalDebe <> oAsi.DetAsientos.TotalHaber Then
                  mConProblemas = True
                  s1 = s1 & "El asiento del archivo " & mArchivo & ", no balancea y fue descartado." & vbCrLf
               End If
                        
               If Len(s1) > 0 Then
                  s = s & s1 & vbCrLf
               Else
                  s = s & "Procesado correctamente" & vbCrLf & vbCrLf
               End If
               If Not mConProblemas Then
                  If mIdAsiento = -1 Then
                     Set oPar = oAp.Parametros.Item(1)
                     mNumeroAsiento = IIf(IsNull(oPar.Registro.Fields("ProximoAsiento").Value), 1, oPar.Registro.Fields("ProximoAsiento").Value)
                     oPar.Registro.Fields("ProximoAsiento").Value = mNumeroAsiento + 1
                     oPar.Guardar
                     Set oPar = Nothing
                     With oAsi.Registro
                        .Fields("NumeroAsiento").Value = mNumeroAsiento
                        .Fields("FechaAsiento").Value = mFecha
                        .Fields("IdIngreso").Value = glbIdUsuario
                        .Fields("FechaIngreso").Value = Now
                     End With
                  Else
                     With oAsi.Registro
                        .Fields("IdModifico").Value = glbIdUsuario
                        .Fields("FechaUltimaModificacion").Value = Now
                     End With
                     oAp.Tarea "Asientos_EliminarDetalles", mIdAsiento
                  End If
                  oAsi.Registro.Fields("ArchivoImportacion").Value = mId(mArchivo, 1, 50)
                  oAsi.Registro.Fields("Concepto").Value = mId(QuitarPath(mArchivo), 1, 50)
                  oAsi.Guardar
                  Set oAsi = Nothing
               End If
            End With
            .Close False
         End With
         .Quit
      End With
            
      Unload oF
      
      If Len(s1) > 0 Then
         Set oF = New frm_Aux
         With oF
            .Caption = "Reporte de importacion de asientos contables"
            .Width = .Width * 2
            .Height = .Height * 2
            .cmd(0).Caption = "Salir"
            .cmd(0).Top = oF.Height - 900
            With .RichTextBox1
               .Top = 0
               .Left = 0
               .Width = oF.Width
               .Height = oF.Height - 1000
               .Text = s1
               .Visible = True
            End With
            .Show vbModal, Me
         End With
      End If
   End If
   
Salida:
   Unload oF
   Set oF = Nothing

   Set oRsAux1 = Nothing
   Set oAp = Nothing
   Set oAsi = Nothing
   Set oPar = Nothing
   Set oEx = Nothing

   Exit Sub

Mal:
   MsgBox "Se ha producido un error al registrar los datos" & vbCrLf & Err.Number & " -> " & Err.Description, vbCritical
   Resume Salida

End Sub

Public Sub ImportacionAsientos2()

   Dim oEx As Excel.Application
   Dim oRs As ADOR.Recordset
   Dim oRsAux As ADOR.Recordset
   Dim oF As Form
   Dim oFld As Field
   Dim mArchivo1 As String, mArchivo2 As String, mError As String, mCodigo As String, mDescripcionLiquidacion As String
   Dim mApellido As String, mNombre As String, mDescripcionCuenta As String, mCodigoDebeHaber As String, mSQL As String
   Dim mBaseSyJ As String, mObra As String, s1 As String
   Dim fl As Integer, fl1 As Integer, cl As Integer, mContador As Integer, mRenglon As Integer
   Dim mIdEmpleado As Long, mCuenta As Long, mNumeroRecibo As Long, mIdCuenta As Long, mIdObra As Long
   Dim mImporte As Double, mPorcentaje As Double
   Dim mFecha1 As Date, mFecha2 As Date
   Dim mOk As Boolean, mConProblemas As Boolean
   
   'On Error GoTo Mal

   Set oF = New frmPathPresto
   With oF
      .Id = 19
      .Show vbModal
      mOk = .Ok
      If mOk Then
         mArchivo1 = .FileBrowser1(0).Text
         mArchivo2 = .FileBrowser1(1).Text
      End If
   End With
   Unload oF
   Set oF = Nothing
   If Not mOk Then Exit Sub

   Set oRsAux = Aplicacion.Parametros.TraerFiltrado("_PorId", 1)
   If oRsAux.RecordCount > 0 Then
      mBaseSyJ = IIf(IsNull(oRsAux.Fields("BasePRONTOSyJAsociada").Value), "", oRsAux.Fields("BasePRONTOSyJAsociada").Value)
   End If
   oRsAux.Close
   If Len(mBaseSyJ) = 0 Then
      MsgBox "No hay definida una base de datos SyJ", vbExclamation
      Exit Sub
   End If
   
   Set oF = New frmAviso
   With oF
      .Label1 = "Abriendo Excel asientos ..."
      .Show
      .Refresh
      DoEvents
   End With

   oF.Label1 = oF.Label1 & vbCrLf & "Procesando asientos ..."
   oF.Label2 = ""
   oF.Label3 = ""
   DoEvents

   fl = 2
   mError = ""
   s1 = ""
   
   Aplicacion.Tarea "_TempAsientoSueldos_Borrar"

   Set oEx = CreateObject("Excel.Application")
   With oEx
      .Visible = True
      .WindowState = xlMinimized
      Me.Refresh
      
      'ASIENTO RESUMEN
      With .Workbooks.Open(mArchivo1)
         With .ActiveSheet
            Do While True
               If Len(Trim(.Cells(fl, 1))) = 0 Then Exit Do
               
               mCodigo = .Cells(fl, 6)
               If IsDate(.Cells(fl, 2)) Then mFecha1 = CDate(.Cells(fl, 2))
               If IsDate(.Cells(fl, 3)) Then mFecha2 = CDate(.Cells(fl, 3))
               mNumeroRecibo = .Cells(fl, 1)
               mDescripcionLiquidacion = .Cells(fl, 4)
               mApellido = .Cells(fl, 7)
               mNombre = .Cells(fl, 8)
               mRenglon = .Cells(fl, 9)
               mCuenta = .Cells(fl, 10)
               mDescripcionCuenta = .Cells(fl, 11)
               mCodigoDebeHaber = .Cells(fl, 12)
               mImporte = .Cells(fl, 13)
               
               mConProblemas = False
               mContador = mContador + 1
               oF.Label2 = "Legajo : " & mCodigo & " " & mApellido & ", " & mNombre
               oF.Label3 = "" & mContador
               DoEvents
               
               mSQL = "Select IdEmpleado From " & mBaseSyJ & ".dbo.Empleados Where Legajo=" & mCodigo
               Set oRsAux = Aplicacion.TablasGenerales.TraerFiltrado("Consulta", "_PorSQL", mSQL)
               If oRsAux.RecordCount = 0 Then
                  s1 = s1 & "El legajo " & mCodigo & " no existe." & vbCrLf
                  mConProblemas = True
               Else
                  mIdEmpleado = oRsAux.Fields(0).Value
               End If
               oRsAux.Close
   
               Set oRsAux = Aplicacion.Cuentas.TraerFiltrado("_PorCodigo", mCuenta)
               If oRsAux.RecordCount = 0 Then
                  s1 = s1 & "La cuenta " & mCuenta & " no existe." & vbCrLf
                  mConProblemas = True
               Else
                  mIdCuenta = oRsAux.Fields(0).Value
               End If
               oRsAux.Close
   
               If Not mConProblemas Then
                  Aplicacion.Tarea "_TempAsientoSueldos_A", Array(mFecha1, mFecha2, mDescripcionLiquidacion, mCodigo, mApellido, _
                              mNombre, mRenglon, mCuenta, mDescripcionCuenta, mCodigoDebeHaber, mNumeroRecibo, mImporte, _
                              mIdEmpleado, mIdCuenta)
               End If
               fl = fl + 1
            Loop
         End With
         .Close False
      End With
      If mConProblemas Then GoTo Salida
      
      'DISTRIBUCION DE HORAS
      oF.Label1 = oF.Label1 & vbCrLf & "Procesando distribucion de horas ..."
      oF.Label2 = ""
      oF.Label3 = ""
      DoEvents
   
      fl = 9
      
      Aplicacion.Tarea "_TempDistribucionHoras_Borrar"
      
      With .Workbooks.Open(mArchivo2)
         With .ActiveSheet
            oEx.ActiveCell.SpecialCells(xlLastCell).Select
            fl1 = oEx.ActiveCell.row
            Do While True
               If Val(.Cells(fl, 2)) = 0 Then Exit Do
               
               mCodigo = .Cells(fl, 2)
               mNombre = .Cells(fl, 3)
               cl = 7
               Do While True
                  If Len(Trim(.Cells(7, cl))) = 0 Then Exit Do
                  
                  mConProblemas = False
                  mObra = .Cells(7, cl)
                  mIdObra = 0
                  Set oRsAux = Aplicacion.GruposObras.TraerFiltrado("_PorDescripcion", mObra)
                  If oRsAux.RecordCount = 0 Then
                     s1 = s1 & "El grupo de obra " & mObra & " no existe." & vbCrLf
                     mConProblemas = True
                  Else
                     mIdObra = oRsAux.Fields(0).Value
                  End If
                  oRsAux.Close
                  
                  mPorcentaje = Round(.Cells(fl, cl) * 100, 2)
               
                  mContador = mContador + 1
                  oF.Label2 = "Legajo : " & mCodigo & " " & mNombre
                  oF.Label3 = "" & mContador
                  DoEvents
               
                  mSQL = "Select IdEmpleado From " & mBaseSyJ & ".dbo.Empleados Where Legajo=" & mCodigo
                  Set oRsAux = Aplicacion.TablasGenerales.TraerFiltrado("Consulta", "_PorSQL", mSQL)
                  If oRsAux.RecordCount = 0 Then
                     s1 = s1 & "El legajo " & mCodigo & " no existe." & vbCrLf
                     mConProblemas = True
                  Else
                     mIdEmpleado = oRsAux.Fields(0).Value
                  End If
                  oRsAux.Close
      
                  If Not mConProblemas And mPorcentaje <> 0 Then
                     Aplicacion.Tarea "_TempDistribucionHoras_A", Array(mCodigo, mObra, mPorcentaje, mIdEmpleado, mIdObra)
                  End If
                  cl = cl + 1
               Loop
               fl = fl + 1
            Loop

'            Do While fl <= fl1
'               If Len(Trim(.Cells(fl, 1))) > 0 Then
'                  mCodigo = .Cells(fl, 1)
'                  mNombre = .Cells(fl, 2)
'                  mObra = .Cells(fl, 3)
'                  mPorcentaje = .Cells(fl, 6)
'
'                  mConProblemas = False
'                  mContador = mContador + 1
'                  oF.Label2 = "Legajo : " & mCodigo & " " & mNombre
'                  oF.Label3 = "" & mContador
'                  DoEvents
'
'                  mSQL = "Select IdEmpleado From " & mBaseSyJ & ".dbo.Empleados Where Legajo=" & mCodigo
'                  Set oRsAux = Aplicacion.TablasGenerales.TraerFiltrado("Consulta", "_PorSQL", mSQL)
'                  If oRsAux.RecordCount = 0 Then
'                     s1 = s1 & "El legajo " & mCodigo & " no existe." & vbCrLf
'                     mConProblemas = True
'                  Else
'                     mIdEmpleado = oRsAux.Fields(0).Value
'                  End If
'                  oRsAux.Close
'
'                  Set oRsAux = Aplicacion.Obras.TraerFiltrado("_PorNumero", mObra)
'                  If oRsAux.RecordCount = 0 Then
'                     s1 = s1 & "La obra " & mObra & " no existe." & vbCrLf
'                     mConProblemas = True
'                  Else
'                     mIdObra = oRsAux.Fields(0).Value
'                  End If
'                  oRsAux.Close
'
'                  If Not mConProblemas Then
'                     Aplicacion.Tarea "_TempDistribucionHoras_A", Array(mCodigo, mObra, mPorcentaje, mIdEmpleado, mIdObra)
'                  End If
'               End If
'               fl = fl + 1
'            Loop
         End With
         .Close False
      End With
      .Quit
   End With
   
   Set oRsAux = Aplicacion.TablasGenerales.TraerFiltrado("Asientos", "_GenerarAsientoSueldos", mFecha2)
   With oRsAux
      If .RecordCount > 0 Then
         Do While Not .EOF
            s1 = s1 & IIf(IsNull(.Fields("Detalle").Value), "", .Fields("Detalle").Value) & vbCrLf
            .MoveNext
         Loop
      End If
   End With
   
Salida:
   On Error Resume Next
   
   oEx.Quit
   
   Unload oF
   Set oF = Nothing

   If Len(s1) > 0 Then
      Set oF = New frm_Aux
      With oF
         .Caption = "Reporte de importacion de asientos contables"
         .Width = .Width * 2
         .Height = .Height * 2
         .cmd(0).Caption = "Salir"
         .cmd(0).Top = oF.Height - 900
         With .RichTextBox1
            .Top = 0
            .Left = 0
            .Width = oF.Width
            .Height = oF.Height - 1000
            .Text = s1
            .Visible = True
         End With
         .Show vbModal, Me
      End With
      Unload oF
      Set oF = Nothing
   End If

   Set oRs = Nothing
   Set oRsAux = Nothing
   Set oEx = Nothing

   Exit Sub

Mal:
   MsgBox "Se ha producido un error al registrar los datos" & vbCrLf & Err.Number & " -> " & Err.Description, vbCritical
   Resume Salida

End Sub

Public Sub DefinicionBasesParaConsolidacion()

   Dim oRs As ADOR.Recordset
   Dim oF As frm_Aux
   Dim oL As ListItem
   Dim mOk As Boolean
   Dim s As String
   Dim i As Integer
   Dim Filas, Columnas
   
   Set oRs = Aplicacion.TablasGenerales.TraerFiltrado("_TempBasesConciliacion", "_TraerTodo")
   
   Set oF = New frm_Aux
   With oF
      .Caption = "Definicion de bases para consolidacion"
      .Text1.Visible = False
      .Width = .Width * 2.15
      .Height = .Height * 1.8
      With .Lista
         .Left = oF.Label1.Left
         .Top = 400
         .Width = 7000
         .Height = 2500
         .MultiSelect = True
         Set .DataSource = oRs
         .Visible = True
      End With
      Set .dcfields(0).RowSource = Aplicacion.TablasGenerales.TraerFiltrado("BD", "_BasesInstaladas")
      With .cmd(0)
         .Top = 3000
         .Left = oF.Lista.Left
         .Caption = "Guardar"
      End With
      .cmd(1).Top = .cmd(0).Top
      .Id = 5
      .Show vbModal, Me
      mOk = .Ok
      For Each oL In .Lista.ListItems
         oL.Selected = True
      Next
      s = .Lista.GetString
   End With
   Unload oF
   Set oF = Nothing

   If mOk Then
      Aplicacion.Tarea "_TempBasesConciliacion_BorrarTabla"
      Filas = VBA.Split(s, vbCrLf)
      For i = LBound(Filas) + 1 To UBound(Filas)
         Columnas = VBA.Split(Filas(i), vbTab)
         Aplicacion.Tarea "_TempBasesConciliacion_InsertarRegistro", _
                        Array(Columnas(1), Columnas(2), Columnas(3))
      Next
   End If

   Set oRs = Nothing

End Sub

Public Sub ConsolidacionContable()

   Dim mvarSeguro As Integer
   mvarSeguro = MsgBox("Esta seguro de ejecutar la consolidacion contable ?", vbYesNo, "Consolidacion contable")
   If mvarSeguro = vbYes Then
      Aplicacion.Tarea "Cuentas_Consolidacion", Array(Date)
      MsgBox "Proceso concluido", vbInformation
   End If

End Sub

Public Sub CierreZ()

   Dim Respuesta As Boolean
   Dim mFiscal As String
   
   mFiscal = BuscarClaveINI("Impresora fiscal")
   
   If Len(mFiscal) > 0 Then
      Dim mvarSeguro As Integer
      mvarSeguro = MsgBox("Esta seguro de hacer el cierre Z?", vbYesNo, "Cierre Z")
      If mvarSeguro = vbYes Then
         On Error GoTo Impresora_apag
         If mId(mFiscal, 1, 2) = "EP" Then
            MsgBox "Para emitir el cierre Z, si facturo con el controlador previamente" & vbCrLf & _
                     "salga del programa y vuelva a entrar.", vbInformation
            Respuesta = Me.PrinterFiscal1.CloseJournal("Z")
         Else
            If Len(BuscarClaveINI("Puerto impresora fiscal")) > 0 Then
               HASAR1.Puerto = Val(BuscarClaveINI("Puerto impresora fiscal"))
            Else
               HASAR1.Puerto = 1
            End If
            HASAR1.Modelo = Val(mFiscal)
            HASAR1.Comenzar
            HASAR1.PrecioBase = False
            HASAR1.TratarDeCancelarTodo
            HASAR1.ReporteZ
            HASAR1.Finalizar
         End If
      End If
   Else
      MsgBox "No hay definido un controlador fiscal!!", vbExclamation
   End If
   
   Exit Sub

Impresora_apag:
    MsgBox "Error Impresora:" & Err.Description, vbRetryCancel, "Errores"

End Sub

Public Sub Envio_RM_Proveedores()

   Dim Filas, Columnas
   Dim iFilas As Integer, i As Integer
   Dim s As String
   
   s = ""
   Filas = VBA.Split(Lista.GetString, vbCrLf)
   For iFilas = LBound(Filas) + 1 To UBound(Filas)
      Columnas = VBA.Split(Filas(iFilas), vbTab)
      s = s & Columnas(2) & "|"
   Next
   If Len(s) = 0 Then
      MsgBox "No hay documentos para enviar", vbExclamation
      Exit Sub
   Else
      s = mId(s, 1, Len(s) - 1)
   End If
   
   Dim oF As frm_Aux
   Set oF = New frm_Aux
   With oF
      .Caption = "Enviar RM's a proveedores"
      .Text1.Visible = False
      .Label1.Visible = False
      .Width = .Width * 3.5
      .Height = .Height * 3.1
      With .Lista
         .Left = oF.Label1.Left
         .Top = 500
         .Width = 12000
         .Height = 5400
         .CheckBoxes = True
         .Visible = True
      End With
      With .cmd(0)
         .Top = 6000
         .Left = oF.Lista.Left
         .Caption = "Generar"
      End With
      .cmd(1).Top = .cmd(0).Top
      .Parametros = s
      .Id = 11
      .Show vbModal, Me
   End With
   Unload oF
   Set oF = Nothing

End Sub

Public Sub RegistrarFechaSalidaPedido()

   Dim iFilas As Integer
   Dim mFecha As Date
   Dim mOk As Boolean
   Dim Filas, Columnas
   Dim oF As frm_Aux
   
   Set oF = New frm_Aux
   With oF
      .Caption = "Fecha de salida de pedido"
      .Text1.Visible = False
      .Label1.Caption = "Fecha de salida :"
      With .DTFields(0)
         .Top = oF.Text1.Top
         .Value = Date
         .Visible = True
      End With
      .Show vbModal, Me
      mOk = .Ok
      mFecha = .DTFields(0).Value
   End With
   Unload oF
   Set oF = Nothing
   
   If Not mOk Then Exit Sub
   
   Filas = VBA.Split(Lista.GetString, vbCrLf)
   For iFilas = LBound(Filas) + 1 To UBound(Filas)
      Columnas = VBA.Split(Filas(iFilas), vbTab)
      Aplicacion.Tarea "Pedidos_RegistrarFechaSalida", Array(Columnas(17), mFecha)
   Next
   Arbol_NodeClick Arbol.SelectedItem

End Sub

Public Sub EnvioFax_RM_Proveedores()

   Dim Filas, Columnas
   Dim iFilas As Integer, i As Integer
   Dim s As String
   
   s = ""
   Filas = VBA.Split(Lista.GetString, vbCrLf)
   For iFilas = LBound(Filas) + 1 To UBound(Filas)
      Columnas = VBA.Split(Filas(iFilas), vbTab)
      s = s & Columnas(2) & "|"
   Next
   If Len(s) = 0 Then
      MsgBox "No hay documentos para enviar", vbExclamation
      Exit Sub
   Else
      s = mId(s, 1, Len(s) - 1)
   End If
   
   Dim oF As frm_Aux
   Set oF = New frm_Aux
   With oF
      .Caption = "Enviar RM's a proveedores por fax"
      .Text1.Visible = False
      .Label1.Visible = False
      .Width = .Width * 3.5
      .Height = .Height * 3.1
      With .Lista
         .Left = oF.Label1.Left
         .Top = 500
         .Width = 12000
         .Height = 5400
         .CheckBoxes = True
         .Visible = True
      End With
      With .cmd(0)
         .Top = 6000
         .Left = oF.Lista.Left
         .Caption = "Generar"
      End With
      .cmd(1).Top = .cmd(0).Top
      .Parametros = s
      .Id = 12
      .Show vbModal, Me
   End With
   Unload oF
   Set oF = Nothing

End Sub

Public Sub GenerarMensajesPorControlDeStock()

   Dim mAux1 As String, mAux2 As String
   Dim oRs As ADOR.Recordset
   
   mAux1 = BuscarClaveINI("Legajos para aviso de control de stock")
   If InStr(1, mAux1, "(" & glbLegajo & ")") <> 0 Then
      Set oRs = Aplicacion.TablasGenerales.TraerFiltrado("Stock", "_Control_Reposicion_Minimo", "A")
      With oRs
         If .RecordCount > 0 Then
            .MoveFirst
            Do While Not .EOF
               mAux2 = "" & IIf(IsNull(.Fields("Codigo").Value), "", .Fields("Codigo").Value & " - ") & _
                           IIf(IsNull(.Fields("Articulo").Value), "", .Fields("Articulo").Value)
               If Not IsNull(.Fields("Faltante min.").Value) Then
                  mAux2 = mId(mAux2, 1, 150) & ", min.:" & .Fields("Stock min.").Value & " " & _
                              ", stk.:" & .Fields("Stock actual").Value & " " & _
                              ", fal.:" & .Fields("Faltante min.").Value
                  Aplicacion.Tarea "NovedadesUsuarios_GrabarNovedadNueva", _
                        Array(glbIdUsuario, 0, mAux2, .Fields("IdArticulo").Value, "STOCK MINIMO")
               ElseIf Not IsNull(.Fields("Faltante rep.").Value) Then
                  mAux2 = mId(mAux2, 1, 150) & ", rep.:" & .Fields("Stock rep.").Value & " " & _
                              ", stk.:" & .Fields("Stock actual").Value & " " & _
                              ", fal.:" & .Fields("Faltante rep.").Value
                  Aplicacion.Tarea "NovedadesUsuarios_GrabarNovedadNueva", _
                        Array(glbIdUsuario, 0, mAux2, .Fields("IdArticulo").Value, "STOCK REPOSICION")
               End If
               .MoveNext
            Loop
         End If
         .Close
      End With
      Set oRs = Nothing
   End If

End Sub

Public Sub DefinirGruposCuentasParaAjusteEnSubdiarios()

   Dim oF As frm_Aux
   Dim mOk As Boolean
   
   Set oF = New frm_Aux
   With oF
      .Caption = "Definir grupos de cuentas para ajustar subdiarios"
      .Label1.Visible = False
      .Text1.Visible = False
      .Width = .Width * 2
      .Height = .Height * 3.2
      With .Lista
         .Left = oF.Label1.Left
         .Top = 500
         .Width = 6500
         .Height = 5400
         .CheckBoxes = True
         .Visible = True
         Set .SmallIcons = oF.Img16
         Set .DataSource = Aplicacion.TiposCuentaGrupos.TraerTodos
      End With
      .Id = 13
      With .cmd(0)
         .Top = 6000
         .Left = oF.Lista.Left
         .Caption = "Guardar"
      End With
      With .cmd(1)
         .Left = oF.cmd(0).Left + oF.cmd(0).Width + 50
         .Top = oF.cmd(0).Top
      End With
      With .Label3
         .Top = oF.cmd(0).Top
         .Left = oF.cmd(1).Left + oF.cmd(1).Width + 100
         .Width = 3000
         .Height = 600
         .Caption = "Las cuentas con jerarquia mayor a 5 son tomadas automaticamente para ajustar"
         .Visible = True
      End With
      .Show vbModal, Me
      mOk = .Ok
   End With
   Unload oF
   Set oF = Nothing

End Sub

Public Sub SeleccionarComprobantesProveedores()

   Dim oEx As Excel.Application
   Dim oF As Form
   Dim oL As ListItem
   Dim mArchivo As String, mLiteral As String
   Dim mOk As Boolean
   Dim fl As Integer, mContador As Integer

'   On Error GoTo Mal

   Set oF = New frmPathPresto
   With oF
      .Id = 11
      .Show vbModal
      mOk = .Ok
      If mOk Then
         mArchivo = .FileBrowser1(0).Text
      End If
   End With
   Unload oF
   Set oF = Nothing

   If Not mOk Then Exit Sub

   Set oF = New frmAviso
   With oF
      .Label1 = "Iniciando EXCEL ..."
      .Show
      .Refresh
      DoEvents
   End With

   oF.Label1 = oF.Label1 & vbCrLf & "Importando datos ..."
   oF.Label2 = ""
   oF.Label3 = ""
   DoEvents

   fl = 1
   mLiteral = oF.Label1.Caption & vbCrLf
   
   Set oEx = CreateObject("Excel.Application")
   With oEx
      .Visible = True
      .WindowState = xlMinimized
      Me.Refresh
      
      With .Workbooks.Open(mArchivo)
         .Sheets("Hoja1").Select
         With .ActiveSheet
            Do While True
               If Len(Trim(.Cells(fl, 1))) > 0 Then
                  mContador = mContador + 1
                  oF.Label1 = mLiteral & "Comprobante : " & .Cells(fl, 1)
                  oF.Label3 = "" & mContador
                  DoEvents
                  For Each oL In Lista.ListItems
                     If InStr(1, .Cells(fl, 1), oL.SubItems(3)) <> 0 Then
                        oL.Selected = True
                     End If
                  Next
                  fl = fl + 1
               Else
                  Exit Do
               End If
            Loop
         End With
         .Close False
      End With
      .Quit
   End With
   
Salida:

   Unload oF
   Set oF = Nothing

   Exit Sub

Mal:

   MsgBox "Se ha producido un error al registrar los datos" & vbCrLf & Err.Number & " -> " & Err.Description, vbCritical
   Resume Salida

End Sub

Public Sub CierreRendicionFF()

   Dim oF As Form
   Dim Filas, Columnas
   Dim iFilas As Integer, i As Integer
   Dim mIdUsuario As Long, mProximaRendicion As Long
   Dim s As String, mUsuario As String
   Dim mOk As Boolean
   
   Filas = VBA.Split(Lista.GetString, vbCrLf)
   If UBound(Filas) = 0 Then Exit Sub
   Columnas = VBA.Split(Filas(1), vbTab)
   
'   Set oF = New frmAutorizacion
'   With oF
'      .Empleado = 0
'      .Administradores = True
'      .Show vbModal, Me
'      mOk = .Ok
'      mUsuario = .Autorizo
'      mIdUsuario = .IdAutorizo
'   End With
'   Unload oF
'   Set oF = Nothing
'   If Not mOk Then Exit Sub
   
   mIdUsuario = glbIdUsuario
   mUsuario = glbInicialesUsuario
   
   Me.Refresh
   
   Set oF = New frm_Aux
   With oF
      .Caption = "Cerrar rendicion de FF"
      .Label1.Caption = "Prox.Rend. :"
      With .Text1
         .Text = Val(Columnas(3)) + 1
         .Enabled = False
      End With
      .Id = 14
      .Show vbModal, Me
      mOk = .Ok
      mProximaRendicion = .Text1.Text
   End With
   Unload oF
   Set oF = Nothing
   
   If mOk Then
      Aplicacion.Tarea "Cuentas_IncrementarRendicionFF", Array(Columnas(2), mProximaRendicion)
   End If
   Arbol_NodeClick Arbol.SelectedItem

End Sub

Public Sub MarcarOPEnCaja()

   Dim s As String, iFilas As Integer
   Dim Filas, Columnas
   Filas = VBA.Split(Lista.GetString, vbCrLf)
   s = ""
   For iFilas = LBound(Filas) + 1 To UBound(Filas)
      Columnas = VBA.Split(Filas(iFilas), vbTab)
      If IsNumeric(Columnas(0)) Then
         Aplicacion.Tarea "OrdenesPago_MarcarComoEnCaja", Columnas(2)
      End If
   Next
   Arbol_NodeClick Arbol.SelectedItem

End Sub

Public Sub MarcarOPEnCajaObra()

   Dim s As String, iFilas As Integer
   Dim Filas, Columnas
   Filas = VBA.Split(Lista.GetString, vbCrLf)
   s = ""
   For iFilas = LBound(Filas) + 1 To UBound(Filas)
      Columnas = VBA.Split(Filas(iFilas), vbTab)
      If IsNumeric(Columnas(0)) Then
         Aplicacion.Tarea "OrdenesPago_MarcarComoEnCaja", Array(Columnas(2), "CO")
      End If
   Next
   Arbol_NodeClick Arbol.SelectedItem

End Sub

Public Sub ConfirmarAcreditacionFF()

   Dim oF As frmAutorizacion
   Dim s As String, iFilas As Integer
   Dim mOk As Boolean
   Dim Filas, Columnas
   
'   Set oF = New frmAutorizacion
'   With oF
'      .Empleado = 0
'      .Administradores = True
'      .Show vbModal, Me
'      mOk = .Ok
'   End With
'   Unload oF
'   Set oF = Nothing
'   If Not mOk Then Exit Sub
   
   Me.Refresh
   
   Filas = VBA.Split(Lista.GetString, vbCrLf)
   s = ""
   For iFilas = LBound(Filas) + 1 To UBound(Filas)
      Columnas = VBA.Split(Filas(iFilas), vbTab)
      If IsNumeric(Columnas(2)) Then
         Aplicacion.Tarea "OrdenesPago_ConfirmarAcreditacionFF", Columnas(2)
      End If
   Next
   Arbol_NodeClick Arbol.SelectedItem

End Sub

Public Sub RecalcularCostoKits()

   Aplicacion.Tarea "Conjuntos_CalcularCostoConjunto_Todos"
   MsgBox "Proceso de recalculo terminado!"

End Sub

Public Sub ImportacionNotasDebito()

   Dim oAp As ComPronto.Aplicacion
   Dim oDeb As ComPronto.NotaDebito
   Dim oPto As ComPronto.PuntoVenta
   Dim oPar As ComPronto.Parametro
   Dim oRs As ADOR.Recordset
   Dim oRsAux As ADOR.Recordset
   Dim oF As Form
   Dim oEx As Excel.Application
   Dim mArchivo As String, mCodigoCliente As String, mError As String, mvarTipoABC As String
   Dim mOk As Boolean, mConProblemas As Boolean
   Dim fl As Integer, mContador As Integer, mIdConcepto As Integer, mvarIdPuntoVenta As Integer
   Dim mIdCodigoIva As Integer
   Dim mvarNumero As Long
   Dim mImporte As Double, mvarCotizacion As Double
   Dim mvarP_IVA1 As Single
   
'   On Error GoTo Mal
   
   mvarCotizacion = Cotizacion(Date, glbIdMonedaDolar)
   If mvarCotizacion = 0 Then
      MsgBox "No hay registrada una cotizacion dolar de hoy", vbExclamation
      Exit Sub
   End If
   
   Set oF = New frmPathPresto
   With oF
      .Id = 13
      .Show vbModal
      mOk = .Ok
      If mOk Then mArchivo = .FileBrowser1(0).Text
   End With
   Unload oF
   Set oF = Nothing
   If Not mOk Then Exit Sub

   Set oF = New frmAviso
   With oF
      .Label1 = "Iniciando EXCEL ..."
      .Show
      .Refresh
      DoEvents
   End With

   oF.Label1 = oF.Label1 & vbCrLf & "Procesando notas de debito ..."
   oF.Label2 = ""
   oF.Label3 = ""
   DoEvents

   fl = 2
   mContador = 0
   mError = ""
   
   Set oAp = Aplicacion
   
   Set oRs = oAp.Parametros.Item(1).Registro
   mvarP_IVA1 = IIf(IsNull(oRs.Fields("Iva1").Value), 0, oRs.Fields("Iva1").Value)
   oRs.Close
   
   Set oEx = CreateObject("Excel.Application")
   With oEx
      .Visible = True
      .WindowState = xlMinimized
      Me.Refresh
      
      With .Workbooks.Open(mArchivo)
         With .ActiveSheet
            Do While True
               If Len(Trim(.Cells(fl, 1))) = 0 Then Exit Do
               
               mConProblemas = False
               
               mCodigoCliente = .Cells(fl, 1)
               mImporte = .Cells(fl, 3)
               mIdConcepto = .Cells(fl, 4)
               
               mContador = mContador + 1
               oF.Label2 = "Cliente : " & mCodigoCliente
               oF.Label3 = "" & mContador
               DoEvents
            
               Set oRs = oAp.Clientes.TraerFiltrado("_PorCodigoCliente", mCodigoCliente)
               If oRs.RecordCount = 0 Then
                  mError = mError & vbCrLf & "El cliente " & mCodigoCliente & "no existe."
               Else
                  mIdCodigoIva = IIf(IsNull(oRs.Fields("IdCodigoIva").Value), 1, oRs.Fields("IdCodigoIva").Value)
                  If mIdCodigoIva <= 2 Or mIdCodigoIva = 9 Then
                     mvarTipoABC = "A"
                  Else
                     mvarTipoABC = "B"
                  End If
'                  Set oRsAux = oAp.PuntosVenta.TraerFiltrado("_PuntosVentaPorIdTipoComprobanteLetra", Array(3, mvarTipoABC))
'                  Set oPto = oAp.PuntosVenta.Item(oRsAux.Fields(0).Value)
'                  mvarNumero = oPto.Registro.Fields("ProximoNumero").Value
'                  oRsAux.Close
               
                  Set oPar = oAp.Parametros.Item(1)
                  mvarNumero = IIf(IsNull(oPar.Registro.Fields("ProximaNotaDebitoInterna").Value), 1, oPar.Registro.Fields("ProximaNotaDebitoInterna").Value)
                  oPar.Registro.Fields("ProximaNotaDebitoInterna").Value = mvarNumero + 1
                  oPar.Guardar
                  Set oPar = Nothing
               
                  Set oDeb = oAp.NotasDebito.Item(-1)
                  With oDeb
                     With .Registro
                        .Fields("NumeroNotaDebito").Value = mvarNumero
                        .Fields("TipoABC").Value = mvarTipoABC
                        .Fields("PuntoVenta").Value = 0
                        .Fields("IdPuntoVenta").Value = 0
                        .Fields("IdCliente").Value = oRs.Fields(0).Value
                        .Fields("FechaNotaDebito").Value = Date
                        .Fields("IdVendedor").Value = oRs.Fields("Vendedor1").Value
                        .Fields("ImporteTotal").Value = mImporte
                        .Fields("ImporteIva1").Value = 0
                        .Fields("ImporteIva2").Value = 0
                        .Fields("IVANoDiscriminado").Value = 0
                        .Fields("RetencionIBrutos1").Value = 0
                        .Fields("PorcentajeIBrutos1").Value = 0
                        .Fields("RetencionIBrutos2").Value = 0
                        .Fields("PorcentajeIBrutos2").Value = 0
                        .Fields("ConvenioMultilateral").Value = 0
                        .Fields("PorcentajeIva1").Value = mvarP_IVA1
                        .Fields("PorcentajeIva2").Value = 0
                        .Fields("IdCodigoIva").Value = mIdCodigoIva
                        .Fields("CtaCte").Value = "NO"
                        .Fields("IdMoneda").Value = 1
                        .Fields("CotizacionMoneda").Value = 1
                        .Fields("CotizacionDolar").Value = mvarCotizacion
                        .Fields("OtrasPercepciones1").Value = 0
                        .Fields("OtrasPercepciones1Desc").Value = ""
                        .Fields("OtrasPercepciones2").Value = 0
                        .Fields("OtrasPercepciones2Desc").Value = ""
                        .Fields("OtrasPercepciones3").Value = 0
                        .Fields("OtrasPercepciones3Desc").Value = ""
                        .Fields("IdUsuarioIngreso").Value = glbIdUsuario
                        .Fields("FechaIngreso").Value = Now
                        .Fields("AplicarEnCtaCte").Value = "SI"
                        .Fields("NoIncluirEnCubos").Value = Null
                        .Fields("Observaciones").Value = "Automatica"
                        .Fields("PercepcionIVA").Value = 0
                        .Fields("PorcentajePercepcionIVA").Value = 0
                        .Fields("NumeroCAI").Value = 0
                        .Fields("FechaVencimientoCAI").Value = DateSerial(2000, 1, 1)
                     End With
                     With .DetNotasDebito.Item(-1)
                        With .Registro
                           .Fields("IdConcepto").Value = mIdConcepto
                           .Fields("Importe").Value = mImporte
                           .Fields("Gravado").Value = "NO"
                           .Fields("IvaNoDiscriminado").Value = 0
                        End With
                        .Modificado = True
                     End With
                     .Guardar
                  End With
                  Set oDeb = Nothing
'                  With oPto
'                     .Registro.Fields("ProximoNumero").Value = mvarNumero + 1
'                     .Guardar
'                  End With
'                  Set oPto = Nothing
               End If
               oRs.Close
               fl = fl + 1
            Loop
         End With
         .Close False
      End With
      .Quit
   End With
   
Salida:

   Unload oF
   Set oF = Nothing

   Set oRs = Nothing
   Set oRsAux = Nothing
   Set oAp = Nothing
   Set oEx = Nothing

   If Len(mError) > 0 Then
      MsgBox "El proceso reporto los siguientes errores : " & mError, vbExclamation
   End If
   
   Exit Sub
   
Mal:

   Select Case Err.Number
      Case Else
         MsgBox "Se ha producido un error al procesar los datos" & vbCrLf & Err.Number & " -> " & Err.Description, vbCritical
   End Select
   Resume Salida

End Sub

Public Sub SetearIdioma(Optional ByVal IdiomaInicial As String, Optional ByVal CodCtrl As String)

   Dim mAux
   If IdiomaInicial = "" Then IdiomaInicial = "esp"
   mAux = TraerValorParametro2("Lenguaje")
   glbIdiomaActual = IIf(IsNull(mAux), "esp", mAux)
   CambiarLenguaje Me, IdiomaInicial, glbIdiomaActual, CodCtrl

End Sub

Public Sub ElegirIdioma()

   Dim oF As frm_Aux
   Dim mOk As Boolean
   Dim oEmp As ComPronto.Empleado
   Dim mIndex As Integer
   Dim mAux1 As String
   
   Set oEmp = Aplicacion.Empleados.Item(glbIdUsuario)
   mAux1 = IIf(IsNull(oEmp.Registro.Fields("Idioma").Value), "", oEmp.Registro.Fields("Idioma").Value)

   Set oF = New frm_Aux
   With oF
      .Caption = "Idioma"
      .Label1.Caption = "Idioma :"
      .Text1.Visible = False
      With .Combo1(1)
         .Top = oF.Text1.Top
         .Left = oF.Text1.Left
         .Width = oF.Text1.Width
         .Visible = True
         Select Case mAux1
            Case "esp"
               .ListIndex = 0
            Case "ing"
               .ListIndex = 1
            Case "por"
               .ListIndex = 2
         End Select
      End With
      .Show vbModal, Me
      mOk = .Ok
      mIndex = .Combo1(1).ListIndex
   End With
   Unload oF
   Set oF = Nothing
   
   If Not mOk Then GoTo Salida
   
   mAux1 = ""
   Select Case mIndex
      Case 0
         mAux1 = "esp"
      Case 1
         mAux1 = "ing"
      Case 2
         mAux1 = "por"
   End Select
   
   CambiarLenguaje Me, glbIdiomaActual, mAux1, ""
   
   glbIdiomaActual = mAux1
   
   oEmp.Registro.Fields("Idioma").Value = mAux1
   oEmp.Guardar
Salida:
   Set oEmp = Nothing

End Sub

Public Sub AsignarMascaras(ByVal mIdRubro As Long, ByVal mIdSubrubro As Long)

   Dim oF As frmAsignaComprador
   Dim oRs As ADOR.Recordset
   Dim mIdEntidad As Long
   Dim mEntidad As String, mCodigo As String
   Dim mOk As Boolean
   Dim mVector
   
   Set oF = New frmAsignaComprador
   With oF
      If mIdRubro > 0 Then
         Set oRs = Aplicacion.Rubros.TraerFiltrado("_PorId", mIdRubro)
         If oRs.RecordCount > 0 Then mEntidad = "Rubro : " & IIf(IsNull(oRs.Fields("Descripcion").Value), "", oRs.Fields("Descripcion").Value)
         .Id = 4
      Else
         Set oRs = Aplicacion.Subrubros.TraerFiltrado("_PorId", mIdSubrubro)
         If oRs.RecordCount > 0 Then mEntidad = "Subrubro : " & IIf(IsNull(oRs.Fields("Descripcion").Value), "", oRs.Fields("Descripcion").Value)
         .Id = 5
      End If
      oRs.Close
      With .Label1
         .Caption = mEntidad
         .Visible = True
      End With
      .Show vbModal, Me
      mOk = .Ok
      If mOk Then
         mIdEntidad = .DataCombo1(0).BoundText
         mCodigo = .DataCombo1(3).BoundText
      End If
   End With
   Unload oF
   Set oF = Nothing
   If Not mOk Or Len(mCodigo) = 0 Then Exit Sub
   
   mVector = VBA.Split(mCodigo, "|")
   If mIdRubro > 0 Then
      Aplicacion.Tarea "DefinicionArticulos_TX_Copiar", Array(mVector(0), mVector(1), mVector(2), mIdRubro, mIdEntidad, mVector(2))
   Else
      Aplicacion.Tarea "DefinicionArticulos_TX_Copiar", Array(mVector(0), mVector(1), mVector(2), mIdEntidad, mIdSubrubro, mVector(2))
   End If
   
   MsgBox "Proceso Concluido", vbInformation

End Sub

Public Sub LiberarOrdenesCompra()

   Dim oAp As ComPronto.Aplicacion
   Dim oCom As ComPronto.OrdenCompra
   Dim oF As frmAutorizacion
   Dim s As String, iFilas As Integer
   Dim mIdAutorizo As Long
   Dim mOk As Boolean, mLibero As Boolean
   Dim Filas, Columnas
   
   Set oF = New frmAutorizacion
   With oF
      .Empleado = 0
      .Administradores = True
      .Show vbModal, Me
      mOk = .Ok
      mIdAutorizo = .IdAutorizo
   End With
   Unload oF
   Set oF = Nothing
   If Not mOk Then Exit Sub
   
   Me.Refresh
   
   Set oAp = Aplicacion
   
   Filas = VBA.Split(Lista.GetString, vbCrLf)
   s = ""
   For iFilas = LBound(Filas) + 1 To UBound(Filas)
      Columnas = VBA.Split(Filas(iFilas), vbTab)
      If IsNumeric(Columnas(2)) Then
         Set oCom = oAp.OrdenesCompra.Item(Columnas(2))
         With oCom.Registro
            mLibero = False
            If IsNull(.Fields("Aprobo").Value) Then
               .Fields("Aprobo").Value = mIdAutorizo
               .Fields("FechaAprobacion").Value = Now
               mLibero = True
            End If
         End With
         If mLibero Then oCom.Guardar
         Set oCom = Nothing
      End If
   Next
   Arbol_NodeClick Arbol.SelectedItem
   
   Set oAp = Nothing

End Sub

Public Sub EmitirRecibos(ByVal Destino As Integer)

   Dim mvarEmiteCotizacion As Boolean
   mvarEmiteCotizacion = False
   Dim of1 As frm_Aux
   Set of1 = New frm_Aux
   With of1
      .Caption = "Emision de recibo"
      .Label1.Visible = False
      .Text1.Visible = False
      With .Frame1
         .Caption = "Emite cotizacion dolar ? : "
         .Top = of1.Label1.Top
         .Visible = True
      End With
      .Option1.Caption = "SI"
      .Option1.Value = True
      .Option2.Caption = "NO"
      .Show vbModal, Me
      mvarEmiteCotizacion = .Option1.Value
   End With
   Unload of1
   Set of1 = Nothing
   Me.Refresh
   
   Dim mvarOK As Boolean
   Dim mCopias As Integer
   Dim mPrinter As String, mPrinterAnt As String
   
   mPrinterAnt = Printer.DeviceName & " on " & Printer.Port
   
   If Destino = 0 Then
      Dim oF As frmCopiasImpresion
      Set oF = New frmCopiasImpresion
      With oF
         .txtCopias.Text = 2
         .Frame1.Visible = False
         .Show vbModal, Me
      End With
      mvarOK = oF.Ok
      mCopias = Val(oF.txtCopias.Text)
      mPrinter = oF.Combo1.Text
      Unload oF
      Set oF = Nothing
      If Not mvarOK Then
         Exit Sub
      End If
   Else
      mCopias = 1
   End If
   
   Dim oW As Word.Application
   Dim iFilas As Integer, mIds As String, mPID As String
   Dim Filas
   Dim Columnas
   
   On Error GoTo Mal
   
   Me.MousePointer = vbHourglass
   DoEvents
   
   If Destino = 0 Then CargaProcesosEnEjecucion
   Set oW = CreateObject("Word.Application")
   If Destino = 0 Then mPID = ObtenerPIDProcesosLanzados
   
   Filas = VBA.Split(Lista.GetString, vbCrLf)
   For iFilas = LBound(Filas) + 1 To UBound(Filas)
      Columnas = VBA.Split(Filas(iFilas), vbTab)
      With oW
         .Visible = True
         .Documents.Add (glbPathPlantillas & "\Recibo_" & glbEmpresaSegunString & ".dot")
         .Application.Run MacroName:="Emision", varg1:=glbStringConexion, varg2:=Columnas(2), _
               varg3:=mvarEmiteCotizacion, varg4:=mPrinter, varg5:=mCopias, _
               varg6:=glbEmpresaSegunString, varg7:=glbPathPlantillas
         If Destino = 0 Then
            oW.Documents(1).Close False
            'oW.Quit
         End If
      End With
   Next
   
   If Destino = 0 Then
      If glbTerminarProcesosOffice Then
         TerminarProceso mPID
      Else
         oW.Quit
      End If
   End If
   
   GoTo Salida
   
Mal:
   Me.MousePointer = vbDefault
   MsgBox "Se ha producido un error al imprimir ..." & vbCrLf & Err.Number & " " & Err.Description, vbCritical

Salida:
   Set oW = Nothing
   Me.MousePointer = vbDefault

End Sub

Public Sub MarcarChequeComoRechazado()

   Dim oAp As ComPronto.Aplicacion
   Dim oValor As ComPronto.Valor
   Dim oF As frmAutorizacion
   Dim s As String, mUsuario As String, iFilas As Integer
   Dim mIdAutorizo As Long
   Dim mOk As Boolean, mLibero As Boolean
   Dim Filas, Columnas
   
   Set oF = New frmAutorizacion
   With oF
      .Empleado = 0
      .Administradores = True
      .Show vbModal, Me
      mOk = .Ok
      mIdAutorizo = .IdAutorizo
      mUsuario = .Autorizo
   End With
   Unload oF
   Set oF = Nothing
   If Not mOk Then Exit Sub
   
   Me.Refresh
   
   Dim of1 As frmAnulacion
   Dim mMotivoAnulacion As String
   Set of1 = New frmAnulacion
   With of1
      .Caption = "Motivo de rechazo del valor (30 caracteres)"
      .Text1.Text = "Usuario : " & mUsuario & " - [" & Now & "]"
      .Show vbModal, Me
      mOk = .Ok
      mMotivoAnulacion = mId(.rchAnulacion.Text, 1, 30)
   End With
   Unload of1
   Set of1 = Nothing
   If Not mOk Then
      MsgBox "Operacion cancelada!", vbExclamation
      Exit Sub
   End If
   
   Set oAp = Aplicacion
   
   Filas = VBA.Split(Lista.GetString, vbCrLf)
   s = ""
   For iFilas = LBound(Filas) + 1 To UBound(Filas)
      Columnas = VBA.Split(Filas(iFilas), vbTab)
      If Columnas(11) <> "RE" Then
         MsgBox "El valor debe venir de un recibo", vbExclamation
         Exit Sub
      End If
      If IsNumeric(Columnas(2)) Then
         Set oValor = oAp.Valores.Item(Columnas(2))
         With oValor.Registro
            .Fields("Rechazado").Value = "SI"
            .Fields("IdUsuarioAnulo").Value = mIdAutorizo
            .Fields("FechaAnulacion").Value = Now
            .Fields("MotivoAnulacion").Value = mMotivoAnulacion
         End With
         oValor.Guardar
         Set oValor = Nothing
      End If
   Next
   Arbol_NodeClick Arbol.SelectedItem
   
   Set oAp = Nothing

End Sub

Public Sub EliminarCuentasContables()

   On Error GoTo Mal
   
   Dim oF As frmAutorizacion
   Dim oL As ListItem
   Dim s As String, mUsuario As String, iFilas As Integer
   Dim mIdAutorizo As Long
   Dim mOk As Boolean, mLibero As Boolean
   Dim Filas, Columnas
   
   Set oF = New frmAutorizacion
   With oF
      .Empleado = 0
      .Administradores = True
      .Show vbModal, Me
      mOk = .Ok
      mIdAutorizo = .IdAutorizo
      mUsuario = .Autorizo
   End With
   Unload oF
   Set oF = Nothing
   If Not mOk Then Exit Sub
   
   Me.Refresh
   
   Me.MousePointer = vbHourglass
   DoEvents

   Filas = VBA.Split(Lista.GetString, vbCrLf)
   For iFilas = LBound(Filas) + 1 To UBound(Filas)
      Columnas = VBA.Split(Filas(iFilas), vbTab)
      If IsNumeric(Columnas(2)) Then
         Aplicacion.Tarea "Cuentas_E", Columnas(2)
         Aplicacion.Tarea "Log_InsertarRegistro", _
               Array("ELIM", Columnas(2), 0, Now, 0, "Tabla : Cuentas", GetCompName(), mIdAutorizo)
      End If
   Next
   Arbol_NodeClick Arbol.SelectedItem
   
   Me.MousePointer = vbDefault

Salida:
   Exit Sub
   
Mal:
   Me.MousePointer = vbDefault
   MsgBox "Se ha producido un error ..." & vbCrLf & Err.Number & " " & Err.Description, vbCritical
   Resume Salida

End Sub

Public Sub ImportacionComprobantesVenta()

   Dim oAp As ComPronto.Aplicacion
   Dim oEx As Excel.Application
   Dim oFac As ComPronto.Factura
   Dim oDeb As ComPronto.NotaDebito
   Dim oCre As ComPronto.NotaCredito
   Dim oCli As ComPronto.Cliente
   Dim oVen As ComPronto.Vendedor
   Dim oRs As ADOR.Recordset
   Dim oRsAux As ADOR.Recordset
   Dim oRsErrores As ADOR.Recordset
   Dim oF As Form
   Dim mArchivo As String, mTipo As String, mLetra As String, mCliente As String, mCorredor As String, mCuit As String
   Dim mCuitCorredor As String, mCAI As String, mComprobante As String
   Dim fl As Integer, mContador As Integer, mIdMonedaPesos As Integer, mPuntoVenta As Integer, mIdPuntoVenta As Integer
   Dim mIdTipoComprobante As Integer, mIdCodigoIva As Integer
   Dim mIdArticuloParaImportacionFacturas As Long, mNumero As Long, mIdCliente As Long, mIdVendedor As Long
   Dim mIdConceptoParaImportacionNDNC As Long, mNumeroCliente As Long, mIdCuenta As Long
   Dim mSubtotal As Double, mIVA As Double, mTotal As Double
   Dim mTasa As Single, mCotizacionDolar As Single
   Dim mFecha As Date, mFechaCAI As Date
   Dim mOk As Boolean, mConProblemas As Boolean
   Dim mAux1

   On Error GoTo Mal

   Set oF = New frmPathPresto
   With oF
      .Id = 16
      .Show vbModal
      mOk = .Ok
      If mOk Then
         mArchivo = .FileBrowser1(0).Text
      End If
   End With
   Unload oF
   Set oF = Nothing

   If Not mOk Then Exit Sub

   Set oAp = Aplicacion

   Set oRsErrores = CreateObject("ADOR.Recordset")
   With oRsErrores
      .Fields.Append "Id", adInteger
      .Fields.Append "Detalle", adVarChar, 200
   End With
   oRsErrores.Open

   Set oRs = oAp.Parametros.TraerFiltrado("_PorId", 1)
   mIdMonedaPesos = IIf(IsNull(oRs.Fields("IdMoneda").Value), 1, oRs.Fields("IdMoneda").Value)
   mIdCuenta = IIf(IsNull(oRs.Fields("IdCuentaDeudoresVarios").Value), 0, oRs.Fields("IdCuentaDeudoresVarios").Value)
   oRs.Close

   If mIdCuenta = 0 Then
      MsgBox "No definio en parametros la cuenta contable deudores varios", vbExclamation
      Exit Sub
   End If
   
   mAux1 = TraerValorParametro2("IdArticuloParaImportacionFacturas")
   mIdArticuloParaImportacionFacturas = IIf(IsNull(mAux1), 0, mAux1)
   mAux1 = TraerValorParametro2("IdConceptoParaImportacionNDNC")
   mIdConceptoParaImportacionNDNC = IIf(IsNull(mAux1), 0, mAux1)

   If mIdArticuloParaImportacionFacturas = 0 Then
      MsgBox "No definio en parametros el articulo generico para importar las facturas", vbExclamation
      Exit Sub
   End If
   
   Set oF = New frmAviso
   With oF
      .Label1 = "Abriendo planilla Excel ..."
      .Show
      .Refresh
      DoEvents
   End With

   oF.Label1 = oF.Label1 & vbCrLf & "Procesando comprobantes ..."
   oF.Label2 = ""
   oF.Label3 = ""
   DoEvents

   fl = 5

   Set oEx = CreateObject("Excel.Application")
   With oEx
      .Visible = True
      .WindowState = xlMinimized
      Me.Refresh

      With .Workbooks.Open(mArchivo)
         .Sheets("Hoja1").Select
         With .ActiveSheet
            Do While True
               If Len(Trim(.Cells(fl, 1))) = 0 Then Exit Do

               mConProblemas = False

               mTipo = .Cells(fl, 2)
               mLetra = "A"
               mPuntoVenta = CInt(.Cells(fl, 3))
               mNumero = CLng(.Cells(fl, 4))
               If IsDate(.Cells(fl, 5)) Then
                  mFecha = CDate(.Cells(fl, 5))
               Else
                  mFecha = Date
               End If
               mCliente = .Cells(fl, 6)
               mCorredor = .Cells(fl, 7)
               mSubtotal = CDbl(.Cells(fl, 8))
               mTasa = CSng(.Cells(fl, 9))
               mIVA = CDbl(.Cells(fl, 10))
               mTotal = CDbl(.Cells(fl, 11))
               mCuit = .Cells(fl, 15)
               mCuitCorredor = .Cells(fl, 16)

               mComprobante = mTipo & " " & mLetra & "-" & Format(mPuntoVenta, "0000") & "-" & Format(mNumero, "00000000")
               
               mContador = mContador + 1
               oF.Label2 = "" & mComprobante
               oF.Label3 = "" & mContador
               DoEvents

               mIdTipoComprobante = 0
               If mTipo = "FAC" Then mIdTipoComprobante = 1
               If mTipo = "NDD" Then mIdTipoComprobante = 3
               If mTipo = "NDC" Then mIdTipoComprobante = 4
               If mIdTipoComprobante = 0 Then
                  AgregarMensajeProcesoPresto oRsErrores, "El tipo de comprobante " & mTipo & _
                        " no existe, el comprobante " & mComprobante & " no fue importado."
                  mConProblemas = True
               End If

               mIdVendedor = 0
               Set oRsAux = oAp.Vendedores.TraerFiltrado("_PorCuit", mCuitCorredor)
               If oRsAux.RecordCount > 0 Then
                  mIdVendedor = oRsAux.Fields(0).Value
               Else
                  oRsAux.Close
                  Set oRsAux = oAp.Vendedores.TraerFiltrado("_PorNombre", mCorredor)
                  If oRsAux.RecordCount > 0 Then
                     mIdVendedor = oRsAux.Fields(0).Value
                  Else
                     Set oVen = oAp.Vendedores.Item(-1)
                     With oVen
                        With .Registro
                           .Fields("CodigoVendedor").Value = 0
                           .Fields("Nombre").Value = mCorredor
                           .Fields("IdLocalidad").Value = 79
                           .Fields("IdProvincia").Value = 3
                           .Fields("Comision").Value = 0
                           .Fields("Cuit").Value = mCuitCorredor
                        End With
                        .Guardar
                        mIdVendedor = .Registro.Fields(0).Value
                     End With
                     Set oVen = Nothing
                     'AgregarMensajeProcesoPresto oRsErrores, "El vendedor " & mCorredor & _
                     '      " no existe, el comprobante " & mComprobante & " no fue importado."
                     'mConProblemas = True
                  End If
               End If
               oRsAux.Close

               mIdCliente = 0
               mIdCodigoIva = 0
               Set oRsAux = oAp.Clientes.TraerFiltrado("_PorCuit", mCuit)
               If oRsAux.RecordCount > 0 Then
                  mIdCliente = oRsAux.Fields(0).Value
                  mIdCodigoIva = oRsAux.Fields("IdCodigoIva").Value
                  If IsNull(oRsAux.Fields("Vendedor1").Value) Then
                     Set oCli = oAp.Clientes.Item(mIdCliente)
                     With oCli
                        With .Registro
                           .Fields("Vendedor1").Value = mIdVendedor
                           .Fields("Cobrador").Value = mIdVendedor
                        End With
                        .Guardar
                     End With
                     Set oCli = Nothing
                  End If
               Else
                  mAux1 = TraerValorParametro2("ProximoNumeroCliente")
                  mNumeroCliente = IIf(IsNull(mAux1), 1, mAux1)
                  GuardarValorParametro2 "ProximoNumeroCliente", "" & mNumeroCliente + 1
                  mIdCodigoIva = 1
                  Set oCli = oAp.Clientes.Item(-1)
                  With oCli
                     With .Registro
                        .Fields("RazonSocial").Value = mCliente
                        .Fields("Direccion").Value = ""
                        .Fields("IdLocalidad").Value = 79
                        .Fields("IdProvincia").Value = 3
                        .Fields("IdPais").Value = 12
                        .Fields("Cuit").Value = mCuit
                        .Fields("IdCodigoIva").Value = mIdCodigoIva
                        .Fields("CodigoCliente").Value = mNumeroCliente
                        .Fields("IdCuenta").Value = mIdCuenta
                        .Fields("Vendedor1").Value = mIdVendedor
                        .Fields("IGCondicion").Value = 4
                        .Fields("IdCondicionVenta").Value = 0
                        .Fields("IdMoneda").Value = mIdMonedaPesos
                        .Fields("TipoCliente").Value = 1
                        .Fields("Confirmado").Value = "NO"
                        .Fields("Cobrador").Value = mIdVendedor
                        .Fields("IdEstado").Value = 1
                        .Fields("EsAgenteRetencionIVA").Value = "NO"
                        .Fields("IdUsuarioIngreso").Value = glbIdUsuario
                        .Fields("FechaIngreso").Value = Now
                        .Fields("Codigo").Value = "CL" & Format(mNumeroCliente, "0000")
                     End With
                     .Guardar
                     mIdCliente = .Registro.Fields(0).Value
                  End With
                  Set oCli = Nothing
                  'AgregarMensajeProcesoPresto oRsErrores, "El cliente " & mCliente & " con cuit " & mCuit & _
                  '      " no existe en la base de datos, el comprobante " & mTipo & " " & mLetra & "-" & _
                  '      Format(mPuntoVenta, "0000") & "-" & Format(mNumero, "00000000") & " no fue importado."
                  'mConProblemas = True
               End If
               oRsAux.Close

               mIdPuntoVenta = 0
               mCAI = ""
               mFechaCAI = 0
               Set oRsAux = oAp.PuntosVenta.TraerFiltrado("_Duplicados", Array(mLetra, mIdTipoComprobante, mPuntoVenta, -1))
               If oRsAux.RecordCount > 0 Then
                  mIdPuntoVenta = oRsAux.Fields(0).Value
                  Select Case mLetra
                     Case "A"
                        If mIdTipoComprobante = 1 Then
                           If IsNull(oRsAux.Fields("NumeroCAI_F_A").Value) Or Len(Trim(oRsAux.Fields("NumeroCAI_F_A").Value)) = 0 Then
                              AgregarMensajeProcesoPresto oRsErrores, "El punto de venta " & mPuntoVenta & " para la letra " & mLetra & _
                                    " no tiene CAI en la base de datos, el comprobante " & mComprobante & " no fue importado."
                              mConProblemas = True
                           Else
                              If IsNumeric(oRsAux.Fields("NumeroCAI_F_A").Value) Then mCAI = oRsAux.Fields("NumeroCAI_F_A").Value
                              If IsDate(oRsAux.Fields("FechaCAI_F_A").Value) Then mFechaCAI = IIf(IsNull(oRsAux.Fields("FechaCAI_F_A").Value), Date, oRsAux.Fields("FechaCAI_F_A").Value)
                           End If
                        ElseIf mIdTipoComprobante = 3 Then
                           If IsNull(oRsAux.Fields("NumeroCAI_D_A").Value) Or Len(Trim(oRsAux.Fields("NumeroCAI_D_A").Value)) = 0 Then
                              AgregarMensajeProcesoPresto oRsErrores, "El punto de venta " & mPuntoVenta & " para la letra " & mLetra & _
                                    " no tiene CAI en la base de datos, el comprobante " & mComprobante & " no fue importado."
                              mConProblemas = True
                           Else
                              If IsNumeric(oRsAux.Fields("NumeroCAI_D_A").Value) Then mCAI = oRsAux.Fields("NumeroCAI_D_A").Value
                              If IsDate(oRsAux.Fields("FechaCAI_D_A").Value) Then mFechaCAI = IIf(IsNull(oRsAux.Fields("FechaCAI_D_A").Value), Date, oRsAux.Fields("FechaCAI_D_A").Value)
                           End If
                        ElseIf mIdTipoComprobante = 4 Then
                           If IsNull(oRsAux.Fields("NumeroCAI_C_A").Value) Or Len(Trim(oRsAux.Fields("NumeroCAI_C_A").Value)) = 0 Then
                              AgregarMensajeProcesoPresto oRsErrores, "El punto de venta " & mPuntoVenta & " para la letra " & mLetra & _
                                    " no tiene CAI en la base de datos, el comprobante " & mComprobante & " no fue importado."
                              mConProblemas = True
                           Else
                              If IsNumeric(oRsAux.Fields("NumeroCAI_C_A").Value) Then mCAI = oRsAux.Fields("NumeroCAI_C_A").Value
                              If IsDate(oRsAux.Fields("FechaCAI_C_A").Value) Then mFechaCAI = IIf(IsNull(oRsAux.Fields("FechaCAI_C_A").Value), Date, oRsAux.Fields("FechaCAI_C_A").Value)
                           End If
                        End If
                     Case "B"
                        If mIdTipoComprobante = 1 Then
                           If IsNull(oRsAux.Fields("NumeroCAI_F_B").Value) Or Len(Trim(oRsAux.Fields("NumeroCAI_F_B").Value)) = 0 Then
                              AgregarMensajeProcesoPresto oRsErrores, "El punto de venta " & mPuntoVenta & " para la letra " & mLetra & _
                                    " no tiene CAI en la base de datos, el comprobante " & mComprobante & " no fue importado."
                              mConProblemas = True
                           Else
                              If IsNumeric(oRsAux.Fields("NumeroCAI_F_B").Value) Then mCAI = oRsAux.Fields("NumeroCAI_F_B").Value
                              If IsDate(oRsAux.Fields("FechaCAI_F_B").Value) Then mFechaCAI = IIf(IsNull(oRsAux.Fields("FechaCAI_F_B").Value), Date, oRsAux.Fields("FechaCAI_F_B").Value)
                           End If
                        ElseIf mIdTipoComprobante = 3 Then
                           If IsNull(oRsAux.Fields("NumeroCAI_D_B").Value) Or Len(Trim(oRsAux.Fields("NumeroCAI_D_B").Value)) = 0 Then
                              AgregarMensajeProcesoPresto oRsErrores, "El punto de venta " & mPuntoVenta & " para la letra " & mLetra & _
                                    " no tiene CAI en la base de datos, el comprobante " & mComprobante & " no fue importado."
                              mConProblemas = True
                           Else
                              If IsNumeric(oRsAux.Fields("NumeroCAI_D_B").Value) Then mCAI = oRsAux.Fields("NumeroCAI_D_B").Value
                              If IsDate(oRsAux.Fields("FechaCAI_D_B").Value) Then mFechaCAI = IIf(IsNull(oRsAux.Fields("FechaCAI_D_B").Value), Date, oRsAux.Fields("FechaCAI_D_B").Value)
                           End If
                        ElseIf mIdTipoComprobante = 4 Then
                           If IsNull(oRsAux.Fields("NumeroCAI_C_B").Value) Or Len(Trim(oRsAux.Fields("NumeroCAI_C_B").Value)) = 0 Then
                              AgregarMensajeProcesoPresto oRsErrores, "El punto de venta " & mPuntoVenta & " para la letra " & mLetra & _
                                    " no tiene CAI en la base de datos, el comprobante " & mComprobante & " no fue importado."
                              mConProblemas = True
                           Else
                              If IsNumeric(oRsAux.Fields("NumeroCAI_C_B").Value) Then mCAI = oRsAux.Fields("NumeroCAI_C_B").Value
                              If IsDate(oRsAux.Fields("FechaCAI_C_B").Value) Then mFechaCAI = IIf(IsNull(oRsAux.Fields("FechaCAI_C_B").Value), Date, oRsAux.Fields("FechaCAI_C_B").Value)
                           End If
                        End If
                     Case "E"
                        If mIdTipoComprobante = 1 Then
                           If IsNull(oRsAux.Fields("NumeroCAI_F_E").Value) Or Len(Trim(oRsAux.Fields("NumeroCAI_F_E").Value)) = 0 Then
                              AgregarMensajeProcesoPresto oRsErrores, "El punto de venta " & mPuntoVenta & " para la letra " & mLetra & _
                                    " no tiene CAI en la base de datos, el comprobante " & mComprobante & " no fue importado."
                              mConProblemas = True
                           Else
                              If IsNumeric(oRsAux.Fields("NumeroCAI_F_E").Value) Then mCAI = oRsAux.Fields("NumeroCAI_F_E").Value
                              If IsDate(oRsAux.Fields("FechaCAI_F_E").Value) Then mFechaCAI = IIf(IsNull(oRsAux.Fields("FechaCAI_F_E").Value), Date, oRsAux.Fields("FechaCAI_F_E").Value)
                           End If
                        ElseIf mIdTipoComprobante = 3 Then
                           If IsNull(oRsAux.Fields("NumeroCAI_D_E").Value) Or Len(Trim(oRsAux.Fields("NumeroCAI_D_E").Value)) = 0 Then
                              AgregarMensajeProcesoPresto oRsErrores, "El punto de venta " & mPuntoVenta & " para la letra " & mLetra & _
                                    " no tiene CAI en la base de datos, el comprobante " & mComprobante & " no fue importado."
                              mConProblemas = True
                           Else
                              If IsNumeric(oRsAux.Fields("NumeroCAI_D_E").Value) Then mCAI = oRsAux.Fields("NumeroCAI_D_E").Value
                              If IsDate(oRsAux.Fields("FechaCAI_D_E").Value) Then mFechaCAI = IIf(IsNull(oRsAux.Fields("FechaCAI_D_E").Value), Date, oRsAux.Fields("FechaCAI_D_E").Value)
                           End If
                        ElseIf mIdTipoComprobante = 4 Then
                           If IsNull(oRsAux.Fields("NumeroCAI_C_E").Value) Or Len(Trim(oRsAux.Fields("NumeroCAI_C_E").Value)) = 0 Then
                              AgregarMensajeProcesoPresto oRsErrores, "El punto de venta " & mPuntoVenta & " para la letra " & mLetra & _
                                    " no tiene CAI en la base de datos, el comprobante " & mComprobante & " no fue importado."
                              mConProblemas = True
                           Else
                              If IsNumeric(oRsAux.Fields("NumeroCAI_C_E").Value) Then mCAI = oRsAux.Fields("NumeroCAI_C_E").Value
                              If IsDate(oRsAux.Fields("FechaCAI_C_E").Value) Then mFechaCAI = IIf(IsNull(oRsAux.Fields("FechaCAI_C_E").Value), Date, oRsAux.Fields("FechaCAI_C_E").Value)
                           End If
                        End If
                  End Select
               Else
                  AgregarMensajeProcesoPresto oRsErrores, "El punto de venta " & mPuntoVenta & " para la letra " & mLetra & _
                        " no existe en la base de datos, el comprobante " & mComprobante & " no fue importado."
                  mConProblemas = True
               End If
               oRsAux.Close

               mCotizacionDolar = Cotizacion(mFecha, glbIdMonedaDolar)
               If mCotizacionDolar = 0 Then
                  AgregarMensajeProcesoPresto oRsErrores, "No hay cotizacion dolar para la fecha " & mFecha & _
                        ", el comprobante " & mComprobante & " no fue importado."
                  mConProblemas = True
               End If

               Select Case mTipo
                  Case "FAC"
                     If mIdArticuloParaImportacionFacturas = 0 Then
                        AgregarMensajeProcesoPresto oRsErrores, "No definio en parametros el articulo generico para la importacion de facturas" & _
                              ", el comprobante " & mComprobante & " no fue importado."
                        mConProblemas = True
                     End If
                     
                     Set oRsAux = oAp.Facturas.TraerFiltrado("_PorNumeroComprobante", Array(mLetra, mPuntoVenta, mNumero))
                     If oRsAux.RecordCount > 0 Then
                        AgregarMensajeProcesoPresto oRsErrores, "La factura " & mComprobante & " ya existe y no fue importada."
                        mConProblemas = True
                     End If
                     oRsAux.Close

                     If Not mConProblemas Then
                        Set oFac = oAp.Facturas.Item(-1)
                        With oFac
                           With .Registro
                              .Fields("NumeroFactura").Value = mNumero
                              .Fields("TipoABC").Value = mLetra
                              .Fields("PuntoVenta").Value = mPuntoVenta
                              .Fields("IdCliente").Value = mIdCliente
                              .Fields("FechaFactura").Value = mFecha
                              .Fields("IdVendedor").Value = mIdVendedor
                              .Fields("ImporteTotal").Value = mTotal
                              .Fields("ImporteIva1").Value = mIVA
                              .Fields("ImporteIva2").Value = 0
                              .Fields("ImporteBonificacion").Value = 0
                              .Fields("RetencionIBrutos1").Value = 0
                              .Fields("PorcentajeIBrutos1").Value = 0
                              .Fields("RetencionIBrutos2").Value = 0
                              .Fields("PorcentajeIBrutos2").Value = 0
                              .Fields("ConvenioMultilateral").Value = "NO"
                              .Fields("RetencionIBrutos3").Value = 0
                              .Fields("PorcentajeIBrutos3").Value = 0
                              .Fields("CotizacionDolar").Value = mCotizacionDolar
                              .Fields("PorcentajeIva1").Value = mTasa
                              .Fields("PorcentajeIva2").Value = 0
                              .Fields("FechaVencimiento").Value = mFecha
                              .Fields("IVANoDiscriminado").Value = 0
                              .Fields("IdMoneda").Value = mIdMonedaPesos
                              .Fields("CotizacionMoneda").Value = 1
                              .Fields("PorcentajeBonificacion").Value = 0
                              .Fields("OtrasPercepciones1").Value = 0
                              .Fields("OtrasPercepciones1Desc").Value = ""
                              .Fields("OtrasPercepciones2").Value = 0
                              .Fields("OtrasPercepciones2Desc").Value = ""
                              .Fields("IdPuntoVenta").Value = mIdPuntoVenta
                              .Fields("NumeroCAI").Value = Val(mCAI)
                              .Fields("FechaVencimientoCAI").Value = mFechaCAI
                              .Fields("IdUsuarioIngreso").Value = glbIdUsuario
                              .Fields("FechaIngreso").Value = Now
                              .Fields("IdCodigoIva").Value = mIdCodigoIva
                              .Fields("PercepcionIVA").Value = 0
                              .Fields("PorcentajePercepcionIVA").Value = 0
                           End With
                           With .DetFacturas.Item(-1)
                              With .Registro
                                 .Fields("NumeroFactura").Value = mNumero
                                 .Fields("TipoABC").Value = mLetra
                                 .Fields("PuntoVenta").Value = mPuntoVenta
                                 .Fields("IdArticulo").Value = mIdArticuloParaImportacionFacturas
                                 .Fields("Cantidad").Value = 1
                                 .Fields("Costo").Value = 0
                                 .Fields("PrecioUnitario").Value = mTotal - mIVA
                                 .Fields("Bonificacion").Value = 0
                                 .Fields("OrigenDescripcion").Value = 1
                                 .Fields("PrecioUnitarioTotal").Value = mTotal - mIVA
                              End With
                              .Modificado = True
                           End With
                           .Guardar
                        End With
                        Set oFac = Nothing
                     End If

                  Case "NDD"
                     If mIdConceptoParaImportacionNDNC = 0 Then
                        AgregarMensajeProcesoPresto oRsErrores, "No definio en parametros el concepto generico para la importacion de nd/nc" & _
                              ", el comprobante " & mComprobante & " no fue importado."
                        mConProblemas = True
                     End If
                     
                     Set oRsAux = oAp.NotasDebito.TraerFiltrado("_PorNumeroComprobante", Array(mLetra, mPuntoVenta, mNumero))
                     If oRsAux.RecordCount > 0 Then
                        AgregarMensajeProcesoPresto oRsErrores, "La nota de debito " & mComprobante & " ya existe y no fue importada."
                        mConProblemas = True
                     End If
                     oRsAux.Close

                     If Not mConProblemas Then
                        Set oDeb = oAp.NotasDebito.Item(-1)
                        With oDeb
                           With .Registro
                              .Fields("NumeroNotaDebito").Value = mNumero
                              .Fields("TipoABC").Value = mLetra
                              .Fields("PuntoVenta").Value = mPuntoVenta
                              .Fields("IdCliente").Value = mIdCliente
                              .Fields("FechaNotaDebito").Value = mFecha
                              .Fields("IdVendedor").Value = mIdVendedor
                              .Fields("ImporteTotal").Value = mTotal
                              .Fields("ImporteIva1").Value = mIVA
                              .Fields("ImporteIva2").Value = 0
                              .Fields("RetencionIBrutos1").Value = 0
                              .Fields("PorcentajeIBrutos1").Value = 0
                              .Fields("RetencionIBrutos2").Value = 0
                              .Fields("PorcentajeIBrutos2").Value = 0
                              .Fields("IdCodigoIva").Value = mIdCodigoIva
                              .Fields("PorcentajeIva1").Value = mTasa
                              .Fields("PorcentajeIva2").Value = 0
                              .Fields("CotizacionDolar").Value = mCotizacionDolar
                              .Fields("CtaCte").Value = "SI"
                              .Fields("IdMoneda").Value = mIdMonedaPesos
                              .Fields("CotizacionMoneda").Value = 1
                              .Fields("IVANoDiscriminado").Value = 0
                              .Fields("ConvenioMultilateral").Value = "NO"
                              .Fields("OtrasPercepciones1").Value = 0
                              .Fields("OtrasPercepciones1Desc").Value = ""
                              .Fields("OtrasPercepciones2").Value = 0
                              .Fields("OtrasPercepciones2Desc").Value = ""
                              .Fields("OtrasPercepciones3").Value = 0
                              .Fields("OtrasPercepciones3Desc").Value = ""
                              .Fields("IdPuntoVenta").Value = mIdPuntoVenta
                              .Fields("NumeroCAI").Value = mCAI
                              .Fields("FechaVencimientoCAI").Value = mFechaCAI
                              .Fields("IdUsuarioIngreso").Value = glbIdUsuario
                              .Fields("FechaIngreso").Value = Now
                              .Fields("AplicarEnCtaCte").Value = "SI"
                              .Fields("RetencionIBrutos3").Value = 0
                              .Fields("PorcentajeIBrutos3").Value = 0
                           End With
                           With .DetNotasDebito.Item(-1)
                              With .Registro
                                 .Fields("IdConcepto").Value = mIdConceptoParaImportacionNDNC
                                 .Fields("Importe").Value = mTotal - mIVA
                                 If mIVA <> 0 Then
                                    .Fields("Gravado").Value = "SI"
                                 Else
                                    .Fields("Gravado").Value = "NO"
                                 End If
                                 .Fields("IvaNoDiscriminado").Value = 0
                              End With
                              .Modificado = True
                           End With
                           .Guardar
                        End With
                        Set oDeb = Nothing
                     End If
                        
                  Case "NDC"
                     If mIdConceptoParaImportacionNDNC = 0 Then
                        AgregarMensajeProcesoPresto oRsErrores, "No definio en parametros el concepto generico para la importacion de nd/nc" & _
                              ", el comprobante " & mComprobante & " no fue importado."
                        mConProblemas = True
                     End If
                     
                     Set oRsAux = oAp.NotasCredito.TraerFiltrado("_PorNumeroComprobante", Array(mLetra, mPuntoVenta, mNumero))
                     If oRsAux.RecordCount > 0 Then
                        AgregarMensajeProcesoPresto oRsErrores, "La nota de credito " & mComprobante & " ya existe y no fue importada."
                        mConProblemas = True
                     End If
                     oRsAux.Close

                     If Not mConProblemas Then
                        Set oCre = oAp.NotasCredito.Item(-1)
                        With oCre
                           With .Registro
                              .Fields("NumeroNotaCredito").Value = mNumero
                              .Fields("TipoABC").Value = mLetra
                              .Fields("PuntoVenta").Value = mPuntoVenta
                              .Fields("IdCliente").Value = mIdCliente
                              .Fields("FechaNotaCredito").Value = mFecha
                              .Fields("IdVendedor").Value = mIdVendedor
                              .Fields("ImporteTotal").Value = mTotal
                              .Fields("ImporteIva1").Value = mIVA
                              .Fields("ImporteIva2").Value = 0
                              .Fields("RetencionIBrutos1").Value = 0
                              .Fields("PorcentajeIBrutos1").Value = 0
                              .Fields("RetencionIBrutos2").Value = 0
                              .Fields("PorcentajeIBrutos2").Value = 0
                              .Fields("IdCodigoIva").Value = mIdCodigoIva
                              .Fields("PorcentajeIva1").Value = mTasa
                              .Fields("PorcentajeIva2").Value = 0
                              .Fields("CotizacionDolar").Value = mCotizacionDolar
                              .Fields("CtaCte").Value = "SI"
                              .Fields("IdMoneda").Value = mIdMonedaPesos
                              .Fields("CotizacionMoneda").Value = 1
                              .Fields("IVANoDiscriminado").Value = 0
                              .Fields("ConvenioMultilateral").Value = "NO"
                              .Fields("OtrasPercepciones1").Value = 0
                              .Fields("OtrasPercepciones1Desc").Value = ""
                              .Fields("OtrasPercepciones2").Value = 0
                              .Fields("OtrasPercepciones2Desc").Value = ""
                              .Fields("OtrasPercepciones3").Value = 0
                              .Fields("OtrasPercepciones3Desc").Value = ""
                              .Fields("IdPuntoVenta").Value = mIdPuntoVenta
                              .Fields("NumeroCAI").Value = mCAI
                              .Fields("FechaVencimientoCAI").Value = mFechaCAI
                              .Fields("IdUsuarioIngreso").Value = glbIdUsuario
                              .Fields("FechaIngreso").Value = Now
                              .Fields("AplicarEnCtaCte").Value = "SI"
                              .Fields("RetencionIBrutos3").Value = 0
                              .Fields("PorcentajeIBrutos3").Value = 0
                           End With
                           With .DetNotasCredito.Item(-1)
                              With .Registro
                                 .Fields("IdConcepto").Value = mIdConceptoParaImportacionNDNC
                                 .Fields("Importe").Value = mTotal - mIVA
                                 If mIVA <> 0 Then
                                    .Fields("Gravado").Value = "SI"
                                 Else
                                    .Fields("Gravado").Value = "NO"
                                 End If
                                 .Fields("IvaNoDiscriminado").Value = 0
                              End With
                              .Modificado = True
                           End With
                           With .DetNotasCreditoImp.Item(-1)
                              With .Registro
                                 .Fields("IdImputacion").Value = -1
                                 .Fields("Importe").Value = mTotal
                              End With
                              .Modificado = True
                           End With
                           .Guardar
                        End With
                        Set oCre = Nothing
                     End If
               End Select
               fl = fl + 1
            Loop
         End With
         .Close False
      End With
      .Quit
   End With

   Unload oF
   Set oF = Nothing

   If Not oRsErrores Is Nothing Then
      If oRsErrores.RecordCount > 0 Then
         Set oF = New frmConsulta1
         With oF
            Set .RecordsetFuente = oRsErrores
            .Id = 13
            .Show vbModal, Me
         End With
      Else
         MsgBox "Proceso completo", vbInformation
      End If
      Set oRsErrores = Nothing
   End If

Salida:
   On Error Resume Next

   Unload oF
   Set oF = Nothing

   Set oRs = Nothing
   Set oRsErrores = Nothing
   Set oRsAux = Nothing
   Set oFac = Nothing
   Set oDeb = Nothing
   Set oCre = Nothing
   Set oCli = Nothing
   Set oEx = Nothing
   Set oAp = Nothing

   Exit Sub

Mal:
   MsgBox "Se ha producido un error al registrar los datos" & vbCrLf & Err.Number & " -> " & Err.Description, vbCritical
   Resume Salida
   
End Sub

' IMPORTADOR DESARROLLADO PARA WILLIAMS, SE EJECUTA POR UNICA VEZ
Public Sub ImportacionComprobantesVenta1()

   Dim oAp As ComPronto.Aplicacion
   Dim oEx As Excel.Application
   Dim oFac As ComPronto.Factura
   Dim oDeb As ComPronto.NotaDebito
   Dim oCre As ComPronto.NotaCredito
   Dim oCli As ComPronto.Cliente
   Dim oVen As ComPronto.Vendedor
   Dim oRs As ADOR.Recordset
   Dim oRsAux As ADOR.Recordset
   Dim oRsErrores As ADOR.Recordset
   Dim oF As Form
   Dim mArchivo As String, mTipo As String, mLetra As String, mCliente As String, mCorredor As String, mCuit As String
   Dim mCuitCorredor As String, mCAI As String, mComprobante As String
   Dim fl As Integer, mContador As Integer, mIdMonedaPesos As Integer, mPuntoVenta As Integer, mIdPuntoVenta As Integer
   Dim mIdTipoComprobante As Integer, mIdCodigoIva As Integer
   Dim mIdArticuloParaImportacionFacturas As Long, mNumero As Long, mIdCliente As Long, mIdVendedor As Long
   Dim mIdConceptoParaImportacionNDNC As Long, mNumeroCliente As Long, mIdCuenta As Long
   Dim mSubtotal As Double, mIVA As Double, mTotal As Double
   Dim mTasa As Single, mCotizacionDolar As Single
   Dim mFecha As Date, mFechaCAI As Date
   Dim mOk As Boolean, mConProblemas As Boolean
   Dim mAux1

'   On Error GoTo Mal

   Set oF = New frmPathPresto
   With oF
      .Id = 16
      .Show vbModal
      mOk = .Ok
      If mOk Then
         mArchivo = .FileBrowser1(0).Text
      End If
   End With
   Unload oF
   Set oF = Nothing

   If Not mOk Then Exit Sub

   Set oAp = Aplicacion

   Set oRsErrores = CreateObject("ADOR.Recordset")
   With oRsErrores
      .Fields.Append "Id", adInteger
      .Fields.Append "Detalle", adVarChar, 200
   End With
   oRsErrores.Open

   Set oRs = oAp.Parametros.TraerFiltrado("_PorId", 1)
   mIdMonedaPesos = IIf(IsNull(oRs.Fields("IdMoneda").Value), 1, oRs.Fields("IdMoneda").Value)
   mIdCuenta = IIf(IsNull(oRs.Fields("IdCuentaDeudoresVarios").Value), 0, oRs.Fields("IdCuentaDeudoresVarios").Value)
   oRs.Close

   If mIdCuenta = 0 Then
      MsgBox "No definio en parametros la cuenta contable deudores varios", vbExclamation
      Exit Sub
   End If
   
   mAux1 = TraerValorParametro2("IdArticuloParaImportacionFacturas")
   mIdArticuloParaImportacionFacturas = IIf(IsNull(mAux1), 0, mAux1)
   mAux1 = TraerValorParametro2("IdConceptoParaImportacionNDNC")
   mIdConceptoParaImportacionNDNC = IIf(IsNull(mAux1), 0, mAux1)

   If mIdArticuloParaImportacionFacturas = 0 Then
      MsgBox "No definio en parametros el articulo generico para importar las facturas", vbExclamation
      Exit Sub
   End If
   
   Set oF = New frmAviso
   With oF
      .Label1 = "Abriendo planilla Excel ..."
      .Show
      .Refresh
      DoEvents
   End With

   oF.Label1 = oF.Label1 & vbCrLf & "Procesando comprobantes ..."
   oF.Label2 = ""
   oF.Label3 = ""
   DoEvents

   fl = 8

   Set oEx = CreateObject("Excel.Application")
   With oEx
      .Visible = True
      .WindowState = xlMinimized
      Me.Refresh

      With .Workbooks.Open(mArchivo)
         .Sheets("Hoja1").Select
         With .ActiveSheet
            Do While True
               If Len(Trim(.Cells(fl, 1))) = 0 Then Exit Do
               If Len(Trim(.Cells(fl, 6))) = 0 Then GoTo Continuar

               mConProblemas = False

               mTipo = .Cells(fl, 5)
               If mTipo = "TO" Then GoTo Continuar
               If mTipo = "SC" Then
                  mLetra = "A"
               Else
                  mLetra = mId(.Cells(fl, 6), 4, 1)
               End If
               mPuntoVenta = CInt(mId(.Cells(fl, 6), 6, 4))
               mNumero = CLng(mId(.Cells(fl, 6), 11, 8))
               If IsDate(.Cells(fl, 3)) Then
                  mFecha = CDate(.Cells(fl, 3))
               Else
                  mFecha = Date
               End If
               mCliente = .Cells(fl, 1)
               mCorredor = .Cells(fl, 10)
               mSubtotal = Abs(CDbl(.Cells(fl, 7)))
               mTasa = 0
               mIVA = 0
               mTotal = mSubtotal
               mCuit = ""
               mCuitCorredor = ""

               mComprobante = .Cells(fl, 6)
               
               mContador = mContador + 1
               oF.Label2 = "" & mComprobante
               oF.Label3 = "" & mContador
               DoEvents

               mIdTipoComprobante = 0
               If mTipo = "FC" Or mTipo = "FZ" Then mIdTipoComprobante = 1
               If mTipo = "ND" Then mIdTipoComprobante = 3
               If mTipo = "NC" Or mTipo = "NZ" Or mTipo = "SC" Then mIdTipoComprobante = 4
               If mIdTipoComprobante = 0 Then
                  AgregarMensajeProcesoPresto oRsErrores, "El tipo de comprobante " & mTipo & _
                        " no existe, el comprobante " & mComprobante & " no fue importado."
                  mConProblemas = True
               End If

               mIdVendedor = 0
               Set oRsAux = oAp.Vendedores.TraerFiltrado("_PorNombre", mCorredor)
               If oRsAux.RecordCount > 0 Then
                  mIdVendedor = oRsAux.Fields(0).Value
               Else
                  'AgregarMensajeProcesoPresto oRsErrores, "El vendedor " & mCorredor & _
                  '      " no existe, el comprobante " & mComprobante & " no fue importado."
                  'mConProblemas = True
               End If
               oRsAux.Close

               mIdCliente = 0
               mIdCodigoIva = 0
               Set oRsAux = oAp.Clientes.TraerFiltrado("_PorRazonSocial", mCliente)
               If oRsAux.RecordCount > 0 Then
                  mIdCliente = oRsAux.Fields(0).Value
                  mIdCodigoIva = oRsAux.Fields("IdCodigoIva").Value
               Else
                  AgregarMensajeProcesoPresto oRsErrores, "El cliente " & mCliente & " con cuit " & mCuit & _
                        " no existe en la base de datos, el comprobante " & mComprobante & " no fue importado."
                  mConProblemas = True
               End If
               oRsAux.Close

               mIdPuntoVenta = 0
               mCAI = ""
               mFechaCAI = 0
               Set oRsAux = oAp.PuntosVenta.TraerFiltrado("_Duplicados", Array(mLetra, mIdTipoComprobante, mPuntoVenta, -1))
               If oRsAux.RecordCount > 0 Then
                  mIdPuntoVenta = oRsAux.Fields(0).Value
                  Select Case mLetra
                     Case "A"
                        If mIdTipoComprobante = 1 Then
                           If IsNull(oRsAux.Fields("NumeroCAI_F_A").Value) Or Len(Trim(oRsAux.Fields("NumeroCAI_F_A").Value)) = 0 Then
                              AgregarMensajeProcesoPresto oRsErrores, "El punto de venta " & mPuntoVenta & " para la letra " & mLetra & _
                                    " no tiene CAI en la base de datos, el comprobante " & mComprobante & " no fue importado."
                              mConProblemas = True
                           Else
                              If IsNumeric(oRsAux.Fields("NumeroCAI_F_A").Value) Then mCAI = oRsAux.Fields("NumeroCAI_F_A").Value
                              If IsDate(oRsAux.Fields("FechaCAI_F_A").Value) Then mFechaCAI = IIf(IsNull(oRsAux.Fields("FechaCAI_F_A").Value), Date, oRsAux.Fields("FechaCAI_F_A").Value)
                           End If
                        ElseIf mIdTipoComprobante = 3 Then
                           If IsNull(oRsAux.Fields("NumeroCAI_D_A").Value) Or Len(Trim(oRsAux.Fields("NumeroCAI_D_A").Value)) = 0 Then
                              AgregarMensajeProcesoPresto oRsErrores, "El punto de venta " & mPuntoVenta & " para la letra " & mLetra & _
                                    " no tiene CAI en la base de datos, el comprobante " & mComprobante & " no fue importado."
                              mConProblemas = True
                           Else
                              If IsNumeric(oRsAux.Fields("NumeroCAI_D_A").Value) Then mCAI = oRsAux.Fields("NumeroCAI_D_A").Value
                              If IsDate(oRsAux.Fields("FechaCAI_D_A").Value) Then mFechaCAI = IIf(IsNull(oRsAux.Fields("FechaCAI_D_A").Value), Date, oRsAux.Fields("FechaCAI_D_A").Value)
                           End If
                        ElseIf mIdTipoComprobante = 4 Then
                           If IsNull(oRsAux.Fields("NumeroCAI_C_A").Value) Or Len(Trim(oRsAux.Fields("NumeroCAI_C_A").Value)) = 0 Then
                              AgregarMensajeProcesoPresto oRsErrores, "El punto de venta " & mPuntoVenta & " para la letra " & mLetra & _
                                    " no tiene CAI en la base de datos, el comprobante " & mComprobante & " no fue importado."
                              mConProblemas = True
                           Else
                              If IsNumeric(oRsAux.Fields("NumeroCAI_C_A").Value) Then mCAI = oRsAux.Fields("NumeroCAI_C_A").Value
                              If IsDate(oRsAux.Fields("FechaCAI_C_A").Value) Then mFechaCAI = IIf(IsNull(oRsAux.Fields("FechaCAI_C_A").Value), Date, oRsAux.Fields("FechaCAI_C_A").Value)
                           End If
                        End If
                     Case "B"
                        If mIdTipoComprobante = 1 Then
                           If IsNull(oRsAux.Fields("NumeroCAI_F_B").Value) Or Len(Trim(oRsAux.Fields("NumeroCAI_F_B").Value)) = 0 Then
                              AgregarMensajeProcesoPresto oRsErrores, "El punto de venta " & mPuntoVenta & " para la letra " & mLetra & _
                                    " no tiene CAI en la base de datos, el comprobante " & mComprobante & " no fue importado."
                              mConProblemas = True
                           Else
                              If IsNumeric(oRsAux.Fields("NumeroCAI_F_B").Value) Then mCAI = oRsAux.Fields("NumeroCAI_F_B").Value
                              If IsDate(oRsAux.Fields("FechaCAI_F_B").Value) Then mFechaCAI = IIf(IsNull(oRsAux.Fields("FechaCAI_F_B").Value), Date, oRsAux.Fields("FechaCAI_F_B").Value)
                           End If
                        ElseIf mIdTipoComprobante = 3 Then
                           If IsNull(oRsAux.Fields("NumeroCAI_D_B").Value) Or Len(Trim(oRsAux.Fields("NumeroCAI_D_B").Value)) = 0 Then
                              AgregarMensajeProcesoPresto oRsErrores, "El punto de venta " & mPuntoVenta & " para la letra " & mLetra & _
                                    " no tiene CAI en la base de datos, el comprobante " & mComprobante & " no fue importado."
                              mConProblemas = True
                           Else
                              If IsNumeric(oRsAux.Fields("NumeroCAI_D_B").Value) Then mCAI = oRsAux.Fields("NumeroCAI_D_B").Value
                              If IsDate(oRsAux.Fields("FechaCAI_D_B").Value) Then mFechaCAI = IIf(IsNull(oRsAux.Fields("FechaCAI_D_B").Value), Date, oRsAux.Fields("FechaCAI_D_B").Value)
                           End If
                        ElseIf mIdTipoComprobante = 4 Then
                           If IsNull(oRsAux.Fields("NumeroCAI_C_B").Value) Or Len(Trim(oRsAux.Fields("NumeroCAI_C_B").Value)) = 0 Then
                              AgregarMensajeProcesoPresto oRsErrores, "El punto de venta " & mPuntoVenta & " para la letra " & mLetra & _
                                    " no tiene CAI en la base de datos, el comprobante " & mComprobante & " no fue importado."
                              mConProblemas = True
                           Else
                              If IsNumeric(oRsAux.Fields("NumeroCAI_C_B").Value) Then mCAI = oRsAux.Fields("NumeroCAI_C_B").Value
                              If IsDate(oRsAux.Fields("FechaCAI_C_B").Value) Then mFechaCAI = IIf(IsNull(oRsAux.Fields("FechaCAI_C_B").Value), Date, oRsAux.Fields("FechaCAI_C_B").Value)
                           End If
                        End If
                     Case "E"
                        If mIdTipoComprobante = 1 Then
                           If IsNull(oRsAux.Fields("NumeroCAI_F_E").Value) Or Len(Trim(oRsAux.Fields("NumeroCAI_F_E").Value)) = 0 Then
                              AgregarMensajeProcesoPresto oRsErrores, "El punto de venta " & mPuntoVenta & " para la letra " & mLetra & _
                                    " no tiene CAI en la base de datos, el comprobante " & mComprobante & " no fue importado."
                              mConProblemas = True
                           Else
                              If IsNumeric(oRsAux.Fields("NumeroCAI_F_E").Value) Then mCAI = oRsAux.Fields("NumeroCAI_F_E").Value
                              If IsDate(oRsAux.Fields("FechaCAI_F_E").Value) Then mFechaCAI = IIf(IsNull(oRsAux.Fields("FechaCAI_F_E").Value), Date, oRsAux.Fields("FechaCAI_F_E").Value)
                           End If
                        ElseIf mIdTipoComprobante = 3 Then
                           If IsNull(oRsAux.Fields("NumeroCAI_D_E").Value) Or Len(Trim(oRsAux.Fields("NumeroCAI_D_E").Value)) = 0 Then
                              AgregarMensajeProcesoPresto oRsErrores, "El punto de venta " & mPuntoVenta & " para la letra " & mLetra & _
                                    " no tiene CAI en la base de datos, el comprobante " & mComprobante & " no fue importado."
                              mConProblemas = True
                           Else
                              If IsNumeric(oRsAux.Fields("NumeroCAI_D_E").Value) Then mCAI = oRsAux.Fields("NumeroCAI_D_E").Value
                              If IsDate(oRsAux.Fields("FechaCAI_D_E").Value) Then mFechaCAI = IIf(IsNull(oRsAux.Fields("FechaCAI_D_E").Value), Date, oRsAux.Fields("FechaCAI_D_E").Value)
                           End If
                        ElseIf mIdTipoComprobante = 4 Then
                           If IsNull(oRsAux.Fields("NumeroCAI_C_E").Value) Or Len(Trim(oRsAux.Fields("NumeroCAI_C_E").Value)) = 0 Then
                              AgregarMensajeProcesoPresto oRsErrores, "El punto de venta " & mPuntoVenta & " para la letra " & mLetra & _
                                    " no tiene CAI en la base de datos, el comprobante " & mComprobante & " no fue importado."
                              mConProblemas = True
                           Else
                              If IsNumeric(oRsAux.Fields("NumeroCAI_C_E").Value) Then mCAI = oRsAux.Fields("NumeroCAI_C_E").Value
                              If IsDate(oRsAux.Fields("FechaCAI_C_E").Value) Then mFechaCAI = IIf(IsNull(oRsAux.Fields("FechaCAI_C_E").Value), Date, oRsAux.Fields("FechaCAI_C_E").Value)
                           End If
                        End If
                  End Select
               Else
                  AgregarMensajeProcesoPresto oRsErrores, "El punto de venta " & mPuntoVenta & " para la letra " & mLetra & _
                        " no existe en la base de datos, el comprobante " & mComprobante & " no fue importado."
                  mConProblemas = True
               End If
               oRsAux.Close

               mCotizacionDolar = 3

               Select Case mIdTipoComprobante
                  Case 1
                     If mIdArticuloParaImportacionFacturas = 0 Then
                        AgregarMensajeProcesoPresto oRsErrores, "No definio en parametros el articulo generico para la importacion de facturas" & _
                              ", el comprobante " & mComprobante & " no fue importado."
                        mConProblemas = True
                     End If
                     
                     Set oRsAux = oAp.Facturas.TraerFiltrado("_PorNumeroComprobante", Array(mLetra, mPuntoVenta, mNumero))
                     If oRsAux.RecordCount > 0 Then
                        AgregarMensajeProcesoPresto oRsErrores, "La factura " & mComprobante & " ya existe y no fue importada."
                        mConProblemas = True
                     End If
                     oRsAux.Close

                     If Not mConProblemas Then
                        Set oFac = oAp.Facturas.Item(-1)
                        With oFac
                           With .Registro
                              .Fields("NumeroFactura").Value = mNumero
                              .Fields("TipoABC").Value = mLetra
                              .Fields("PuntoVenta").Value = mPuntoVenta
                              .Fields("IdCliente").Value = mIdCliente
                              .Fields("FechaFactura").Value = mFecha
                              .Fields("IdVendedor").Value = mIdVendedor
                              .Fields("ImporteTotal").Value = mTotal
                              .Fields("ImporteIva1").Value = mIVA
                              .Fields("ImporteIva2").Value = 0
                              .Fields("ImporteBonificacion").Value = 0
                              .Fields("RetencionIBrutos1").Value = 0
                              .Fields("PorcentajeIBrutos1").Value = 0
                              .Fields("RetencionIBrutos2").Value = 0
                              .Fields("PorcentajeIBrutos2").Value = 0
                              .Fields("ConvenioMultilateral").Value = "NO"
                              .Fields("RetencionIBrutos3").Value = 0
                              .Fields("PorcentajeIBrutos3").Value = 0
                              .Fields("CotizacionDolar").Value = mCotizacionDolar
                              .Fields("PorcentajeIva1").Value = mTasa
                              .Fields("PorcentajeIva2").Value = 0
                              .Fields("FechaVencimiento").Value = mFecha
                              .Fields("IVANoDiscriminado").Value = 0
                              .Fields("IdMoneda").Value = mIdMonedaPesos
                              .Fields("CotizacionMoneda").Value = 1
                              .Fields("PorcentajeBonificacion").Value = 0
                              .Fields("OtrasPercepciones1").Value = 0
                              .Fields("OtrasPercepciones1Desc").Value = ""
                              .Fields("OtrasPercepciones2").Value = 0
                              .Fields("OtrasPercepciones2Desc").Value = ""
                              .Fields("IdPuntoVenta").Value = mIdPuntoVenta
                              .Fields("NumeroCAI").Value = Val(mCAI)
                              .Fields("FechaVencimientoCAI").Value = mFechaCAI
                              .Fields("IdUsuarioIngreso").Value = glbIdUsuario
                              .Fields("FechaIngreso").Value = Now
                              .Fields("IdCodigoIva").Value = mIdCodigoIva
                              .Fields("PercepcionIVA").Value = 0
                              .Fields("PorcentajePercepcionIVA").Value = 0
                           End With
                           With .DetFacturas.Item(-1)
                              With .Registro
                                 .Fields("NumeroFactura").Value = mNumero
                                 .Fields("TipoABC").Value = mLetra
                                 .Fields("PuntoVenta").Value = mPuntoVenta
                                 .Fields("IdArticulo").Value = mIdArticuloParaImportacionFacturas
                                 .Fields("Cantidad").Value = 1
                                 .Fields("Costo").Value = 0
                                 .Fields("PrecioUnitario").Value = mTotal - mIVA
                                 .Fields("Bonificacion").Value = 0
                                 .Fields("OrigenDescripcion").Value = 1
                                 .Fields("PrecioUnitarioTotal").Value = mTotal - mIVA
                              End With
                              .Modificado = True
                           End With
                           .Guardar
                        End With
                        Set oFac = Nothing
                     End If

                  Case 3
                     If mIdConceptoParaImportacionNDNC = 0 Then
                        AgregarMensajeProcesoPresto oRsErrores, "No definio en parametros el concepto generico para la importacion de nd/nc" & _
                              ", el comprobante " & mComprobante & " no fue importado."
                        mConProblemas = True
                     End If
                     
                     Set oRsAux = oAp.NotasDebito.TraerFiltrado("_PorNumeroComprobante", Array(mLetra, mPuntoVenta, mNumero))
                     If oRsAux.RecordCount > 0 Then
                        AgregarMensajeProcesoPresto oRsErrores, "La nota de debito " & mComprobante & " ya existe y no fue importada."
                        mConProblemas = True
                     End If
                     oRsAux.Close

                     If Not mConProblemas Then
                        Set oDeb = oAp.NotasDebito.Item(-1)
                        With oDeb
                           With .Registro
                              .Fields("NumeroNotaDebito").Value = mNumero
                              .Fields("TipoABC").Value = mLetra
                              .Fields("PuntoVenta").Value = mPuntoVenta
                              .Fields("IdCliente").Value = mIdCliente
                              .Fields("FechaNotaDebito").Value = mFecha
                              .Fields("IdVendedor").Value = mIdVendedor
                              .Fields("ImporteTotal").Value = mTotal
                              .Fields("ImporteIva1").Value = mIVA
                              .Fields("ImporteIva2").Value = 0
                              .Fields("RetencionIBrutos1").Value = 0
                              .Fields("PorcentajeIBrutos1").Value = 0
                              .Fields("RetencionIBrutos2").Value = 0
                              .Fields("PorcentajeIBrutos2").Value = 0
                              .Fields("IdCodigoIva").Value = mIdCodigoIva
                              .Fields("PorcentajeIva1").Value = mTasa
                              .Fields("PorcentajeIva2").Value = 0
                              .Fields("CotizacionDolar").Value = mCotizacionDolar
                              .Fields("CtaCte").Value = "SI"
                              .Fields("IdMoneda").Value = mIdMonedaPesos
                              .Fields("CotizacionMoneda").Value = 1
                              .Fields("IVANoDiscriminado").Value = 0
                              .Fields("ConvenioMultilateral").Value = "NO"
                              .Fields("OtrasPercepciones1").Value = 0
                              .Fields("OtrasPercepciones1Desc").Value = ""
                              .Fields("OtrasPercepciones2").Value = 0
                              .Fields("OtrasPercepciones2Desc").Value = ""
                              .Fields("OtrasPercepciones3").Value = 0
                              .Fields("OtrasPercepciones3Desc").Value = ""
                              .Fields("IdPuntoVenta").Value = mIdPuntoVenta
                              .Fields("NumeroCAI").Value = mCAI
                              .Fields("FechaVencimientoCAI").Value = mFechaCAI
                              .Fields("IdUsuarioIngreso").Value = glbIdUsuario
                              .Fields("FechaIngreso").Value = Now
                              .Fields("AplicarEnCtaCte").Value = "SI"
                              .Fields("RetencionIBrutos3").Value = 0
                              .Fields("PorcentajeIBrutos3").Value = 0
                           End With
                           With .DetNotasDebito.Item(-1)
                              With .Registro
                                 .Fields("IdConcepto").Value = mIdConceptoParaImportacionNDNC
                                 .Fields("Importe").Value = mTotal - mIVA
                                 If mIVA <> 0 Then
                                    .Fields("Gravado").Value = "SI"
                                 Else
                                    .Fields("Gravado").Value = "NO"
                                 End If
                                 .Fields("IvaNoDiscriminado").Value = 0
                              End With
                              .Modificado = True
                           End With
                           .Guardar
                        End With
                        Set oDeb = Nothing
                     End If
                        
                  Case 4
                     If mIdConceptoParaImportacionNDNC = 0 Then
                        AgregarMensajeProcesoPresto oRsErrores, "No definio en parametros el concepto generico para la importacion de nd/nc" & _
                              ", el comprobante " & mComprobante & " no fue importado."
                        mConProblemas = True
                     End If
                     
                     Set oRsAux = oAp.NotasCredito.TraerFiltrado("_PorNumeroComprobante", Array(mLetra, mPuntoVenta, mNumero))
                     If oRsAux.RecordCount > 0 Then
                        AgregarMensajeProcesoPresto oRsErrores, "La nota de credito " & mComprobante & " ya existe y no fue importada."
                        mConProblemas = True
                     End If
                     oRsAux.Close

                     If Not mConProblemas Then
                        Set oCre = oAp.NotasCredito.Item(-1)
                        With oCre
                           With .Registro
                              .Fields("NumeroNotaCredito").Value = mNumero
                              .Fields("TipoABC").Value = mLetra
                              .Fields("PuntoVenta").Value = mPuntoVenta
                              .Fields("IdCliente").Value = mIdCliente
                              .Fields("FechaNotaCredito").Value = mFecha
                              .Fields("IdVendedor").Value = mIdVendedor
                              .Fields("ImporteTotal").Value = mTotal
                              .Fields("ImporteIva1").Value = mIVA
                              .Fields("ImporteIva2").Value = 0
                              .Fields("RetencionIBrutos1").Value = 0
                              .Fields("PorcentajeIBrutos1").Value = 0
                              .Fields("RetencionIBrutos2").Value = 0
                              .Fields("PorcentajeIBrutos2").Value = 0
                              .Fields("IdCodigoIva").Value = mIdCodigoIva
                              .Fields("PorcentajeIva1").Value = mTasa
                              .Fields("PorcentajeIva2").Value = 0
                              .Fields("CotizacionDolar").Value = mCotizacionDolar
                              .Fields("CtaCte").Value = "SI"
                              .Fields("IdMoneda").Value = mIdMonedaPesos
                              .Fields("CotizacionMoneda").Value = 1
                              .Fields("IVANoDiscriminado").Value = 0
                              .Fields("ConvenioMultilateral").Value = "NO"
                              .Fields("OtrasPercepciones1").Value = 0
                              .Fields("OtrasPercepciones1Desc").Value = ""
                              .Fields("OtrasPercepciones2").Value = 0
                              .Fields("OtrasPercepciones2Desc").Value = ""
                              .Fields("OtrasPercepciones3").Value = 0
                              .Fields("OtrasPercepciones3Desc").Value = ""
                              .Fields("IdPuntoVenta").Value = mIdPuntoVenta
                              .Fields("NumeroCAI").Value = mCAI
                              .Fields("FechaVencimientoCAI").Value = mFechaCAI
                              .Fields("IdUsuarioIngreso").Value = glbIdUsuario
                              .Fields("FechaIngreso").Value = Now
                              .Fields("AplicarEnCtaCte").Value = "SI"
                              .Fields("RetencionIBrutos3").Value = 0
                              .Fields("PorcentajeIBrutos3").Value = 0
                           End With
                           With .DetNotasCredito.Item(-1)
                              With .Registro
                                 .Fields("IdConcepto").Value = mIdConceptoParaImportacionNDNC
                                 .Fields("Importe").Value = mTotal - mIVA
                                 If mIVA <> 0 Then
                                    .Fields("Gravado").Value = "SI"
                                 Else
                                    .Fields("Gravado").Value = "NO"
                                 End If
                                 .Fields("IvaNoDiscriminado").Value = 0
                              End With
                              .Modificado = True
                           End With
                           With .DetNotasCreditoImp.Item(-1)
                              With .Registro
                                 .Fields("IdImputacion").Value = -1
                                 .Fields("Importe").Value = mTotal - mIVA
                              End With
                              .Modificado = True
                           End With
                           .Guardar
                        End With
                        Set oCre = Nothing
                     End If
               End Select
Continuar:
               fl = fl + 1
            Loop
         End With
         .Close False
      End With
      .Quit
   End With

   Unload oF
   Set oF = Nothing

   If Not oRsErrores Is Nothing Then
      If oRsErrores.RecordCount > 0 Then
         Set oF = New frmConsulta1
         With oF
            Set .RecordsetFuente = oRsErrores
            .Id = 13
            .Show vbModal, Me
         End With
      Else
         MsgBox "Proceso completo", vbInformation
      End If
      Set oRsErrores = Nothing
   End If

Salida:
   On Error Resume Next

   Unload oF
   Set oF = Nothing

   Set oRs = Nothing
   Set oRsErrores = Nothing
   Set oRsAux = Nothing
   Set oFac = Nothing
   Set oDeb = Nothing
   Set oCre = Nothing
   Set oCli = Nothing
   Set oEx = Nothing
   Set oAp = Nothing

   Exit Sub

Mal:
   MsgBox "Se ha producido un error al registrar los datos" & vbCrLf & Err.Number & " -> " & Err.Description, vbCritical
   Resume Salida
   
End Sub

'IMPORTADOR DESARROLLADO PARA CORREDOR CENTRAL, SON TICKETS DE PUNTOS DE VENTA PARA COBRO DE PEAJES
Public Sub ImportacionComprobantesVenta2()

   Dim oAp As ComPronto.Aplicacion
   Dim oEx As Excel.Application
   Dim oFac As ComPronto.Factura
   Dim oCre As ComPronto.NotaCredito
   Dim oPto As ComPronto.PuntoVenta
   Dim oRs As ADOR.Recordset
   Dim oRsAux As ADOR.Recordset
   Dim oRsErrores As ADOR.Recordset
   Dim oF As Form
   Dim mArchivo As String, mTipo As String, mLetra As String, mCliente As String, mCorredor As String, mCuit As String
   Dim mObservaciones As String, mCAI As String, mComprobante As String, mNumeroObra As String
   Dim fl As Integer, mContador As Integer, mIdMonedaPesos As Integer, mPuntoVenta As Integer, mIdPuntoVenta As Integer
   Dim mIdTipoComprobante As Integer, mIdCodigoIva As Integer
   Dim mIdArticuloParaImportacionFacturas As Long, mNumero As Long, mIdCliente As Long, mIdVendedor As Long
   Dim mIdConceptoParaImportacionNDNC As Long, mNumeroCliente As Long, mIdCuenta As Long, mNumeroInicial As Long
   Dim mNumeroFinal As Long, mCodigoId As Long, mIdObra As Long
   Dim mSubtotal As Double, mIVA As Double, mTotal As Double
   Dim mTasa As Single, mCotizacionDolar As Single
   Dim mFecha As Date, mFechaCAI As Date
   Dim mOk As Boolean, mConProblemas As Boolean
   Dim mAux1

   On Error GoTo Mal

   Set oF = New frmPathPresto
   With oF
      .Id = 16
      .Show vbModal
      mOk = .Ok
      If mOk Then
         mArchivo = .FileBrowser1(0).Text
      End If
   End With
   Unload oF
   Set oF = Nothing

   If Not mOk Then Exit Sub

   Set oAp = Aplicacion

   Set oRsErrores = CreateObject("ADOR.Recordset")
   With oRsErrores
      .Fields.Append "Id", adInteger
      .Fields.Append "Detalle", adVarChar, 200
   End With
   oRsErrores.Open

   Set oRs = oAp.Parametros.TraerFiltrado("_PorId", 1)
   mIdMonedaPesos = IIf(IsNull(oRs.Fields("IdMoneda").Value), 1, oRs.Fields("IdMoneda").Value)
   mIdCuenta = IIf(IsNull(oRs.Fields("IdCuentaDeudoresVarios").Value), 0, oRs.Fields("IdCuentaDeudoresVarios").Value)
   mTasa = IIf(IsNull(oRs.Fields("Iva1").Value), 0, oRs.Fields("Iva1").Value)
   oRs.Close

   If mIdCuenta = 0 Then
      MsgBox "No definio en parametros la cuenta contable deudores varios", vbExclamation
      Exit Sub
   End If
   
   mCliente = BuscarClaveINI("Id de cliente por default para importacion de comprobantes de venta")
   If Len(mCliente) = 0 Then
      MsgBox "No definio en PRONTO INI el cliente default para importacion de comprobantes de venta", vbExclamation
      Exit Sub
   End If
   mIdCliente = Val(mCliente)
   Set oRs = oAp.Clientes.TraerFiltrado("_PorId", mIdCliente)
   If oRs.RecordCount = 0 Then
      oRs.Close
      Set oRs = Nothing
      MsgBox "El cliente default no existe en la tabla Clientes", vbExclamation
      Exit Sub
   End If
   oRs.Close
   
   mAux1 = TraerValorParametro2("IdArticuloParaImportacionFacturas")
   mIdArticuloParaImportacionFacturas = IIf(IsNull(mAux1), 0, mAux1)
   mAux1 = TraerValorParametro2("IdConceptoParaImportacionNDNC")
   mIdConceptoParaImportacionNDNC = IIf(IsNull(mAux1), 0, mAux1)

   If mIdArticuloParaImportacionFacturas = 0 Then
      MsgBox "No definio en parametros el articulo generico para importar las facturas", vbExclamation
      Exit Sub
   End If
   
   Set oF = New frmAviso
   With oF
      .Label1 = "Abriendo planilla Excel ..."
      .Show
      .Refresh
      DoEvents
   End With

   oF.Label1 = oF.Label1 & vbCrLf & "Procesando comprobantes ..."
   oF.Label2 = ""
   oF.Label3 = ""
   DoEvents

   fl = 2

   Set oEx = CreateObject("Excel.Application")
   With oEx
      .Visible = True
      .WindowState = xlMinimized
      Me.Refresh

      With .Workbooks.Open(mArchivo)
         .Sheets("Hoja1").Select
         With .ActiveSheet
            Do While True
               If Len(Trim(.Cells(fl, 1))) = 0 Then Exit Do

               mConProblemas = False

               mLetra = "A"
               mPuntoVenta = CInt(.Cells(fl, 6))
               mCodigoId = CLng(.Cells(fl, 2))
               If IsDate(.Cells(fl, 3)) Then
                  mFecha = CDate(.Cells(fl, 3))
               Else
                  mFecha = Date
               End If
               mNumeroInicial = CLng(.Cells(fl, 7))
               mNumeroFinal = CLng(.Cells(fl, 8))
               mTotal = Abs(CDbl(Replace(Replace(.Cells(fl, 9), ".", ""), ",", ".")))
               mIVA = Abs(CDbl(Replace(Replace(.Cells(fl, 10), ".", ""), ",", ".")))
               mSubtotal = mTotal - mIVA
               mObservaciones = "CodID : " & .Cells(fl, 2) & vbCrLf & "Estacion : " & .Cells(fl, 4) & vbCrLf & "Concepto : " & .Cells(fl, 5)
               mNumeroObra = .Cells(fl, 11)
               
               mIdTipoComprobante = 1
               mTipo = "FA"
               If UCase(Trim(.Cells(fl, 5))) = "ANULADO" Then
                  mIdTipoComprobante = 4
                  mTipo = "NC"
               End If

               mComprobante = mTipo & " " & mLetra & "-" & Format(mPuntoVenta, "0000") & "-" & Format(mNumeroInicial, "00000000") & " / " & Format(mNumeroFinal, "00000000")
               
               If Trim(.Cells(fl, 5)) <> "Venta en Via" And UCase(Trim(.Cells(fl, 5))) <> "ANULADO" Then
                  AgregarMensajeProcesoPresto oRsErrores, "El concepto del comprobante " & mComprobante & " es incorrecto y no fue importado."
                  mConProblemas = True
               End If
               
               mContador = mContador + 1
               oF.Label2 = "" & mComprobante
               oF.Label3 = "" & mContador
               DoEvents

               mIdCodigoIva = 0
               mIdVendedor = 0
               Set oRsAux = oAp.Clientes.TraerFiltrado("_PorId", mIdCliente)
               If oRsAux.RecordCount > 0 Then
                  mIdCodigoIva = oRsAux.Fields("IdCodigoIva").Value
                  mIdVendedor = IIf(IsNull(oRsAux.Fields("Vendedor1").Value), 0, oRsAux.Fields("Vendedor1").Value)
               End If
               oRsAux.Close
               
               mIdObra = 0
               If Len(Trim(mNumeroObra)) > 0 Then
                  Set oRsAux = oAp.Obras.TraerFiltrado("_PorNumero", mNumeroObra)
                  If oRsAux.RecordCount > 0 Then
                     mIdObra = oRsAux.Fields("IdObra").Value
                  End If
                  oRsAux.Close
               End If

               mIdPuntoVenta = 0
               mCAI = ""
               mFechaCAI = 0
               Set oRsAux = oAp.PuntosVenta.TraerFiltrado("_Duplicados", Array(mLetra, mIdTipoComprobante, mPuntoVenta, -1))
               If oRsAux.RecordCount > 0 Then
                  mIdPuntoVenta = oRsAux.Fields(0).Value
                  Select Case mLetra
                     Case "A"
                        If mIdTipoComprobante = 1 Then
                           If IsNull(oRsAux.Fields("NumeroCAI_F_A").Value) Or Len(Trim(oRsAux.Fields("NumeroCAI_F_A").Value)) = 0 Then
                              AgregarMensajeProcesoPresto oRsErrores, "El punto de venta " & mPuntoVenta & " para la letra " & mLetra & _
                                    " no tiene CAI en la base de datos, el comprobante " & mComprobante & " no fue importado."
                              mConProblemas = True
                           Else
                              If IsNumeric(oRsAux.Fields("NumeroCAI_F_A").Value) Then mCAI = oRsAux.Fields("NumeroCAI_F_A").Value
                              If IsDate(oRsAux.Fields("FechaCAI_F_A").Value) Then mFechaCAI = IIf(IsNull(oRsAux.Fields("FechaCAI_F_A").Value), Date, oRsAux.Fields("FechaCAI_F_A").Value)
                           End If
                        ElseIf mIdTipoComprobante = 3 Then
                           If IsNull(oRsAux.Fields("NumeroCAI_D_A").Value) Or Len(Trim(oRsAux.Fields("NumeroCAI_D_A").Value)) = 0 Then
                              AgregarMensajeProcesoPresto oRsErrores, "El punto de venta " & mPuntoVenta & " para la letra " & mLetra & _
                                    " no tiene CAI en la base de datos, el comprobante " & mComprobante & " no fue importado."
                              mConProblemas = True
                           Else
                              If IsNumeric(oRsAux.Fields("NumeroCAI_D_A").Value) Then mCAI = oRsAux.Fields("NumeroCAI_D_A").Value
                              If IsDate(oRsAux.Fields("FechaCAI_D_A").Value) Then mFechaCAI = IIf(IsNull(oRsAux.Fields("FechaCAI_D_A").Value), Date, oRsAux.Fields("FechaCAI_D_A").Value)
                           End If
                        ElseIf mIdTipoComprobante = 4 Then
                           If IsNull(oRsAux.Fields("NumeroCAI_C_A").Value) Or Len(Trim(oRsAux.Fields("NumeroCAI_C_A").Value)) = 0 Then
                              AgregarMensajeProcesoPresto oRsErrores, "El punto de venta " & mPuntoVenta & " para la letra " & mLetra & _
                                    " no tiene CAI en la base de datos, el comprobante " & mComprobante & " no fue importado."
                              mConProblemas = True
                           Else
                              If IsNumeric(oRsAux.Fields("NumeroCAI_C_A").Value) Then mCAI = oRsAux.Fields("NumeroCAI_C_A").Value
                              If IsDate(oRsAux.Fields("FechaCAI_C_A").Value) Then mFechaCAI = IIf(IsNull(oRsAux.Fields("FechaCAI_C_A").Value), Date, oRsAux.Fields("FechaCAI_C_A").Value)
                           End If
                        End If
                     Case "B"
                        If mIdTipoComprobante = 1 Then
                           If IsNull(oRsAux.Fields("NumeroCAI_F_B").Value) Or Len(Trim(oRsAux.Fields("NumeroCAI_F_B").Value)) = 0 Then
                              AgregarMensajeProcesoPresto oRsErrores, "El punto de venta " & mPuntoVenta & " para la letra " & mLetra & _
                                    " no tiene CAI en la base de datos, el comprobante " & mComprobante & " no fue importado."
                              mConProblemas = True
                           Else
                              If IsNumeric(oRsAux.Fields("NumeroCAI_F_B").Value) Then mCAI = oRsAux.Fields("NumeroCAI_F_B").Value
                              If IsDate(oRsAux.Fields("FechaCAI_F_B").Value) Then mFechaCAI = IIf(IsNull(oRsAux.Fields("FechaCAI_F_B").Value), Date, oRsAux.Fields("FechaCAI_F_B").Value)
                           End If
                        ElseIf mIdTipoComprobante = 3 Then
                           If IsNull(oRsAux.Fields("NumeroCAI_D_B").Value) Or Len(Trim(oRsAux.Fields("NumeroCAI_D_B").Value)) = 0 Then
                              AgregarMensajeProcesoPresto oRsErrores, "El punto de venta " & mPuntoVenta & " para la letra " & mLetra & _
                                    " no tiene CAI en la base de datos, el comprobante " & mComprobante & " no fue importado."
                              mConProblemas = True
                           Else
                              If IsNumeric(oRsAux.Fields("NumeroCAI_D_B").Value) Then mCAI = oRsAux.Fields("NumeroCAI_D_B").Value
                              If IsDate(oRsAux.Fields("FechaCAI_D_B").Value) Then mFechaCAI = IIf(IsNull(oRsAux.Fields("FechaCAI_D_B").Value), Date, oRsAux.Fields("FechaCAI_D_B").Value)
                           End If
                        ElseIf mIdTipoComprobante = 4 Then
                           If IsNull(oRsAux.Fields("NumeroCAI_C_B").Value) Or Len(Trim(oRsAux.Fields("NumeroCAI_C_B").Value)) = 0 Then
                              AgregarMensajeProcesoPresto oRsErrores, "El punto de venta " & mPuntoVenta & " para la letra " & mLetra & _
                                    " no tiene CAI en la base de datos, el comprobante " & mComprobante & " no fue importado."
                              mConProblemas = True
                           Else
                              If IsNumeric(oRsAux.Fields("NumeroCAI_C_B").Value) Then mCAI = oRsAux.Fields("NumeroCAI_C_B").Value
                              If IsDate(oRsAux.Fields("FechaCAI_C_B").Value) Then mFechaCAI = IIf(IsNull(oRsAux.Fields("FechaCAI_C_B").Value), Date, oRsAux.Fields("FechaCAI_C_B").Value)
                           End If
                        End If
                     Case "E"
                        If mIdTipoComprobante = 1 Then
                           If IsNull(oRsAux.Fields("NumeroCAI_F_E").Value) Or Len(Trim(oRsAux.Fields("NumeroCAI_F_E").Value)) = 0 Then
                              AgregarMensajeProcesoPresto oRsErrores, "El punto de venta " & mPuntoVenta & " para la letra " & mLetra & _
                                    " no tiene CAI en la base de datos, el comprobante " & mComprobante & " no fue importado."
                              mConProblemas = True
                           Else
                              If IsNumeric(oRsAux.Fields("NumeroCAI_F_E").Value) Then mCAI = oRsAux.Fields("NumeroCAI_F_E").Value
                              If IsDate(oRsAux.Fields("FechaCAI_F_E").Value) Then mFechaCAI = IIf(IsNull(oRsAux.Fields("FechaCAI_F_E").Value), Date, oRsAux.Fields("FechaCAI_F_E").Value)
                           End If
                        ElseIf mIdTipoComprobante = 3 Then
                           If IsNull(oRsAux.Fields("NumeroCAI_D_E").Value) Or Len(Trim(oRsAux.Fields("NumeroCAI_D_E").Value)) = 0 Then
                              AgregarMensajeProcesoPresto oRsErrores, "El punto de venta " & mPuntoVenta & " para la letra " & mLetra & _
                                    " no tiene CAI en la base de datos, el comprobante " & mComprobante & " no fue importado."
                              mConProblemas = True
                           Else
                              If IsNumeric(oRsAux.Fields("NumeroCAI_D_E").Value) Then mCAI = oRsAux.Fields("NumeroCAI_D_E").Value
                              If IsDate(oRsAux.Fields("FechaCAI_D_E").Value) Then mFechaCAI = IIf(IsNull(oRsAux.Fields("FechaCAI_D_E").Value), Date, oRsAux.Fields("FechaCAI_D_E").Value)
                           End If
                        ElseIf mIdTipoComprobante = 4 Then
                           If IsNull(oRsAux.Fields("NumeroCAI_C_E").Value) Or Len(Trim(oRsAux.Fields("NumeroCAI_C_E").Value)) = 0 Then
                              AgregarMensajeProcesoPresto oRsErrores, "El punto de venta " & mPuntoVenta & " para la letra " & mLetra & _
                                    " no tiene CAI en la base de datos, el comprobante " & mComprobante & " no fue importado."
                              mConProblemas = True
                           Else
                              If IsNumeric(oRsAux.Fields("NumeroCAI_C_E").Value) Then mCAI = oRsAux.Fields("NumeroCAI_C_E").Value
                              If IsDate(oRsAux.Fields("FechaCAI_C_E").Value) Then mFechaCAI = IIf(IsNull(oRsAux.Fields("FechaCAI_C_E").Value), Date, oRsAux.Fields("FechaCAI_C_E").Value)
                           End If
                        End If
                  End Select
               Else
                  AgregarMensajeProcesoPresto oRsErrores, "El punto de venta " & mPuntoVenta & " para la letra " & mLetra & _
                        " no existe en la base de datos, el comprobante " & mComprobante & " no fue importado."
                  mConProblemas = True
               End If
               oRsAux.Close

               mCotizacionDolar = Cotizacion(mFecha, glbIdMonedaDolar)
               If mCotizacionDolar = 0 Then
                  AgregarMensajeProcesoPresto oRsErrores, "No hay cotizacion dolar para la fecha " & mFecha & _
                        ", el comprobante " & mComprobante & " no fue importado."
                  mConProblemas = True
               End If

               mNumero = 0
               If Not mConProblemas Then
                  Set oPto = Aplicacion.PuntosVenta.Item(mIdPuntoVenta)
                  With oPto.Registro
                     mNumero = .Fields("ProximoNumero").Value
                     .Fields("ProximoNumero").Value = mNumero + 1
                  End With
                  oPto.Guardar
                  Set oPto = Nothing
               End If
               
               Select Case mIdTipoComprobante
                  Case 1
                     If mIdArticuloParaImportacionFacturas = 0 Then
                        AgregarMensajeProcesoPresto oRsErrores, "No definio en parametros el articulo generico para la importacion de facturas" & _
                              ", el comprobante " & mComprobante & " no fue importado."
                        mConProblemas = True
                     End If
                     
                     Set oRsAux = oAp.Facturas.TraerFiltrado("_PorCodigoIdAuxiliar", mCodigoId)
                     If oRsAux.RecordCount > 0 Then
                        AgregarMensajeProcesoPresto oRsErrores, "La factura " & mComprobante & " ya existe y no fue importada."
                        mConProblemas = True
                     End If
                     oRsAux.Close

                     If Not mConProblemas Then
                        Set oFac = oAp.Facturas.Item(-1)
                        With oFac
                           With .Registro
                              .Fields("NumeroFactura").Value = mNumero
                              .Fields("TipoABC").Value = mLetra
                              .Fields("PuntoVenta").Value = mPuntoVenta
                              .Fields("IdCliente").Value = mIdCliente
                              .Fields("FechaFactura").Value = mFecha
                              .Fields("IdVendedor").Value = mIdVendedor
                              .Fields("ImporteTotal").Value = mTotal
                              .Fields("ImporteIva1").Value = 0
                              .Fields("ImporteIva2").Value = 0
                              .Fields("AjusteIva").Value = mIVA
                              .Fields("ImporteBonificacion").Value = 0
                              .Fields("RetencionIBrutos1").Value = 0
                              .Fields("PorcentajeIBrutos1").Value = 0
                              .Fields("RetencionIBrutos2").Value = 0
                              .Fields("PorcentajeIBrutos2").Value = 0
                              .Fields("ConvenioMultilateral").Value = "NO"
                              .Fields("RetencionIBrutos3").Value = 0
                              .Fields("PorcentajeIBrutos3").Value = 0
                              .Fields("CotizacionDolar").Value = mCotizacionDolar
                              .Fields("PorcentajeIva1").Value = mTasa
                              .Fields("PorcentajeIva2").Value = 0
                              .Fields("FechaVencimiento").Value = mFecha
                              .Fields("IVANoDiscriminado").Value = 0
                              .Fields("IdMoneda").Value = mIdMonedaPesos
                              .Fields("CotizacionMoneda").Value = 1
                              .Fields("PorcentajeBonificacion").Value = 0
                              .Fields("OtrasPercepciones1").Value = 0
                              .Fields("OtrasPercepciones1Desc").Value = ""
                              .Fields("OtrasPercepciones2").Value = 0
                              .Fields("OtrasPercepciones2Desc").Value = ""
                              .Fields("IdPuntoVenta").Value = mIdPuntoVenta
                              .Fields("NumeroCAI").Value = Val(mCAI)
                              .Fields("FechaVencimientoCAI").Value = mFechaCAI
                              .Fields("IdUsuarioIngreso").Value = glbIdUsuario
                              .Fields("FechaIngreso").Value = Now
                              .Fields("IdCodigoIva").Value = mIdCodigoIva
                              .Fields("PercepcionIVA").Value = 0
                              .Fields("PorcentajePercepcionIVA").Value = 0
                              .Fields("NumeroFacturaInicial").Value = mNumeroInicial
                              .Fields("NumeroFacturaFinal").Value = mNumeroFinal
                              .Fields("Observaciones").Value = mObservaciones
                              .Fields("CodigoIdAuxiliar").Value = mCodigoId
                              If mIdObra > 0 Then .Fields("IdObra").Value = mIdObra
                           End With
                           With .DetFacturas.Item(-1)
                              With .Registro
                                 .Fields("NumeroFactura").Value = mNumero
                                 .Fields("TipoABC").Value = mLetra
                                 .Fields("PuntoVenta").Value = mPuntoVenta
                                 .Fields("IdArticulo").Value = mIdArticuloParaImportacionFacturas
                                 .Fields("Cantidad").Value = 1
                                 .Fields("Costo").Value = 0
                                 .Fields("PrecioUnitario").Value = mTotal - mIVA
                                 .Fields("Bonificacion").Value = 0
                                 .Fields("OrigenDescripcion").Value = 1
                                 .Fields("PrecioUnitarioTotal").Value = mTotal - mIVA
                              End With
                              .Modificado = True
                           End With
                           .Guardar
                        End With
                        Set oFac = Nothing
                     End If

                  Case 4
                     If mIdConceptoParaImportacionNDNC = 0 Then
                        AgregarMensajeProcesoPresto oRsErrores, "No definio en parametros el concepto generico para la importacion de nd/nc" & _
                              ", el comprobante " & mComprobante & " no fue importado."
                        mConProblemas = True
                     End If
                     
                     Set oRsAux = oAp.NotasCredito.TraerFiltrado("_PorCodigoIdAuxiliar", mCodigoId)
                     If oRsAux.RecordCount > 0 Then
                        AgregarMensajeProcesoPresto oRsErrores, "La nota de credito " & mComprobante & " ya existe y no fue importada."
                        mConProblemas = True
                     End If
                     oRsAux.Close

                     If Not mConProblemas Then
                        Set oCre = oAp.NotasCredito.Item(-1)
                        With oCre
                           With .Registro
                              .Fields("NumeroNotaCredito").Value = mNumero
                              .Fields("TipoABC").Value = mLetra
                              .Fields("PuntoVenta").Value = mPuntoVenta
                              .Fields("IdCliente").Value = mIdCliente
                              .Fields("FechaNotaCredito").Value = mFecha
                              .Fields("IdVendedor").Value = mIdVendedor
                              .Fields("ImporteTotal").Value = mTotal
                              .Fields("ImporteIva1").Value = mIVA
                              .Fields("ImporteIva2").Value = 0
                              .Fields("RetencionIBrutos1").Value = 0
                              .Fields("PorcentajeIBrutos1").Value = 0
                              .Fields("RetencionIBrutos2").Value = 0
                              .Fields("PorcentajeIBrutos2").Value = 0
                              .Fields("IdCodigoIva").Value = mIdCodigoIva
                              .Fields("PorcentajeIva1").Value = mTasa
                              .Fields("PorcentajeIva2").Value = 0
                              .Fields("CotizacionDolar").Value = mCotizacionDolar
                              .Fields("CtaCte").Value = "SI"
                              .Fields("IdMoneda").Value = mIdMonedaPesos
                              .Fields("CotizacionMoneda").Value = 1
                              .Fields("IVANoDiscriminado").Value = 0
                              .Fields("ConvenioMultilateral").Value = "NO"
                              .Fields("OtrasPercepciones1").Value = 0
                              .Fields("OtrasPercepciones1Desc").Value = ""
                              .Fields("OtrasPercepciones2").Value = 0
                              .Fields("OtrasPercepciones2Desc").Value = ""
                              .Fields("OtrasPercepciones3").Value = 0
                              .Fields("OtrasPercepciones3Desc").Value = ""
                              .Fields("IdPuntoVenta").Value = mIdPuntoVenta
                              .Fields("NumeroCAI").Value = mCAI
                              .Fields("FechaVencimientoCAI").Value = mFechaCAI
                              .Fields("IdUsuarioIngreso").Value = glbIdUsuario
                              .Fields("FechaIngreso").Value = Now
                              .Fields("AplicarEnCtaCte").Value = "SI"
                              .Fields("RetencionIBrutos3").Value = 0
                              .Fields("PorcentajeIBrutos3").Value = 0
                              .Fields("Observaciones").Value = mObservaciones
                              .Fields("CodigoIdAuxiliar").Value = mCodigoId
                              .Fields("NumeroFacturaOriginal").Value = mNumeroInicial
                              If mIdObra > 0 Then .Fields("IdObra").Value = mIdObra
                           End With
                           With .DetNotasCredito.Item(-1)
                              With .Registro
                                 .Fields("IdConcepto").Value = mIdConceptoParaImportacionNDNC
                                 .Fields("Importe").Value = mTotal - mIVA
                                 If mIVA <> 0 Then
                                    .Fields("Gravado").Value = "SI"
                                 Else
                                    .Fields("Gravado").Value = "NO"
                                 End If
                                 .Fields("IvaNoDiscriminado").Value = 0
                              End With
                              .Modificado = True
                           End With
                           With .DetNotasCreditoImp.Item(-1)
                              With .Registro
                                 .Fields("IdImputacion").Value = -1
                                 .Fields("Importe").Value = mTotal
                              End With
                              .Modificado = True
                           End With
                           .Guardar
                        End With
                        Set oCre = Nothing
                     End If
               End Select
               fl = fl + 1
            Loop
         End With
         .Close False
      End With
      .Quit
   End With

   Unload oF
   Set oF = Nothing

   If Not oRsErrores Is Nothing Then
      If oRsErrores.RecordCount > 0 Then
         Set oF = New frmConsulta1
         With oF
            Set .RecordsetFuente = oRsErrores
            .Id = 13
            .Show vbModal, Me
         End With
      Else
         MsgBox "Proceso completo", vbInformation
      End If
      Set oRsErrores = Nothing
   End If

Salida:
   On Error Resume Next

   Unload oF
   Set oF = Nothing

   Set oRs = Nothing
   Set oRsErrores = Nothing
   Set oRsAux = Nothing
   Set oFac = Nothing
   Set oCre = Nothing
   Set oPto = Nothing
   Set oEx = Nothing
   Set oAp = Nothing

   Exit Sub

Mal:
   MsgBox "Se ha producido un error al registrar los datos" & vbCrLf & Err.Number & " -> " & Err.Description, vbCritical
   Resume Salida
   
End Sub

Public Sub ImportacionAjustesStock()

   Dim oAp As ComPronto.Aplicacion
   Dim oEx As Excel.Application
   Dim oAju As ComPronto.AjusteStock
   Dim oPar As ComPronto.Parametro
   Dim oRs As ADOR.Recordset
   Dim oRsAux As ADOR.Recordset
   Dim oRsErrores As ADOR.Recordset
   Dim oF As Form
   Dim mArchivo As String, mCodigoMaterial As String, mMaterial As String, mObra As String
   Dim fl As Integer, mContador As Integer
   Dim mIdObra As Long, mIdUnidad As Long, mNumeroAjusteStock As Long, mIdArticulo As Long, mIdUbicacion As Long
   Dim mCantidad As Double
   Dim mFecha As Date
   Dim mOk As Boolean, mConProblemas As Boolean
   
   On Error GoTo Mal

   Set oF = New frmPathPresto
   With oF
      .Id = 20
      .Show vbModal
      mOk = .Ok
      If mOk Then mArchivo = .FileBrowser1(0).Text
   End With
   Unload oF
   Set oF = Nothing
   If Not mOk Then Exit Sub

   Set oAp = Aplicacion

   Set oRsErrores = CreateObject("ADOR.Recordset")
   With oRsErrores
      .Fields.Append "Id", adInteger
      .Fields.Append "Detalle", adVarChar, 200
   End With
   oRsErrores.Open
   
   Set oF = New frmAviso
   With oF
      .Label1 = "Abriendo planilla Excel ..."
      .Show
      .Refresh
      DoEvents
   End With

   oF.Label1 = oF.Label1 & vbCrLf & "Procesando ajustes de stock ..."
   oF.Label2 = ""
   oF.Label3 = ""
   DoEvents

   fl = 2
   mContador = 0
   
   Set oEx = CreateObject("Excel.Application")
   With oEx
      .Visible = True
      .WindowState = xlMinimized
      Me.Refresh
      With .Workbooks.Open(mArchivo)
         .Sheets("Hoja1").Select
         With .ActiveSheet
            Do While True
               If Len(Trim(.Cells(fl, 1))) = 0 Then
                  Set oPar = oAp.Parametros.Item(1)
                  With oPar.Registro
                     mNumeroAjusteStock = .Fields("ProximoNumeroAjusteStock").Value
                     oAju.Registro.Fields("NumeroAjusteStock").Value = mNumeroAjusteStock
                     .Fields("ProximoNumeroAjusteStock").Value = mNumeroAjusteStock + 1
                  End With
                  oPar.Guardar
                  Set oPar = Nothing
                  
                  oF.Label1 = oF.Label1 & vbCrLf & "REGISTRANDO AJUSTE... UN MOMENTO"
                  DoEvents
                  
                  oAju.Guardar
                  Set oAju = Nothing
                  Exit Do
               End If
               
               mConProblemas = False
               
               mContador = mContador + 1
               oF.Label2 = "Material : " & .Cells(fl, 4)
               oF.Label3 = "" & mContador
               DoEvents
            
               If IsDate(.Cells(fl, 1)) Then
                  mFecha = CDate(.Cells(fl, 1))
               Else
                  mFecha = Date
               End If
               mObra = .Cells(fl, 2)
               mCodigoMaterial = .Cells(fl, 3)
               mMaterial = .Cells(fl, 4)
               mCantidad = .Cells(fl, 5)
               mIdUnidad = .Cells(fl, 6)
               mIdUbicacion = .Cells(fl, 7)
               
               mIdObra = 0
               Set oRsAux = oAp.Obras.TraerFiltrado("_PorNumero", mObra)
               If oRsAux.RecordCount > 0 Then
                  mIdObra = oRsAux.Fields(0).Value
               Else
                  AgregarMensajeProcesoPresto oRsErrores, "La obra " & mObra & " no existe en la base de datos."
                  mConProblemas = True
               End If
               oRsAux.Close
               
               Set oRsAux = oAp.TablasGenerales.TraerUno("Unidades", mIdUnidad)
               If oRsAux.RecordCount = 0 Then
                  AgregarMensajeProcesoPresto oRsErrores, "La unidad " & mIdUnidad & " no existe en la base de datos."
                  mConProblemas = True
               End If
               oRsAux.Close
               
               Set oRsAux = oAp.TablasGenerales.TraerUno("Ubicaciones", mIdUbicacion)
               If oRsAux.RecordCount = 0 Then
                  AgregarMensajeProcesoPresto oRsErrores, "La ubicacion " & mIdUbicacion & " no existe en la base de datos."
                  mConProblemas = True
               End If
               oRsAux.Close
               
               mIdArticulo = 0
               Set oRsAux = oAp.Articulos.TraerFiltrado("_PorCodigo", mCodigoMaterial)
               If oRsAux.RecordCount > 0 Then
                  mIdArticulo = oRsAux.Fields(0).Value
               Else
                  AgregarMensajeProcesoPresto oRsErrores, "El material " & mCodigoMaterial & " no existe en la base de datos."
                  mConProblemas = True
               End If
               oRsAux.Close
               
               If mContador = 1 Then
                  Set oAju = oAp.AjustesStock.Item(-1)
                  With oAju
                     With .Registro
                        .Fields("NumeroAjusteStock").Value = 0
                        .Fields("FechaAjuste").Value = mFecha
                        .Fields("Observaciones").Value = "Importacion de ajuste de stock"
                        .Fields("IdRealizo").Value = glbIdUsuario
                        .Fields("FechaRegistro").Value = Now
                        .Fields("IdAprobo").Value = glbIdUsuario
                        .Fields("TipoAjuste").Value = "N"
                        .Fields("IdUsuarioIngreso").Value = glbIdUsuario
                        .Fields("FechaIngreso").Value = Now
                     End With
                  End With
               End If
               
               If Not mConProblemas Then
                  With oAju.DetAjustesStock.Item(-1)
                     With .Registro
                        .Fields("IdAjusteStock").Value = 0
                        .Fields("IdArticulo").Value = mIdArticulo
                        .Fields("CantidadUnidades").Value = mCantidad
                        .Fields("IdUnidad").Value = mIdUnidad
                        .Fields("Partida").Value = ""
                        .Fields("IdUbicacion").Value = mIdUbicacion
                        .Fields("IdObra").Value = mIdObra
                     End With
                     .Modificado = True
                  End With
               End If
               fl = fl + 1
            Loop
         End With
         .Close False
      End With
      .Quit
   End With
   
   Unload oF
   Set oF = Nothing

   If Not oRsErrores Is Nothing Then
      If oRsErrores.RecordCount > 0 Then
         Set oF = New frmConsulta1
         With oF
            Set .RecordsetFuente = oRsErrores
            .Id = 13
            .Show vbModal, Me
         End With
      Else
         MsgBox "Proceso completo", vbInformation
      End If
      Set oRsErrores = Nothing
   End If

Salida:
   On Error Resume Next
   
   Unload oF
   Set oF = Nothing

   Set oRs = Nothing
   Set oRsErrores = Nothing
   Set oRsAux = Nothing
   Set oAju = Nothing
   Set oPar = Nothing
   Set oEx = Nothing
   Set oAp = Nothing

   Exit Sub

Mal:
   MsgBox "Se ha producido un error al registrar los datos" & vbCrLf & Err.Number & " -> " & Err.Description, vbCritical
   Resume Salida
   
End Sub

Public Sub PasarOPaEntregada()

   Dim s As String
   Dim iFilas As Integer
   Dim mAuxL1 As Long
   Dim mFecha As Date
   Dim mOk As Boolean
   Dim Filas, Columnas
   Dim oF As frm_Aux
   
   Set oF = New frm_Aux
   With oF
      .Label1.Caption = "Numero recibo :"
      With .Label2(1)
         .Caption = "Fecha :"
         .Visible = True
      End With
      With .DTFields(1)
         .Value = Date
         .Visible = True
      End With
      .Show vbModal, Me
      mAuxL1 = Val(.Text1.Text)
      mFecha = .DTFields(1).Value
      mOk = .Ok
   End With
   Unload oF
   Set oF = Nothing
   If Not mOk Then Exit Sub
   
   Filas = VBA.Split(Lista.GetString, vbCrLf)
   s = ""
   For iFilas = LBound(Filas) + 1 To UBound(Filas)
      Columnas = VBA.Split(Filas(iFilas), vbTab)
      If IsNumeric(Columnas(2)) Then Aplicacion.Tarea "OrdenesPago_MarcarComoEntregado", Array(Columnas(2), mAuxL1, mFecha)
   Next
   Set Lista.DataSource = Aplicacion.OrdenesPago.TraerFiltrado("_EnCaja")

End Sub
