@model ProntoMVC.Data.Models.Pedido
@{
    ViewBag.Title = "Pedido " + ((Model.IdPedido <= 0) ? "Nuevo" : Model.NumeroPedido.NullSafeToString()); ;
}


@using (Html.BeginForm(null, null, FormMethod.Post, new { id = "formid" }))
{

    @Html.ValidationSummary(true)

    <script src="@Url.Content("~/Scripts/ScriptPedido.js?1529")" type="text/javascript"></script>       @*aparentemente tengo que llamarla despues de cargar las div*@

    <script>

        function deshabilitar() {

            // $("*").attr("disabled", "disabled");
            $("#formid *").not("#Lista").not(".ui-jqgrid").not("#lImprimir").not("#anular").not("#AnularFirmas").attr("disabled", "disabled");


            // para que solo bloquee el contenido y me deje scrollear, saqué el 'closest'


            $.blockUI.defaults.css.cursor = 'default';
            $.blockUI.defaults.overlayCSS.cursor = 'default';

            //http://stackoverflow.com/questions/19810312/disabling-entire-jqgrid-jquery-grid-plugin-using-jquery-blockui-plugin
            //                $("#Lista").closest(".ui-jqgrid").block({
            //                    message: "", //"<h1>Being processed...</h1>",
            //                    css: { border: "3px solid #a00" }
            //                });





            $("#Lista").block({ // para que solo bloquee el contenido y me deje scrollear, saqué el 'closest'
                message: "", //"<h1>Being processed...</h1>",
                //                css: {
                //                    // border: "3px solid #a00"
                ////                    'cursor': 'default',
                ////                    'background-color': 'rgb(218, 211, 211)',
                ////                    'color': '#fff'
                //                }
                //                ,
                theme: true,
                themedCSS: {
                    width: "35%",
                    left: "30%"
                    // ,  background-color: 'rgb(218, 211, 211)'
                    //  ,  border: "3px solid #a00"
                }

            });

            $("#ListaDrag").block({ // para que solo bloquee el contenido y me deje scrollear, saqué el 'closest'
                message: "", //"<h1>Being processed...</h1>",
                css: {
                    // border: "3px solid #a00"
                    // cursor: 'default'
                }
                  ,
                theme: true,
                themedCSS: {
                    width: "35%",
                    left: "30%"
                    // ,  background-color: 'rgb(218, 211, 211)'
                    //  ,  border: "3px solid #a00"
                }
            });
            $("#ListaDrag2").block({ // para que solo bloquee el contenido y me deje scrollear, saqué el 'closest'
                message: "", //"<h1>Being processed...</h1>",
                css: {
                    // border: "3px solid #a00"
                    cursor: 'default'

                }
            });
            //panelLayout(""



        }
    </script>

    @*para centrar verticalmente las observaciones *@
    <style type="text/css">
        .ui-jqgrid tr.jqgrow td {
            vertical-align: middle !important;
        }
    </style>



    <div class="container-fluid" style="padding-left: 0px; padding-right: 0px;">
        <div class="modal" id="loading">
            <img src="@Url.Content("~/Content/images/fhhrx.gif")" style="margin-right: 5px;" />
            Cargando...
        </div>
        <style>
            /* probando cómo zafar del color en los border del arbol de la izquierda */
            .ui-jqgrid tr.ui-row-ltr td {
                border-color: rgb(234, 234, 234) /* rgba(213, 175, 175, 0); */;
            }
        </style>
        <style>
            input[readonly] {
                background: transparent;
                border: 0;
                -webkit-box-shadow: none;
                -moz-box-shadow: none;
                box-shadow: none;
            }

            .container-fluid {
                padding-left: 8px; /*    margin-right: 15px; */
            }
        </style>
        <style>
            .ui-jqgrid tr.footrow-ltr td {
                border-right-color: transparent !important;
                border: 0 transparent !important;
            }
        </style>
        <style>
            .accordion-heading {
                /*   font-size: 25px !important;  */
            }

            /* http://stackoverflow.com/questions/13778703/adding-open-closed-icon-to-twitter-bootstrap-collapsibles-accordions */
            .accordion-caret .accordion-toggle:hover {
                text-decoration: none;
            }

                .accordion-caret .accordion-toggle:hover span, .accordion-caret .accordion-toggle:hover strong {
                    text-decoration: underline;
                }

            .accordion-caret .accordion-toggle:before {
                font-size: 20px;
                vertical-align: -3px;
            }

            .accordion-caret .accordion-toggle:not(.collapsed):before {
                /*                content: "▾"; */
                margin-right: 0px;
            }

            .accordion-caret .accordion-toggle.collapsed:before {
                /*             content: "▸"; */
                margin-right: 0px;
            }
        </style>
        @if (false)
        {

            <style>
                /* jqGrid builds some additional divs over the main grid table. The outer div has the class ui-jqgrid. So if you need to remove right and left border existing over the whole grid you can use the following CSS: */

                .ui-jqgrid {
                    border-right-width: 0px;
                    border-left-width: 0px;
                }

                    /* If you need to remove all grid's borders you can use

                .ui-jqgrid { border-width: 0px; }
                If you want additionally remove vertical border between the cells in the grid you can use */


                    .ui-jqgrid tr.ui-row-ltr td {
                        /* border-right-color: transparent; */
                        border-right-color: #E4E4E4;
                    }




                    /*To remove horizontal border between the rows you can use */

                    .ui-jqgrid tr.ui-row-ltr td {
                        /* border-right-color: transparent; */
                        border-right-color: #E4E4E4;
                    }
                /*To remove vertical borders between the column headers you can use */

                th.ui-th-column {
                    /*    border-right-color: transparent !important; */
                    border-right-color: rgb(234, 234, 234) !important;
                }
                /* or alternatively (without the usage of !important) */

                .ui-jqgrid-labels .ui-th-column {
                    /* border-right-color: transparent;*/
                    border-right-color: #E4E4E4;
                }
            </style>
        }
        <style>
            /*  http://stackoverflow.com/questions/13103544/how-to-restrict-jqgrid-textarea-height-in-grid-only */
            tr.jqgrow > td.textInDiv > div {
                max-height: 30px;
                height: 30px;
                overflow: auto;
            }

            td.form-view-data > span > div {
                max-height: 30px;
                height: 30px;
                overflow: auto;
            }
        </style>




        <form class="form-horizontal">
            <div id="cuerpomaspie" class="" style="padding-bottom:2px; position: relative;  " @*Height of the footer *@>
                <div id="conscroll" style="height: 600px; margin-bottom: 40px; overflow-y: scroll;
                padding-left: 25px; padding-right: 25px; overflow-x: hidden;">
                    <div>@Html.Hidden("IdPedido", Model.IdPedido)</div>
                    <div>@Html.Hidden("IdProveedor", Model.IdProveedor)</div>
                    @*  <div class="span12">
                        </div>*@
                    <div class="row-fluid" style="margin-bottom: 15px; margin-top: 5px;">

                        <div class="span6">
                            <div class="" style='font-size: 34px; margin-top: 5px; height: 45px; font-weight: 400;
                            text-shadow: 0 1px 0  lightgray; font-family: "Segoe UI Web Regular", "Segoe UI", "Lucida", Tahoma, Arial,"sans-serif"'>


                                <span class="span1" style="padding-top: 15px; width: 110px">Pedido </span>
                                @Html.TextBoxFor(model => model.NumeroPedido, new { style = "height: 50px ;  font-weight: 400; text-shadow: 0 1px 0  lightgray; font-size: 34px; border: 0; padding: 0 ; text-align: right; background: transparent;  font-family: 'Segoe UI Web Regular', 'Segoe UI', 'Lucida', Tahoma, Arial,'sans-serif';                    -webkit-box-shadow: none; -moz-box-shadow: none; box-shadow: none;                   ", @class = "span3", @readonly = "readonly" })
                                <span class="" style="padding-top: 15px; width: 10px">/ </span>
                                @Html.TextBoxFor(model => model.SubNumero, new { style = "width: 40px; height: 50px; font-weight: 400; text-shadow: 0 1px 0  lightgray; font-size: 34px; border: 0; padding: ; text-align: left; background: ;  font-family: 'Segoe UI Web Regular', 'Segoe UI', 'Lucida', Tahoma, Arial,'sans-serif';  ", @class = "span1" })
                            </div>
                        </div>
                        <div class="span6">
                            @*  <input type="button" id="grabar2" value="Aceptar" style="margin-top: 15px;" class="btn  btn-large btn-primary pull-right" />*@
                        </div>
                        <script>
                            $(function () {

                                function resizeInput() {
                                    // $(this).attr('size', $(this).val().length + 2);
                                    $(this).css('width', $(this).val().length * 32);
                                }


                                $('#SubNumero').keyup(resizeInput).each(resizeInput);

                                $('#NumeroPedido').css('width', $('#NumeroPedido').val().length * 21);

                            })
                        </script>
                    </div>
                    <div class="accordion" id="accordionA">
                        <div class="accordion-group  accordion-caret " style="border: 0px; padding: 0px;">
                            <div class="accordion-heading" style="border: 0px; padding: 0px;">
                                <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordionA" href="#collapseEncabezado"
                                   style="border: 0px; padding: 0px; color: #9C0000; font-size: 12px">
                                    ENCABEZADO
                                </a>
                            </div>
                            <div id="collapseEncabezado" class="accordion-body collapse in" style="border: 0px;
                            padding: 0px;">
                                @*si pones "collapse in" empieza abierto*@
                                <div class="accordion-inner" style="border: 0px; padding: 0px;">
                                    <div class="row-fluid">
                                        <div class="span2 lightblue">
                                            @Html.LabelFor(model => model.FechaPedido, "Fecha")
                                            @*       @Html.TextBoxFor(model => model.FechaPedido, new Dictionary<string, object> { { "class", "span12" }, { "placeholder", "dd/mm/yyyy" } })*@
                                            @Html.TextBox("FechaPedido", Model.FechaPedido.GetValueOrDefault().ToString("dd/MM/yyyy"), new Dictionary<string, object> { { "class", "span12" }, { "placeholder", "dd/mm/yyyy" } })
                                            @Html.ValidationMessageFor(model => model.FechaPedido)
                                            <script>
                                                $("#FechaPedido").datepicker({
                                                    changeMonth: true,
                                                    changeYear: true,
                                                    dateFormat: 'dd/mm/yy'
                                                    //numberOfMonths: 2,
                                                });



                                            </script>
                                        </div>
                                        <!--/span-->
                                        @*   <div class="span1 lightblue">
                                                @Html.HiddenFor(model => model.IdProveedor)
                                                @Html.LabelFor(model => model.Proveedor.CodigoProveedor, "Codigo")
                                                @Html.TextBoxFor(m => m.Proveedor.CodigoProveedor, new { id = "CodigoProveedor", @class = "span12" })
                                            </div>*@
                                        <div class="span9 lightblue">
                                            @Html.LabelFor(model => model.IdProveedor, "Proveedor") @*para que quede el espacio*@
                                            @Html.TextBoxFor(m => m.Proveedor.RazonSocial, new { id = "DescripcionProveedor", @class = "span12" })
                                            <script type="text/jscript">


                                                $("#CodigoProveedor").autocomplete({
                                                    source: '@Url.Action("GetCodigosProveedorAutocomplete", "Proveedor")', minLength: 0,
                                                    messages: { noResults: "", results: function () { } },
                                                    select: proveedorSeleccionado,
                                                    autoFocus: true
                                                })

                                                $("#DescripcionProveedor").autocomplete({
                                                    source: '@Url.Action("GetCodigosProveedorAutocomplete", "Proveedor")',
                                                    minLength: 0,
                                                    messages: { noResults: "", results: function () { } },
                                                    select: proveedorSeleccionado,
                                                    autoFocus: true

                                                });









                                                function proveedorSeleccionado(event, ui) {

                                                    ActualizarProveedor(ui.item);
                                                    ///////////////////////
                                                    event.preventDefault();
                                                }

                                                function ActualizarProveedor(item) {
                                                    $("#IdProveedor").val(item.id);
                                                    $("#CodigoProveedor").val(item.codigo || "");
                                                    $("#DescripcionProveedor").val(item.value || "");
                                                    $("#IdCodigoIva").val(item.idCodigoIva);

                                                    $("#Proveedor_Email").val(item.Email || "");
                                                    $("#Proveedor_Telefono").val(item.Telefono || "");
                                                    $("#Proveedor_Direccion").val(item.Direccion || "");
                                                    $("#Proveedor_Provincia_Nombre").val(item.Provincia || "");
                                                    $("#Proveedor_Localidad_Nombre").val(item.Localidad || "");
                                                    $("#Proveedor_Fax").val(item.Fax || "");
                                                    $("#Proveedor_Cuit").val(item.Cuit) || "";
                                                    $("#IdCondicionVenta").val(item.IdCondicionVenta);
                                                    $("#IdListaPrecios").val(item.IdListaPrecios);



                                                    $("#Proveedor_EsAgenteRetencionIVA").val(item.EsAgenteRetencionIVA || "");
                                                    $("#Proveedor_BaseMinimaParaPercepcionIVA").val(item.BaseMinimaParaPercepcionIVA) || "";
                                                    $("#Proveedor_PorcentajePercepcionIVA").val(item.PorcentajePercepcionIVA) || "";


                                                    $("#IdIBCondicionPorDefecto").val(item.IdIBCondicionPorDefecto);
                                                    $("#IdIBCondicionPorDefecto2").val(item.IdIBCondicionPorDefecto2);
                                                    $("#IdIBCondicionPorDefecto3").val(item.IdIBCondicionPorDefecto3);
                                                    var someNumericValue = '@(ViewBag.someStringValue)'; //http://stackoverflow.com/questions/10389649/possible-to-access-mvc-viewbag-object-from-javascript-file
                                                    $("#Proveedor_PercepcionIIBB").val(someNumericValue);
                                                    $('#Proveedor_IBCondicionCat1_AlicuotaPercepcion').val(item.AlicuotaPercepcion1);
                                                    $('#Proveedor_IBCondicionCat2_AlicuotaPercepcion').val(item.AlicuotaPercepcion2);
                                                    $('#Proveedor_IBCondicionCat3_AlicuotaPercepcion').val(item.AlicuotaPercepcion3);


                                                    ActualizarPercepcionIIBB();
                                                    // ActualizarListaPuntoVenta();
                                                    // ActualizarPuntoVenta();
                                                }


                                                function ActualizarPercepcionIIBB() {
                                                    var mvarIBCondicion, mvarPercepcionIIBB, mvarId;

                                                    mvarIBCondicion = $("#Proveedor_IBCondicion"); // IBCondicion del Proveedor elegido
                                                    mvarPercepcionIIBB = $("#PercepcionIIBB"); // PercepcionIIBB de parametros generales -los parametros generales los debo incluir en el model, o en el viewmodel? -agregalos al viewbag...



                                                    if (mvarIBCondicion == 1 || mvarIBCondicion == 4 || (mvarId < 0 && mvarPercepcionIIBB != "SI")) {

                                                        $("#IdIBCondicionPorDefecto").prop('disabled', true);
                                                        $("#IdIBCondicionPorDefecto2").prop('disabled', true);
                                                        $("#IdIBCondicionPorDefecto3").prop('disabled', true);

                                                        //            dcfields(4).Enabled = False
                                                        //            dcfields(5).Enabled = False
                                                        //            dcfields(6).Enabled = False
                                                        //            .Fields("IdIBCondicion").Value = Null
                                                        //            .Fields("IdIBCondicion2").Value = Null
                                                        //            .Fields("IdIBCondicion3").Value = Null
                                                        //            With Check1(0)
                                                        //               .Value = 0
                                                        //               .Enabled = False
                                                        //            End With
                                                        //            With Check1(1)
                                                        //               .Value = 0
                                                        //               .Enabled = False
                                                        //            End With
                                                        //            With Check1(2)
                                                        //               .Value = 0
                                                        //               .Enabled = False
                                                        //            End With
                                                    } else {
                                                        $("#IdIBCondicionPorDefecto").prop('disabled', false);
                                                        $("#IdIBCondicionPorDefecto2").prop('disabled', false);
                                                        $("#IdIBCondicionPorDefecto3").prop('disabled', false);
                                                        //            Check1(0).Enabled = True
                                                        //            If IsNull(.Fields("IdIBCondicion").Value) Then
                                                        //               .Fields("IdIBCondicion").Value = mvarIdIBCondicion
                                                        //               If mvarIdIBCondicion <> 0 Then Check1(0).Value = 1
                                                        //            End If
                                                        //            If Check1(0).Value = 1 Then dcfields(4).Enabled = True Else dcfields(4).Enabled = False
                                                        //            Check1(1).Enabled = True
                                                        //            If IsNull(.Fields("IdIBCondicion2").Value) And mvarIdIBCondicion2 <> 0 Then
                                                        //               .Fields("IdIBCondicion2").Value = mvarIdIBCondicion2
                                                        //               If mvarIdIBCondicion2 <> 0 Then Check1(1).Value = 1
                                                        //            End If
                                                        //            If Check1(1).Value = 1 Then dcfields(5).Enabled = True Else dcfields(5).Enabled = False
                                                        //            Check1(2).Enabled = True
                                                        //            If IsNull(.Fields("IdIBCondicion3").Value) And mvarIdIBCondicion3 <> 0 Then
                                                        //               .Fields("IdIBCondicion3").Value = mvarIdIBCondicion3
                                                        //               If mvarIdIBCondicion3 <> 0 Then Check1(2).Value = 1
                                                        //            End If
                                                        //            If Check1(2).Value = 1 Then dcfields(6).Enabled = True Else dcfields(6).Enabled = False
                                                    }
                                                }

                                                function AutocompleteManual(term) {
                                                    $.ajax({
                                                        type: 'POST',
                                                        contentType: 'application/json; charset=utf-8',
                                                        url: ROOT + 'Proveedor/GetCodigosProveedorAutocomplete',
                                                        dataType: 'json',
                                                        // data:JSON.stringify( {formulario: colData , grilla: dataToSend })
                                                        data: JSON.stringify({ term: term }),
                                                        success: function (result) {
                                                            var item = result[0];

                                                            ActualizarProveedor(item);
                                                        }
                                                    })
                                                }


                                                function ActualizarDatosProveedor(cadenaAutoComplete) {
                                                    // var code = "OPELMEC";
                                                    // simulo un ingreso y clic en el autocomplete (tiene que tener puesto el autofocus: true)
                                                    // http: //stackoverflow.com/questions/8036143/jquery-autocomplete-select-first-item
                                                    AutocompleteManual(cadenaAutoComplete);
                                                    return;
                                                    $("#DescripcionProveedor").val(cadenaAutoComplete);
                                                    $("#DescripcionProveedor").autocomplete('search', cadenaAutoComplete);
                                                    $(".ui-menu-item:first a").click();
                                                    // '@Url.Action("GetCodigosProveedorAutocomplete", "Proveedor")'
                                                };


                                            </script>
                                        </div>
                                        <div class="span1 pull-right" style="text-align: center">
                                            @Html.Hidden("PedidoExterior", Model.PedidoExterior)
                                            @Html.LabelFor(model => model.PedidoExterior, "Exterior")
                                            @Html.CheckBox("PedidoExteriorCheck", Model.PedidoExterior == "SI")
                                        </div>
                                        <script>
                                            $('#PedidoExteriorCheck').change(function () {
                                                $.get(ROOT + 'Pedido/ProximoNumero?bEsExterior='
                                    + ($('#PedidoExteriorCheck').attr("checked") == "checked")
                                    , function (data) {
                                        $("#NumeroPedido").val(data);
                                        $("#PedidoExterior").val(($('#PedidoExteriorCheck').attr("checked") == "checked") ? "SI" : "NO");

                                    });
                                            });

                                        </script>
                                        <!--/span-->
                                    </div>
                                    <!--/row-->
                                    <div class="row-fluid">
                                        <div class="span2 lightblue">
                                            @Html.LabelFor(model => model.IdComprador, "Comprador")
                                            @Html.DropDownList("IdComprador", null, String.Empty, new { @class = "span12" })
                                            @Html.ValidationMessageFor(model => model.IdComprador)
                                            <script type="text/jscript">
                                                function TraerDatosComprador(id) {
                                                    $.get(ROOT + 'Empleado/GetEmpleado/' + id, function (data) {
                                                        $("#Comprador_Email").val(data[0].Email || "");
                                                    });
                                                }

                                                $("#IdComprador").change(function () {

                                                    TraerDatosComprador($("#IdComprador").val());
                                                });



                                            </script>
                                        </div>
                                        <!--/span-->
                                        <div class="span2 lightblue">
                                            @Html.LabelFor(model => model.LugarEntrega, "Email")
                                            @Html.TextBoxFor(model => model.Comprador.Email, new { @class = "span12", @readonly = "readonly" })
                                            @Html.ValidationMessageFor(model => model.LugarEntrega)
                                        </div>
                                        <!--/span-->
                                        <div class="span2 lightblue">
                                            @Html.LabelFor(model => model.IdCondicionCompra, "Cond. compra")
                                            @Html.DropDownList("IdCondicionCompra", null, String.Empty, new { @class = "span12" })
                                            @Html.ValidationMessageFor(model => model.IdCondicionCompra)
                                            <script>



                                                $("#IdCondicionCompra").change(function () {
                                                    $("#DetalleCondicionCompra").val($("#IdCondicionCompra option:selected").text());

                                                })
                                            </script>
                                        </div>
                                        <!--/span-->
                                        <div class="span6 lightblue">
                                            @Html.LabelFor(model => model.DetalleCondicionCompra, "Aclaracion sobre las condiciones de compra")
                                            @Html.TextBoxFor(model => model.DetalleCondicionCompra, new { @class = "span12" })
                                            @Html.ValidationMessageFor(model => model.DetalleCondicionCompra)
                                        </div>
                                        <!--/span-->
                                    </div>
                                    <div class="row-fluid">
                                        <div class="span4 lightblue">
                                            @Html.LabelFor(model => model.Aprobo, "Aprobo")
                                            @Html.DropDownList("Aprobo", null, String.Empty, new { @class = "span12" })
                                            @Html.ValidationMessageFor(model => model.Aprobo)
                                        </div>
                                        <!--/span-->
                                        <div class="span2 lightblue">
                                            @Html.Label("Autorizaciones")
                                            <form>
                                                @{

// con jquery se llama despues a  "Requerimiento/Autorizaciones" para tildar y a Aprobado() para el primer check
                                                    <input type="checkbox" id="chk0" readonly="readonly" disabled="disabled" class="GridCheckBox"
                                                           title="" />

                                                    int ca = ViewBag.CantidadAutorizaciones;

                                                    int j = 1;
                                                    for (var i = 1; i <= ca; i++)
                                                    {
                                                        <input type="checkbox" id="chk@(i)" readonly="readonly" disabled="disabled" class="GridCheckBox" title="" />
                                                    }
                                                }
                                            </form>
                                        </div>
                                        <div class="span2 lightblue">
                                            @Html.LabelFor(model => model.Aprobo, ". ")
                                            @if (Model.Aprobo != null)
                                            {
                                                <input type="button" id="AnularFirmas" value="@(ViewBag.CantidadAutorizaciones > 1 ? "Anular liberación" : "Anular firmas") " class="btn btn-link" />
                                            }
                                            <script>

                                                //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                ////////////////////////////////////   usar el mismo jqdialog  pasandole callbacks    ////////////////////////////////
                                                //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                $(function () {
                                                    $('#AnularFirmas').click(function () {


                                                        var IdAprobo = $("#Aprobo > option:selected").attr("value");
                                                        var Aprobo = $("#Aprobo > option:selected").html();
                                                        $("#Aux1").val(IdAprobo);
                                                        $("#Aux2").val(Aprobo);
                                                        $("#Aux3").val("");
                                                        $("#Aux10").val("");


                                                        $("#dialog-password").dialog({
                                                            buttons: {
                                                                'Aceptar': function () {
                                                                    //alert('hola');
                                                                    // $(this).dialog('close');
                                                                    // http://stackoverflow.com/questions/1031674/how-do-i-write-a-jquery-function-that-accepts-a-callback-as-a-parameter
                                                                    validatePwd2(anularfirma, function () { });
                                                                    $(this).dialog('close');
                                                                },
                                                                'Cancelar': function () {
                                                                    $(this).dialog('close');
                                                                }
                                                            },
                                                            open: function () {

                                                            }
                                                        });

                                                        $('#dialog-password').data('Combo', 'Aprobo');
                                                        $('#dialog-password').dialog('open');

                                                        $('#mySelect').focus(); // esto es clave, para que no me cierre el cuadro de dialogo al recibir un posible enter apretado en el change

                                                        //preseleccionar el usuario que había liberado
                                                        //deshabilitar el combo (solo puede anular la liberacion el que lo liberó)
                                                        $('#mySelect').prop("disabled", true);




                                                        if (IdAprobo == "") {
                                                            $("#mySelect").val([]);
                                                        }
                                                        else {
                                                            $('#mySelect').val(IdAprobo);
                                                        }







                                                    })






                                                    function anularfirma() {

                                                        $.ajax({
                                                            type: 'POST',
                                                            contentType: 'application/json; charset=utf-8',
                                                            url: ROOT + 'Pedido/AnularFirmas',
                                                            dataType: 'json',
                                                            data: JSON.stringify(SerializaForm()),
                                                            success: function (result) {
                                                                alert("Firmas anuladas");
                                                                window.location.replace(window.location.pathname);
                                                                //window.location = (ROOT + "Pedido/Edit/" + result.IdPedido);
                                                            },
                                                            error: function (result) {
                                                                alert("No se pudo anular");
                                                            }

                                                        })
                                                    }





                                                    $("#Aprobo").change(function (event) {
                                                        //            alert("change");
                                                        //        event.preventDefault();
                                                        //        event.stopPropagation();
                                                        aprobar();
                                                    });




                                                    function aprobar() {
                                                        var IdAprobo = $("#Aprobo > option:selected").attr("value");
                                                        var Aprobo = $("#Aprobo > option:selected").html();
                                                        $("#Aux1").val(IdAprobo);
                                                        $("#Aux2").val(Aprobo);
                                                        $("#Aux3").val("");
                                                        $("#Aux10").val("");

                                                        $("#dialog-password").dialog({
                                                            buttons: {
                                                                'Aceptar': function () {
                                                                    //alert('hola');
                                                                    //  $(this).dialog('close');
                                                                    // http://stackoverflow.com/questions/1031674/how-do-i-write-a-jquery-function-that-accepts-a-callback-as-a-parameter
                                                                    validatePwd2(

                                                                function () {

                                                                    var combo = $("#Aux0").val();
                                                                    var idusuario = $("#Aux1").val();
                                                                    var post = $("#Aux10").val();
                                                                    $('#' + combo).val(idusuario);
                                                                    $("#Aux3").val(idusuario);


                                                                    // ok
                                                                },
                                                                 function () {

                                                                     alert('Password incorrecta');

                                                                     var combo = $("#Aux0").val();

                                                                     $('#' + combo).val("");
                                                                     $("#Aux3").val("");
                                                                 }
                                                                );
                                                                },
                                                                'Cancelar': function () {
                                                                    $(this).dialog('close');
                                                                }
                                                            },

                                                            open: function () {

                                                                //alert("hay que volver a llenar el mySelect"); //porque el anular lo rellena con otra lista
                                                                // pasar la eleccion del combo DESPUES de que hizo la llamada a CargarEmpleadosParaAprobar, como callback

                                                                var callbackfunction = function () {
                                                                    var combo = $("#dialog-password").data('Combo')
                                                                    var idusuario = $("#Aux1").val();
                                                                    var usuario = $("#Aux2").val();
                                                                    $("#Aux0").val(combo);
                                                                    $("#usuario").val(usuario);
                                                                    $('#password').focus();
                                                                    if (idusuario == "") {
                                                                        $("#mySelect").val([]);
                                                                    }
                                                                    else {
                                                                        $('#mySelect').val(idusuario);
                                                                    }
                                                                }

                                                                CargarEmpleadosParaAprobar(callbackfunction);
                                                            },
                                                            close: function () {
                                                                // si usás una funcion de callback, pasale los parametros. Quiero decir: que el dialog no tenga que saber cómo implementarla!
                                                                // http://stackoverflow.com/questions/939032/jquery-pass-more-parameters-into-callback

                                                                $('#password').val("");
                                                                var combo = $("#Aux0").val();
                                                                $('#' + combo).val("");  // acá reseteo el combo que se pasó como parámetro en la llamada   $('#dialog-password').data('Combo', 'Aprobo');
                                                                $("#Aux3").val("");
                                                            }
                                                        });

                                                        $('#dialog-password').data('Combo', 'Aprobo');
                                                        $('#dialog-password').dialog('open');
                                                        $('#mySelect').focus(); // esto es clave, para que no me cierre el cuadro de dialogo al recibir un posible enter apretado en el change
                                                    }




                                                })
                                            </script>
                                        </div>
                                        <!--/span-->
                                        <!--/span-->
                                    </div>
                                    <!--/row-->
                                    <!--/row-->
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="accordion" id="accordion2">
                        <div class="accordion-group accordion-caret " style="border: 0px; padding: 0px;">
                            <div class="accordion-heading" style="border: 0px; padding: 0px;">
                                <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#collapseOne"
                                   style="border: 0px; padding: 0px; color: #9C0000; font-size: 12px">
                                    DATOS DEL PROVEEDOR
                                </a>
                            </div>
                            <div id="collapseOne" class="accordion-body collapse" style="border: 0px; padding: 0px;">
                                @*si pones "collapse in" empieza abierto*@
                                <div class="accordion-inner" style="border: 0px; padding: 0px;">
                                    <div class="row-fluid">
                                        <div class="span5 lightblue">
                                            @Html.LabelFor(model => model.Proveedor.Direccion, "Dirección ")
                                            @Html.TextBoxFor(model => model.Proveedor.Direccion, new { @class = "span12", @readonly = true, @disabled = "disabled" })
                                            @Html.ValidationMessageFor(model => model.Aprobo)
                                        </div>
                                        <!--/span-->
                                        <div class="span7 lightblue">
                                            @Html.LabelFor(model => model.Proveedor.Localidad.Nombre, "Localidad")
                                            @Html.TextBoxFor(model => model.Proveedor.Localidad.Nombre, new { @class = "span12", @readonly = true, @disabled = "disabled" })
                                            @Html.ValidationMessageFor(model => model.Proveedor.Localidad)
                                        </div>
                                        <!--/span-->
                                        <!--/span-->
                                    </div>
                                    <div class="row-fluid">
                                        <div class="span5 lightblue">
                                            @Html.LabelFor(model => model.Proveedor.Provincia.Nombre, "Provincia ")
                                            @Html.TextBoxFor(model => model.Proveedor.Provincia.Nombre, new { @class = "span12", @readonly = true, @disabled = "disabled" })
                                            @Html.ValidationMessageFor(model => model.Aprobo)
                                        </div>
                                        <!--/span-->
                                        <div class="span7 lightblue">
                                            @Html.LabelFor(model => model.Proveedor.Telefono1, "Telefono")
                                            @Html.TextBoxFor(model => model.Proveedor.Telefono1, new { @class = "span12", @readonly = true, @disabled = "disabled" })
                                            @Html.ValidationMessageFor(model => model.Proveedor.Localidad)
                                        </div>
                                        <!--/span-->
                                        <!--/span-->
                                    </div>
                                    <div class="row-fluid">
                                        <div class="span5 lightblue">
                                            @Html.LabelFor(model => model.Proveedor.Email, "Email ")
                                            @Html.TextBoxFor(model => model.Proveedor.Email, new { @class = "span12", @readonly = true, @disabled = "disabled" })
                                            @Html.ValidationMessageFor(model => model.Aprobo)
                                        </div>
                                        <!--/span-->
                                        <div class="span7 lightblue">
                                            @Html.LabelFor(model => model.Proveedor.IdCodigoIva, "Condicion IVA")
                                            @Html.DropDownList("IdCodigoIva", null, new { @class = "span12", @readonly = true, @disabled = "disabled" })
                                            @Html.ValidationMessageFor(model => model.Proveedor.DescripcionIva)
                                        </div>
                                        <!--/span-->
                                        <!--/span-->
                                    </div>
                                    <!--/row-->
                                    <div class="row-fluid">
                                        <div class="span6 lightblue">
                                            @Html.LabelFor(model => model.Contacto, "Contacto")
                                            @Html.TextBoxFor(model => model.Contacto, new { @class = "span12" })
                                            @Html.ValidationMessageFor(model => model.Contacto)
                                        </div>
                                    </div>
                                    <!--/row-->
                                </div>
                            </div>
                        </div>
                    </div>
                    <!--/row-->
                    <div class="accordion" id="accordion6">
                        <div class="accordion-group accordion-caret " style="border: 0">
                            <div class="accordion-heading" style="">
                                <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion6" href="#collapse6"
                                   style="border: 0px; padding: 0px; color: #9C0000; font-size: 10px">DETALLE</a>
                            </div>
                            <div id="collapse6" class="accordion-body collapse in" style="border: 0px; padding: 0px;">
                                @*si agregas 'in' y pones class="accordion-body collapse in" empieza abierto*@
                                <div class="accordion-inner" style="border: 0px; padding: 0px;">
                                    <div class="row-fluid" style="margin-bottom: 2px;">
                                        <div class="row-fluid" style="margin-bottom: 2px;">
                                            <div id="divGrilla" class="span12 lightblue" style="padding-left: 0px; padding-right: 2px;
                                            min-height: 150px">
                                                <style>
                                                    .ui-jqdialog td {
                                                        border: 0px !important;
                                                    }

                                                    .ui-jqdialog table {
                                                        border: 0px !important;
                                                    }

                                                    .ui-jqdialog .ui-jqdialog-titlebar {
                                                        padding: 0;
                                                        position: relative;
                                                    }


                                                    .ui-jqdialog-titlebar {
                                                        height: 15px;
                                                    }

                                                    .ui-jqdialog button {
                                                    }

                                                    /*   http://stackoverflow.com/questions/14954587/jqgrid-for-twitter-bootstrap  */
                                                    input.ui-pg-input {
                                                        width: auto;
                                                        padding: 0px;
                                                        margin: 0px;
                                                        line-height: normal;
                                                    }



                                                    select.ui-pg-selbox {
                                                        width: auto;
                                                        padding: 0px;
                                                        margin: 0px;
                                                        line-height: normal;
                                                    }

                                                    .ui-widget select {
                                                        margin-bottom: 0px !important; /* para que en la edicion inline de la grilla no me haga mas alto el renglon   */
                                                    }




                                                    .ui-widget-content button {
                                                        background: rgb(231, 231, 231);
                                                        color: black !important;
                                                    }

                                                    .ui-jqgrid tr.footrow-ltr {
                                                        font-size: 9px;
                                                    }


                                                    .AltoRenglones tr.jqgrow td /* .ui-jqgrid tr.jqgrow td */ {
                                                        height: 32px;
                                                    }



                                                    .ui-jqgrid tr.ui-row-ltr td {
                                                        /* lineas de las grillas verticales*/ /*
                                                                            border-right-style: none;
                                                                            border-left-style: none;
                                                                            */
                                                    }

                                                    .ui-icon, .ui-widget-content .ui-icon {
                                                        /* background-image:
                                                        none; */
                                                    }

                                                    /* el padding... http://stackoverflow.com/questions/17732147/how-to-add-class-to-a-cell-in-jqgrid*/
                                                    .ui-jqgrid tr.jqgrow td {
                                                        padding-left: 8px;
                                                        padding-right: 8px;
                                                    }

                                                    .ui-widget-content hr {
                                                        border: 0 !important; /* el borde molesto en el form de detalle de la jqgrid antes de los botones de aceptar/cancelar */
                                                    }


                                                    .AltoRenglones tr.jqgrow td /* .ui-jqgrid tr.jqgrow td */ {
                                                        height: 36px; /* jugar entre .AltoRenglones y el style de font de la grilla */
                                                    }
                                                </style>
                                                <table id="Lista" class="scroll separacion AltoRenglones" cellpadding="0" cellspacing="0"
                                                       style="font-size: ; ">
                                                    @*/* jugar entre .AltoRenglones y el style de font de la grilla */*@
                                                </table>
                                            </div>
                                        </div>
                                        @* <div id="ListaPager" class="scroll">
                                            </div>*@
                                        @if (System.Diagnostics.Debugger.IsAttached && false)
                                        {
                                            <input type="button" class="btn btn-small" id="addDataSinPopup" value="+ Agregar"
                                                   onclick="var id;id = Math.ceil(Math.random() * 1000000);$('#Lista').jqGrid('addRowData',id, {});" />
                                        }
                                        <input type="button" class="btn btn-small" id="addData" value="+ Agregar" />
                                        <input type="button" class="btn btn-small" id="edtData" value="Modificar" />
                                        <input type="button" class="btn btn-small" id="delData" value="Borrar" />
                                        <div class="btn-group">
                                            <button class="btn dropdown-toggle btn-small " data-toggle="dropdown">
                                                más <span class="caret "></span>
                                            </button>
                                            <ul class="dropdown-menu ">
                                                @*      <input type="button" class="btn btn-small  pull-right" id="asignarBonif" value="Asignar bonificacion unitario" />
                                                    <input type="button" class="btn btn-small  pull-right" id="asignarIVA" value="Asignar IVA" />
                                                    <input type="button" class="btn btn-small  pull-right" id="asignarPrecio" value="Asignar precio unitario" />
                                                    <input type="button" class="btn btn-small  pull-right" id="asignarPrecio" value="renumerar items" />
                                                    <input type="button" class="btn btn-small  pull-right" id="asignarPrecio" value="duplicar" />
                                                    <input type="button" class="btn btn-small  pull-right" id="asignarPrecio" value="asignar" />*@
                                                <li><a id="asignarBonif" href="#">Asignar bonificacion unitario</a></li>
                                                <li><a id="asignarPrecio" href="#">Asignar precio unitario</a></li>
                                                <li><a id="asignarIVA" href="#">Asignar IVA</a></li>
                                                <li><a id="asignarFechaNecesidad" href="#">Asignar fecha necesidad</a></li>
                                                <li><a id="asignarFechaEntrega" href="#">Asignar fecha entrega</a></li>
                                                <li><a id="Renumerar" href="#">Renumerar items</a></li>
                                                <li><a id="DuplicarItems" href="#">Duplicar</a></li>
                                            </ul>
                                        </div>
                                        <div id="dialog" title="" style="">
                                            <label for="InputFechaEntrega" id="labeldialog">
                                                Fecha de entrega
                                            </label>
                                            <input type="text" id="InputFechaEntrega" value="" />
                                            <script>

                                                $(function () {





                                                    $("#dialog").dialog({
                                                        autoOpen: false,
                                                        modal: true,
                                                        buttons: {
                                                            "Aceptar": function () {
                                                                // $("#nombre").val($("#el_nombre").val);

                                                                PisarFechaEntrega("FechaEntrega");

                                                                $(this).dialog("close");
                                                            },
                                                            "Cerrar": function () {
                                                                $(this).dialog("close");
                                                            }
                                                        }
                                                    });


                                                    function PisarFechaEntrega(nombre) {

                                                        var f = $("#InputFechaEntrega").val();

                                                        var $grid = $("#Lista");
                                                        var righe = $grid.jqGrid("getGridParam", "selarrrow");
                                                        if ((righe == null) || (righe.length == 0)) {
                                                            righe = $grid.jqGrid('getDataIDs');
                                                            // return false;
                                                        }


                                                        for (var i = 0; i < righe.length; i++) {
                                                            var Id = righe[i];

                                                            var rowData = $grid.jqGrid('getRowData', Id);
                                                            rowData[nombre] = f;
                                                            $grid.jqGrid('setRowData', Id, rowData);

                                                        }
                                                    }




                                                    $("#asignarPrecio").click(function () {
                                                        $("#InputFechaEntrega").val('');
                                                        $('[id$=labeldialog]').text("Ingrese el Precio");
                                                        $("#dialog").dialog({
                                                            buttons: {
                                                                "Aceptar": function () {
                                                                    PisarFechaEntrega("Precio");
                                                                    $(this).dialog("close");
                                                                },
                                                                "Cerrar": function () {
                                                                    $(this).dialog("close");
                                                                }
                                                            }
                                                        });
                                                        $("#dialog").dialog("open");
                                                    });


                                                    $("#asignarIVA").click(function () {
                                                        $("#InputFechaEntrega").val('');
                                                        $('[id$=labeldialog]').text("Ingrese el IVA");
                                                        $("#dialog").dialog({
                                                            buttons: {
                                                                "Aceptar": function () {
                                                                    PisarFechaEntrega("PorcentajeIva");
                                                                    $(this).dialog("close");
                                                                },
                                                                "Cerrar": function () {
                                                                    $(this).dialog("close");
                                                                }
                                                            }
                                                        });
                                                        $("#dialog").dialog("open");
                                                    });

                                                    $("#asignarFechaNecesidad").click(function () {
                                                        $("#InputFechaEntrega").val('');
                                                        $('[id$=labeldialog]').text("Ingrese la fecha de necesidad");
                                                        $("#dialog").dialog({
                                                            buttons: {
                                                                "Aceptar": function () {
                                                                    PisarFechaEntrega("FechaNecesidad");
                                                                    $(this).dialog("close");
                                                                },
                                                                "Cerrar": function () {
                                                                    $(this).dialog("close");
                                                                }
                                                            }
                                                        });
                                                        $("#dialog").dialog("open");
                                                    });

                                                    $("#asignarFechaEntrega").click(function () {
                                                        $("#InputFechaEntrega").val('');
                                                        $('[id$=labeldialog]').text("Ingrese la fecha de entrega");
                                                        $("#dialog").dialog({
                                                            buttons: {
                                                                "Aceptar": function () {
                                                                    PisarFechaEntrega("FechaEntrega");
                                                                    $(this).dialog("close");
                                                                },
                                                                "Cerrar": function () {
                                                                    $(this).dialog("close");
                                                                }
                                                            }
                                                        });
                                                        $("#dialog").dialog("open");
                                                    });

                                                    $("#asignarBonif").click(function () {

                                                        $("#InputFechaEntrega").val('');
                                                        $('[id$=labeldialog]').text("Ingrese el porcentaje de bonificacion");
                                                        $("#dialog").dialog({
                                                            buttons: {
                                                                "Aceptar": function () {
                                                                    PisarFechaEntrega("PorcentajeBonificacion");
                                                                    $(this).dialog("close");
                                                                },
                                                                "Cerrar": function () {
                                                                    $(this).dialog("close");
                                                                }
                                                            }
                                                        });
                                                        $("#dialog").dialog("open");

                                                    });





                                                    $("#DuplicarItems").click(function () {

                                                        var $grid = $("#Lista");

                                                        var rowid = $grid.jqGrid('getGridParam', 'selrow');
                                                        var rowdata = $('#Lista').jqGrid('saveRow', rowid);



                                                        copyData = $grid.jqGrid('getRowData', rowid);
                                                        copyData['field_id'] = '';
                                                        copyData['NumeroItem'] = $grid.getGridParam("reccount") + 1;
                                                        $grid.jqGrid('addRowData', '', copyData);

                                                        renumerar();


                                                    });


                                                    $("#Renumerar").click(function () {

                                                        renumerar();
                                                    });


                                                    function renumerar() {
                                                        var $grid = $("#Lista");

                                                        var righe = $grid.jqGrid('getDataIDs');

                                                        for (var i = 0; i < righe.length; i++) {
                                                            var Id = righe[i];

                                                            var rowData = $grid.jqGrid('getRowData', Id);
                                                            rowData['NumeroItem'] = i + 1;
                                                            $grid.jqGrid('setRowData', Id, rowData);

                                                        }
                                                    }

                                                });

                                            </script>
                                        </div>
                                        <style>
                                            tr.jqgrow > td.textInDiv > div {
                                                max-height: 20px;
                                                overflow: auto;
                                            }

                                            td.form-view-data > span > div {
                                                max-height: 150px;
                                                overflow: auto;
                                            }
                                        </style>
                                        @*<input type="button" class="btn btn-small" id="" value="Buscar" onclick="conmutarPanelesDerecho();   pageLayout.hide('south'); pageLayout.hide('north'); RefrescaAnchoGrillaDetalle();" />*@
                                        <br />
                                        <br />
                                        <div class="row-fluid">
                                            <div class="span6 lightblue">
                                                <div class="row-fluid">
                                                    <div class="span12 lightblue">
                                                        @Html.LabelFor(model => model.Observaciones)
                                                        @Html.TextAreaFor(model => model.Observaciones, new { @class = "span12", @style = "height: 100px" })
                                                        @Html.ValidationMessageFor(model => model.Observaciones)
                                                    </div>
                                                    <!--/span-->
                                                </div>
                                            </div>
                                            <div class="span6 lightblue">
                                                <style>
                                                    .subtotales input {
                                                        /*height: 16px;*/
                                                        min-height: 18px !important;
                                                        line-height: 18px;
                                                        padding: 0;
                                                        margin: 0;
                                                        font-size: 10px;
                                                    }

                                                        .subtotales input[readonly] {
                                                            background: transparent;
                                                            border: 0;
                                                        }

                                                    .subtotales select {
                                                        /* height : 16px; */
                                                        min-height: 18px !important;
                                                        line-height: 18px;
                                                        padding: 0;
                                                        margin: 0;
                                                        font-size: 10px;
                                                    }

                                                    table td {
                                                        padding: 0px;
                                                        border: solid 1px;
                                                        border-color: transparent;
                                                    }
                                                </style>
                                                <table id="Totales" class="subtotales span12" width="" border="0" cellspacing="0"
                                                       cellpadding="0" style="margin: 0px 0px 0px 0px; height: ; padding: 0px; border-style: none;
                                                border-width: thin; border-spacing: 0px; font-size: xx-small">
                                                    <tr class="">
                                                        <td width="100" colspan="2">
                                                            SUBTOTAL
                                                        </td>
                                                        <td width="100" align="">
                                                            <input type="text" name="Subtotal1" id="Subtotal1" style="width: 85%; text-align: right;"
                                                                   readonly="readonly" />
                                                        </td>
                                                        <td width="100" class="subtotales">
                                                            MONEDA
                                                        </td>
                                                        <td width="100" style="height: 15px; line-height: 14px;" class="">
                                                            @Html.DropDownList("IdMoneda", null, "",
                            new { @class = "span12 ", @style = "height: 15px;   line-height: 14px;" })
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td width="100" colspan="2">
                                                            BONIFICACION ITEMS
                                                        </td>
                                                        <td width="100">
                                                            <input type="text" name="TotalBonificacionItems" id="TotalBonificacionItems" style="width: 85%;
                                                            text-align: right;" readonly="readonly" />
                                                        </td>
                                                        <td width="100">
                                                            CONV.PESOS
                                                        </td>
                                                        <td width="100">
                                                            @Html.TextBoxFor(model => model.CotizacionMoneda, new { @class = "span12 subtotales" })
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td width="100">
                                                            BONIF GLOBAL
                                                        </td>
                                                        <td width="100" class="span2 subtotales">
                                                            @Html.TextBoxFor(model => model.PorcentajeBonificacion, new { @class = "span8 subtotales" })
                                                            <script>
                                                                $("#PorcentajeBonificacion").change(function () { calculateTotal(); });
                                                                $("#PorcentajeBonificacion").keyup(function () { calculateTotal(); });
                                                            </script>
                                                        </td>
                                                        <td width="100">
                                                            <input type="text" name="TotalBonificacionGlobal" id="TotalBonificacionGlobal" style="width: 85%;
                                                            text-align: right;" readonly="readonly" />
                                                        </td>
                                                        <td width="100">
                                                            COTIZ DOLAR
                                                        </td>
                                                        <td width="100">
                                                            @Html.TextBoxFor(model => model.CotizacionDolar, new { @class = "span12 subtotales" })
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td width="100" colspan="2">
                                                            SUBTOTAL
                                                        </td>
                                                        <td width="100">
                                                            <input type="text" name="Subtotal2" id="Subtotal2" style="width: 85%; text-align: right;"
                                                                   readonly="readonly" />
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td width="100" colspan="2">
                                                            IVA
                                                        </td>
                                                        <td width="100">
                                                            <input type="text" name="TotalIva" id="TotalIva" style="width: 85%; text-align: right;"
                                                                   readonly="readonly" />
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td width="100" colspan="2">
                                                            TOTAL
                                                        </td>
                                                        <td width="100">
                                                            <input type="text" name="Total" id="Total" style="width: 85%; text-align: right;"
                                                                   readonly="readonly" />
                                                        </td>
                                                    </tr>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <br />
                    <div class="accordion" id="accordion4">
                        <div class="accordion-group accordion-caret " style="border: 0px; padding: 0px;">
                            <div class="accordion-heading" style="border: 0px; padding: 0px;">
                                <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion4" href="#collapseAdicionales"
                                   style="border: 0px; padding: 0px; color: #9C0000; font-size: 12px">
                                    DATOS ADICIONALES...
                                </a>
                            </div>
                            <div id="collapseAdicionales" class="accordion-body collapse" style="border: 0px;
                            padding: 0px;">
                                @*si pones "collapse in" empieza abierto*@
                                <div class="accordion-inner" style="border: 0px; padding: 0px;">
                                    <br />
                                    <div class="row-fluid">
                                        <div class="span6 lightblue">
                                            @*@Html.CheckBox("ImprimeImportante", true, new { @class = "" })*@
                                            @Html.RadioButtonFor(model => model.ImprimeImportante, "SI") SI
                                            @Html.RadioButtonFor(model => model.ImprimeImportante, "NO") NO @*  @Html.CheckBoxStringFor(e => e.ImprimeImportante)*@
                                            @Html.LabelFor(model => model.Importante, "0 Importante")
                                            @Html.TextAreaFor(model => model.Importante, new { @class = "span12" })
                                            @Html.ValidationMessageFor(model => model.Importante)
                                        </div>
                                        <div class="span6 lightblue">
                                            @*   @Html.CheckBox("ImprimePlazoEntrega", true, new { @class = "" })*@
                                            @Html.RadioButtonFor(model => model.ImprimePlazoEntrega, "SI") SI
                                            @Html.RadioButtonFor(model => model.ImprimePlazoEntrega, "NO") NO
                                            @Html.LabelFor(model => model.PlazoEntrega, "1 Plazo Entrega")
                                            @Html.TextAreaFor(model => model.PlazoEntrega, new { @class = "span12" })
                                            @Html.ValidationMessageFor(model => model.Aprobo)
                                        </div>
                                    </div>
                                    <div class="row-fluid">
                                        <div class="span6 lightblue">
                                            @Html.RadioButtonFor(model => model.ImprimeLugarEntrega, "SI") SI
                                            @Html.RadioButtonFor(model => model.ImprimeLugarEntrega, "NO") NO
                                            @Html.LabelFor(model => model.LugarEntrega, "2 Lugar de entrega")
                                            @Html.TextAreaFor(model => model.LugarEntrega, new { @class = "span12" })
                                            @Html.ValidationMessageFor(model => model.Aprobo)
                                        </div>
                                        <div class="span6 lightblue">
                                            @Html.RadioButtonFor(model => model.ImprimeFormaPago, "SI") SI
                                            @Html.RadioButtonFor(model => model.ImprimeFormaPago, "NO") NO
                                            @Html.LabelFor(model => model.FormaPago, "3 Forma de pago")
                                            @Html.TextAreaFor(model => model.FormaPago, new { @class = "span12" })
                                            @Html.ValidationMessageFor(model => model.Aprobo)
                                        </div>
                                    </div>
                                    <div class="row-fluid">
                                        <div class="span6 lightblue">
                                            @Html.RadioButtonFor(model => model.ImprimeImputaciones, "SI") SI
                                            @Html.RadioButtonFor(model => model.ImprimeImputaciones, "NO") NO
                                            @Html.LabelFor(model => model.FormaPago, "4-Imputacion contable ")
                                            @Html.TextArea("Imputacion", new { @class = "span12" })
                                        </div>
                                        <div class="span6 lightblue">
                                            @Html.RadioButtonFor(model => model.ImprimeInspecciones, "SI") SI
                                            @Html.RadioButtonFor(model => model.ImprimeInspecciones, "NO") NO
                                            @Html.LabelFor(model => model.FormaPago, "5-Inspecciones")
                                            @Html.TextArea("Inspecciones", new { @class = "span12" })
                                        </div>
                                    </div>
                                    <div class="row-fluid">
                                        <div class="span6 lightblue">
                                            @Html.RadioButtonFor(model => model.ImprimeGarantia, "SI") SI
                                            @Html.RadioButtonFor(model => model.ImprimeGarantia, "NO") NO
                                            @Html.LabelFor(model => model.Garantia, "6 Garantia  ")
                                            @Html.TextAreaFor(model => model.Garantia, new { @class = "span12" })
                                            @Html.ValidationMessageFor(model => model.Aprobo)
                                        </div>
                                        <div class="span6 lightblue">
                                            @Html.RadioButtonFor(model => model.ImprimeDocumentacion, "SI") SI
                                            @Html.RadioButtonFor(model => model.ImprimeDocumentacion, "NO") NO
                                            @Html.LabelFor(model => model.Documentacion, "7 Documentacion")
                                            @Html.TextAreaFor(model => model.Documentacion, new { @class = "span12" })
                                            @Html.ValidationMessageFor(model => model.Documentacion)
                                        </div>
                                    </div>
                                    <div class="row-fluid">
                                        <div class="span6 lightblue">
                                            @Html.LabelFor(model => model.FormaPago, " 8 Clausula u$s ")
                                            @Html.TextArea("Clausula", new { @class = "span12" })
                                        </div>
                                        <div class="span6 lightblue">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    @* "row-fluid navbar navbar-fixed-bottom background: rgba(234, 234, 234, 0.84);" *@
                </div>
                <div id="pie" style="position: absolute; bottom: -26px; background: rgb(236, 236, 236);
                width: 100%; height: 68px; padding-left: 0; margin-right: 15px;">
                    <hr style="margin: 0; border-top-color: #D8D4D4; border-bottom: 0px solid #ffffff;" />
                    <div class="row-fluid " style="padding: 11px 0px 0px 0px">
                        <div class="span3 pull-left">
                            <div>
                                @if ((TempData["Alerta"] ?? "").ToString().Contains("Grabado"))
                                {
                                    <div class="alert fade in span12  alert-success" id="mensajeAlerta" style="display: none;
                                    font-size: small; height: 30px; overflow: hidden;">
                                        @*                            <button type="button" class="close" style="height: 40px; width: 40px; font-size: x-large;">
                                            &times;</button>*@ << @Html.Raw(TempData["Alerta"].ToString())
                                            @*@TempData["Alerta"].NullSafeToString()*@
                                        </div>
                                }
                            </div>
                        </div>
                        <div class="span8">
                            <span>
                                @Html.ActionLink("Volver al listado", "Index", null, new { @class = "btn btn-link  pull-right" })
                            </span>
                            @if (Model.FechaAnulacion == null)
                            {

                                if (Model.IdPedido <= 0)
                                {
                                }
                                else
                                {

                                    if (Model.Aprobo != null)
                                    {
                                        <div class="btn-group dropup">
                                            <a class="btn  btn-large" style="color: Black" href="@Url.Action("Imprimir", new { @id = Model.IdPedido })">
                                                <i class="icon-print"></i>&nbsp;Imprimir
                                            </a>
                                            <button class="btn dropdown-toggle btn-large" data-toggle="dropdown">
                                                <span class="caret "></span>
                                            </button>
                                            <ul class="dropdown-menu ">
                                                <li>
                                                    <a class="" href="@Url.Action("Imprimir", new { @id = Model.IdPedido, @bAgruparItems = true })">
                                                        <i class="icon-print"></i>&nbsp;Agrupar items
                                                    </a>
                                                </li>
                                            </ul>
                                        </div>
                                    }

                                    if (false)
                                    {
                                        <a id="anular2" class="btn btn-link " style="color: Black" href="@Url.Action("Anular", new { @id = Model.IdPedido })">
                                            <i class=""></i>&nbsp;Anular orig
                                        </a>
                                    }


                                    <input type="button" id="anular" value="Anular" class="btn btn-large pull-right" />
                                    <script>


                                        $(function () {
                                            $("#anular").click(function () {

                                                // http://bdlconsultores.dyndns.org/Consultas/Admin/verConsultas1.php?recordid=10950



                                                $("#dialog-password").dialog({
                                                    buttons: {
                                                        'Aceptar': function () {
                                                            //alert('hola');
                                                            // $(this).dialog('close');
                                                            // http://stackoverflow.com/questions/1031674/how-do-i-write-a-jquery-function-that-accepts-a-callback-as-a-parameter
                                                            //                                                    validatePwd2(anularfirma, function () { });
                                                            //                                                    $(this).dialog('close');

                                                            window.location.href = ROOT + 'Pedido/Anular/' + $("#IdPedido").val();
                                                        },
                                                        'Cancelar': function () {
                                                            $(this).dialog('close');
                                                        }
                                                    },
                                                    open: function () {

                                                    }
                                                });

                                                //                                    $("#Aux1").val("");
                                                //                                    $("#Aux2").val("");
                                                //                                    $("#Aux3").val("");
                                                //                                    $("#Aux10").val("anularPED");
                                                $('#dialog-password').dialog('open');
                                                $('#mySelect').prop("disabled", false);


                                                CargarUsuariosConPermisoDeAnulacion();

                                            });










                                            function CargarUsuariosConPermisoDeAnulacion() {
                                                var combo = $("#mySelect")
                                                combo.find("option:gt(0)").remove();
                                                combo.find("option:first").text("Cargando...");

                                                $.getJSON(ROOT + 'Articulo/GetStoreProc?sp=Empleados_TX_ParaAnularPorFormulario&p1=4', {
                                                    //country_id: $(this).val()
                                                }, function (json) {
                                                    combo.find("option:first").text("");
                                                    for (var i = 0; i < json.length; i++) {
                                                        $("<option/>").attr("value", json[i].value).text(json[i].title).appendTo(combo);
                                                    }
                                                });

                                            }


                                        })
                                    </script>
                                }

                                if (Model.Aprobo == null)
                                {

                                    <input type="button" id="grabar2" value="Aceptar" class="btn  btn-large btn-primary   pull-right " />
                                }
                                else
                                {
                                    <span class="label label-info">Liberado</span>

                                }

                            }
                            else
                            {
                                <span class="label error-info">ANULADA</span>
                                <script>
                                    $(function () {
                                        deshabilitar();
                                    })
                                </script>
                            }
                        </div>
                        <div class="span1">
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>
    <!--/.fluid-container-->
                                                    <script type="text/javascript">


                                                        $(window).resize(function () {
                                                            RefrescaAnchoGrillaDetalle();

                                                            $("#conscroll").height($(window).height() - 120);
                                                        });



                                                        function RefrescaAnchoGrillaDetalle() {
                                                            // $("#Lista").setGridWidth($(window).width());
                                                            // la zona de drop se te complica si estas arrastrando un renglon muy largo de una grilla ancha sobre una grilla angosta

                                                            $("#Lista").setGridWidth($("#divGrilla").width());

                                                            //        $("#ListaDrag").setGridWidth(jQuery("#ListaDrag").parent().width());
                                                            //        $("#ListaDrag2").setGridWidth(jQuery("#ListaDrag").parent().width());
                                                        }


                                                        $(function () {


                                                            //            $("body").on({
                                                            //                ajaxStart: function () {
                                                            //                    $(this).addClass("loading");
                                                            //                },
                                                            //                ajaxStop: function () {
                                                            //                    $(this).removeClass("loading");
                                                            //                }
                                                            //            });


                                                            var OrigenDescripcionDefault = 0; // ViewBag.OrigenDescripcionDefault








                                                            // vuelvo a llenar el mySelect (se hace por primera vez en el Layout) porque no sé qué pasa que algo me lo vacía
                                                            $.post(ROOT + 'Empleado/EmpleadosParaComboSectorCompras/',
                                                            function (data) {
                                                                var select = $('#mySelect').empty();
                                                                for (var i = 0; i < data.length; i++) {
                                                                    select.append('<option value="' + data[i].IdEmpleado + '">' + data[i].Nombre + '</option>');
                                                                }
                                                            }, "json");



                                                            $.ajax({
                                                                type: "GET",
                                                                contentType: "application/json; charset=utf-8",
                                                                url: ROOT + 'Pedido/Autorizaciones/',
                                                                data: { IdPedido: $("#IdPedido").val() },
                                                                dataType: "Json",
                                                                success: function (data) {
                                                                    for (var i = 0; i < data.length; i++) {
                                                                        var j = i + 1;
                                                                        $("#chk" + j).attr('checked', true);
                                                                        $("#chk" + j).attr('title', data[i].Nombre);
                                                                    }


                                                                }
                                                            });
                                                            Aprobado();

                                                            function Aprobado() {
                                                                if ($('#Aprobo').val() != "") {
                                                                    //if ($('#FechaAprobacion').val() != null) {
                                                                    $("#chk0").attr('checked', true);
                                                                    var Aprobo = $("#Aprobo > option:selected").html();
                                                                    $("#chk0").attr('title', Aprobo);
                                                                }
                                                                else {
                                                                    $("#chk0").attr('checked', false);
                                                                    $("#chk0").attr('title', "");
                                                                }
                                                            }








                                                            $(function () {

                                                                if ($("#Aprobo").val() > 0 || $("#FechaAnulacion").val() > 0) {
                                                                    //si está aprobada, bloqueo los controles y la grilla
                                                                    deshabilitar();
                                                                }


                                                                pageLayout.hide('south');
                                                                //pageLayout.show('south');


                                                            });


                                                        })
                                                    </script>
                                                    }