@model ProntoMVC.Models.Requerimiento
@{
    ViewBag.Title = "Requerimiento " + ((Model.IdRequerimiento == -1) ? "Nuevo" : Model.NumeroRequerimiento.NullSafeToString()); ;
}
@using (Html.BeginForm(null, null, FormMethod.Post, new { id = "formid" }))
{
    @Html.ValidationSummary(true)
    

    <!--/.fluid-container-->
    <script type="text/javascript">
        var OrigenDescripcionDefault = @ViewBag.OrigenDescripcionDefault 
        // http://stackoverflow.com/questions/10389649/possible-to-access-mvc-viewbag-object-from-javascript-file
       
    </script>
    <script src="@Url.Content("~/Scripts/ScriptRequerimiento.js?1518")"  type="text/javascript"></script>       @*aparentemente tengo que llamarla despues de cargar las div*@

    <div class="container-fluid">
        <div class="modal" id="loading">
            <img  src="@Url.Content("~/Content/images/fhhrx.gif")"  style="margin-right: 5px;" />
            Cargando...
        </div>
        <style>
            .container-fluid
            {
                padding-left: 15px; /*    margin-right: 15px; */
            }
        </style>
        <style>
            .ui-jqgrid tr.footrow-ltr td
            {
                border-right-color: transparent !important;
                border: 0 transparent !important;
            }
        </style>
        @if (false)
        {
    
            
            <style>
                /* jqGrid builds some additional divs over the main grid table. The outer div has the class ui-jqgrid. So if you need to remove right and left border existing over the whole grid you can use the following CSS: */
                
                .ui-jqgrid
                {
                    border-right-width: 0px;
                    border-left-width: 0px;
                }
                /* If you need to remove all grid's borders you can use

.ui-jqgrid { border-width: 0px; }
If you want additionally remove vertical border between the cells in the grid you can use */
                
                .ui-jqgrid tr.ui-row-ltr td
                {
                    /* border-right-color: transparent; */
                    border-right-color: #E4E4E4;
                }
                
                
                
                
                /*To remove horizontal border between the rows you can use */
                
                .ui-jqgrid tr.ui-row-ltr td
                {
                    /* border-right-color: transparent; */
                    border-right-color: #E4E4E4;
                }
                /*To remove vertical borders between the column headers you can use */
                
                th.ui-th-column
                {
                    /*    border-right-color: transparent !important; */
                    border-right-color: rgb(234, 234, 234) !important;
                }
                /* or alternatively (without the usage of !important) */
                
                .ui-jqgrid-labels .ui-th-column
                {
                    /* border-right-color: transparent;*/
                    border-right-color: #E4E4E4;
                }
            </style>
        }
        <style>
            /*  http://stackoverflow.com/questions/13103544/how-to-restrict-jqgrid-textarea-height-in-grid-only */
            tr.jqgrow > td.textInDiv > div
            {
                max-height: 30px;
                height: 30px;
                overflow: auto;
            }
            td.form-view-data > span > div
            {
                max-height: 30px;
                height: 30px;
                overflow: auto;
            }
        </style>
        <form class="form-horizontal">
        <div id="cuerposinpie" class=""  style="padding-bottom:2px;  "  @*Height of the footer *@ >
            <br />
            @*    <legend>Requerimiento</legend>*@
            <div>@Html.Hidden("IdRequerimiento", Model.IdRequerimiento)</div>
            <div>@Html.Hidden("Cumplido", Model.Cumplido)</div>
            <div>@Html.Hidden("FechaAnulacion", Model.FechaAnulacion)</div>
            <div>@Html.Hidden("UsuarioAnulacion", Model.UsuarioAnulacion)</div>
            <div>@Html.Hidden("MotivoAnulacion", Model.MotivoAnulacion)</div>
            <div>@Html.Hidden("NumeroRequerimiento", Model.NumeroRequerimiento)</div>
            @*<div class="row-fluid">
                <div class="span12 bgcolor">
                    <div class="alert alert-error">
                        <a href="#" class="close" data-dismiss="alert">×</a>
                        Error Messages.
                    </div>
                </div>
            </div>   *@
            <div class="row-fluid" style="">
                @*            <div class="" style='font-size: 34px; height: 40px; font-family: "Segoe UI Web Regular", "Segoe UI", "Lucida", Tahoma, Arial,"sans-serif"'>
*@
                <div class="" style='font-size: 34px; margin-top: 5px; height: 45px; font-weight: 500;
                    text-shadow: 0 1px 0  lightgray; font-family: "Segoe UI Web Regular", "Segoe UI", "Lucida", Tahoma, Arial,"sans-serif"'>
                    Requerimiento
                    @Html.DisplayFor(model => model.NumeroRequerimiento, new { style = "height: 45px ; font-weight: bold; font-size: 34px; border: 0; padding: 0; background: transparent;", @class = "", @readonly = "readonly" })
                    @*@Html.TextBoxFor(model => model.NumeroRequerimiento, new { style = "height: 45px ; font-weight: bold; font-size: 34px; border: 0; padding: 0; background: transparent;", @class = "", @readonly = "readonly" })*@
                </div>
            </div>
            <div class="row-fluid">
                <div class="span3 lightblue">
                    @Html.LabelFor(model => model.FechaRequerimiento, "Fecha")
                    @* @Html.TextBoxFor(model => model.FechaRequerimiento, new Dictionary<string, object> { { "class", "span12" }, { "placeholder", "dd/mm/yyyy" } })*@
                    @Html.TextBox("FechaRequerimiento", Model.FechaRequerimiento.GetValueOrDefault().ToString("dd/MM/yyyy"), new Dictionary<string, object> { { "class", "span12" }, { "placeholder", "dd/mm/yyyy" } })
                    @*, { "type", "date" }, { "data-datepicker", "datepicker" }*@
                    @Html.ValidationMessageFor(model => model.FechaRequerimiento)
                </div>
                <!--/span-->
                <div class="span6 lightblue">
                    @Html.Hidden("IdObra", Model.IdObra)
                    @Html.LabelFor(model => model.IdObra, "Obra")
                    @*                @Html.DropDownList("IdObra", null, "", new { @class = "span12" })*@
                    @Html.TextBoxFor(m => m.Obra.Descripcion, new { id = "DescripcionObra", @class = "span12" })
                    @Html.ValidationMessageFor(model => model.IdObra)
                    <script type="text/jscript">




                        $("#DescripcionObra").autocomplete({
                            source: '@Url.Action("GetObrasAutocomplete2", "Articulo")',
                            minLength: 0,
                            messages: { noResults: "", results: function () { } },
                            select: proveedorSeleccionado,
                            autoFocus: true

                        });


                        function proveedorSeleccionado(event, ui) {

                            ActualizarObra(ui.item);
                            ///////////////////////
                            event.preventDefault();
                        }

                        function ActualizarObra(item) {
                            $("#IdObra").val(item.id);
                            //                        $("#CodigoProveedor").val(item.codigo || "");
                            $("#DescripcionObra").val(item.value || "");
                            //                        $("#IdCodigoIva").val(item.idCodigoIva);
                        }


                    </script>
                </div>
                <!--/span-->
                <div class="span3 lightblue">
                    @Html.LabelFor(model => model.IdSector, "Sector")
                    @Html.DropDownList("IdSector", null, "", new { @class = "span12" })
                    @Html.ValidationMessageFor(model => model.IdSector)
                </div>
            </div>
            <!--/row-->
            <div class="row-fluid">
                <div class="span3 lightblue">
                    @Html.LabelFor(model => model.IdSolicito, "Solicitó")
                    @Html.DropDownList("IdSolicito", null, new { @class = "span12" })
                    @Html.ValidationMessageFor(model => model.IdSolicito)
                </div>
                <!--/span-->
                <div class="span9 lightblue">
                    @Html.LabelFor(model => model.LugarEntrega, "Lugar de entrega")
                    @Html.TextBoxFor(model => model.LugarEntrega, new { @class = "span12" })
                    @Html.ValidationMessageFor(model => model.LugarEntrega)
                </div>
                <!--/span-->
            </div>
            <!--/row-->
            <div class="row-fluid">
                <div class="span3
        lightblue">
                    @Html.LabelFor(model => model.Aprobo, "Aprobó")
                    @Html.DropDownList("Aprobo", null, "", new { @class = "span12" })
                    @Html.ValidationMessageFor(model => model.Aprobo)
                </div>
                <!--/span-->
                <div class="span2 lightblue">
                    @Html.Label("Autorizaciones")
                    <form>
                    @{ 
               
        // con jquery se llama despues a  "Requerimiento/Autorizaciones" para tildar y a Aprobado() para el primer check
                        <input type="checkbox" id="chk0" readonly="readonly" disabled="disabled" class="GridCheckBox"
                            title="" />

        int ca = @ViewBag.CantidadAutorizaciones;

        int j = 1;
        for (var i = 1; i <= ca; i++)
        { <input type="checkbox" id="chk@(i)" readonly="readonly"  disabled="disabled" class="GridCheckBox" title="" /> }
                    }
                    </form>
                </div>
                <div class="span7 lightblue">
                    @Html.LabelFor(model => model.Detalle)
                    @Html.TextBoxFor(model => model.Detalle, new { @class = "span12" })
                    @Html.ValidationMessageFor(model => model.Detalle)
                </div>
                <!--/span-->
            </div>
            <!--/row-->
            <div class="row-fluid">
                <!--/span-->
            </div>
            <!--/row-->
            <div id="RManulada" class="row-fluid" style="display: none; font-weight: bold; background-color: red">
            </div>
            <br />
            <div class="row-fluid">
                <div id="divGrilla" class="span12 lightblue" style="padding-left: 0px; padding-right: 2px;
                    min-height: 150px">
                    <style>
                        .ui-jqdialog td
                        {
                            border: 0px !important;
                        }
                        .ui-jqdialog table
                        {
                            border: 0px !important;
                        }
                        
                        .ui-jqdialog .ui-jqdialog-titlebar
                        {
                            padding: 0;
                            position: relative;
                        }
                        
                        .ui-jqdialog-titlebar
                        {
                            height: 15px;
                        }
                        .ui-jqdialog button
                        {
                        }
                        /* http://stackoverflow.com/questions/14954587/jqgrid-for-twitter-bootstrap
        */input.ui-pg-input
                        {
                            width: auto;
                            padding: 0px;
                            margin: 0px;
                            line-height: normal;
                        }
                        select.ui-pg-selbox
                        {
                            width: auto;
                            padding: 0px;
                            margin: 0px;
                            line-height: normal;
                        }
                        .ui-widget select
                        {
                            margin-bottom: 0px !important; /* para que en la edicion inline
        de la grilla no me haga mas alto el renglon */
                        }
                        .ui-widget-content button
                        {
                            background: rgb(231, 231, 231);
                            color: black !important;
                        }
                        .ui-jqgrid tr.footrow-ltr
                        {
                            font-size: 9px;
                        }
                        .AltoRenglones tr.jqgrow td /* .ui-jqgrid tr.jqgrow td */
                        {
                            height: 32px;
                        }
                        .ui-jqgrid tr.ui-row-ltr td
                        {
                            /* lineas de las grillas verticales*/ /*
                            border-right-style: none; 
                            border-left-style: none;
                            */
                        }
                        .ui-icon, .ui-widget-content .ui-icon
                        {
                            /* background-image:
        none; */
                        }
                    </style>
                    <table id="Lista" class="scroll separacion AltoRenglones" cellpadding="0" cellspacing="0"
                        style="font-size: 20px; font-family: 'Helvetica Narrow', 'Arial Narrow', Tahoma, Arial, Helvetica, sans-serif;">
                        @*/* jugar entre .AltoRenglones y el style de font de la grilla */*@
                    </table>
                    <div id="ListaPager" class="scroll">
                    </div>
                    <input type="button" class="btn btn-small" id="addData" value="+ Agregar" />
                    <input type="button" class="btn btn-small" id="edtData" value="Modificar" />
                    <input type="button" class="btn btn-small" id="delData" value="Borrar" />
                    <input type="button" class="btn btn-small pull-right" id="" value="Buscar" onclick="conmutarPanelesDerecho();  pageLayout.hide('south'); pageLayout.hide('north'); RefrescaAnchoGrillaDetalle();" />&nbsp;
                    <input type="button" class="btn btn-small  pull-right" id="asignarNecesidad" value="Asignar fecha" />&nbsp;
                    @*<input type="button" class="btn btn-small  pull-right" id="duplicar" value="Duplicar" />*@
                </div>
                <div id="dialog" title="">
                    Fecha de entrega
                    <input type="text" id="InputFechaEntrega" value="" />
                    <script>




                        $(function () {


                            $("#dialog").dialog({
                                autoOpen: false,
                                modal: true,
                                buttons: {
                                    "Aceptar": function () {
                                        // $("#nombre").val($("#el_nombre").val);
                                        var f = $("#InputFechaEntrega").val();


                                        var $grid = $("#Lista");
                                        var righe = $grid.jqGrid("getGridParam", "selarrrow");

                                        //                                            selRowIds.each(function (id1, id2) {
                                        //                                                return rows.namedItem(id1).rowIndex - rows.namedItem(id2).rowIndex;

                                        //                                                var data = $(nomeGrigliaFiglia).jqGrid('getRowData', Id);
                                        //                                            })


                                        if ((righe == null) || (righe.length == 0)) {
                                            return false;
                                        }


                                        for (var i = 0; i < righe.length; i++) {
                                            var Id = righe[i];

                                            var rowData = $grid.jqGrid('getRowData', Id);
                                            rowData.FechaEntrega = f;
                                            $grid.jqGrid('setRowData', Id, rowData);

                                        }






                                        $(this).dialog("close");
                                    },
                                    "Cerrar": function () {
                                        $(this).dialog("close");
                                    }
                                }
                            });



                            $("#asignarNecesidad").click(function () {

                                var $grid = $("#Lista");
                                var righe = $grid.jqGrid("getGridParam", "selarrrow");

                                if ((righe == null) || (righe.length == 0)) {
                                    righe = $grid.jqGrid('getDataIDs');
                                    //                                    alert("No elegiste items");
                                    //                                    return false;
                                }

                                // $("#InputFechaEntrega").val();
                                initDateEdit($("#InputFechaEntrega"));

                                $("#dialog").dialog("option", "width", 600);
                                $("#dialog").dialog("option", "height", 300);
                                $("#dialog").dialog("option", "resizable", false);
                                $("#dialog").dialog("open");

                            });


                        });

                    </script>
                </div>
            </div>
            <br />
            <div class="row-fluid" id="Totales">
                <div class="span6 lightblue">
                    @Html.LabelFor(model => model.Observaciones)
                    @Html.TextAreaFor(model => model.Observaciones, new { @class = "span12", @style = "height: 100px" })
                    @Html.ValidationMessageFor(model => model.Observaciones)
                </div>
            </div>
            <div class="row-fluid">
                @*style="background: rgba(234, 234, 234, 0.84); border: 1px solid lightgray;  height: 54px; padding-top: 2px;"*@
                <div class="span6 pull-right">
                    @if (Model.Cumplido != "SI")
                    {
                        <input type="button" id="grabar2" value="Aceptar" class="btn btn-large btn-primary" />
                        <input type="button" id="anular" value="Anular" class="btn btn-large " />
                    }
                    @if (Model.IdRequerimiento <= 0)
                    {

                    }
                    else
                    {
                        //btn-link
                        <a class="btn btn-large " style="color: Black" href="@Url.Action("Imprimir", new { @id = Model.IdRequerimiento })">
                            <i class="icon-print"></i>&nbsp;Imprimir</a>
                            
                    }
                    @Html.ActionLink("Volver al listado", "Index", null, new { @class = "btn btn-link" })
                </div>
            </div>
        </div>
        </form>
    </div>
   
    <script type="text/javascript">
        //    function theimage(){
        //     var filename = document.getElementById('file-id').value;
        //     document.getElementById('file-path').value = filename;
        //     var filename1 = $('#file-id').next().val();
        //     alert(filename);
        //    }

        $(window).resize(function () {
            RefrescaAnchoGrillaDetalle();
        });




        function RefrescaAnchoGrillaDetalle() {
            // $("#Lista").setGridWidth($(window).width());
            // la zona de drop se te complica si estas arrastrando un renglon muy largo de una grilla ancha sobre una grilla angosta

            $("#Lista").setGridWidth($("#divGrilla").width());

            //        $("#ListaDrag").setGridWidth(jQuery("#ListaDrag").parent().width());
            //        $("#ListaDrag2").setGridWidth(jQuery("#ListaDrag").parent().width());
        }






        $(function () {



            pageLayout.hide('south');
            //pageLayout.show('south');


        });

    </script>
}